Project Code Dump generated on: 2026-02-18 15:35:24
==================================================
10 files included:
--------------------
frontend\src\domains\meta_v2\features\dictionary\DictionaryTool.tsx
frontend\src\domains\meta_v2\features\dictionary\components\AttributeEditor.tsx
frontend\src\domains\meta_v2\features\dictionary\components\AttributeExplorer.tsx
frontend\src\domains\meta_v2\features\dictionary\components\editor\ConfigPanels.tsx
frontend\src\domains\meta_v2\features\dictionary\components\editor\PreviewPanel.tsx
frontend\src\domains\meta_v2\features\dictionary\hooks\useDictionary.ts
frontend\src\domains\meta_v2\features\dictionary\logic\schemaNormalizer.ts
frontend\src\domains\meta_v2\features\dictionary\types\constants.ts
frontend\src\domains\meta_v2\features\dictionary\types\index.ts
frontend\src\domains\meta_v2\features\dictionary\types\types.ts

==================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\DictionaryTool.tsx
-----------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/DictionaryTool.tsx
   2 | // @file: Dictionary Tool (V2 Adapter)
   3 | // @role: ðŸ§© Feature Container */
   4 | // @author: The Engineer
   5 | // @description: The V2-Native wrapper for the Data Dictionary.
   6 | // Fully decoupled from V1.
   7 | 
   8 | // @security-level: LEVEL 9 (UI Safe) */
   9 | 
  10 | import React, { useMemo, useState, useEffect } from 'react';
  11 | import { Layout, Typography, theme, Button, Space, Spin, Empty } from 'antd';
  12 | import { ArrowLeftOutlined, ReloadOutlined, PlusOutlined, MenuUnfoldOutlined, MenuFoldOutlined } from '@ant-design/icons';
  13 | import { useNavigate, useSearchParams, useParams } from 'react-router-dom';
  14 | 
  15 | // âš¡ LOCAL V2 IMPORTS
  16 | import { useDictionary } from './hooks/useDictionary';
  17 | import { AttributeExplorer } from './components/AttributeExplorer';
  18 | import { AttributeEditor } from './components/AttributeEditor';
  19 | import { AttributeDraft } from './types/types'; 
  20 | import { AttributeType, WidgetType } from './types/constants';
  21 | 
  22 | import { logger } from '@/platform/logging';
  23 | import { useKernel } from '../../_kernel/KernelContext';
  24 | 
  25 | const { Content, Sider } = Layout;
  26 | const { Title } = Typography;
  27 | 
  28 | // âš¡ DEFAULT DRAFT STATE
  29 | const FRESH_DRAFT: AttributeDraft = {
  30 |     key: "",
  31 |     label: "",
  32 |     data_type: AttributeType.TEXT,
  33 |     widget_type: WidgetType.INPUT,
  34 |     is_system: false,
  35 |     is_dynamic: true,
  36 |     is_required: false,
  37 |     is_unique: false,
  38 |     is_active: true,
  39 |     options: [],
  40 |     configuration: {},
  41 |     domain: ""
  42 | };
  43 | 
  44 | interface DictionaryToolProps {
  45 |     domain?: string; 
  46 | }
  47 | 
  48 | export const DictionaryTool: React.FC<DictionaryToolProps> = ({ domain: propDomain }) => {
  49 |     const { token } = theme.useToken();
  50 |     const navigate = useNavigate();
  51 |     
  52 |     // âš¡ ROUTING LOGIC: Capture both Path Param and Query Param
  53 |     const { domain: paramDomain } = useParams<{ domain: string }>();
  54 |     const [searchParams] = useSearchParams();
  55 |     const urlDomain = searchParams.get('domain');
  56 |     
  57 |     // 1. RESOLVE CONTEXT (V2 Way)
  58 |     const { activeContext, selectContext } = useKernel();
  59 |     
  60 |     // Prioritize Prop -> Path Param -> Query Param -> Active Context
  61 |     const targetDomain = propDomain || paramDomain || urlDomain || activeContext?.key;
  62 | 
  63 |     // âš¡ SYNC ENGINE: Ensure Kernel is aware of Router URL changes
  64 |     useEffect(() => {
  65 |         if (targetDomain && activeContext?.key !== targetDomain) {
  66 |             logger.trace("DICTIONARY", `ðŸ”„ Syncing Kernel Context with Route: ${targetDomain}`);
  67 |             selectContext(targetDomain);
  68 |         }
  69 |     }, [targetDomain, activeContext?.key, selectContext]);
  70 |     
  71 |     // 2. FEATURE LOGIC
  72 |     const { 
  73 |         attributes, 
  74 |         isLoading, 
  75 |         saveAttribute, 
  76 |         deleteAttribute, 
  77 |         refresh 
  78 |     } = useDictionary(targetDomain || '');
  79 | 
  80 |     // 3. LOCAL UI STATE
  81 |     const [selectedKey, setSelectedKey] = useState<string | null>(null);
  82 |     const [isCreating, setIsCreating] = useState(false);
  83 |     
  84 |     // âš¡ UX STATE: Auto-Collapse the list when editing
  85 |     const [collapsed, setCollapsed] = useState(false); 
  86 | 
  87 |     // 4. COMPUTED DRAFT
  88 |     const activeDraft = useMemo(() => {
  89 |         if (selectedKey) {
  90 |             const found = attributes.find(a => a.key === selectedKey);
  91 |             if (found) {
  92 |                 return {
  93 |                     ...FRESH_DRAFT,
  94 |                     ...found,
  95 |                     configuration: found.configuration || (found as any).config || {},
  96 |                     domain: targetDomain || ''
  97 |                 } as AttributeDraft;
  98 |             }
  99 |         }
 100 |         return { ...FRESH_DRAFT, domain: targetDomain || '' };
 101 |     }, [selectedKey, attributes, targetDomain]);
 102 | 
 103 |     // 5. HANDLERS
 104 |     const handleBack = () => {
 105 |         // Go back to Topology (parent route)
 106 |         navigate('/meta-v2');
 107 |     };
 108 | 
 109 |     const handleSave = async (draft: AttributeDraft) => {
 110 |         const success = await saveAttribute(draft);
 111 |         if (success) {
 112 |             setIsCreating(false);
 113 |             setSelectedKey(null);
 114 |             
 115 |             // âš¡ UX: Expand list again after saving so they can pick the next item
 116 |             setCollapsed(false); 
 117 |             logger.whisper('UI', 'ðŸ“ Expanding Attribute Explorer');
 118 |         }
 119 |     };
 120 | 
 121 |     const handleDelete = async (key: string) => {
 122 |         const success = await deleteAttribute(key);
 123 |         if (success) {
 124 |             if (selectedKey === key) {
 125 |                 setSelectedKey(null);
 126 |                 setIsCreating(false);
 127 |                 setCollapsed(false);
 128 |             }
 129 |         }
 130 |     };
 131 | 
 132 |     if (!targetDomain) {
 133 |         return <Empty description="No Domain Selected" />;
 134 |     }
 135 | 
 136 |     const showEditor = selectedKey !== null || isCreating;
 137 | 
 138 |     return (
 139 |         <Layout style={{ height: '100%', background: 'transparent' }}>
 140 |             {/* TOOLBAR */}
 141 |             <div style={{ 
 142 |                 padding: '16px 24px', 
 143 |                 borderBottom: `1px solid ${token.colorBorderSecondary}`,
 144 |                 display: 'flex', justifyContent: 'space-between', alignItems: 'center',
 145 |                 background: token.colorBgContainer
 146 |             }}>
 147 |                 <Space>
 148 |                     <Button icon={<ArrowLeftOutlined />} onClick={handleBack}>Back</Button>
 149 |                     <Title level={4} style={{ margin: 0 }}>
 150 |                         Data Dictionary: {targetDomain}
 151 |                     </Title>
 152 |                 </Space>
 153 |                 <Space>
 154 |                     <Button icon={<ReloadOutlined />} onClick={refresh} loading={isLoading} />
 155 |                     <Button type="primary" icon={<PlusOutlined />} onClick={() => { 
 156 |                         setSelectedKey(null); 
 157 |                         setIsCreating(true); 
 158 |                         setCollapsed(true); // âš¡ Auto-collapse for creation focus
 159 |                     }}>
 160 |                         Add Field
 161 |                     </Button>
 162 |                 </Space>
 163 |             </div>
 164 | 
 165 |             {/* MAIN CONTENT (Split View) */}
 166 |             <Layout hasSider style={{ height: 'calc(100% - 64px)' }}>
 167 |                 <Sider 
 168 |                     width={320} 
 169 |                     theme="light" 
 170 |                     collapsible 
 171 |                     collapsed={collapsed}
 172 |                     trigger={null}
 173 |                     style={{ borderRight: `1px solid ${token.colorBorderSecondary}`, overflowY: 'auto' }}
 174 |                 >
 175 |                     {isLoading ? (
 176 |                         <div style={{ padding: 32, textAlign: 'center' }}><Spin /></div>
 177 |                     ) : (
 178 |                         <div style={{ padding: 16 }}>
 179 |                             {/* âš¡ FIX: Header with Collapse Toggle */}
 180 |                             <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
 181 |                                 {!collapsed && <Title level={5} style={{ margin: 0 }}>Attributes</Title>}
 182 |                                 <Button 
 183 |                                     type="text" 
 184 |                                     icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />} 
 185 |                                     onClick={() => setCollapsed(!collapsed)}
 186 |                                 />
 187 |                             </div>
 188 | 
 189 |                              <AttributeExplorer 
 190 |                                 attributes={attributes} 
 191 |                                 onSelect={(attr) => { 
 192 |                                     setIsCreating(false); 
 193 |                                     setSelectedKey(attr.key); 
 194 |                                      
 195 |                                     // âš¡ UX: Auto-collapse when user selects a field to edit
 196 |                                     setCollapsed(true); 
 197 |                                     logger.whisper('UI', `ðŸ“ Auto-collapsing Explorer to edit: ${attr.key}`);
 198 |                                 }}
 199 |                                 selectedKey={selectedKey}
 200 |                                 collapsed={collapsed}
 201 |                                 onToggleCollapse={() => setCollapsed(!collapsed)}
 202 |                                 onCreate={() => {
 203 |                                     setSelectedKey(null); 
 204 |                                     setIsCreating(true); 
 205 |                                     setCollapsed(true);
 206 |                                 }}
 207 |                             />
 208 |                         </div>
 209 |                     )}
 210 |                 </Sider>
 211 | 
 212 |                 <Content style={{ padding: 24, overflowY: 'auto', background: token.colorBgLayout }}>
 213 |                     {showEditor ? (
 214 |                         <div style={{ maxWidth: 800, margin: '0 auto', background: token.colorBgContainer, padding: 24, borderRadius: 8 }}>
 215 |                             <AttributeEditor 
 216 |                                 key={selectedKey || 'new'}
 217 |                                 draft={activeDraft}
 218 |                                 isNew={isCreating || !selectedKey}
 219 |                                 isSaving={false}
 220 |                                 onSave={handleSave}
 221 |                                 onDelete={(!isCreating && !activeDraft.is_system) ? () => handleDelete(selectedKey!) : undefined}
 222 |                             />
 223 |                         </div>
 224 |                     ) : (
 225 |                         <div style={{ height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
 226 |                             <Empty description="Select a field to edit details" />
 227 |                         </div>
 228 |                     )}
 229 |                 </Content>
 230 |             </Layout>
 231 |         </Layout>
 232 |     );
 233 | };
 234 | 
 235 | export default DictionaryTool;
 236 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\components\AttributeEditor.tsx
-----------------------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/components/AttributeEditor.tsx
   2 | // @file: Attribute Editor (Orchestrator - V2)
   3 | // @role: ðŸŽ¨ UI Presentation / ðŸ§  Logic Container */
   4 | // @author: The Engineer
   5 | // @description: The Master Controller for editing Attributes.
   6 | // Decoupled from V1 MetaContext. Uses V2 Kernel.
   7 | 
   8 | // @security-level: LEVEL 9 (UI Safe) */
   9 | 
  10 | import React, { useState, useEffect } from 'react';
  11 | import { 
  12 |   Form, Input, Select, Switch, Button, Card, 
  13 |   Row, Col, Divider, Space, Typography, theme, Tag, Tooltip, Alert // âš¡ FIX: Added Alert
  14 | } from 'antd';
  15 | import { 
  16 |   SaveOutlined, DeleteOutlined, QuestionCircleOutlined,
  17 |   LockOutlined 
  18 | } from '@ant-design/icons';
  19 | 
  20 | // âš¡ V2 KERNEL IMPORTS
  21 | // FIX: Adjusted relative path from ../../../../ (4 levels) to ../../../ (3 levels)
  22 | import { useKernel } from '../../../_kernel/KernelContext';
  23 | import type { DomainSummary } from '../../../_kernel/types';
  24 | 
  25 | import { useTrace } from '@/platform/logging/useTrace';
  26 | import type { AttributeDraft, AttributeConfig } from '../types';
  27 | import { AttributeType, WidgetType, WIDGET_COMPATIBILITY, HELP_TEXT } from '../types';
  28 | 
  29 | import { ConfigPanels } from './editor/ConfigPanels';
  30 | import { PreviewPanel } from './editor/PreviewPanel';
  31 | 
  32 | const { TextArea } = Input;
  33 | const { Option } = Select;
  34 | 
  35 | interface AttributeEditorProps {
  36 |   draft: AttributeDraft;
  37 |   isSaving: boolean;
  38 |   onSave: (draft: AttributeDraft) => void;
  39 |   onDelete?: () => void;
  40 |   isNew: boolean;
  41 | }
  42 | 
  43 | export const AttributeEditor: React.FC<AttributeEditorProps> = ({
  44 |   draft: initialDraft,
  45 |   isSaving,
  46 |   onSave,
  47 |   onDelete,
  48 |   isNew
  49 | }) => {
  50 |   useTrace('AttributeEditorV2', { id: initialDraft.id, type: initialDraft.data_type });
  51 | 
  52 |   const { token } = theme.useToken();
  53 |   const { registry } = useKernel(); // âš¡ V2 CONTEXT REPLACEMENT
  54 |   
  55 |   const [localDraft, setLocalDraft] = useState<AttributeDraft>(initialDraft);
  56 |   
  57 |   // âš¡ SYNC: Update local state if parent selection changes
  58 |   useEffect(() => {
  59 |     setLocalDraft(initialDraft);
  60 |   }, [initialDraft.key, initialDraft.id]);
  61 | 
  62 |   const isLocked = localDraft.is_system && !isNew;
  63 |   const compatibleWidgets = WIDGET_COMPATIBILITY[localDraft.data_type] || [WidgetType.INPUT];
  64 | 
  65 |   // âš¡ LOGIC: Auto-switch widget if data type changes
  66 |   useEffect(() => {
  67 |       if (!compatibleWidgets.includes(localDraft.widget_type)) {
  68 |           updateField('widget_type', compatibleWidgets[0]);
  69 |       }
  70 |   }, [localDraft.data_type]);
  71 | 
  72 |   const updateField = (field: keyof AttributeDraft, value: any) => {
  73 |       if (isLocked && field !== 'label' && field !== 'description') return; // Allow cosmetic edits
  74 |       setLocalDraft(prev => ({ ...prev, [field]: value }));
  75 |   };
  76 | 
  77 |   // âš¡ CONTRACT FIX: Updates 'configuration', NOT 'config'
  78 |   const updateConfig = (key: keyof AttributeConfig, value: any) => {
  79 |     // We allow config updates even if locked, generally (e.g. placeholder)
  80 |     setLocalDraft(prev => ({
  81 |       ...prev,
  82 |       configuration: {
  83 |         ...(prev.configuration || {}),
  84 |         [key]: value
  85 |       }
  86 |     }));
  87 |   };
  88 | 
  89 |   const handleLabelChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  90 |     const label = e.target.value;
  91 |     if (isNew) {
  92 |         // âš¡ LOGIC: Auto-Slugify
  93 |         const key = label.toUpperCase().replace(/[^A-Z0-9_]/g, '_');
  94 |         setLocalDraft(prev => ({ ...prev, label, key }));
  95 |     } else {
  96 |         updateField('label', label);
  97 |     }
  98 |   };
  99 | 
 100 |   return (
 101 |     <div style={{ paddingBottom: 48 }}>
 102 |         
 103 |         {/* 1. HEADER */}
 104 |         <div style={{ 
 105 |             display: 'flex', 
 106 |             justifyContent: 'space-between', 
 107 |             alignItems: 'center',
 108 |             marginBottom: 24
 109 |         }}>
 110 |             <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
 111 |                 <Typography.Title level={3} style={{ margin: 0, color: token.colorText }}>
 112 |                   {isNew ? 'New Attribute' : localDraft.label}
 113 |                 </Typography.Title>
 114 |                 {isLocked && <Tag icon={<LockOutlined />} color="warning">System Field</Tag>}
 115 |             </div>
 116 | 
 117 |             <Space>
 118 |                {onDelete && !isLocked && (
 119 |                     <Button danger icon={<DeleteOutlined />} onClick={onDelete}>Delete</Button>
 120 |                 )}
 121 |                 
 122 |                 <Button 
 123 |                     type="primary" 
 124 |                     icon={<SaveOutlined />} 
 125 |                     loading={isSaving}
 126 |                     onClick={() => onSave(localDraft)}
 127 |                 >
 128 |                     Save Changes
 129 |                 </Button>
 130 |             </Space>
 131 |         </div>
 132 | 
 133 |         <Row gutter={24}>
 134 |             {/* 2. CONFIGURATION */}
 135 |             <Col span={14}>
 136 |                 <Form layout="vertical">
 137 |                     
 138 |                     {/* A. DEFINITION */}
 139 |                     <Card title="Definition" size="small" style={{ marginBottom: 24 }}>
 140 |                         <Row gutter={16}>
 141 |                             <Col span={12}>
 142 |                                 <Form.Item label="Label" required tooltip="The human-readable name shown in forms.">
 143 |                                     <Input 
 144 |                                         value={localDraft.label} 
 145 |                                         onChange={handleLabelChange} 
 146 |                                     />
 147 |                                 </Form.Item>
 148 |                             </Col>
 149 |                             <Col span={12}>
 150 |                                 <Form.Item label="Machine Key" required tooltip="The database column name. Must be unique within the domain.">
 151 |                                     <Input 
 152 |                                         value={localDraft.key} 
 153 |                                         disabled={!isNew} // âš¡ LOCK if not new
 154 |                                         style={{ fontFamily: 'monospace' }}
 155 |                                         prefix={!isNew ? <LockOutlined style={{ color: token.colorTextQuaternary }} /> : undefined}
 156 |                                     />
 157 |                                 </Form.Item>
 158 |                             </Col>
 159 |                         </Row>
 160 |                         <Form.Item label="Description">
 161 |                             <TextArea 
 162 |                                 rows={2} 
 163 |                                 value={localDraft.description} 
 164 |                                 onChange={e => updateField('description', e.target.value)}
 165 |                                 placeholder="Explain what this field is used for..."
 166 |                             />
 167 |                         </Form.Item>
 168 |                     </Card>
 169 | 
 170 |                     {/* B. LOGIC */}
 171 |                     <Card 
 172 |                         title={
 173 |                             <Space>
 174 |                                 <span>Data Logic</span>
 175 |                                 <Tooltip title={HELP_TEXT.DATA_TYPE.desc}>
 176 |                                     <QuestionCircleOutlined style={{ color: token.colorTextSecondary }} />
 177 |                                 </Tooltip>
 178 |                             </Space>
 179 |                         } 
 180 |                         size="small" 
 181 |                         style={{ marginBottom: 24 }}
 182 |                     >
 183 |                         <Row gutter={16}>
 184 |                             <Col span={12}>
 185 |                                 <Form.Item label="Data Type" help={HELP_TEXT.TYPES[localDraft.data_type as keyof typeof HELP_TEXT.TYPES]}>
 186 |                                     <Select 
 187 |                                         value={localDraft.data_type}
 188 |                                         onChange={v => updateField('data_type', v)}
 189 |                                         disabled={!isNew} // âš¡ LOCK if not new
 190 |                                     >
 191 |                                         {Object.values(AttributeType).map(t => (
 192 |                                             <Option key={t} value={t}>{t}</Option>
 193 |                                         ))}
 194 |                                     </Select>
 195 |                                 </Form.Item>
 196 |                             </Col>
 197 |                             <Col span={12}>
 198 |                                 <Form.Item label="Interface Widget" tooltip={HELP_TEXT.WIDGET_TYPE.desc}>
 199 |                                     <Select 
 200 |                                         value={localDraft.widget_type}
 201 |                                         onChange={v => updateField('widget_type', v)}
 202 |                                     >
 203 |                                         {compatibleWidgets.map(t => (
 204 |                                             <Option key={t} value={t}>{t}</Option>
 205 |                                         ))}
 206 |                                     </Select>
 207 |                                 </Form.Item>
 208 |                             </Col>
 209 |                         </Row>
 210 |                         
 211 |                         <Divider orientation="left" style={{ fontSize: 12, color: token.colorTextSecondary }}>Type Configuration</Divider>
 212 |                         
 213 |                         <ConfigPanels 
 214 |                             type={localDraft.data_type}
 215 |                             config={localDraft.configuration} 
 216 |                             onChange={updateConfig}
 217 |                             domainList={registry as DomainSummary[]} 
 218 |                             disabled={false}
 219 |                         />
 220 |                     </Card>
 221 | 
 222 |                     {/* C. RULES */}
 223 |                     <Card title="Rules & Constraints" size="small">
 224 |                         <Row>
 225 |                             <Col span={8}>
 226 |                                 <Form.Item label="Required" tooltip={HELP_TEXT.CONSTRAINTS.REQUIRED} style={{ marginBottom: 0 }}>
 227 |                                     <Switch 
 228 |                                         checked={localDraft.is_required} 
 229 |                                         onChange={c => updateField('is_required', c)} 
 230 |                                         disabled={isLocked} 
 231 |                                     />
 232 |                                 </Form.Item>
 233 |                             </Col>
 234 |                             <Col span={8}>
 235 |                                 <Form.Item label="Unique" tooltip={HELP_TEXT.CONSTRAINTS.UNIQUE} style={{ marginBottom: 0 }}>
 236 |                                     <Switch 
 237 |                                         checked={localDraft.is_unique} 
 238 |                                         onChange={c => updateField('is_unique', c)} 
 239 |                                         disabled={isLocked} 
 240 |                                     />
 241 |                                 </Form.Item>
 242 |                             </Col>
 243 |                             <Col span={8}>
 244 |                                 <Form.Item label="Active" tooltip={HELP_TEXT.CONSTRAINTS.ACTIVE} style={{ marginBottom: 0 }}>
 245 |                                     <Switch 
 246 |                                         checked={localDraft.is_active} 
 247 |                                         onChange={c => updateField('is_active', c)} 
 248 |                                         disabled={isLocked} 
 249 |                                     />
 250 |                                 </Form.Item>
 251 |                             </Col>
 252 |                         </Row>
 253 |                     </Card>
 254 |                 </Form>
 255 |             </Col>
 256 | 
 257 |             {/* 3. SIMULATOR */}
 258 |             <Col span={10}>
 259 |                 <div style={{ position: 'sticky', top: 88 }}>
 260 |                     <PreviewPanel draft={localDraft} />
 261 |                     
 262 |                     {isLocked && (
 263 |                         <Alert 
 264 |                             message="System Field" 
 265 |                             description={HELP_TEXT.SYSTEM_LOCKED} 
 266 |                             type="warning" 
 267 |                             showIcon 
 268 |                             style={{ marginTop: 16 }} 
 269 |                         />
 270 |                     )}
 271 |                 </div>
 272 |             </Col>
 273 |         </Row>
 274 |     </div>
 275 |   );
 276 | };
 277 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\components\AttributeExplorer.tsx
-------------------------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/components/AttributeExplorer.tsx
   2 | // @file: Attribute Explorer (List View - V2)
   3 | // @author: The Engineer
   4 | // @description: Navigable list of Domain Attributes.
   5 | // FEATURES:
   6 | // Smart Sorting (System fields first).
   7 | // URL-Driven Search (Deep Linking).
   8 | // Decoupled from V1.
   9 | 
  10 | // @security-level: LEVEL 9 (UI Safe) */
  11 | 
  12 | import React, { useMemo } from 'react';
  13 | import { List, Input, Button, theme, Empty, Tooltip, Space, Typography } from 'antd';
  14 | import { 
  15 |   PlusOutlined, SearchOutlined, NumberOutlined, 
  16 |   FontSizeOutlined, CalendarOutlined, CheckSquareOutlined, 
  17 |   PaperClipOutlined, LinkOutlined, CodeOutlined, UnorderedListOutlined,
  18 |   MenuFoldOutlined, MenuUnfoldOutlined
  19 | } from '@ant-design/icons';
  20 | 
  21 | import { SmartListItem } from '@/platform/ui/list/SmartListItem';
  22 | import { useUrlState } from '@/platform/hooks/useUrlState';
  23 | import { useTrace } from '@/platform/logging/useTrace';
  24 | 
  25 | import type { AttributeDefinition } from '../types';
  26 | import { AttributeType } from '../types';
  27 | 
  28 | interface AttributeExplorerProps {
  29 |   attributes: AttributeDefinition[];
  30 |   selectedKey: string | 'NEW' | null;
  31 |   onSelect: (attr: AttributeDefinition) => void;
  32 |   onCreate: () => void;
  33 |   collapsed: boolean;
  34 |   onToggleCollapse: () => void;
  35 | }
  36 | 
  37 | const getTypeIcon = (type: AttributeType) => {
  38 |   switch (type) {
  39 |     case AttributeType.TEXT: return <FontSizeOutlined />;
  40 |     case AttributeType.NUMBER: return <NumberOutlined />;
  41 |     case AttributeType.BOOLEAN: return <CheckSquareOutlined />;
  42 |     case AttributeType.DATE:
  43 |     case AttributeType.DATETIME: return <CalendarOutlined />;
  44 |     case AttributeType.FILE: return <PaperClipOutlined />;
  45 |     case AttributeType.REFERENCE: return <LinkOutlined />;
  46 |     case AttributeType.SELECT:
  47 |     case AttributeType.MULTI_SELECT: return <UnorderedListOutlined />;
  48 |     case AttributeType.JSON: return <CodeOutlined />;
  49 |     default: return <FontSizeOutlined />;
  50 |   }
  51 | };
  52 | 
  53 | export const AttributeExplorer: React.FC<AttributeExplorerProps> = ({
  54 |   attributes,
  55 |   selectedKey,
  56 |   onSelect,
  57 |   onCreate,
  58 |   collapsed,
  59 |   onToggleCollapse
  60 | }) => {
  61 |   const { token } = theme.useToken();
  62 |   
  63 |   // âš¡ DEEP LINKING: Replaced local state with URL state for search persistence
  64 |   const [searchTerm, setSearchTerm] = useUrlState('q', '');
  65 | 
  66 |   useTrace('AttributeExplorerV2', { count: attributes.length, collapsed });
  67 | 
  68 |   // ðŸ§  SMART SORTING
  69 |   const processedAttributes = useMemo(() => {
  70 |     let result = attributes;
  71 |     
  72 |     if (searchTerm && !collapsed) {
  73 |         const lower = searchTerm.toLowerCase();
  74 |         result = result.filter(a => 
  75 |             a.label.toLowerCase().includes(lower) || 
  76 |             a.key.toLowerCase().includes(lower)
  77 |         );
  78 |     }
  79 |     
  80 |     return result.sort((a, b) => {
  81 |         // ID sort for stability
  82 |         if (a.key === 'id') return -1;
  83 |         if (b.key === 'id') return 1;
  84 |         
  85 |         // System fields first
  86 |         if (a.is_system && !b.is_system) return -1;
  87 |         if (!a.is_system && b.is_system) return 1;
  88 |         
  89 |         // Alphabetical
  90 |         return a.label.localeCompare(b.label);
  91 |     });
  92 |   }, [attributes, searchTerm, collapsed]);
  93 | 
  94 |   return (
  95 |     <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
  96 |       
  97 |       {/* 1. TOOLBAR */}
  98 |       <div style={{ padding: collapsed ? '12px 8px' : '16px 16px 12px', borderBottom: `1px solid ${token.colorSplit}` }}>
  99 |         {collapsed ? (
 100 |             <Space direction="vertical" style={{ width: '100%', alignItems: 'center' }}>
 101 |                  <Button type="text" icon={<MenuUnfoldOutlined />} onClick={onToggleCollapse} />
 102 |                  <Tooltip title="New Attribute" placement="right">
 103 |                     <Button type="primary" shape="circle" icon={<PlusOutlined />} onClick={onCreate} />
 104 |                  </Tooltip>
 105 |             </Space>
 106 |         ) : (
 107 |             <div style={{ display: 'flex', gap: 8 }}>
 108 |                 <Input 
 109 |                     prefix={<SearchOutlined style={{ color: token.colorTextDisabled }} />} 
 110 |                     placeholder="Search..." 
 111 |                     value={searchTerm}
 112 |                     onChange={(e) => setSearchTerm(e.target.value)}
 113 |                     allowClear
 114 |                     style={{ flex: 1 }}
 115 |                 />
 116 |                 <Tooltip title="Collapse List">
 117 |                     <Button icon={<MenuFoldOutlined />} onClick={onToggleCollapse} />
 118 |                 </Tooltip>
 119 |                 <Tooltip title="New Attribute">
 120 |                     <Button type="primary" icon={<PlusOutlined />} onClick={onCreate} />
 121 |                 </Tooltip>
 122 |             </div>
 123 |         )}
 124 |       </div>
 125 | 
 126 |       {/* 2. SCROLLABLE LIST */}
 127 |       <div style={{ flex: 1, overflowY: 'auto' }}>
 128 |         {processedAttributes.length === 0 && !collapsed ? (
 129 |           <div style={{ padding: 32, textAlign: 'center' }}>
 130 |             <Empty image={Empty.PRESENTED_IMAGE_SIMPLE} description="No fields" />
 131 |           </div>
 132 |         ) : (
 133 |           <List
 134 |             dataSource={processedAttributes}
 135 |             renderItem={(item) => (
 136 |                <SmartListItem
 137 |                   // âš¡ FIX: Use 'key' (string) instead of 'id' (number) for uniqueness
 138 |                   key={item.key} 
 139 |                   label={item.label}
 140 |                   secondaryLabel={item.key}
 141 |                   icon={getTypeIcon(item.data_type)}
 142 |                   tag={item.data_type}
 143 |                   isActive={selectedKey === item.key}
 144 |                   isCompact={collapsed}
 145 |                   isSystem={item.is_system}
 146 |                   onClick={() => onSelect(item)}
 147 |                />
 148 |             )}
 149 |           />
 150 |         )}
 151 |       </div>
 152 |       
 153 |       {/* 3. FOOTER */}
 154 |       {!collapsed && (
 155 |           <div style={{ padding: 8, borderTop: `1px solid ${token.colorSplit}`, textAlign: 'center' }}>
 156 |             <Typography.Text type="secondary" style={{ fontSize: 10 }}>
 157 |                 {processedAttributes.length} Fields
 158 |             </Typography.Text>
 159 |           </div>
 160 |       )}
 161 |     </div>
 162 |   );
 163 | };
 164 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\components\editor\ConfigPanels.tsx
---------------------------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/components/editor/ConfigPanels.tsx
   2 | // @file: Editor Configuration Panels (V2)
   3 | // @author: The Engineer
   4 | // @description: Fractal sub-component for handling Type-Specific settings. CRASH PROOFED.
   5 | // Decoupled from V1, now uses V2 types.
   6 | 
   7 | // @security-level: LEVEL 9 (UI Safe) */
   8 | 
   9 | import React from 'react';
  10 | import { Form, Input, Select, Switch, InputNumber, Row, Col, Alert, Typography } from 'antd';
  11 | import { UnorderedListOutlined, NumberOutlined, CodeOutlined, LinkOutlined } from '@ant-design/icons';
  12 | 
  13 | import type { DomainSummary } from '../../../../_kernel/types';
  14 | import type { AttributeConfig } from '../../types';
  15 | import { AttributeType } from '../../types';
  16 | 
  17 | const { TextArea } = Input;
  18 | const { Option } = Select;
  19 | const { Text, Paragraph } = Typography;
  20 | 
  21 | interface ConfigPanelProps {
  22 |   type: AttributeType;
  23 |   config: AttributeConfig;
  24 |   onChange: (key: keyof AttributeConfig, value: any) => void;
  25 |   domainList: DomainSummary[];
  26 |   disabled?: boolean;
  27 | }
  28 | 
  29 | export const ConfigPanels: React.FC<ConfigPanelProps> = ({ type, config, onChange, domainList, disabled = false }) => {
  30 |   
  31 |   // âš¡ CRASH GUARD: Ensure we have an object to read from
  32 |   const safeConfig = config || {};
  33 | 
  34 |   // --- 1. NUMBER CONFIGURATION ---
  35 |   if (type === AttributeType.NUMBER) {
  36 |     return (
  37 |       <>
  38 |         <Alert 
  39 |           message="Numeric Constraints" 
  40 |           description="Define the acceptable range for this number. Leave empty for no limit." 
  41 |           type="info" 
  42 |           showIcon 
  43 |           icon={<NumberOutlined />}
  44 |           style={{ marginBottom: 16 }} 
  45 |         />
  46 |         <Row gutter={16}>
  47 |           <Col span={8}>
  48 |             <Form.Item label="Minimum Value" help="Lowest number allowed">
  49 |               <InputNumber 
  50 |                   style={{ width: '100%' }} 
  51 |                   value={safeConfig.min} 
  52 |                   onChange={v => onChange('min', v)} 
  53 |                   disabled={disabled} 
  54 |                   placeholder="-âˆž"
  55 |               />
  56 |             </Form.Item>
  57 |           </Col>
  58 |           <Col span={8}>
  59 |             <Form.Item label="Maximum Value" help="Highest number allowed">
  60 |               <InputNumber 
  61 |                   style={{ width: '100%' }} 
  62 |                   value={safeConfig.max} 
  63 |                   onChange={v => onChange('max', v)} 
  64 |                   disabled={disabled} 
  65 |                   placeholder="+âˆž"
  66 |               />
  67 |             </Form.Item>
  68 |           </Col>
  69 |            <Col span={8}>
  70 |              <Form.Item label="Precision" help="Digits after the dot">
  71 |                <InputNumber 
  72 |                    style={{ width: '100%' }} 
  73 |                    value={safeConfig.precision} 
  74 |                    min={0} max={6} 
  75 |                    onChange={v => onChange('precision', v)} 
  76 |                    disabled={disabled} 
  77 |                    placeholder="0"
  78 |                />
  79 |              </Form.Item>
  80 |           </Col>
  81 |         </Row>
  82 |       </>
  83 |     );
  84 |   }
  85 | 
  86 |   // --- 2. TEXT CONFIGURATION ---
  87 |   if (type === AttributeType.TEXT) {
  88 |     return (
  89 |       <>
  90 |         <Row gutter={16}>
  91 |           <Col span={24}>
  92 |             <Form.Item label="Placeholder Text" help="Gray text shown inside the empty box.">
  93 |               <Input 
  94 |                   value={safeConfig.placeholder} 
  95 |                   onChange={e => onChange('placeholder', e.target.value)} 
  96 |                   disabled={disabled} 
  97 |                   placeholder="e.g. 'Enter your full name'"
  98 |                />
  99 |             </Form.Item>
 100 |           </Col>
 101 |           <Col span={24}>
 102 |             <Form.Item label="Regex Pattern (Advanced)" help="Enforce a specific format.">
 103 |               <Input 
 104 |                 style={{ fontFamily: 'monospace' }} 
 105 |                 value={safeConfig.regex} 
 106 |                 onChange={e => onChange('regex', e.target.value)} 
 107 |                 prefix="/" 
 108 |                 suffix="/g" 
 109 |                 disabled={disabled}
 110 |                 placeholder="^[a-zA-Z]+$"
 111 |               />
 112 |             </Form.Item>
 113 |           </Col>
 114 |         </Row>
 115 |       </>
 116 |     );
 117 |   }
 118 | 
 119 |   // --- 3. SELECTION CONFIGURATION ---
 120 |   if ([AttributeType.SELECT, AttributeType.MULTI_SELECT].includes(type)) {
 121 |     return (
 122 |       <>
 123 |         <Alert 
 124 |           message="Defining Options" 
 125 |           description='Enter the choices as a generic list. Example: ["Draft", "Pending", "Approved"]' 
 126 |           type="info" 
 127 |           showIcon 
 128 |           icon={<UnorderedListOutlined />}
 129 |           style={{ marginBottom: 16 }} 
 130 |         />
 131 |         <Form.Item label="Options List (JSON Array)">
 132 |           <TextArea 
 133 |             rows={5}
 134 |             style={{ fontFamily: 'monospace' }}
 135 |             value={JSON.stringify(safeConfig.options || [], null, 2)}
 136 |             onChange={(e) => {
 137 |               try {
 138 |                 const opts = JSON.parse(e.target.value);
 139 |                 onChange('options', opts);
 140 |               } catch { /* Allow typing */ }
 141 |             }}
 142 |             disabled={disabled}
 143 |             placeholder='["Option A", "Option B", "Option C"]'
 144 |           />
 145 |         </Form.Item>
 146 |       </>
 147 |     );
 148 |   }
 149 | 
 150 |   // --- 4. DATE / DATETIME ---
 151 |   if ([AttributeType.DATE, AttributeType.DATETIME].includes(type)) {
 152 |     return (
 153 |       <>
 154 |         <Alert message="Validation Note" type="info" showIcon description="Date logic is handled in Governance." style={{ marginBottom: 16 }} />
 155 |         <Row gutter={16}>
 156 |             <Col span={24}>
 157 |             <Form.Item label="Display Format">
 158 |                 <Select 
 159 |                     value={safeConfig.date_format} 
 160 |                     onChange={v => onChange('date_format', v)}
 161 |                     allowClear
 162 |                     placeholder="Select how the date looks..."
 163 |                     disabled={disabled}
 164 |                 >
 165 |                     <Option value="YYYY-MM-DD">International (2024-12-31)</Option>
 166 |                     <Option value="DD/MM/YYYY">European (31/12/2024)</Option>
 167 |                     <Option value="MM/DD/YYYY">American (12/31/2024)</Option>
 168 |                 </Select>
 169 |             </Form.Item>
 170 |             </Col>
 171 |         </Row>
 172 |       </>
 173 |     );
 174 |   }
 175 | 
 176 |   // --- 5. REFERENCE (COMPLEX) ---
 177 |   if (type === AttributeType.REFERENCE) {
 178 |     return (
 179 |       <>
 180 |         <Alert 
 181 |             message="Relational Link" 
 182 |             description="Creates a Foreign Key connection to another Data Domain." 
 183 |             type="success" 
 184 |             showIcon 
 185 |             style={{ marginBottom: 16 }} 
 186 |         />
 187 |         <Form.Item label="Target Domain" required help="Which 'Table' does this point to?">
 188 |         <Select 
 189 |             value={safeConfig.target_domain}
 190 |             onChange={(v) => onChange('target_domain', v)}
 191 |             placeholder="Select a Domain..."
 192 |             disabled={disabled}
 193 |         >
 194 |             {domainList.map(d => (
 195 |             <Option key={d.key} value={d.key}>
 196 |                 <Space><LinkOutlined /> {d.label} ({d.key})</Space>
 197 |             </Option>
 198 |             ))}
 199 |         </Select>
 200 |         </Form.Item>
 201 |       </>
 202 |     );
 203 |   }
 204 | 
 205 |   // --- 6. FILE ---
 206 |   if (type === AttributeType.FILE) {
 207 |     return (
 208 |       <Row gutter={16}>
 209 |         <Col span={12}>
 210 |           <Form.Item label="Max Size Limit" help="In Megabytes (MB)">
 211 |             <InputNumber 
 212 |               style={{ width: '100%' }} 
 213 |               value={safeConfig.max_size_mb} 
 214 |               onChange={v => onChange('max_size_mb', v)} 
 215 |               addonAfter="MB"
 216 |               disabled={disabled}
 217 |               placeholder="10"
 218 |             />
 219 |           </Form.Item>
 220 |         </Col>
 221 |         <Col span={12}>
 222 |           <Form.Item label="Allowed Extensions" help="Restrict file types">
 223 |             <Select
 224 |               mode="tags"
 225 |               style={{ width: '100%' }}
 226 |               placeholder="Select types..."
 227 |               value={safeConfig.allowed_extensions}
 228 |               onChange={v => onChange('allowed_extensions', v)}
 229 |               disabled={disabled}
 230 |               options={[
 231 |                 { value: '.pdf', label: 'PDF Document' },
 232 |                 { value: '.jpg', label: 'JPG Image' },
 233 |                 { value: '.png', label: 'PNG Image' },
 234 |                 { value: '.csv', label: 'CSV Spreadsheet' },
 235 |                 { value: '.docx', label: 'Word Document' }
 236 |               ]}
 237 |             />
 238 |           </Form.Item>
 239 |         </Col>
 240 |       </Row>
 241 |     );
 242 |   }
 243 | 
 244 |   // --- 7. BOOLEAN ---
 245 |   if (type === AttributeType.BOOLEAN) {
 246 |     return (
 247 |       <>
 248 |         <Paragraph type="secondary" style={{ fontSize: 12, marginBottom: 16 }}>
 249 |             Booleans are strictly True/False. Used for flags like "Is Active".
 250 |         </Paragraph>
 251 |         <Form.Item label="Default State" help="What should be selected initially?">
 252 |             <Switch 
 253 |             checked={safeConfig.default_value === true}
 254 |             onChange={(c) => onChange('default_value', c)}
 255 |             checkedChildren="True (On)"
 256 |             unCheckedChildren="False (Off)"
 257 |             disabled={disabled}
 258 |             />
 259 |         </Form.Item>
 260 |       </>
 261 |     );
 262 |   }
 263 | 
 264 |   // --- 8. JSON (COMPLEX) ---
 265 |   if (type === AttributeType.JSON) {
 266 |       return (
 267 |           <>
 268 |             <Alert 
 269 |                 message="Developer Zone" 
 270 |                 description="Stores a raw JSON object. Use for complex metadata." 
 271 |                 type="warning" 
 272 |                 showIcon 
 273 |                 icon={<CodeOutlined />}
 274 |                 style={{ marginBottom: 16 }} 
 275 |             />
 276 |             <Form.Item label="JSON Schema (Validation)" help="Optional: Paste a JSON Schema.">
 277 |                 <TextArea 
 278 |                     rows={6}
 279 |                     style={{ fontFamily: 'monospace', fontSize: 12 }}
 280 |                     placeholder='{ "type": "object", "properties": { ... } }'
 281 |                     value={JSON.stringify(safeConfig.json_schema || {}, null, 2)}
 282 |                     onChange={(e) => {
 283 |                         try {
 284 |                           const schema = JSON.parse(e.target.value);
 285 |                             onChange('json_schema', schema);
 286 |                         } catch { /* Typing */ }
 287 |                     }}
 288 |                     disabled={disabled}
 289 |                 />
 290 |             </Form.Item>
 291 |           </>
 292 |       );
 293 |   }
 294 | 
 295 |   return <Alert type="warning" message="No specific configuration available for this type." />;
 296 | };
 297 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\components\editor\PreviewPanel.tsx
---------------------------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/components/editor/PreviewPanel.tsx
   2 | // @file: Live Preview Panel (V2)
   3 | // @author: The Engineer
   4 | // @description: Renders the widget in real-time.
   5 | // Decoupled from V1, now uses V2 types.
   6 | 
   7 | // @security-level: LEVEL 9 (UI Safe) */
   8 | 
   9 | import React from 'react';
  10 | import { 
  11 |     Card, Form, Input, InputNumber, Select, Switch, 
  12 |     DatePicker, TimePicker, Checkbox, Radio, Upload, Tag, theme, Slider
  13 | } from 'antd';
  14 | import { InboxOutlined } from '@ant-design/icons';
  15 | 
  16 | import type { AttributeDraft } from '../../types';
  17 | import { WidgetType } from '../../types';
  18 | 
  19 | interface PreviewPanelProps {
  20 |     draft: AttributeDraft;
  21 | }
  22 | 
  23 | export const PreviewPanel: React.FC<PreviewPanelProps> = ({ draft }) => {
  24 |     const { token } = theme.useToken();
  25 |     const { label, widget_type, configuration, data_type, is_required } = draft;
  26 | 
  27 |     const renderWidget = () => {
  28 |         const props: any = {
  29 |             placeholder: configuration.placeholder,
  30 |             disabled: false, 
  31 |             style: { width: '100%' }
  32 |         };
  33 | 
  34 |         // --- TEXT WIDGETS ---
  35 |         if (widget_type === WidgetType.INPUT) return <Input {...props} />;
  36 |         if (widget_type === WidgetType.TEXTAREA) return <Input.TextArea rows={3} {...props} />;
  37 |         if (widget_type === WidgetType.EMAIL) return <Input type="email" prefix="@" {...props} />;
  38 |         if (widget_type === WidgetType.PHONE) return <Input prefix="ðŸ“ž" {...props} />;
  39 |         if (widget_type === WidgetType.COLOR_PICKER) return <Input type="color" style={{ width: 64, padding: 0, border: 'none' }} {...props} />;
  40 |         if (widget_type === WidgetType.RICH_TEXT) return <Input.TextArea rows={4} placeholder="[Rich Text Editor Placeholder]" {...props} />;
  41 | 
  42 |         // --- NUMBER WIDGETS ---
  43 |         if (widget_type === WidgetType.NUMBER) return <InputNumber {...props} min={configuration.min} max={configuration.max} step={configuration.step} />;
  44 |         if (widget_type === WidgetType.CURRENCY) return <InputNumber {...props} prefix={configuration.currency_symbol || '$'} formatter={value => `${value}`.replace(/\B(?=(\d{3})+(?!\d))/g, ',')} />;
  45 |         if (widget_type === WidgetType.PERCENTAGE) return <InputNumber {...props} suffix="%" min={0} max={100} />;
  46 |         if (widget_type === WidgetType.SLIDER) return <Slider min={configuration.min || 0} max={configuration.max || 100} defaultValue={configuration.min || 0} />;
  47 | 
  48 |         // --- SELECTION WIDGETS ---
  49 |         if (widget_type === WidgetType.DROPDOWN) return <Select {...props} options={configuration.options} />;
  50 |         if (widget_type === WidgetType.TAGS) return <Select {...props} mode="tags" options={configuration.options} tokenSeparators={[',']} />;
  51 |         if (widget_type === WidgetType.RADIO_GROUP) return <Radio.Group options={configuration.options} />;
  52 |         if (widget_type === WidgetType.CHECKBOX_GROUP) return <Checkbox.Group options={configuration.options} />;
  53 |         if (widget_type === WidgetType.AUTOCOMPLETE) return <Select showSearch {...props} options={configuration.options} />;
  54 | 
  55 |         // --- DATE WIDGETS ---
  56 |         if (widget_type === WidgetType.DATE_PICKER) return <DatePicker {...props} style={{ width: '100%' }} />;
  57 |         if (widget_type === WidgetType.DATETIME_PICKER) return <DatePicker showTime {...props} style={{ width: '100%' }} />;
  58 |         if (widget_type === WidgetType.TIME_PICKER) return <TimePicker {...props} style={{ width: '100%' }} />;
  59 | 
  60 |         // --- BOOLEAN WIDGETS ---
  61 |         if (widget_type === WidgetType.SWITCH) return <Switch defaultChecked={configuration.default_value} />;
  62 |         if (widget_type === WidgetType.CHECKBOX) return <Checkbox defaultChecked={configuration.default_value}>{label}</Checkbox>;
  63 | 
  64 |         // --- FILE WIDGETS ---
  65 |         if (widget_type === WidgetType.FILE_UPLOAD) {
  66 |             return (
  67 |                 <Upload.Dragger style={{ padding: 16, background: token.colorBgContainer }}>
  68 |                     <p className="ant-upload-drag-icon"><InboxOutlined style={{ color: token.colorPrimary }} /></p>
  69 |                     <p className="ant-upload-text" style={{ color: token.colorText }}>Click or drag file</p>
  70 |                     <p className="ant-upload-hint" style={{ color: token.colorTextSecondary }}>
  71 |                         Max: {configuration.max_size_mb || 5}MB 
  72 |                         {configuration.allowed_extensions && ` (${configuration.allowed_extensions.join(', ')})`}
  73 |                     </p>
  74 |                 </Upload.Dragger>
  75 |             );
  76 |         }
  77 | 
  78 |         // --- COMPLEX WIDGETS ---
  79 |         if (widget_type === WidgetType.JSON_EDITOR) return <Input.TextArea rows={6} style={{ fontFamily: 'monospace' }} placeholder="{ ... }" />;
  80 |         if (widget_type === WidgetType.REFERENCE_LOOKUP) return <Select showSearch placeholder={`Select ${configuration.target_domain || 'Record'}...`} style={{ width: '100%' }} disabled />;
  81 | 
  82 |         // Fallback
  83 |         return <Tag color="orange">Preview Not Available ({widget_type})</Tag>;
  84 |     };
  85 | 
  86 |     return (
  87 |         <Card 
  88 |             title={<span style={{ color: token.colorTextHeading }}><span style={{ marginRight: 8 }}>ðŸ‘ï¸</span> Live Preview</span>} 
  89 |             size="small" 
  90 |             style={{ 
  91 |                 background: token.colorFillAlter, 
  92 |                 borderColor: token.colorSplit,
  93 |                 height: '100%'
  94 |             }}
  95 |             styles={{ body: { padding: 24 } }}
  96 |         >
  97 |             <Form layout="vertical">
  98 |                 <Form.Item 
  99 |                     label={<span style={{ color: token.colorTextSecondary }}>{label || 'Field Label'}</span>}
 100 |                     required={is_required}
 101 |                     tooltip={draft.description}
 102 |                 >
 103 |                     {renderWidget()}
 104 |                 </Form.Item>
 105 |             </Form>
 106 | 
 107 |             <div style={{ 
 108 |                 marginTop: 24, 
 109 |                 fontSize: 10, 
 110 |                 color: token.colorTextQuaternary, 
 111 |                 textAlign: 'center', 
 112 |                 borderTop: `1px dashed ${token.colorSplit}`, 
 113 |                 paddingTop: 8 
 114 |             }}>
 115 |                 Validation: {data_type} 
 116 |                 {configuration.regex && ` | Regex: ${configuration.regex}`}
 117 |             </div>
 118 |         </Card>
 119 |     );
 120 | };
 121 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\hooks\useDictionary.ts
---------------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/hooks/useDictionary.ts
   2 | // @file: Dictionary Logic Hook (V2)
   3 | // @author: The Engineer
   4 | // @description: Encapsulates all Data Access Logic for Domain Attributes.
   5 | // FRACTAL PATTERN: Separates Data (Axios/ReactQuery) from View (Components).
   6 | // UPDATED: Imports normalizeSchema from LOCAL V2 logic.
   7 | 
   8 | 
   9 | import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
  10 | import axios from 'axios';
  11 | import { App } from 'antd';
  12 | 
  13 | // âš¡ V2 IMPORT (Decoupled)
  14 | import { normalizeSchema } from '../logic/schemaNormalizer';
  15 | 
  16 | import type { AttributeDraft } from '../types/types';
  17 | import { API_BASE_URL } from '@/config';
  18 | 
  19 | export const useDictionary = (domainKey: string) => {
  20 |     const queryClient = useQueryClient();
  21 |     const { message } = App.useApp();
  22 | 
  23 |     // 1. FETCH ATTRIBUTES
  24 |     const { data: attributes = [], isLoading, isError } = useQuery({
  25 |         queryKey: ['meta_v2', 'attributes', domainKey],
  26 |         queryFn: async () => {
  27 |             if (!domainKey) return [];
  28 |             // âš¡ GATEWAY: Use standardized base
  29 |             const res = await axios.get(`${API_BASE_URL}/api/v1/meta/schema/${domainKey}`, {
  30 |                 params: { active_only: false }
  31 |             });
  32 |             return normalizeSchema(res.data);
  33 |         },
  34 |         enabled: !!domainKey
  35 |     });
  36 | 
  37 |     // 2. SAVE (CREATE / UPDATE)
  38 |     const saveMutation = useMutation({
  39 |         mutationFn: async (draft: AttributeDraft) => {
  40 |             if (draft.id && draft.id > 0) {
  41 |                 // Update Existing
  42 |                 return axios.patch(`${API_BASE_URL}/api/v1/meta/attributes/${draft.id}`, draft);
  43 |             } else {
  44 |                 // Create New
  45 |                 return axios.post(`${API_BASE_URL}/api/v1/meta/attributes`, { 
  46 |                     ...draft, 
  47 |                     domain: domainKey 
  48 |                 });
  49 |             }
  50 |         },
  51 |         onSuccess: () => {
  52 |             queryClient.invalidateQueries({ queryKey: ['meta_v2', 'attributes'] });
  53 |             message.success('Schema Definition Saved');
  54 |         },
  55 |         onError: (err: any) => {
  56 |             message.error(err.response?.data?.detail || 'Save failed');
  57 |         }
  58 |     });
  59 | 
  60 |     // 3. DELETE
  61 |     const deleteMutation = useMutation({
  62 |         mutationFn: async (id: number) => {
  63 |             return axios.delete(`${API_BASE_URL}/api/v1/meta/attributes/${id}`);
  64 |         },
  65 |         onSuccess: () => {
  66 |             queryClient.invalidateQueries({ queryKey: ['meta_v2', 'attributes'] });
  67 |             message.success('Attribute Deleted');
  68 |         },
  69 |         onError: (err: any) => {
  70 |             message.error(err.response?.data?.detail || 'Delete failed');
  71 |         }
  72 |     });
  73 | 
  74 |     return {
  75 |         // Data
  76 |         attributes,
  77 |         isLoading,
  78 |         isError,
  79 |         
  80 |         // Actions
  81 |         saveAttribute: saveMutation.mutateAsync,
  82 |         deleteAttribute: deleteMutation.mutateAsync,
  83 |         
  84 |         // State
  85 |         isSaving: saveMutation.isPending,
  86 |         isDeleting: deleteMutation.isPending,
  87 |         refresh: () => queryClient.invalidateQueries({ queryKey: ['meta_v2', 'attributes'] })
  88 |     };
  89 | };
  90 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\logic\schemaNormalizer.ts
------------------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/logic/schemaNormalizer.ts
   2 | // @file: Schema Normalizer (V2)
   3 | // @author: The Engineer
   4 | // @description: Logic Adapter.
   5 | // FIX: Used 'import type' for interfaces to prevent Vite Runtime Crash.
   6 | // FIX: Separated Value imports (Enums) from Type imports (Interfaces).
   7 | // CONTEXT: Migrated to meta_v2 for decoupling.
   8 | 
   9 | 
  10 | // âš¡ CRITICAL FIX: Separate Type imports from Value imports
  11 | import type { AttributeDefinition } from '../types/types';
  12 | import { AttributeType, WidgetType } from '../types/types'; // V2 Types now contain Enums too
  13 | 
  14 | export const normalizeSchema = (data: any): AttributeDefinition[] => {
  15 |   if (!data) return [];
  16 | 
  17 |   // Scenario A: It's already an Array
  18 |   if (Array.isArray(data)) {
  19 |     return data.map(sanitizeAttribute);
  20 |   }
  21 | 
  22 |   // Scenario B: It's a Hybrid Schema Object
  23 |   const collected = new Map<string, AttributeDefinition>();
  24 | 
  25 |   const add = (item: any) => {
  26 |     const clean = sanitizeAttribute(item);
  27 |     if (clean.key) collected.set(clean.key, clean);
  28 |   };
  29 | 
  30 |   // Check possible containers
  31 |   if (data.fields && typeof data.fields === 'object') {
  32 |     Object.values(data.fields).forEach(add);
  33 |   } else if (data.attributes && Array.isArray(data.attributes)) {
  34 |     data.attributes.forEach(add);
  35 |   } else if (data.columns && Array.isArray(data.columns)) {
  36 |     data.columns.forEach(add);
  37 |   }
  38 | 
  39 |   return Array.from(collected.values());
  40 | };
  41 | 
  42 | const sanitizeAttribute = (raw: any): AttributeDefinition => {
  43 |   return {
  44 |     id: raw.id || 0,
  45 |     domain: raw.domain || 'UNKNOWN',
  46 |     key: raw.key || 'unknown_key',
  47 |     label: raw.label || raw.key || 'Untitled',
  48 |     description: raw.description || '',
  49 |     
  50 |     data_type: (raw.data_type as AttributeType) || AttributeType.TEXT,
  51 |     widget_type: (raw.widget_type as WidgetType) || WidgetType.INPUT,
  52 |     
  53 |     is_required: !!raw.is_required,
  54 |     is_unique: !!raw.is_unique,
  55 |     is_system: !!raw.is_system,
  56 |     is_active: raw.is_active !== false,
  57 |     
  58 |     configuration: raw.configuration ? JSON.parse(JSON.stringify(raw.configuration)) : {},
  59 |     
  60 |     created_at: raw.created_at,
  61 |     updated_at: raw.updated_at
  62 |   };
  63 | };
  64 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\types\constants.ts
-----------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/types/constants.ts
   2 | // @file: Dictionary Constants (Runtime - V2)
   3 | // @author: The Engineer
   4 | // @description: Values that EXIST at runtime (Enums, Objects).
   5 | // Decoupled from V1.
   6 | 
   7 | // @security-level: LEVEL 0 (Core Constants) */
   8 | 
   9 | export enum AttributeType {
  10 |     TEXT = "TEXT",
  11 |     TEXTAREA = "TEXTAREA",
  12 |     RICH_TEXT = "RICH_TEXT",
  13 |     NUMBER = "NUMBER",
  14 |     BOOLEAN = "BOOLEAN",
  15 |     SELECT = "SELECT",
  16 |     MULTI_SELECT = "MULTI_SELECT",
  17 |     DATE = "DATE",
  18 |     DATETIME = "DATETIME",
  19 |     TIME = "TIME",
  20 |     REFERENCE = "REFERENCE",
  21 |     FILE = "FILE",
  22 |     JSON = "JSON",
  23 |     FORMULA = "FORMULA"
  24 | }
  25 | 
  26 | export enum WidgetType {
  27 |     // Text
  28 |     INPUT = "INPUT",
  29 |     TEXTAREA = "TEXTAREA",
  30 |     RICH_TEXT = "RICH_TEXT",
  31 |     EMAIL = "EMAIL",
  32 |     PHONE = "PHONE",
  33 |     PASSWORD = "PASSWORD",
  34 |     COLOR_PICKER = "COLOR_PICKER",
  35 | 
  36 |     // Numeric
  37 |     NUMBER = "NUMBER",
  38 |     SLIDER = "SLIDER",
  39 |     CURRENCY = "CURRENCY",
  40 |     PERCENTAGE = "PERCENTAGE",
  41 |     RATE = "RATE",
  42 | 
  43 |     // Choice
  44 |     DROPDOWN = "DROPDOWN",
  45 |     AUTOCOMPLETE = "AUTOCOMPLETE",
  46 |     RADIO_GROUP = "RADIO_GROUP",
  47 |     CHECKBOX_GROUP = "CHECKBOX_GROUP",
  48 |     TAGS = "TAGS",
  49 |     SEGMENTED = "SEGMENTED",
  50 |     TREE_SELECT = "TREE_SELECT",
  51 | 
  52 |     // Boolean
  53 |     SWITCH = "SWITCH",
  54 |     CHECKBOX = "CHECKBOX",
  55 | 
  56 |     // Date
  57 |     DATE_PICKER = "DATE_PICKER",
  58 |     DATETIME_PICKER = "DATETIME_PICKER",
  59 |     TIME_PICKER = "TIME_PICKER",
  60 |     DATE_RANGE = "DATE_RANGE",
  61 | 
  62 |     // Advanced
  63 |     FILE_UPLOAD = "FILE_UPLOAD",
  64 |     JSON_EDITOR = "JSON_EDITOR",
  65 |     REFERENCE_LOOKUP = "REFERENCE_LOOKUP"
  66 | }
  67 | 
  68 | // ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type
  69 | export const WIDGET_COMPATIBILITY: Record<AttributeType, WidgetType[]> = {
  70 |     [AttributeType.TEXT]: [WidgetType.INPUT, WidgetType.TEXTAREA, WidgetType.RICH_TEXT, WidgetType.EMAIL, WidgetType.PHONE, WidgetType.COLOR_PICKER, WidgetType.PASSWORD],
  71 |     [AttributeType.TEXTAREA]: [WidgetType.TEXTAREA, WidgetType.RICH_TEXT],
  72 |     [AttributeType.RICH_TEXT]: [WidgetType.RICH_TEXT],
  73 |     [AttributeType.NUMBER]: [WidgetType.NUMBER, WidgetType.CURRENCY, WidgetType.PERCENTAGE, WidgetType.SLIDER, WidgetType.RATE],
  74 |     [AttributeType.BOOLEAN]: [WidgetType.SWITCH, WidgetType.CHECKBOX],
  75 |     [AttributeType.SELECT]: [WidgetType.DROPDOWN, WidgetType.RADIO_GROUP, WidgetType.SEGMENTED],
  76 |     [AttributeType.MULTI_SELECT]: [WidgetType.TAGS, WidgetType.CHECKBOX_GROUP, WidgetType.TREE_SELECT],
  77 |     [AttributeType.DATE]: [WidgetType.DATE_PICKER],
  78 |     [AttributeType.DATETIME]: [WidgetType.DATETIME_PICKER, WidgetType.DATE_RANGE],
  79 |     [AttributeType.TIME]: [WidgetType.TIME_PICKER],
  80 |     [AttributeType.FILE]: [WidgetType.FILE_UPLOAD],
  81 |     [AttributeType.REFERENCE]: [WidgetType.REFERENCE_LOOKUP, WidgetType.TREE_SELECT],
  82 |     [AttributeType.JSON]: [WidgetType.JSON_EDITOR, WidgetType.DATE_RANGE],
  83 |     [AttributeType.FORMULA]: [WidgetType.INPUT]
  84 | };
  85 | 
  86 | // ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions
  87 | export const HELP_TEXT = {
  88 |     DATA_TYPE: {
  89 |         title: "What is Data Type?",
  90 |         desc: "Defines how the database stores this value. This cannot be changed once created to prevent data corruption."
  91 |     },
  92 |     WIDGET_TYPE: {
  93 |         title: "What is Interface Widget?",
  94 |         desc: "Determines how the user interacts with this field in the UI. (e.g., A 'Boolean' can be a Switch or a Checkbox)."
  95 |     },
  96 |     SYSTEM_LOCKED: "This is a System Field required by the Kernel. It cannot be edited or deleted.",
  97 |     TYPES: {
  98 |         TEXT: "Alphanumeric strings. Used for names, titles, descriptions.",
  99 |         NUMBER: "Integers or Decimals. Used for prices, quantities, counts.",
 100 |         BOOLEAN: "True/False binary state. Used for flags like 'Is Active'.",
 101 |         SELECT: "Single choice from a predefined list of options.",
 102 |         REFERENCE: "Link to a record in another Domain (Foreign Key).",
 103 |         JSON: "Complex structured data object (Developer Mode)."
 104 |     },
 105 |     CONSTRAINTS: {
 106 |         REQUIRED: "Blocks saving the record if this field is empty.",
 107 |         UNIQUE: "Ensures no two records have the same value for this field.",
 108 |         ACTIVE: "Determines if this field is visible in the application."
 109 |     }
 110 | };
 111 | 
 112 | export const DEFAULT_DRAFT_CONFIG = {};
 113 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\types\index.ts
-------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/types/index.ts
   2 | // @file: Type Barrel (V2)
   3 | // @author: The Engineer
   4 | // @description: Re-exports Types and Constants explicitly to prevent bundler confusion.
   5 | 
   6 | import { AttributeType, WidgetType } from './constants';
   7 | import type { AttributeDraft } from './types';
   8 | 
   9 | // 1. Export Values (Runtime)
  10 | export * from './constants';
  11 | 
  12 | // 2. Export Types (Compile-time)
  13 | // We explicitly list them to avoid "export type *" issues
  14 | export type { 
  15 |   SelectOption, 
  16 |   AttributeConfig, 
  17 |   AttributeDefinition, 
  18 |   AttributeDraft 
  19 | } from './types';
  20 | 
  21 | // 3. Default Constant
  22 | export const DEFAULT_DRAFT: AttributeDraft = {
  23 |   domain: '',
  24 |   key: '',
  25 |   label: '',
  26 |   data_type: AttributeType.TEXT,
  27 |   widget_type: WidgetType.INPUT,
  28 |   is_required: false,
  29 |   is_unique: false,
  30 |   is_system: false,
  31 |   is_active: true,
  32 |   configuration: {}
  33 | };
  34 | 

================================================================================

# Source code from: frontend\src\domains\meta_v2\features\dictionary\types\types.ts
-------------------------------------------------------------------------------------
   1 | // FILEPATH: frontend/src/domains/meta_v2/features/dictionary/types/types.ts
   2 | // @file: Dictionary Interfaces (Types)
   3 | // @author: The Engineer
   4 | // @description: Types that DISAPPEAR at runtime. Pure Interfaces.
   5 | // @security-level: LEVEL 0 (Core Types) */
   6 | 
   7 | // âš¡ RE-EXPORT CONSTANTS FROM V1 (Shared Kernel) or DUPLICATE IF NEEDED
   8 | // For now, we assume constants are shared or need to be copied.
   9 | // Since I don't have the constants file for V2 yet, I will redefine the Enums here or import from shared.
  10 | // Looking at the dump, `meta/features/dictionary/types/constants.ts` exists in V1.
  11 | // I will assume standard strings for now to avoid broken imports.
  12 | 
  13 | export enum AttributeType {
  14 |   TEXT = "TEXT",
  15 |   TEXTAREA = "TEXTAREA",
  16 |   RICH_TEXT = "RICH_TEXT",
  17 |   NUMBER = "NUMBER",
  18 |   BOOLEAN = "BOOLEAN",
  19 |   SELECT = "SELECT",
  20 |   MULTI_SELECT = "MULTI_SELECT",
  21 |   DATE = "DATE",
  22 |   DATETIME = "DATETIME",
  23 |   TIME = "TIME",
  24 |   REFERENCE = "REFERENCE",
  25 |   FILE = "FILE",
  26 |   JSON = "JSON",
  27 |   FORMULA = "FORMULA"
  28 | }
  29 | 
  30 | export enum WidgetType {
  31 |   INPUT = "INPUT",
  32 |   TEXTAREA = "TEXTAREA",
  33 |   RICH_TEXT = "RICH_TEXT",
  34 |   EMAIL = "EMAIL",
  35 |   PHONE = "PHONE",
  36 |   COLOR = "COLOR",
  37 |   NUMBER = "NUMBER",
  38 |   SLIDER = "SLIDER",
  39 |   CURRENCY = "CURRENCY",
  40 |   PERCENTAGE = "PERCENTAGE",
  41 |   DROPDOWN = "DROPDOWN",
  42 |   AUTOCOMPLETE = "AUTOCOMPLETE",
  43 |   RADIO_GROUP = "RADIO_GROUP",
  44 |   CHECKBOX_GROUP = "CHECKBOX_GROUP",
  45 |   TAGS = "TAGS",
  46 |   SWITCH = "SWITCH",
  47 |   CHECKBOX = "CHECKBOX",
  48 |   DATE_PICKER = "DATE_PICKER",
  49 |   DATETIME_PICKER = "DATETIME_PICKER",
  50 |   TIME_PICKER = "TIME_PICKER",
  51 |   FILE_UPLOAD = "FILE_UPLOAD",
  52 |   REFERENCE_LOOKUP = "REFERENCE_LOOKUP",
  53 |   JSON_EDITOR = "JSON_EDITOR"
  54 | }
  55 | 
  56 | export interface SelectOption {
  57 |   label: string;
  58 |   value: string | number;
  59 |   color?: string;
  60 | }
  61 | 
  62 | export interface AttributeConfig {
  63 |   // Text
  64 |   placeholder?: string;
  65 |   regex?: string;
  66 |   min_length?: number;
  67 |   max_length?: number;
  68 |   
  69 |   // Number
  70 |   min?: number;
  71 |   max?: number;
  72 |   step?: number;
  73 |   precision?: number;
  74 |   currency_symbol?: string;
  75 |   
  76 |   // Date
  77 |   min_date?: string;
  78 |   max_date?: string;
  79 |   date_format?: string;
  80 | 
  81 |   // Options
  82 |   options?: SelectOption[];
  83 |   allow_custom?: boolean;
  84 |   
  85 |   // Reference
  86 |   target_domain?: string;
  87 |   filter_logic?: Record<string, any>;
  88 |   
  89 |   // File
  90 |   allowed_extensions?: string[];
  91 |   max_size_mb?: number;
  92 |   
  93 |   // JSON
  94 |   json_schema?: Record<string, any>;
  95 | 
  96 |   // General
  97 |   default_value?: any;
  98 |   help_text?: string;
  99 | }
 100 | 
 101 | export interface AttributeDefinition {
 102 |   id: number;
 103 |   domain: string;
 104 |   key: string;
 105 |   label: string;
 106 |   description?: string;
 107 |   data_type: AttributeType;
 108 |   widget_type: WidgetType;
 109 |   is_required: boolean;
 110 |   is_unique: boolean;
 111 |   is_system: boolean;
 112 |   is_active: boolean;
 113 |   configuration: AttributeConfig;
 114 |   created_at?: string;
 115 |   updated_at?: string;
 116 |   is_draft?: boolean;
 117 | }
 118 | 
 119 | export interface AttributeDraft {
 120 |   id?: number; 
 121 |   domain: string;
 122 |   key: string;
 123 |   label: string;
 124 |   description?: string;
 125 |   data_type: AttributeType;
 126 |   widget_type: WidgetType;
 127 |   is_required: boolean;
 128 |   is_unique: boolean;
 129 |   is_system: boolean;
 130 |   is_active: boolean;
 131 |   configuration: AttributeConfig;
 132 | }
 133 | 

================================================================================


================================================================================
# SYSTEM INSTRUCTION: THE "STRICT ARCHITECT" PROTOCOL (v4.0)
================================================================================
SYSTEM INSTRUCTION: THE "LEVEL 5" ENGINEER PROTOCOL (v5.0 - Fractal Edition)
IDENTITY: You are "The Engineer" (ansav8@gmail.com). 
SUPERVISOR: I am "The Architect." 
MISSION: Build an Enterprise Operating System. 
PRIME DIRECTIVE: Translate architectural vision into flawless, fractal, modular code. 

ðŸš« BANNED: "Quick screens," temporary hacks, and "Layer-Based" folders (e.g., /components, /services).
âœ… REQUIRED: "Fractal Feature-Based" Architecture (Colocation of UI, Logic, and State).

ðŸ›‘ SECTION 1: THE PRIME DIRECTIVES (Non-Negotiable)
If you violate these rules, the session is considered failed.

1. NO GHOST CODING (The Smart Copy Rule): 
   You must NEVER write code for a file without asking me to provide its latest content first. 
   * If you need a file, ask: "Please Smart Copy [File/Folder Path]."
   * Prefer requesting FOLDERS (e.g., `src/features/billing`) to get full dependency context.

2. NO UNAUTHORIZED EXECUTION: 
   You are locked in "Analysis Mode" by default. You cannot switch to "Coding Mode" without my explicit "Approved" or "Go ahead" command.

3. MAXIMUM 2 FILES PER RESPONSE (FIRM RULE): 
   To guarantee complete code delivery, you are strictly limited to generating maximum 2 files per response. If a task requires 3+ files, you MUST stop after the second file and ask permission to continue.

4. COMPLETE CODE ONLY: 
   Never provide snippets. You must generate the ENTIRE file content every time, even for a one-line change.

5. FRACTAL ARCHITECTURE ENFORCEMENT:
   You must reject any plan that creates a Monolith. Code must be organized by FEATURE, not by type. 
   (e.g., `features/auth/components` = GOOD. `src/components/auth` = REJECT).

6. ENTERPRISE MODULARITY: 
   Focus on Smart Polling, "Storyteller" Floodgate patterns, and extreme verbosity in logging. Logic must be "Operating System Grade"â€”robust, self-healing, and strictly typed.

ðŸ”„ SECTION 2: THE WORKFLOW LOOP
PHASE A: DIAGNOSIS & SYNC (Default State)
Trigger: I give a task or report a bug. Your Protocol:
   1. Analyze: Think about the problem from a "Level 5 OS" perspective (Security, Scalability, Fractal Modularity).
   2. Context Check: Do you have the latest files? 
      * If NO: List the exact paths and ask: ">> PLEASE SMART COPY: [Paths] or combine"
      * If YES: Proceed to Phase B.
   3. Stop: Do not propose the solution yet. Wait for the files.

PHASE B: STRATEGY & APPROVAL
Trigger: I provide the file contents (via Smart Copy or Paste). Your Protocol:
   1. Review: Analyze the code provided.
   2. Fractal Audit: Ensure the changes respect strict feature isolation (no cross-contamination).
   3. Plan: Explain exactly what you will change and why.
   4. Ask: "Do you approve this plan?"

PHASE C: EXECUTION (Coding Mode)
Trigger: I say "Approved" or use an >> APPROVE command. Your Protocol:
   1. Check Limit: Confirm you are generating â‰¤ 2 files.
   2. Generate: Write the COMPLETE code.
   3. Format: Use the "Mandatory Code Format" below.
   4. Verify: Check for omissions (Green/Red check).

ðŸ“ SECTION 3: MANDATORY OUTPUT FORMATS
1. The Code Block Format
(Must be used whenever generating code. CRITICAL: The internal header must use the correct comment syntax for the language).

FILEPATH: /path/to/actual/file.ext

Code snippet

[USE NATIVE COMMENT SYNTAX]
# For Python/Shell/YAML:
# FILEPATH: /path/to/actual/file.ext
# @file ... [Standard Header with Author ansav8@gmail.com] ...

# For HTML/XML:
# For JS/CSS/C/Java:
/* FILEPATH: /path/to/actual/file.ext */
/* @file ... [Standard Header with Author ansav8@gmail.com] ... */

[... FULL COMPLETE CODE - NO OMISSIONS ...]

2. The Project State Footer (REQUIRED on EVERY END OF the message)
This is the anchor that keeps you in sync. You must generate the "Next Action Menu" with specific options I can copy.

Plaintext

[PROJECT STATE BLOCK]
Task ID: [Unique ID, e.g., P1-S2]
Feature: [Name]
Phase: [Phase #] - [Phase Name]
Status: [ðŸ”´ ANALYSIS | ðŸŸ¡ SYNCING | ðŸŸ¢ CODING]
Sync Check: [âœ… LATEST CODE USED | âš ï¸ ASSUMED (VIOLATION)]
Files Delivered: [X] of [Total Required] (Limit 2 per prompt)
Code Integrity: [âœ… FULL / âŒ TRUNCATED / âšª N/A]

NEXT ACTION MENU (Select & Copy one):
> [Option 1]: >> APPROVE [Task ID]. Proceed to code generation.
> [Option 2]: >> CONTINUE. Generate the next batch of files.
> [Option 3]: >> PROVIDE FILES. I will run Smart Copy and paste the content now.
> [Option 4]: >> REVISE [Task ID]. I disagree with the plan, let's discuss.
