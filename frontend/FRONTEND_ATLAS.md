# ðŸ—ºï¸ FLODOCK SYSTEM ATLAS (Prism V10)
**Generated:** 2026-02-20 10:10
**Mode:** Total Recall (Full Comment Extraction).

---
## ðŸ“‚ `frontend/src/`

### ðŸ“„ `App.tsx`
> Root Provider Stack with fixed locale and fluid height.

---
## ðŸ“‚ `frontend/src/_kernel/`

### ðŸ“„ `CapabilitiesContext.tsx`
> FILEPATH: frontend/src/_kernel/CapabilitiesContext.tsx */

**Components & Logic:**

* **`CapabilitiesProvider`**
  * **Logic Flow:**
    * `Execute the Handshake`
    * `Hook for consuming the capabilities`
* **`useCapabilities`**
  * ðŸ“ *Hook for consuming the capabilities*

---
### ðŸ“„ `SystemRegistry.ts`
> Keeps the app alive by catching legacy calls from 'CapabilitiesContext' or 'SystemContext'.

| Attribute | Value |
| :--- | :--- |
| **status** | `ZOMBIE (Logic Removed, Interfaces Preserved)` |

**Components & Logic:**

* **`CapabilityItem`**
  * ðŸ“ *--- TYPES (Kept for compatibility to prevent TS errors) ---*
* **`ContextField`**
* **`SystemCapabilities`**
  * **Logic Flow:**
    * `--- SAFE MODE DEFAULTS ---`
* **`SystemRegistry`**

---
### ðŸ“„ `config.ts`
> FILEPATH: frontend/src/_kernel/config.ts */

**Components & Logic:**

* **`API_BASE_URL`**
  * ðŸ“ *localhost:8000';*
  * **Logic Flow:**
    * `3. Application Metadata`
* **`APP_VERSION`**
  * ðŸ“ *3. Application Metadata*
* **`IS_DEV`**
* **`IS_DEBUG`**

---
## ðŸ“‚ `frontend/src/api/core/`

### ðŸ“„ `ApiError.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ApiError`**

---
### ðŸ“„ `ApiRequestOptions.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ApiRequestOptions`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ApiResult.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ApiResult`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `CancelablePromise.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`CancelError`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
* **`OnCancel`**
* **`CancelablePromise`**

---
### ðŸ“„ `OpenAPI.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`OpenAPIConfig`**
* **`OpenAPI`**

---
### ðŸ“„ `request.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`request`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
## ðŸ“‚ `frontend/src/api/`

### ðŸ“„ `index.ts`
> generated using openapi-typescript-codegen -- do not edit */

---
## ðŸ“‚ `frontend/src/api/models/`

### ðŸ“„ `AIRequest.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AIRequest`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ActiveAppCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ActiveAppCreate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ActiveAppRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ActiveAppRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ActiveAppUpdate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ActiveAppUpdate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `AttributeConfig.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AttributeConfig`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `AttributeCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AttributeCreate`**

---
### ðŸ“„ `AttributeRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AttributeRead`**

---
### ðŸ“„ `AttributeType.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AttributeType`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `AttributeUpdate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AttributeUpdate`**

---
### ðŸ“„ `BindingType.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`BindingType`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `BrickList.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`BrickList`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `DataCircuitCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`DataCircuitCreate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `DataCircuitRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`DataCircuitRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `DataCircuitUpdate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`DataCircuitUpdate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `DryRunRequest.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`DryRunRequest`**

---
### ðŸ“„ `DryRunResult.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`DryRunResult`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `HTTPValidationError.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`HTTPValidationError`**

---
### ðŸ“„ `NexusTraceRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`NexusTraceRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `PolicyBase.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyBase`**

---
### ðŸ“„ `PolicyBindingCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyBindingCreate`**

---
### ðŸ“„ `PolicyBindingRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyBindingRead`**

---
### ðŸ“„ `PolicyBindingUpdate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyBindingUpdate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `PolicyCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyCreate`**

---
### ðŸ“„ `PolicyGroupCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyGroupCreate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `PolicyGroupRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyGroupRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `PolicyGroupUpdate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyGroupUpdate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `PolicyRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyRead`**

---
### ðŸ“„ `PolicyResolutionStrategy.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyResolutionStrategy`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `PolicyRule.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyRule`**

---
### ðŸ“„ `PolicyUpdate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyUpdate`**

---
### ðŸ“„ `ReleaseCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ReleaseCreate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ReleaseRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ReleaseRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `RuleActionType.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`RuleActionType`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `RuleCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`RuleCreate`**

---
### ðŸ“„ `RuleEffect.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`RuleEffect`**

---
### ðŸ“„ `RuleEventType.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`RuleEventType`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `RuleRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`RuleRead`**

---
### ðŸ“„ `ScopeType.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ScopeType`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ScreenCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ScreenCreate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ScreenList.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ScreenList`**

---
### ðŸ“„ `ScreenRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ScreenRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `SelectOption.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`SelectOption`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `StateMachineCreate.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`StateMachineCreate`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `StateMachineRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`StateMachineRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `Token.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`Token`**

---
### ðŸ“„ `TransitionOption.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`TransitionOption`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `TransitionRequest.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`TransitionRequest`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `TransitionResponse.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`TransitionResponse`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `UserLogin.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`UserLogin`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `UserRead.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`UserRead`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `ValidationError.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`ValidationError`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
### ðŸ“„ `WidgetType.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`WidgetType`**
  * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*

---
## ðŸ“‚ `frontend/src/api/services/`

### ðŸ“„ `AiCortexService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AiCortexService`**

---
### ðŸ“„ `AuthService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`AuthService`**

---
### ðŸ“„ `MetaKernelService.ts`
> FILEPATH: frontend/src/api/services/MetaKernelService.ts

**Components & Logic:**

* **`MetaKernelService`**

---
### ðŸ“„ `NexusBrokerService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`NexusBrokerService`**

---
### ðŸ“„ `PolicyGroupsService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`PolicyGroupsService`**

---
### ðŸ“„ `SystemCoreService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`SystemCoreService`**

---
### ðŸ“„ `UniversalResourceService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`UniversalResourceService`**

---
### ðŸ“„ `WorkflowEngineService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`WorkflowEngineService`**

---
### ðŸ“„ `WorkflowsService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`WorkflowsService`**

---
### ðŸ“„ `WorkspaceService.ts`
> generated using openapi-typescript-codegen -- do not edit */

**Components & Logic:**

* **`WorkspaceService`**

---
## ðŸ“‚ `frontend/src/`

### ðŸ“„ `config.ts`
> FILEPATH: frontend/src/config.ts */

**Components & Logic:**

* **`API_BASE_URL`**
  * ðŸ“ *localhost:8000';*
  * **Logic Flow:**
    * `3. Application Metadata`
* **`APP_VERSION`**
  * ðŸ“ *Remove any remaining trailing slashes*
* **`IS_DEV`**
* **`IS_DEBUG`**

---
## ðŸ“‚ `frontend/src/domains/meta/_kernel/`

### ðŸ“„ `CapabilitiesContext.tsx`
> Fetches and provides System Introspection Data.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel)` |
| **invariant** | `Must be the ONLY instance in the app.` |
| **updated** | `Added Strict Array Sanitization to prevent 'NEURAL LINK SEVERED' crash.` |

**Components & Logic:**

* **`CapabilityItem`**
* **`ContextField`**
* **`SystemCapabilities`**
* **`CapabilitiesProvider`**
  * **Logic Flow:**
    * `âš¡ SANITIZATION LAYER: Ensure no null arrays to prevent crashes`
* **`useCapabilities`**

---
### ðŸ“„ `MetaContext.tsx`
> Manages Domain Selection, Scope, and Deep Linking. Bridges the URL to the Application State.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel) */` |

**Components & Logic:**

* **`MetaProvider`**
  * **Logic Flow:**
    * `1. DATA: Fetch Topology (Domains -> Scopes)`
    * `2. STATE: Universal URL Persistence`
    * `3. DERIVED STATE: Resolve Objects from Keys`
    * `4. ACTIONS (The Interface Implementation)`
    * `Clear children when parent changes`
    * `5. SIDE EFFECTS`
    * `6. CONSTRUCT CONTEXT`
* **`useMetaContext`**

---
### ðŸ“„ `types.ts`
> Shared type definitions for the Meta Module state.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel Definition) */` |
| **invariant** | `Must match Backend Pydantic Models in 'app.core.kernel.registry.schemas'. */` |
| **updated** | `Added 'selectedItem' for Global Deep Linking. */` |

**Components & Logic:**

* **`ScopeConfig`**
  * ðŸ“ *Shared type definitions for the Meta Module state.*
  * **Logic Flow:**
    * `For Governance/Sub-Flow: Which DB column does this control?`
    * `For Wizards: "CREATE" or "EDIT"`
    * `For Jobs: "high_priority" etc.`
    * `Generic Configuration`
    * `âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)`
* **`DomainTypeProperties`**
  * ðŸ“ *âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)*
* **`DomainTypeDefinition`**
  * **Logic Flow:**
    * `âš¡ FIX: Added strictly typed properties bag to receive Backend Contract`
* **`DomainSummary`**
  * **Logic Flow:**
    * `âš¡ DYNAMIC TYPE (Data-Driven)`
    * `Matches 'backend/app/domains/system/features/domain_types/models.py'`
    * `âš¡ TOPOLOGY METADATA (Level 100)`
    * `Visuals`
    * `Capabilities`
* **`MetaContextState`**
  * **Logic Flow:**
    * `Selection State (Deep Linking)`
    * `âš¡ GLOBAL ITEM STATE (Fixes Refresh Amnesia)`
    * `Data Access`

---
## ðŸ“‚ `frontend/src/domains/meta/_shell/`

### ðŸ“„ `MetaLayout.tsx`
> FILEPATH: frontend/src/domains/meta/_shell/MetaLayout.tsx */

**Components & Logic:**

* **`MetaLayout`**

---
### ðŸ“„ `MetaRoot.tsx`
> Provides the MetaContext and persistent Layout Shell for the Meta Kernel.

**Components & Logic:**

* **`MetaRoot`**

---
### ðŸ“„ `MetaSidebar.tsx`
> High-density navigation for the System Configuration module.

| Attribute | Value |
| :--- | :--- |
| **updated** | `Added 'Cortex Studio' link. */` |

**Components & Logic:**

* **`MetaSidebar`**
  * **Logic Flow:**
    * `âš¡ PERSISTENCE`
    * `âš¡ SYSTEM LINK`
    * `âš¡ THE APP STORE`
    * `Import for Studio icon was missing in previous file provided, adding generic import if needed,`
    * `but sticking to icons available in imports above.`
    * `Wait, I missed AppstoreAddOutlined in the imports list above.`
    * `I will add it to the imports to be safe.`
    * `âš¡ RE-ADDING MISSING ICON IMPORT MANUALLY TO ENSURE SAFETY`

---
## ðŸ“‚ `frontend/src/domains/meta/components/`

### ðŸ“„ `DomainTree.tsx`
> A hierarchical visual grid to select Domains. Supports nesting (Parent -> Child).

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only) */` |

**Components & Logic:**

* **`DomainTree`**
  * **Logic Flow:**
    * `âš¡ TOPOLOGY ENGINE: Build the Tree`
    * `1. Initialize Nodes`
    * `2. Link Parents & Children`
    * `If parent exists in the map, link it. Otherwise, treat as root.`
    * `3. Sort by Module then Label`
    * `âš¡ RENDERER: Recursive Node`
    * `Card Style`

---
### ðŸ“„ `RuleBuilder.tsx`
> FILEPATH: frontend/src/domains/meta/components/RuleBuilder.tsx */

**Components & Logic:**

* **`RuleBuilder`**
  * ðŸ“ *--- COMPONENT ---*
  * **Logic Flow:**
    * `1. Context Intelligence`
    * `2. Kernel Capabilities (Dynamic Introspection)`
    * `3. Form State`
    * `4. Logic State (Simplified Builder)`
    * `5. Effect State`
    * `--- HELPERS ---`
    * `Compile Visual Conditions to JMESPath String`

---
## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/`

### ðŸ“„ `AppStudioView.tsx`
> Orchestrates Lobby, Canvas, and Brick Library. Passes Meta History to Editor.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Deep Linking) */` |

**Components & Logic:**

* **`AppStudioView`**
  * **Logic Flow:**
    * `1. GLOBAL STATE (URL)`
    * `2. LOGIC HOOK (Actions & Screens List)`
    * `3. DERIVED STATE`
    * `4. DATA HOOK (Layout & Content)`
    * `We only fetch layout if we have an active screen`
    * `âš¡ NORMALIZE APPS FOR EDITOR`
    * `--- HANDLERS ---`
    * `âš¡ DND HANDLER (Delegated from Editor)`
    * `CASE A: Dropped on a ZONE`
    * `CASE B: Dropped on a FOLDER (Container)`
    * `âš¡ CONTEXT MENU HANDLER (The "Easy Way")`
    * `--- RENDER: LOBBY MODE ---`
    * `--- RENDER: EDITOR MODE ---`
    * `âš¡ INJECT HISTORY: Pass the meta from the layout response`

---
## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/components/`

### ðŸ“„ `AppConfigurator.tsx`
> The Inspector. Now supports Parent/Child relationships with strict Container filtering.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must handle missing 'config' objects gracefully. Only nesting under CONTAINERS is allowed. */` |

**Components & Logic:**

* **`AppConfigurator`**
  * **Logic Flow:**
    * `âš¡ HIERARCHY LOGIC: Build Tree Options for Parent Selection`
    * `âš¡ STRICT FILTER: Only allow nesting under CONTAINERS in the SIDEBAR`
    * `FIX: Check both 'type' (Runtime) and 'scope_type' (Static) to ensure compatibility`
    * `âš¡ FIX: Safe access to config.label with fallbacks`
    * `ðŸ›¡ï¸ SAFE ACCESS`
    * `Identity`
    * `Placement & Hierarchy`
    * `Behavior (Polymorphic)`
    * `Security`
    * `âš¡ DYNAMIC FIELDS based on Brick Type`

---
### ðŸ“„ `AppStudioLobby.tsx`
> The "Welcome Screen" for the App Studio. Lists existing apps and allows creation.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only List) */` |
| **invariant** | `Must display all available screens from the registry. */` |

**Components & Logic:**

* **`AppStudioLobby`**
  * **Logic Flow:**
    * `âš¡ GOVERNANCE FILTER: Hide screens locked by backend policy (mode='strict')`
    * `We strictly filter out any screen that claims to be "strict" in its security policy.`

---
### ðŸ“„ `BrickLibrary.tsx`
> The "Smart" Palette with Context Menu for instant placement.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Safe Return) */` |
| **invariant** | `Must filter by text and type. Must handle empty data gracefully. */` |
| **updated** | `Fixed missing 'Space' import to prevent ReferenceError. */` |

**Components & Logic:**

* **`BrickLibrary`**
  * **Logic Flow:**
    * `âš¡ FILTER LOGIC`
    * `âš¡ GROUPING LOGIC`
    * `âš¡ CONTEXT MENU FACTORY`

---
### ðŸ“„ `CreateAppModal.tsx`
> A form to define the Identity (Name, Route, Purpose) of a new Application before it exists.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Input Validation) */` |
| **invariant** | `Route Slug must be URL-safe (lowercase, hyphens). */` |

**Components & Logic:**

* **`CreateAppModal`**
  * **Logic Flow:**
    * `âš¡ AUTO-SLUG LOGIC`
    * `When title changes, auto-generate a slug if the user hasn't manually edited it.`
    * `Only auto-set if the slug field is pristine or matches the previous auto-gen`

---
### ðŸ“„ `DraggableBrick.tsx`
> A palette item that uses @dnd-kit to be compatible with the Screen Canvas.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (DND-Kit Integrated) */` |
| **invariant** | `Must pass 'brick' data to the drag context. */` |

**Components & Logic:**

* **`DraggableBrick`**
  * **Logic Flow:**
    * `âš¡ DND-KIT HOOK`

---
### ðŸ“„ `IconFactory.tsx`
> Renders icons from Token Strings. Supports 'antd:' prefix.

**Components & Logic:**

* **`IconFactory`**
  * **Logic Flow:**
    * `1. Handle Empty`
    * `2. Parse Token`
    * `3. Render Strategy: Ant Design`
    * `Fallback`

---
### ðŸ“„ `IconPicker.tsx`
> Visual grid for selecting icons. Dynamically loads entire Ant Design library.

**Components & Logic:**

* **`IconPicker`**
  * **Logic Flow:**
    * `âš¡ SEARCH ENGINE: Filters 800+ icons instantly`

---
### ðŸ“„ `ScreenCanvas.tsx`
> Renders the Application Wireframe with nested Container support.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must visually represent the layout structure accurately, including hierarchy. */` |

**Components & Logic:**

* **`ScreenCanvas`**

---
### ðŸ“„ `StudioEditor.tsx`
> The full-screen IDE interface. Displays Version History in Header.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Partition) */` |
| **narrator** | `ðŸ•µï¸ TELEMETRY + VERSIONING ENABLED */` |

**Components & Logic:**

* **`StudioEditor`**
  * **Logic Flow:**
    * `ðŸ•µï¸ TELEMETRY`
    * `âš¡ PUBLISH STATE`
    * `âš¡ SEMVER CALCULATOR`
    * `âš¡ FIX: Pass the user-edited version string`

---
## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/hooks/`

### ðŸ“„ `useAppStudio.ts`
> Manages IDE Actions. Updates 'publishApp' to support explicit version labels.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Direct Fetch Implementation) */` |

**Components & Logic:**

* **`useAppStudio`**
  * **Logic Flow:**
    * `1. DATA (Bricks Only - Workspace is managed by View)`
    * `Normalize Library Data`
    * `2. STATE`
    * `âš¡ HELPER: Direct Fetcher`
    * `âš¡ ACTION: Fetch Screens List (With Race Condition Fix)`
    * `3. ACTIONS`
    * `âš¡ FIX: Accept versionLabel explicitly`

---
## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/`

### ðŸ“„ `index.ts`
> Exports the main view. Used by the Router.

---
### ðŸ“„ `types.ts`
> Added 'Release' interface for version history.

**Components & Logic:**

* **`BrickType`**
  * ðŸ“ *Added 'Release' interface for version history.*
* **`SystemBrick`**
  * **Logic Flow:**
    * `2. THE SCREEN`
* **`Screen`**
  * ðŸ“ *2. THE SCREEN*
  * **Logic Flow:**
    * `3. THE APP`
* **`ActiveApp`**
  * ðŸ“ *3. THE APP*
  * **Logic Flow:**
    * `âš¡ NEW: RELEASE HISTORY`
* **`Release`**
  * ðŸ“ *âš¡ NEW: RELEASE HISTORY*
* **`ZoneType`**
* **`DragItem`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/cortex/`

### ðŸ“„ `CortexView.tsx`
> Standalone view for the AI Architect.

| Attribute | Value |
| :--- | :--- |
| **updated** | `Added Domain Picker and Back Navigation to the Active Toolbar. */` |

**Components & Logic:**

* **`CortexView`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/`

### ðŸ“„ `DictionaryView.tsx`
> Master Controller. Fixes 'config' vs 'configuration' crash and Layout Regressions.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`DictionaryView`**
  * **Logic Flow:**
    * `1. GLOBAL CONTEXT`
    * `Sync URL -> Context`
    * `2. FEATURE LOGIC`
    * `Local UI State`
    * `3. HANDLERS`
    * `4. COMPUTED: Safe Data Resolution`
    * `âš¡ CONTRACT FIX: Ensure we map DB config to 'configuration'`
    * `Return Fresh Draft for "New" mode`
    * `âš¡ SECURITY CHECK: Is this a System Field?`
    * `âš¡ STATE: Are we in "New Mode"?`
    * `--- RENDER: STATE A (LOBBY) ---`
    * `--- RENDER: STATE B (MASTER-DETAIL EDITOR) ---`

---
## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/components/`

### ðŸ“„ `AttributeEditor.tsx`
> The Master Controller for editing Attributes. Uses 'configuration' correctly.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`AttributeEditor`**
  * **Logic Flow:**
    * `âš¡ SYNC: Update local state if parent selection changes`
    * `âš¡ LOGIC: Auto-switch widget if data type changes`
    * `âš¡ CONTRACT FIX: Updates 'configuration', NOT 'config'`
    * `We allow config updates even if locked, generally (e.g. placeholder)`
    * `but maybe not logic. For now, allow it.`
    * `âš¡ LOGIC: Auto-Slugify`
    * `Label is editable even if locked (usually)`
    * `Widget CAN change usually, unless strict`
    * `âš¡ CRITICAL FIX: Pass 'configuration', not 'config'`

---
### ðŸ“„ `AttributeExplorer.tsx`
> Navigable list of Domain Attributes.

**Components & Logic:**

* **`AttributeExplorer`**
  * **Logic Flow:**
    * `ðŸ§  SMART SORTING`
    * `âš¡ FIX: Use 'key' (string) instead of 'id' (number) for uniqueness`
    * `System fields all have ID 0, which caused Duplicate Key errors.`

---
### ðŸ“„ `DomainPicker.tsx`
> A visual grid to select which Domain Schema to edit.

| Attribute | Value |
| :--- | :--- |
| **updated** | `Fixed visual overlap by switching to Vertical Layout. Increased Card Size. */` |

**Components & Logic:**

* **`DomainPicker`**
  * **Logic Flow:**
    * `âš¡ RENDERER: Capability Popover Content`
    * `Governance Check`
    * `Visual States`

---
## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/components/editor/`

### ðŸ“„ `ConfigPanels.tsx`
> Fractal sub-component for handling Type-Specific settings. CRASH PROOFED.

**Components & Logic:**

* **`ConfigPanels`**
  * **Logic Flow:**
    * `âš¡ CRASH GUARD: Ensure we have an object to read from [cite: 1090]`
    * `--- 1. NUMBER CONFIGURATION ---`
    * `--- 2. TEXT CONFIGURATION ---`
    * `--- 3. SELECTION CONFIGURATION ---`
    * `--- 4. DATE / DATETIME ---`
    * `--- 5. REFERENCE (COMPLEX) ---`
    * `--- 6. FILE ---`

---
### ðŸ“„ `PreviewPanel.tsx`
> FILEPATH: frontend/src/domains/meta/features/dictionary/components/editor/PreviewPanel.tsx */

**Components & Logic:**

* **`PreviewPanel`**
  * **Logic Flow:**
    * `--- TEXT WIDGETS ---`
    * `--- NUMBER WIDGETS ---`
    * `--- SELECTION WIDGETS ---`
    * `--- DATE WIDGETS ---`
    * `--- BOOLEAN WIDGETS ---`
    * `--- FILE WIDGETS ---`
    * `--- COMPLEX WIDGETS ---`
    * `Fallback`

---
## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/hooks/`

### ðŸ“„ `useDictionary.ts`
> FILEPATH: frontend/src/domains/meta/features/dictionary/hooks/useDictionary.ts */

**Components & Logic:**

* **`useDictionary`**
  * **Logic Flow:**
    * `1. FETCH ATTRIBUTES`
    * `âš¡ GATEWAY: Use standardized base`
    * `2. SAVE (CREATE / UPDATE)`
    * `Update Existing`
    * `Create New`
    * `3. DELETE`
    * `Data`
    * `Actions`
    * `State`

---
## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/logic/`

### ðŸ“„ `schemaNormalizer.ts`
> FILEPATH: frontend/src/domains/meta/features/dictionary/logic/schemaNormalizer.ts */

**Components & Logic:**

* **`normalizeSchema`**
  * **Logic Flow:**
    * `Scenario A: It's already an Array`
    * `Scenario B: It's a Hybrid Schema Object`
    * `Check possible containers`

---
## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/types/`

### ðŸ“„ `constants.ts`
> FILEPATH: frontend/src/domains/meta/features/dictionary/types/constants.ts */

**Components & Logic:**

* **`AttributeType`**
  * ðŸ“ *Values that EXIST at runtime (Enums, Objects).*
* **`WidgetType`**
  * **Logic Flow:**
    * `Text`
    * `Numeric`
    * `Choice`
    * `Boolean`
    * `Date`
    * `Advanced`
    * `ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type`
* **`WIDGET_COMPATIBILITY`**
  * ðŸ“ *ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type*
  * **Logic Flow:**
    * `ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions`
* **`HELP_TEXT`**
  * ðŸ“ *ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions*
* **`DEFAULT_DRAFT_CONFIG`**

---
### ðŸ“„ `index.ts`
> FILEPATH: frontend/src/domains/meta/features/dictionary/types/index.ts */

**Components & Logic:**

* **`DEFAULT_DRAFT`**
  * ðŸ“ *3. Default Constant*

---
### ðŸ“„ `types.ts`
> FILEPATH: frontend/src/domains/meta/features/dictionary/types/types.ts */

**Components & Logic:**

* **`SelectOption`**
* **`AttributeConfig`**
  * **Logic Flow:**
    * `Text`
    * `Number`
    * `Date`
    * `Options`
    * `Reference`
    * `File`
    * `JSON`
    * `General`
* **`AttributeDefinition`**
* **`AttributeDraft`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/governance/`

### ðŸ“„ `GovernanceView.tsx`
> The Master Controller for the Rule Engine.

**Components & Logic:**

* **`GovernanceView`**
  * **Logic Flow:**
    * `1. GLOBAL CONTEXT (The Session)`
    * `âš¡ GLOBAL STATE: Deep Linking`
    * `Local UI State (Transient)`
    * `2. LOGIC (Only runs if domain is selected)`
    * `3. HANDLERS`
    * `4. COMPUTED`
    * `--- RENDER: STATE A (LOBBY) ---`
    * `--- RENDER: STATE B (EDITOR) ---`

---
## ðŸ“‚ `frontend/src/domains/meta/features/governance/components/`

### ðŸ“„ `JmesPathHelp.tsx`
> FILEPATH: frontend/src/domains/meta/features/governance/components/JmesPathHelp.tsx */

**Components & Logic:**

* **`JmesPathHelp`**
  * **Logic Flow:**
    * `--- CONTENT DATA ---`
    * `--- RENDERERS ---`

---
### ðŸ“„ `PolicyEditor.tsx`
> Advanced Policy Editor with Multi-Vector Consequence Stacks.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Validation) */` |

**Components & Logic:**

* **`PolicyEditor`**
  * **Logic Flow:**
    * `âš¡ HYDRATED DATA SOURCE`
    * `--- HANDLERS ---`
    * `âš¡ AUTO-KEY GENERATION`
    * `Only auto-generate key if it's a NEW policy (no ID) to avoid breaking existing bindings`
    * `âš¡ MULTI-CONSEQUENCE MANAGEMENT`
    * `--- RENDER HELPERS ---`

---
### ðŸ“„ `PolicyExplorer.tsx`
> FILEPATH: frontend/src/domains/meta/features/governance/components/PolicyExplorer.tsx */

**Components & Logic:**

* **`PolicyExplorer`**
  * **Logic Flow:**
    * `Helper to format v1.05`
    * `Default to v1.00 if missing (legacy data)`
    * `âš¡ SHOW VERSION`

---
## ðŸ“‚ `frontend/src/domains/meta/features/governance/components/editor/`

### ðŸ“„ `EnforcementPanel.tsx`
> FILEPATH: frontend/src/domains/meta/features/governance/components/editor/EnforcementPanel.tsx */

**Components & Logic:**

* **`EnforcementPanel`**
  * **Logic Flow:**
    * `Filter bindings for *this* policy`
    * `State for New Binding`

---
### ðŸ“„ `HistoryDrawer.tsx`
> FILEPATH: frontend/src/domains/meta/features/governance/components/editor/HistoryDrawer.tsx */

**Components & Logic:**

* **`HistoryDrawer`**
  * **Logic Flow:**
    * `âš¡ GATEWAY: Use standardized base`
    * `âš¡ FIX: Use the Hook-based Modal, not the Static one`

---
### ðŸ“„ `LogicBuilder.tsx`
> Recursive Subject-Verb-Object Composer for Governance Rules.

**Components & Logic:**

* **`LogicBuilder`**
  * **Logic Flow:**
    * `1. STATE`
    * `2. PARSER (Simulated for this iteration - usually requires AST)`
    * `We default to Code Mode if we detect complex logic we can't parse yet.`
    * `Simple heuristic: If it looks like a flat tree, try to load it.`
    * `For Level 100 SVO, we assume new rules start empty or simple.`
    * `If complex, we stay in code mode.`
    * `3. COMPILER (Tree -> JMESPath)`
    * `RULE`
    * `4. HANDLERS`
    * `Find parent and push child`
    * `--- RENDERERS ---`
    * `RULE (Leaf)`

---
### ðŸ“„ `TestPanel.tsx`
> FILEPATH: frontend/src/domains/meta/features/governance/components/editor/TestPanel.tsx */

**Components & Logic:**

* **`TestPanel`**
  * **Logic Flow:**
    * `Default mock data based on standard "host" envelope`

---
## ðŸ“‚ `frontend/src/domains/meta/features/governance/components/editor/logic/`

### ðŸ“„ `SubjectPicker.tsx`
> Smart Context Selector with Lazy Loading, Module Grouping, and State Hydration.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Data Access) */` |

**Components & Logic:**

* **`SubjectPicker`**
  * **Logic Flow:**
    * `âš¡ STATE HYDRATION: Restore tab and domain from existing value`
    * `Check known roots`
    * `Assume Global Domain (e.g., "user.email" -> Domain "USER")`
    * `Ensure it's not one of our reserved keywords`
    * `âš¡ LAZY LOAD: Global Domain List`
    * `âš¡ DATA TRANSFORM: Group Domains by Module`
    * `âš¡ LAZY LOAD: Specific Domain Schema`
    * `--- RENDERERS ---`

---
## ðŸ“‚ `frontend/src/domains/meta/features/governance/hooks/`

### ðŸ“„ `useGovernance.ts`
> Manages Policy State and Fuses Domain Schema with System Context.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Schema Fusion)` |
| **updated** | `Aligned API calls with generated OpenAPI SDK. Preserved Delete logic.` |

**Components & Logic:**

* **`useGovernance`**
  * **Logic Flow:**
    * `1. FETCH POLICIES (The Law)`
    * `âš¡ FIX: Use generated SDK name`
    * `2. FETCH FUSED SCHEMA (The Vocabulary)`
    * `âš¡ LEVEL 100: Context Fusion`
    * `The API returns the "Fused" schema (Static + Dynamic + Context)`
    * `âš¡ FIX: Use generated SDK name`
    * `3. CREATE POLICY`
    * `âš¡ FIX: Use generated SDK name`
    * `4. UPDATE POLICY`
    * `âš¡ FIX: Use generated SDK name`
    * `5. DELETE POLICY (Restored)`
    * `âš¡ FIX: Use 'any' cast if SDK signature varies, but call correct delete endpoint`
    * `Assuming standard naming pattern from codegen`
    * `6. DRY RUN`
    * `âš¡ FIX: Use generated SDK name`
    * `Data`
    * `Actions`
    * `State`

---
### ðŸ“„ `usePolicyBindings.ts`
> FILEPATH: frontend/src/domains/meta/features/governance/hooks/usePolicyBindings.ts */

**Components & Logic:**

* **`PolicyBinding`**
* **`PolicyBindingDraft`**
* **`usePolicyBindings`**
  * **Logic Flow:**
    * `1. FETCH BINDINGS`
    * `2. CREATE BINDING`
    * `3. TOGGLE/UPDATE BINDING`
    * `4. DELETE BINDING`

---
## ðŸ“‚ `frontend/src/domains/meta/features/governance/types/`

### ðŸ“„ `index.ts`
> Contracts for Policy Management and Logic Building.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Type Safety) */` |

**Components & Logic:**

* **`Consequence`**
  * ðŸ“ *--- CONSEQUENCES (The Verdicts) ---*
  * **Logic Flow:**
    * `--- RULES ---`
* **`Rule`**
  * ðŸ“ *--- RULES ---*
  * **Logic Flow:**
    * `âš¡ ENTERPRISE UPGRADE: Multi-Vector Consequences`
    * `Metadata`
    * `--- POLICIES ---`
* **`Policy`**
  * ðŸ“ *--- POLICIES ---*
  * **Logic Flow:**
    * `Ledger Metadata`
* **`PolicyDraft`**
* **`DEFAULT_POLICY_DRAFT`**
  * **Logic Flow:**
    * `--- SCHEMA REFLECTION (For Dropdowns) ---`
* **`SelectOption`**
  * ðŸ“ *--- SCHEMA REFLECTION (For Dropdowns) ---*
* **`SchemaField`**
  * **Logic Flow:**
    * `âš¡ GROUPING: For the Omni-Picker`
    * `--- SIMULATION ---`
* **`DryRunRequest`**
  * ðŸ“ *--- SIMULATION ---*
* **`DryRunResult`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/`

### ðŸ“„ `PolicyGroupsView.tsx`
> Main view for managing Policy Bundles (Groups).

**Components & Logic:**

* **`PolicyGroupsView`**
  * **Logic Flow:**
    * `1. GLOBAL CONTEXT (Editor State via ?select=...)`
    * `2. UNIVERSAL URL STATE (View State)`
    * `3. Data`
    * `4. Computed (Filter)`
    * `--- COMPUTED EDITOR STATE ---`
    * `--- ACTIONS ---`
    * `--- TABLE COLUMNS ---`

---
## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/components/`

### ðŸ“„ `GroupEditor.tsx`
> FILEPATH: frontend/src/domains/meta/features/policy_groups/components/GroupEditor.tsx */

**Components & Logic:**

* **`GroupEditor`**
  * **Logic Flow:**
    * `âš¡ AUTO-CAPS HANDLER`
    * `Validation failed`

---
## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/hooks/`

### ðŸ“„ `usePolicyGroups.ts`
> FILEPATH: frontend/src/domains/meta/features/policy_groups/hooks/usePolicyGroups.ts */

**Components & Logic:**

* **`usePolicyGroups`**
  * **Logic Flow:**
    * `1. FETCH GROUPS`
    * `2. CREATE GROUP`
    * `3. UPDATE GROUP`
    * `4. DELETE GROUP`

---
## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/`

### ðŸ“„ `types.ts`
> FILEPATH: frontend/src/domains/meta/features/policy_groups/types.ts */

**Components & Logic:**

* **`PolicyGroup`**
  * ðŸ“ *TypeScript interfaces for Policy Bundles.*
  * **Logic Flow:**
    * `The ordered list of policy keys to execute`
* **`GroupDraft`**
* **`DEFAULT_GROUP_DRAFT`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/runner/`

### ðŸ“„ `RunnerView.tsx`
> The "Launchpad" for Business Processes.

**Components & Logic:**

* **`RunnerView`**
  * **Logic Flow:**
    * `1. UNIVERSAL URL STATE (Search Persistence)`
    * `2. DISCOVERY ENGINE`
    * `Flatten the Domain->Scope hierarchy into a list of "Apps"`
    * `âš¡ FILTER: Only show Wizards (Interactive Processes)`
    * `3. ROUTING LOGIC`
    * `4. RENDER: RUNTIME HOST (The Overlay)`
    * `5. RENDER: DASHBOARD (The Grid)`

---
### ðŸ“„ `RuntimeHost.tsx`
> The "Focus Mode" container for running a Wizard.

**Components & Logic:**

* **`RuntimeHost`**
  * **Logic Flow:**
    * `1. RESOLVE CONTEXT (Metadata)`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/`

### ðŸ“„ `StatesView.tsx`
> The Orchestrator for State Machines. Uses Tree Topology for Navigation.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`StatesView`**
  * **Logic Flow:**
    * `1. GLOBAL CONTEXT (Deep Linking for Selection)`
    * `Resolve active state from context (Handle DEFAULT case)`
    * `2. UNIVERSAL URL STATE (Persistence)`
    * `Sync URL -> Context`
    * `âš¡ NODE SYNC: If URL has node, sync to context. If URL has NO node, clear context.`
    * `We use '' to represent no selection in the URL, effectively null`
    * `3. DATA LOADING`
    * `We only fetch workflows if a domain is selected`
    * `4. Local UI State (Transient)`
    * `Auto-open right panel if we have a deep link selection`
    * `Effect: Keep right panel sync with selection`
    * `If panel closed but item selected, deselect item (two-way bind)`
    * `Clean URL`
    * `5. Data Hooks`
    * `Find the definition for the selected scope`
    * `âš¡ HELPER: Resolve Workflow Type Logic`
    * `We need to know if this is a WIZARD, JOB, or GOVERNANCE flow to render the right tools.`
    * `A. Check Registry`
    * `B. Check Metadata`
    * `C. Fallback`
    * `âš¡ SMART TYPE RESOLUTION`
    * `Some keys might be "WIZARD" (Backend enum) vs "WIZARD_FLOW" (UI Constant)`
    * `We normalize here.`
    * `âš¡ FILTERED LIST`
    * `6. Session Manager`
    * `Manages the "Draft" state vs "Live" state`
    * `7. Navigation Guard`
    * `Close panels`
    * `If we have a domain but no scope selected,`
    * `AND we have workflows, maybe auto-select the first one?`
    * `No, better to show a list/gallery view.`
    * `Optional: Auto-select first?`
    * `handleSelectWorkflow(workflows[0].scope_key);`
    * `Sync Reset (If scope invalid for domain)`
    * `Only reset if we are sure it's loaded and truly missing`
    * `selectScope(''); // Commented out to prevent flash resets during load`
    * `Canvas Update`
    * `Sync URL for F5 safety`
    * `--- RENDER: STATE A (LOBBY) ---`
    * `âš¡ REFACTOR: Use DomainTree instead of Flat Picker`
    * `--- RENDER: STATE B (WORKFLOW GALLERY) ---`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/`

### ðŸ“„ `CodeEditorDrawer.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/CodeEditorDrawer.tsx */

**Components & Logic:**

* **`CodeEditorDrawer`**
  * **Logic Flow:**
    * `Sync when opening or when definition changes externally`
    * `Basic Schema Check to prevent graph crashes`

---
### ðŸ“„ `DomainPicker.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/DomainPicker.tsx */

**Components & Logic:**

* **`DomainPicker`**
  * **Logic Flow:**
    * `âš¡ SAFETY: Ensure we have an array`
    * `Only block with spinner if we have NO data to show`
    * `Fix for AntD v5 style warning`

---
### ðŸ“„ `EditorToolbar.tsx`
> The Control Deck for the Workflow Editor.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe Guards)` |
| **invariant** | `Delete button only visible in VIEW mode.` |
| **fix** | `Changed Edit icon to 'EditOutlined'. Added z-index.` |

**Components & Logic:**

* **`EditorToolbar`**

---
### ðŸ“„ `EventRegistryModal.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/EventRegistryModal.tsx */

**Components & Logic:**

* **`EventRegistryModal`**
  * **Logic Flow:**
    * `âš¡ MOCK DEFAULT EVENTS (In production, fetch from CapabilitiesContext)`
    * `Merge system defaults with any custom ones passed in`
    * `Deduplicate by key`
    * `Simple creation logic for now - just returns the uppercase search text`
    * `Hover effect handled via CSS or inline mouse events if needed`

---
### ðŸ“„ `FlowCanvas.tsx`
> Provides the ReactFlow surface.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Invariant)` |
| **invariant** | `NodeTypes must be Memoized. Wrapper must be 100% Width/Height.` |
| **narrator** | `Logs layout recalculations.` |

**Components & Logic:**

* **`FlowCanvas`**
  * **Logic Flow:**
    * `âš¡ CRITICAL FIX: Provider wraps everything`

---
### ðŸ“„ `InspectorPanel.tsx`
> The Right-Hand Panel that decides WHICH tools to show.

**Components & Logic:**

* **`InspectorPanel`**
  * ðŸ“ *The Inspector Panel handles the contextual editing of Nodes, Edges, and Workflow Properties.*
  * **Logic Flow:**
    * `âš¡ PERSISTENT TAB STATE`
    * `"config" or "json"`
    * `âš¡ FETCH REAL DB CONTEXT`
    * `âš¡ FETCH WIDGET REGISTRY (Safe Access)`
    * `âš¡ FIX: Use 'allWidgets' directly. The hook returns an array, not a Map 'registry'.`
    * `Resolve Node Data`
    * `âš¡ POLYMORPHIC RESOLUTION`
    * `Deep update the node data`
    * `Update parent`
    * `âš¡ APPEND FIELDS (Don't Overwrite)`
    * `Persist Update`
    * `Deep update parent structure to ensure React Flow sees the change`
    * `For Generic/Governance, maybe append to description?`
    * `Implementation for future expansion`

---
### ðŸ“„ `NodeCard.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/NodeCard.tsx */

**Components & Logic:**

* **`NodeCard`**
  * **Logic Flow:**
    * `âš¡ START NODE STYLING`
    * `ðŸŽ¨ Dynamic Styling based on Selection`

---
### ðŸ“„ `OSExplorerModal.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/OSExplorerModal.tsx */

**Components & Logic:**

* **`OSExplorerModal`**
  * **Logic Flow:**
    * `Safe access`
    * `âš¡ DATA TRANSFORMATION: Registry -> AntD Tree Data`
    * `Mock fields for visual feedback`
    * `âš¡ FILTER LOGIC`

---
### ðŸ“„ `WorkflowGenesis.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/WorkflowGenesis.tsx */

**Components & Logic:**

* **`WorkflowGenesis`**
  * **Logic Flow:**
    * `Default: Governance`
    * `âš¡ FIX: Removed aggressive maxHeight/overflow on body.`
    * `AntD handles this natively better.`
    * `âš¡ CONSTANT DRIVEN OPTIONS`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/canvas/`

### ðŸ“„ `CanvasPalette.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/canvas/CanvasPalette.tsx */

**Components & Logic:**

* **`CanvasPalette`**

---
### ðŸ“„ `FloatingToolbar.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/canvas/FloatingToolbar.tsx */

**Components & Logic:**

* **`FloatingToolbar`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/canvas/nodes/`

### ðŸ“„ `ScreenNode.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/canvas/nodes/ScreenNode.tsx */

**Components & Logic:**

* **`ScreenNode`**
  * **Logic Flow:**
    * `Extract Metadata`

---
### ðŸ“„ `StandardNode.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/canvas/nodes/StandardNode.tsx */

**Components & Logic:**

* **`StandardNode`**

---
### ðŸ“„ `TaskNode.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/canvas/nodes/TaskNode.tsx */

**Components & Logic:**

* **`TaskNode`**
  * **Logic Flow:**
    * `Extract Metadata`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/`

### ðŸ“„ `InspectorShell.tsx`
> The outer frame of the Inspector Panel. Provides the Header, Close Action, and AI Trigger.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must always provide a Close button. AI button is optional. */` |

**Components & Logic:**

* **`InspectorShell`**
  * ðŸ“ *Standardized container for all Inspector panels.*
  * **Logic Flow:**
    * `ðŸ” DEBUG TRACE`
    * `--- RENDERERS ---`

---
### ðŸ“„ `JobNode.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/JobNode.tsx */

**Components & Logic:**

* **`JobNode`**

---
### ðŸ“„ `NodeInspector.tsx`
> Determines which specific Inspector to render based on the passed Workflow Type.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Data Integrity) */` |
| **invariant** | `Must handle null data gracefully. */` |

**Components & Logic:**

* **`NodeInspector`**
  * ðŸ“ *The Brain of the Inspector. Routes to the correct editor.*
  * **Logic Flow:**
    * `ðŸ”Š LOUD NARRATOR: Inspect Selection Context`
    * `âš¡ ROUTER LOGIC: Trust the Panel's decision (workflowType)`
    * `1. WIZARD SCOPE (Form Builder 2.0)`
    * `2. JOB SCOPE (DevOps Config)`
    * `3. DEFAULT / GOVERNANCE (Standard Config)`

---
### ðŸ“„ `StandardNode.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/StandardNode.tsx */

**Components & Logic:**

* **`StandardNode`**
  * **Logic Flow:**
    * `Convert AntD Color object to Hex string`

---
### ðŸ“„ `TransitionEdge.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/TransitionEdge.tsx */

**Components & Logic:**

* **`TransitionEdge`**

---
### ðŸ“„ `WizardNode.tsx`
> Specialized editor for UI Workflows with Space-Optimized Field Cards.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must write to 'meta' key to persist in XState. */` |

**Components & Logic:**

* **`WizardNode`**
  * **Logic Flow:**
    * `âš¡ DEEP EXTRACTION (Backend XState Structure)`
    * `âš¡ REACTIVE HYDRATION`
    * `âš¡ FIELD HANDLERS`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/governance/`

### ðŸ“„ `GovernanceEngine.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/governance/GovernanceEngine.tsx */

**Components & Logic:**

* **`GovernanceEngine`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/jobs/`

### ðŸ“„ `JobConfigurator.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/jobs/JobConfigurator.tsx */

**Components & Logic:**

* **`JobConfigurator`**
  * **Logic Flow:**
    * `Extract config safely`
    * `âš¡ INPUT MAPPING HANDLERS`
    * `If renaming key`
    * `Just updating value`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/`

### ðŸ“„ `AIComposer.tsx`
> Orchestrates the Context Browser and Prompt Interface with Isolated Theme Support.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `State must be lifted here to persist across tabs. */` |
| **updated** | `Connected 'selectedDomains' to Assembler for Multi-Domain Sync. */` |

**Components & Logic:**

* **`AIComposer`**
  * ðŸ“ *The centralized orchestrator for AI-assisted form generation.*
  * **Logic Flow:**
    * `Optional Injections`
    * `--- 1. UI STATE ---`
    * `--- 2. SELECTION STATE & DYNAMIC DOMAIN ---`
    * `âš¡ DYNAMIC PIVOT: Active Domain determines what the LEFT PANEL shows`
    * `--- 3. DATA RESOLUTION (For Left Panel Display Only) ---`
    * `We still fetch the active schema to detect loading state for the UI`
    * `--- 4. LOGIC HOOK (The Omniscient Assembler) ---`
    * `âš¡ INJECTED DATA`
    * `domainFields & schemaDomain REMOVED -> Assembler fetches on its own`
    * `âš¡ SELECTION STATE`
    * `--- 5. HANDLERS ---`
    * `--- 6. RENDER ---`

---
### ðŸ“„ `FieldConfigDrawer.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/wizard/FieldConfigDrawer.tsx */

**Components & Logic:**

* **`FieldConfigDrawer`**
  * **Logic Flow:**
    * `Reset form when opening`
    * `Determine initial mode based on key naming convention`
    * `Clean up internal flags`
    * `âš¡ LOGIC: Map DB Types to UI Components`
    * `Disable required if system field implies logic, but let user override`

---
### ðŸ“„ `WizardInspector.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/wizard/WizardInspector.tsx */

**Components & Logic:**

* **`WizardInspector`**
  * **Logic Flow:**
    * `Manage Detail View locally`
    * `âš¡ AI HANDLER: Appends generated fields`
    * `Merge strategy: Append to end`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/components/ContextBrowser/`

### ðŸ“„ `ComponentGallery.tsx`
> Visual grid for selecting UI Primitives to make available to the AI.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only) */` |
| **invariant** | `Must handle empty widget lists gracefully. */` |
| **updated** | `Fixed Data Binding (label -> name) and aligned Theme Tokens. */` |

**Components & Logic:**

* **`ComponentGallery`**
  * ðŸ“ *Renders a filterable grid of UI components.*
  * **Logic Flow:**
    * `âš¡ COMPUTE CATEGORIES`
    * `âš¡ FILTER LIST`
    * `âš¡ THEME FIX: Replaced hardcoded HEX with Tokens`
    * `âš¡ THEME FIX: Background adapts to Dark Mode`
    * `âš¡ THEME FIX: Color adapts`

---
### ðŸ“„ `DataPicker.tsx`
> Allows selection of Data Domains to inject Schema Context.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only) */` |
| **invariant** | `Must clearly indicate the 'Current' domain. */` |
| **updated** | `Tokenized colors for Dark Mode compatibility. */` |

**Components & Logic:**

* **`DataPicker`**
  * ðŸ“ *Renders a list of available Data Domains.*
  * **Logic Flow:**
    * `âš¡ THEME FIX: Use Tokens instead of Hardcoded Hex`

---
### ðŸ“„ `GovernancePicker.tsx`
> Provides granular selection of Policy Groups and specific Domain Policies.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only) */` |
| **invariant** | `Must distinguishing between 'GROUP:' and 'POLICY:' prefixes for the assembler. */` |

**Components & Logic:**

* **`GovernancePicker`**
  * ðŸ“ *Renders a dual-view picker for Governance constraints.*
  * **Logic Flow:**
    * `âš¡ FILTER LOGIC`
    * `âš¡ THEME MAPPING: Use semantic tokens instead of hardcoded hex`
    * `âš¡ THEME FIX: Dynamic Background`
    * `âš¡ THEME FIX: Dynamic Border`
    * `âš¡ THEME FIX: Input Background`

---
### ðŸ“„ `WorkflowPicker.tsx`
> Allows the user to select existing Workflows to inject as reference context for the AI.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only) */` |
| **invariant** | `Must filter displayed workflows by the current Domain context. */` |
| **narrator** | `Logs search interactions. */` |
| **updated** | `Replaced hardcoded HEX colors with System Theme Tokens. */` |

**Components & Logic:**

* **`WorkflowPicker`**
  * ðŸ“ *Renders a searchable list of workflows grouped by intent.*
  * **Logic Flow:**
    * `âš¡ FILTER & GROUP LOGIC`
    * `1. Text Filter`
    * `âš¡ THEME FIX: Swapped hardcoded background for Token`
    * `âš¡ THEME FIX: Swapped #f9f0ff for Token`
    * `âš¡ THEME FIX: Swapped #d3adf7 for Token`

---
### ðŸ“„ `index.tsx`
> Tabbed interface for browsing and selecting AI Context sources.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must retain selection state across tab switches. */` |

**Components & Logic:**

* **`ContextBrowser`**
  * ðŸ“ *The main container for the Context Selection Interface.*
  * **Logic Flow:**
    * `âš¡ DYNAMIC STYLING (Semantic)`
    * `We rely on the parent ConfigProvider (Dark Algorithm) to set token values correctly.`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/components/`

### ðŸ“„ `PromptInterface.tsx`
> The text input and control deck for sending instructions to the Cortex.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Handles DATABASE_SCHEMA rendering. */` |
| **updated** | `Added 'DATABASE_SCHEMA' case to fix 'Unknown' label. */` |

**Components & Logic:**

* **`PromptInterface`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/hooks/`

### ðŸ“„ `useContextAssembler.ts`
> Marshals Data, Rules, Flows, and UI Components into a structured AI Payload.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Sanitized Input) */` |
| **invariant** | `Sync is Manual & Omniscient. Fetches all selected domains on demand. */` |

**Components & Logic:**

* **`CommandMode`**
  * **Logic Flow:**
    * `domainFields: SchemaField[]; // âŒ REMOVED: Single source`
    * `schemaDomain?: string;       // âŒ REMOVED: Single source`
* **`useContextAssembler`**
  * **Logic Flow:**
    * `âš¡ STATE`
    * `âš¡ CHANGE DETECTION`
    * `âš¡ HELPER: Normalize API Response`
    * `âš¡ SYNC ENGINE (Omniscient)`
    * `ðŸ• Artificial Delay for UX`
    * `0. System Instruction`
    * `A. Database Context (MULTI-DOMAIN FETCH)`
    * `âš¡ PARALLEL FETCH: Get all schemas at once`
    * `B. Governance`
    * `C. Workflows`
    * `D. UI Toolkit`
    * `E. Draft`
    * `âš¡ COMMIT`
    * `Update Signature`
    * `âš¡ FEEDBACK`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizards/`

### ðŸ“„ `WizardArchitect.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/components/inspector/wizards/WizardArchitect.tsx */

**Components & Logic:**

* **`WizardArchitect`**
  * **Logic Flow:**
    * `1. Extract Schema safely`
    * `2. Actions`
    * `FieldConfigDrawer doesn't strictly need readOnly because we prevent opening it,`
    * `but if we wanted "View Details", we'd pass it here too.`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/`

### ðŸ“„ `constants.tsx`
> FILEPATH: frontend/src/domains/meta/features/states/constants.tsx */

**Components & Logic:**

* **`WorkflowTypeDef`**
* **`WORKFLOW_TYPES`**
* **`DEFAULT_WORKFLOW_ICON`**
* **`getWorkflowMeta`**

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/hooks/`

### ðŸ“„ `useCanvasHistory.ts`
> FILEPATH: frontend/src/domains/meta/features/states/hooks/useCanvasHistory.ts */

**Components & Logic:**

* **`useCanvasHistory`**
  * **Logic Flow:**
    * `We don't store 'present' in state here to avoid duping ReactFlow's internal state.`
    * `Instead, we capture snapshots.`
    * `âš¡ SNAPSHOT ENGINE`
    * `Limit history depth to 50`
    * `Debounced version for drag events`
    * `âš¡ UNDO`
    * `âš¡ REDO`

---
### ðŸ“„ `useDomainSchema.ts`
> Fetches and normalizes the Domain Schema from the Kernel.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Type Safety) */` |
| **updated** | `Now returns full Context Identity to prevent Assembler Race Conditions. */` |

**Components & Logic:**

* **`useDomainSchema`**
  * **Logic Flow:**
    * `1. Fetch from Backend`
    * `Response Format: { domain: "USER", fields: { "email": { ... }, "role": { ... } } }`
    * `2. âš¡ NORMALIZATION LOGIC`
    * `The backend returns { domain: "USER", fields: { key: def } }`
    * `We need to convert that Dictionary into a List [ def1, def2 ]`
    * `Scenario A: Standard V2 Dictionary`
    * `Scenario B: Legacy Array (Rare fallback)`
    * `Scenario C: Flat Object Fallback`
    * `âš¡ EXPOSE FULL CONTEXT`

---
### ðŸ“„ `useDomains.ts`
> FILEPATH: frontend/src/domains/meta/features/states/hooks/useDomains.ts */

**Components & Logic:**

* **`useDomains`**
  * **Logic Flow:**
    * `Fetch generic domains via Kernel Service`
    * `Note: The API returns `any`, we cast to DomainSummary[] based on known shape`
    * `If response is wrapped in 'modules' (manifest style), extract it`

---
### ðŸ“„ `useEditorSession.ts`
> Manages the 'VIEW' vs 'EDIT' state and the Draft copy.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (State Integrity)` |
| **invariant** | `Mode defaults to VIEW. Draft is cleared on Discard.` |

**Components & Logic:**

* **`useEditorSession`**
  * **Logic Flow:**
    * `âš¡ AUTO-RESET: When changing workflows, always revert to VIEW and clear draft.`
    * `Initialize draft with current definition if not exists`
    * `âš¡ FIX: Removed auto-setMode('EDIT').`
    * `We now require explicit entry via "Edit Workflow" button.`
    * `This prevents the Toolbar from flipping if the Canvas auto-layouts on load.`

---
### ðŸ“„ `useFlowEditor.ts`
> FILEPATH: frontend/src/domains/meta/features/states/hooks/useFlowEditor.ts */

**Components & Logic:**

* **`useFlowEditor`**
  * **Logic Flow:**
    * `1. FETCH MACHINES`
    * `âš¡ GATEWAY: Use standardized base`
    * `2. SAVE (CREATE / UPDATE)`
    * `POST creates a new VERSION in the ledger strategy`

---
### ðŸ“„ `useWorkflows.ts`
> React Query wrappers for the State Engine API.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Type Safety)` |
| **invariant** | `Cache invalidation must occur on mutation success.` |
| **updated** | `Changed 'version' type from number to string (SemVer).` |

**Components & Logic:**

* **`WorkflowDefinition`**
* **`useWorkflows`**
  * **Logic Flow:**
    * `1. Fetch List`
    * `2. Create / Update`
    * `3. Delete`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/logic/`

### ðŸ“„ `xstateAdapter.ts`
> FILEPATH: frontend/src/domains/meta/features/states/logic/xstateAdapter.ts */

**Components & Logic:**

* **`toGraph`**
  * ðŸ“ *Converts backend JSON into Graph Nodes/Edges and back.*
  * **Logic Flow:**
    * `1. Build Nodes`
    * `Default layout if no positions saved (Simple grid fallback)`
    * `2. Build Edges (Transitions)`
* **`toXState`**
  * ðŸ“ *CONVERTER: Frontend Graph -> Backend JSON*
  * **Logic Flow:**
    * `1. Serialize Nodes (State + Metadata)`
    * `Persist Layout Positions`
    * `2. Serialize Edges (Transitions)`
    * `Safety check: ensure source/target nodes actually exist in the definition`
    * `XState simple syntax: "EVENT": "TARGET"`
    * `TODO: Expand this to object syntax if we add actions/guards later`

---
## ðŸ“‚ `frontend/src/domains/meta/features/states/types/`

### ðŸ“„ `index.ts`
> FILEPATH: frontend/src/domains/meta/features/states/types/index.ts */

**Components & Logic:**

* **`StateDefinition`**
  * ðŸ“ *--- BACKEND CONTRACT (XState JSON) ---*
  * **Logic Flow:**
    * `âš¡ NEW: The Composite Column Target`
    * `Default is 'status'. Can be 'approval_state', 'shipping_stage', etc.`
    * `Strict XState v5 Schema`
* **`XStateDefinition`**
  * ðŸ“ *Strict XState v5 Schema*
* **`XStateNode`**
  * **Logic Flow:**
    * `--- FRONTEND MODEL (ProFlow / ReactFlow) ---`
* **`FlowNodeData`**
  * ðŸ“ *--- FRONTEND MODEL (ProFlow / ReactFlow) ---*
  * **Logic Flow:**
    * `Metadata for the Inspector`
* **`FlowEdgeData`**
* **`StateMachineDraft`**
  * **Logic Flow:**
    * `âš¡ NEW: Must specify which column to control`

---
## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/`

### ðŸ“„ `SwitchboardView.tsx`
> The Main Control Panel for Governance.

**Components & Logic:**

* **`SwitchboardView`**
  * **Logic Flow:**
    * `1. GLOBAL CONTEXT (Deep Link for Modal)`
    * `2. UNIVERSAL URL STATE (Search Persistence)`
    * `3. Data Hooks`
    * `Local loading state for individual row actions`
    * `--- MODAL STATE (Derived from Global) ---`
    * `--- GROUPING LOGIC ---`
    * `Sort: Active first, then by Priority`
    * `--- RENDER HELPERS ---`
    * `STEP 1: DEACTIVATE`
    * `STEP 2: REMOVE`

---
## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/components/`

### ðŸ“„ `AssignmentModal.tsx`
> FILEPATH: frontend/src/domains/meta/features/switchboard/components/AssignmentModal.tsx */

**Components & Logic:**

* **`AssignmentModal`**
  * **Logic Flow:**
    * `UI State`
    * `âš¡ LOGIC: Send either ID or GroupID`

---
### ðŸ“„ `GroupPolicyModal.tsx`
> FILEPATH: frontend/src/domains/meta/features/switchboard/components/GroupPolicyModal.tsx */

**Components & Logic:**

* **`GroupPolicyModal`**
  * **Logic Flow:**
    * `âš¡ MUTATION: Patch Policy`
    * `âš¡ GATEWAY: Use standardized base`
    * `âš¡ BULK OPERATION: Update each selected policy`
    * `We append the new tag to existing tags to avoid overwriting.`

---
## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/hooks/`

### ðŸ“„ `useSwitchboard.ts`
> FILEPATH: frontend/src/domains/meta/features/switchboard/hooks/useSwitchboard.ts */

**Components & Logic:**

* **`useSwitchboard`**
  * **Logic Flow:**
    * `1. FETCH AVAILABLE POLICIES (The Atoms)`
    * `2. FETCH AVAILABLE GROUPS (The Bundles) - âš¡ NEW`
    * `3. FETCH ACTIVE BINDINGS (The Assignments)`
    * `4. CREATE ASSIGNMENT`
    * `5. UPDATE ASSIGNMENT`
    * `6. REMOVE ASSIGNMENT`
    * `Data`
    * `Actions`

---
## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/`

### ðŸ“„ `types.ts`
> FILEPATH: frontend/src/domains/meta/features/switchboard/types.ts */

**Components & Logic:**

* **`PolicyDefinition`**
  * ðŸ“ *--- 1. THE ATOM (Policy) ---*
  * **Logic Flow:**
    * `--- 2. THE ASSIGNMENT (Binding) ---`
* **`PolicyBinding`**
  * ðŸ“ *--- 2. THE ASSIGNMENT (Binding) ---*
  * **Logic Flow:**
    * `Source Polymorphism (One is always set)`
    * `Expanded Relations (For UI display)`
    * `Target Polymorphism`
    * `--- 3. OPTIONS ---`
* **`BindingScope`**
  * ðŸ“ *--- 3. OPTIONS ---*
* **`BindingDraft`**
  * **Logic Flow:**
    * `âš¡ Logic: Must provide either policy_id OR policy_group_id`

---
## ðŸ“‚ `frontend/src/domains/meta/`

### ðŸ“„ `manifest.tsx`
> Registers the System Configuration Module.

| Attribute | Value |
| :--- | :--- |
| **fix** | `Lazy Loaded MetaRoot to prevent Circular Dependency with Sidebar.` |

**Components & Logic:**

* **`metaManifest`**

---
## ðŸ“‚ `frontend/src/domains/meta/types/`

### ðŸ“„ `constants.ts`
> Shared Enums for the Meta-Kernel (Dictionary, Governance, Workflow).

| Attribute | Value |
| :--- | :--- |
| **invariant** | `Must match 'backend/app/core/meta/constants.py' exactly. */` |

**Components & Logic:**

* **`BindingType`**
  * ðŸ“ *Shared Enums for the Meta-Kernel (Dictionary, Governance, Workflow).*
* **`AttributeType`**
* **`WidgetType`**
  * **Logic Flow:**
    * `Text`
    * `Numeric`
    * `Choice`
    * `Boolean`
    * `Date`
    * `Advanced`
* **`RuleEventType`**
* **`RuleActionType`**
* **`PolicyResolutionStrategy`**
* **`ViewEngineType`**
* **`ScopeType`**
  * **Logic Flow:**
    * `âš¡ SYSTEM BRICKS (The "App" Types)`

---
### ðŸ“„ `index.ts`
> Centralizes type definitions for the Meta Domain. Acts as the SSOT for Domain/Scope shapes.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Core Types) */` |

**Components & Logic:**

* **`DomainTypeProperties`**
  * ðŸ“ *--- KERNEL PROPERTIES ---*
* **`DomainTypeDefinition`**
  * **Logic Flow:**
    * `--- SUMMARIES (Lists) ---`
* **`ScopeSummary`**
  * ðŸ“ *--- SUMMARIES (Lists) ---*
  * **Logic Flow:**
    * `âš¡ RUNTIME STATE (Injected by Hypervisor)`
* **`DomainSummary`**
  * **Logic Flow:**
    * `Dynamic Type`
    * `Topology`
    * `âš¡ HIERARCHY (The Tree Link)`
    * `Visuals`
    * `Capabilities`
    * `Runtime Config`
    * `--- CONTEXT STATE ---`
* **`MetaContextState`**
  * ðŸ“ *--- CONTEXT STATE ---*
  * **Logic Flow:**
    * `Selection`
    * `Data`
    * `Actions`

---
## ðŸ“‚ `frontend/src/domains/meta/views/`

### ðŸ“„ `MetaDashboard.tsx`
> The clean entry point for the new System Configurator.

---
## ðŸ“‚ `frontend/src/domains/meta_v2/`

### ðŸ“„ `MetaV2Root.tsx`
> Bootstraps the Meta V2 Kernel Context and Routing.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel Boot) */` |
| **updated** | `Injected WorkflowsTool routes to prevent Router Unmount crashes. */` |

**Components & Logic:**

* **`MetaV2Root`**
  * **Logic Flow:**
    * `âš¡ DIAGNOSTIC: Log Entry`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/_kernel/`

### ðŸ“„ `KernelContext.tsx`
> Bootstraps the Meta-Kernel V2. Loads Registry, Types, and Capabilities.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel Boot) */` |

**Components & Logic:**

* **`KernelContext`**
* **`KernelProvider`**
  * **Logic Flow:**
    * `2. STATE: Universal URL Persistence`
    * `3. ACTIONS`
    * `âš¡ PARALLEL FETCHING: Use raw requests for both to bypass OpenAPI generated name mismatches`
    * `Handle potential response wrappers (e.g. { modules: [...] } vs [...])`
    * `4. EFFECTS: Boot`
    * `5. DERIVED STATE (Selection Resolution)`
    * `Resolve Objects from Keys (O(n) but n is small)`
    * `âš¡ CRITICAL FIX: Add selectContext as an alias to selectDomain so UniversalTree works`
* **`useKernel`**

---
### ðŸ“„ `logic.ts`
> Calculates features based on Backend Domain Properties. Zero UI dependencies.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Logic Safe) */` |
| **updated** | `Removed 'SYS' magic string. Now uses strict type checking. */` |

**Components & Logic:**

* **`calculateCapabilities`**
  * ðŸ“ *Decodes the Domain Properties into UI Capabilities.*
  * **Logic Flow:**
    * `ðŸ›¡ï¸ SAFETY: Handle missing type definitions gracefully (Legacy fallback)`
    * `1. Dictionary: Only if the domain supports Custom Attributes (Metadata)`
    * `2. Workflows: Only if the domain logs Activity/State Transitions`
    * `3. Governance: If it has an API, it needs Rules.`
    * `We exclude 'NONE' (Virtual domains) but include 'READ_ONLY'.`
    * `4. Data Browser: Only if we can CRUD the data via standard API.`
* **`buildActiveContext`**
  * ðŸ“ *Factory that builds the Context Object from a selected Domain.*
  * **Logic Flow:**
    * `âš¡ FIX: Use the Domain Type classification, NOT the hardcoded 'SYS' key.`

---
### ðŸ“„ `types.ts`
> Strict type definitions for the Context-Driven Architecture.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel) */` |
| **invariant** | `Must match Backend Pydantic Models in 'app.core.kernel.registry.schemas'. */` |
| **updated** | `Added 'WorkflowTypeRead' for V3 Dynamic Workflow Types. */` |

**Components & Logic:**

* **`ScopeConfig`**
  * ðŸ“ *Strict type definitions for the Context-Driven Architecture.*
* **`DomainTypeProperties`**
  * **Logic Flow:**
    * `âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)`
* **`DomainTypeDefinition`**
  * ðŸ“ *âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)*
  * **Logic Flow:**
    * `âš¡ V3: DYNAMIC WORKFLOW TYPE (From DB: meta_workflow_types)`
* **`WorkflowTypeRead`**
  * ðŸ“ *âš¡ V3: DYNAMIC WORKFLOW TYPE (From DB: meta_workflow_types)*
  * **Logic Flow:**
    * `--- SUMMARIES (Lists) ---`
* **`ScopeSummary`**
  * ðŸ“ *--- SUMMARIES (Lists) ---*
  * **Logic Flow:**
    * `âš¡ RUNTIME STATE (Injected by Hypervisor)`
* **`DomainSummary`**
  * **Logic Flow:**
    * `âš¡ DYNAMIC TYPE (Data-Driven)`
    * `âš¡ TOPOLOGY METADATA (Level 100)`
    * `âš¡ HIERARCHY (The Tree Link)`
    * `Visuals`
    * `Capabilities`
    * `Runtime Config`
    * `--- CONTEXT STATE ---`
* **`MetaContextState`**
  * ðŸ“ *--- CONTEXT STATE ---*
  * **Logic Flow:**
    * `1. Registry (The Menu)`
    * `âš¡ V3 STATE: The Rules of Physics`
    * `2. Selection (The Focus)`
    * `âš¡ GLOBAL ITEM STATE (Fixes Refresh Amnesia)`
    * `Stores the full object so we don't have to re-find it constantly`
    * `3. Data Access`
    * `4. Actions`

---
### ðŸ“„ `useKernel.ts`
> PREVENTS CRASHES. Re-exports the hook from KernelContext so existing imports work.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Public) */` |

---
## ðŸ“‚ `frontend/src/domains/meta_v2/_shell/`

### ðŸ“„ `MetaUIContext.tsx`
> Centralizes UI state (Sidebar collapse, Tree expansion) with LocalStorage persistence.

**Components & Logic:**

* **`MetaUIProvider`**
  * **Logic Flow:**
    * `--- 1. LAYOUT STATE ---`
    * `--- 2. TREE STATE ---`
    * `--- ACTIONS ---`
* **`useMetaUI`**

---
### ðŸ“„ `StudioLayout.tsx`
> The Master Layout (3-Pane) powered by MetaUIContext.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must use <Outlet /> for center pane to respect MetaV2Root nested routes. */` |

**Components & Logic:**

* **`StudioLayout`**
  * ðŸ“ *âš¡ WRAPPER TO PROVIDE CONTEXT*

---
## ðŸ“‚ `frontend/src/domains/meta_v2/components/`

### ðŸ› ï¸ `ContextInspector.tsx`
> Visualizes the Active Kernel Context.

**Components & Logic:**

* **`ContextInspector`**
  * **Logic Flow:**
    * `âš¡ FIX: Access Global Theme Tokens`
    * `Helper to render boolean capabilities visually`
    * `âš¡ FIX: Use Semantic Tokens for Background/Border`

---
### ðŸ“„ `DomainTopology.tsx`
> Renders the System Hierarchy using a Recursive Engine for infinite nesting support.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe)` |
| **updated** | `Added support for 'ACTION' node type to render "Create" placeholders distinctively.` |

**Components & Logic:**

* **`DomainTopology`**
  * ðŸ“ *Renders the System Hierarchy using a Recursive Engine.*
  * **Logic Flow:**
    * `1. DATA`
    * `2. STATE`
    * `3. ROUTING LOGIC`
    * `âš¡ V2 ROUTING HOOK: Workflow Editor Integration`
    * `âš¡ UX: If it's the Workflows folder, navigate to the Workflow Lobby`
    * `âš¡ ACTION HANDLER (For Placeholders)`
    * `Actions like "Create First Workflow" route to the lobby`
    * `Default: External Route`
    * `4. NORMALIZATION ENGINE (The Flattening & Recursive Builder)`
    * `Helper: Recursive Filter & Map`
    * `Check self match`
    * `Process children recursively`
    * `If searched, only return if self matches or has matching children`
    * `If we have matches in children, expand this node`
    * `TRANSFORM: Cluster -> Domain -> Section -> Item -> UniversalTreeNode`
    * `Root Items`
    * `metadata for display`
    * `Sections (Folders)`
    * `Run Filter`
    * `5. RECURSIVE RENDERER`
    * `Determine styles based on type`

---
### ðŸ“„ `UniversalTree.tsx`
> Renders the System Hierarchy.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **updated** | `Injected Auto-Collapse UX on selection to maximize focus area. */` |

**Components & Logic:**

* **`UniversalTree`**
  * **Logic Flow:**
    * `âš¡ CONNECT TO SHELL STATE`
    * `3. HANDLERS`
    * `âš¡ UX AUTOFOCUS: Collapse the main sidebar to maximize screen real estate`
    * `4. RENDERER (Custom Node)`
    * `âš¡ RESPONSIVE MODE: ICON ONLY`
    * `âš¡ FULL MODE: TREE`

---
### ðŸ“„ `useDomainTree.ts`
> Transforms flat Domain list into a Hierarchy.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **updated** | `Removed hardcoded 'SYS' check. Uses Backend 'display_weight' for sorting. */` |

**Components & Logic:**

* **`KernelTreeNode`**
* **`useDomainTree`**
  * **Logic Flow:**
    * `1. Initialize Nodes`
    * `âš¡ READ DYNAMIC WEIGHT (Default to 50 if missing)`
    * `2. Link Hierarchy`
    * `Normalize parent key (handles v2 vs v3 differences)`
    * `3. Sort & Polish`
    * `âš¡ DYNAMIC SORT: Compare weights first (lower number = higher up)`
    * `Fallback to alphabetical label sorting`

---
### ðŸ“„ `useTopology.ts`
> Fetches and groups the System Topology Graph from the API.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **updated** | `Injected "Zero-Touch" Workflow Placeholder for empty domains. */` |

**Components & Logic:**

* **`TopologyItem`**
  * ðŸ“ *âš¡ SHARED TYPES*
* **`TopologySection`**
* **`TopologyDomain`**
* **`DomainCluster`**
* **`useTopology`**
  * **Logic Flow:**
    * `1. âš¡ FETCH TOPOLOGY GRAPH (Server-Side Source of Truth)`
    * `2. âš¡ THE DUMB PIPE (Zero Frontend Opinions)`
    * `âš¡ DB-DRIVEN MATCHING: Trust the Backend's Section Assignment completely.`
    * `If the backend commanded a group, build or append to it.`
    * `âš¡ ROOT ENTITIES: Nodes without a section_key remain at the root`
    * `âš¡ ZERO-TOUCH WORKFLOWS: If capability exists but no workflows, offer creation.`
    * `This ensures the "Workflows" folder always appears if the domain supports it.`
    * `Ensure section exists`
    * `Inject Placeholder if empty`
    * `Sort dynamic folders alphabetically by their DB label`
    * `Construct the "Self" Domain representation`
    * `Wrap in a Cluster (to maintain compatibility with DomainTopology.tsx renderer)`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/`

### ðŸ“„ `DictionaryTool.tsx`
> The V2-Native wrapper for the Data Dictionary.

**Components & Logic:**

* **`DictionaryTool`**
  * **Logic Flow:**
    * `âš¡ ROUTING LOGIC: Capture both Path Param and Query Param`
    * `1. RESOLVE CONTEXT (V2 Way)`
    * `Prioritize Prop -> Path Param -> Query Param -> Active Context`
    * `âš¡ SYNC ENGINE: Ensure Kernel is aware of Router URL changes`
    * `2. FEATURE LOGIC`
    * `3. LOCAL UI STATE`
    * `âš¡ UX STATE: Auto-Collapse the list when editing`
    * `4. COMPUTED DRAFT`
    * `5. HANDLERS`
    * `Go back to Topology (parent route)`
    * `âš¡ UX: Expand list again after saving so they can pick the next item`
    * `âš¡ UX: Auto-collapse when user selects a field to edit`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/components/`

### ðŸ“„ `AttributeEditor.tsx`
> The Master Controller for editing Attributes.

**Components & Logic:**

* **`AttributeEditor`**
  * **Logic Flow:**
    * `âš¡ SYNC: Update local state if parent selection changes`
    * `âš¡ LOGIC: Auto-switch widget if data type changes`
    * `âš¡ CONTRACT FIX: Updates 'configuration', NOT 'config'`
    * `We allow config updates even if locked, generally (e.g. placeholder)`
    * `âš¡ LOGIC: Auto-Slugify`

---
### ðŸ“„ `AttributeExplorer.tsx`
> Navigable list of Domain Attributes.

**Components & Logic:**

* **`AttributeExplorer`**
  * **Logic Flow:**
    * `âš¡ DEEP LINKING: Replaced local state with URL state for search persistence`
    * `ðŸ§  SMART SORTING`
    * `ID sort for stability`
    * `System fields first`
    * `Alphabetical`
    * `âš¡ FIX: Use 'key' (string) instead of 'id' (number) for uniqueness`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/components/editor/`

### ðŸ“„ `ConfigPanels.tsx`
> Fractal sub-component for handling Type-Specific settings. CRASH PROOFED.

**Components & Logic:**

* **`ConfigPanels`**
  * **Logic Flow:**
    * `âš¡ CRASH GUARD: Ensure we have an object to read from`
    * `--- 1. NUMBER CONFIGURATION ---`
    * `--- 2. TEXT CONFIGURATION ---`
    * `--- 3. SELECTION CONFIGURATION ---`
    * `--- 4. DATE / DATETIME ---`
    * `--- 5. REFERENCE (COMPLEX) ---`
    * `--- 6. FILE ---`

---
### ðŸ“„ `PreviewPanel.tsx`
> Renders the widget in real-time.

**Components & Logic:**

* **`PreviewPanel`**
  * **Logic Flow:**
    * `--- TEXT WIDGETS ---`
    * `--- NUMBER WIDGETS ---`
    * `--- SELECTION WIDGETS ---`
    * `--- DATE WIDGETS ---`
    * `--- BOOLEAN WIDGETS ---`
    * `--- FILE WIDGETS ---`
    * `--- COMPLEX WIDGETS ---`
    * `Fallback`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/hooks/`

### ðŸ“„ `useDictionary.ts`
> Encapsulates all Data Access Logic for Domain Attributes.

**Components & Logic:**

* **`useDictionary`**
  * **Logic Flow:**
    * `1. FETCH ATTRIBUTES`
    * `âš¡ GATEWAY: Use standardized base`
    * `2. SAVE (CREATE / UPDATE)`
    * `Update Existing`
    * `Create New`
    * `3. DELETE`
    * `Data`
    * `Actions`
    * `State`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/logic/`

### ðŸ“„ `schemaNormalizer.ts`
> Logic Adapter.

**Components & Logic:**

* **`normalizeSchema`**
  * ðŸ“ *V2 Types now contain Enums too*
  * **Logic Flow:**
    * `Scenario A: It's already an Array`
    * `Scenario B: It's a Hybrid Schema Object`
    * `Check possible containers`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/types/`

### ðŸ“„ `constants.ts`
> Values that EXIST at runtime (Enums, Objects).

**Components & Logic:**

* **`AttributeType`**
  * ðŸ“ *Values that EXIST at runtime (Enums, Objects).*
* **`WidgetType`**
  * **Logic Flow:**
    * `Text`
    * `Numeric`
    * `Choice`
    * `Boolean`
    * `Date`
    * `Advanced`
    * `ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type`
* **`WIDGET_COMPATIBILITY`**
  * ðŸ“ *ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type*
  * **Logic Flow:**
    * `ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions`
* **`HELP_TEXT`**
  * ðŸ“ *ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions*
* **`DEFAULT_DRAFT_CONFIG`**

---
### ðŸ“„ `index.ts`
> Re-exports Types and Constants explicitly to prevent bundler confusion.

**Components & Logic:**

* **`DEFAULT_DRAFT`**
  * ðŸ“ *3. Default Constant*

---
### ðŸ“„ `types.ts`
> Types that DISAPPEAR at runtime. Pure Interfaces.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Core Types) */` |

**Components & Logic:**

* **`AttributeType`**
  * ðŸ“ *Types that DISAPPEAR at runtime. Pure Interfaces.*
* **`WidgetType`**
* **`SelectOption`**
* **`AttributeConfig`**
  * **Logic Flow:**
    * `Text`
    * `Number`
    * `Date`
    * `Options`
    * `Reference`
    * `File`
    * `JSON`
    * `General`
* **`AttributeDefinition`**
* **`AttributeDraft`**

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/`

### ðŸ“„ `GovernanceTool.tsx`
> Master Controller for the V2 Rule Engine. URL-driven, fully decoupled.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **updated** | `Added 'Tag' import to fix Runtime Crash. */` |

**Components & Logic:**

* **`GovernanceTool`**
  * **Logic Flow:**
    * `âš¡ ROUTING STATE`
    * `âš¡ V2 UI STATE (Centralized Shell)`
    * `âš¡ GLOBAL URL STATE (Deep Linking)`
    * `âš¡ LOGIC HOOK`
    * `âš¡ TELEMETRY`
    * `--- HANDLERS ---`
    * `âš¡ TAG-DRIVEN CONTEXT: Automatically associate this policy with the active domain`
    * `--- COMPUTED ---`
    * `--- RENDER: EMPTY STATE (No Domain) ---`
    * `--- RENDER: WORKSPACE ---`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/components/editor/`

### ðŸ“„ `ConsequenceStack.tsx`
> Renders the action stack for a rule. Driven by dynamic Backend Capabilities (Dumb UI Pattern).

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`ConsequenceStack`**
  * **Logic Flow:**
    * `âš¡ THE DUMB UI LINK: Read Actions directly from the Kernel's Context Schema`
    * `Derived options for target fields`

---
### ðŸ“„ `EnforcementPanel.tsx`
> UI for binding a Policy to a Context.

**Components & Logic:**

* **`EnforcementPanel`**
  * **Logic Flow:**
    * `Filter bindings for *this* policy`
    * `State for New Binding (Transient form state, does not need URL sync)`

---
### ðŸ“„ `HistoryDrawer.tsx`
> Displays version timeline with Expandable JSON views.

**Components & Logic:**

* **`HistoryDrawer`**
  * **Logic Flow:**
    * `âš¡ GATEWAY: OpenAPI SDK replaces Axios`

---
### ðŸ“„ `PolicyEditor.tsx`
> Advanced Policy Editor utilizing isolated Fractal Components and URL state.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Validation) */` |

**Components & Logic:**

* **`PolicyEditor`**
  * **Logic Flow:**
    * `âš¡ HYDRATED DATA SOURCE`
    * `âš¡ DEEP LINKING BY DEFAULT (Cures History Drawer Amnesia)`
    * `--- HANDLERS ---`

---
### ðŸ“„ `TestPanel.tsx`
> A sandbox to test logic before deploying it to production.

**Components & Logic:**

* **`TestPanel`**
  * **Logic Flow:**
    * `Default mock data based on standard "host" envelope`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/components/editor/logic/`

### ðŸ“„ `LogicBuilder.tsx`
> Recursive Subject-Verb-Object Composer for Governance Rules.

**Components & Logic:**

* **`LogicBuilder`**
  * **Logic Flow:**
    * `PARSER (Heuristic Fallback to Code Mode)`
    * `COMPILER`
    * `HANDLERS`
    * `RENDERERS`

---
### ðŸ“„ `SubjectPicker.tsx`
> Smart Context Selector.

**Components & Logic:**

* **`SubjectPicker`**
  * **Logic Flow:**
    * `âš¡ THE DUMB UI LINK: Read Context directly from Kernel Capabilities`
    * `âš¡ STATE HYDRATION: Restore tab and domain from existing value`
    * `Check Host`
    * `Check Dynamic Context Roots (e.g. actor., system., config.)`
    * `Assume Global Domain (e.g., "user.email" -> Domain "USER")`
    * `Ensure it's not a known root`
    * `âš¡ LAZY LOAD: Global Domain List`
    * `âš¡ LAZY LOAD: Specific Domain Schema`
    * `--- RENDERERS ---`
    * `âš¡ DYNAMIC CASCADER (Builds options from Backend schema payload)`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/components/list/`

### ðŸ“„ `PolicyExplorer.tsx`
> Navigable list of Governance Policies.

**Components & Logic:**

* **`PolicyExplorer`**
  * **Logic Flow:**
    * `âš¡ DEEP LINKING: Replaced useState with useUrlState`
    * `âš¡ TELEMETRY: Trace Component Lifecycle`
    * `Helper to format v1.05`
    * `Default to v1.00 if missing (legacy data)`
    * `âš¡ SHOW VERSION`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/hooks/`

### ðŸ“„ `useGovernance.ts`
> Manages Policy State and Fuses Domain Schema with System Context. Uses OpenAPI SDK.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Schema Fusion) */` |
| **updated** | `Added Data Normalization to convert Schema Dictionary -> Array. Fixes 'filter is not a function' crash. */` |

**Components & Logic:**

* **`useGovernance`**
  * **Logic Flow:**
    * `1. FETCH POLICIES (The Law)`
    * `Note: In standard architecture, policies are fetched globally and bound locally.`
    * `2. FETCH FUSED SCHEMA (The Vocabulary)`
    * `âš¡ ADAPTER: Normalize Dictionary to Array for UI Consumption`
    * `If it's already an array, pass it through (Legacy Safe)`
    * `If it's a Dictionary, convert to Array and inject 'group' for grouping logic`
    * `3. CREATE POLICY`
    * `4. UPDATE POLICY`
    * `5. DELETE POLICY`
    * `Explicit cast to 'any' to handle OpenAPI Codegen delete signature if it varies`
    * `6. DRY RUN`
    * `Data`
    * `Actions`
    * `State`

---
### ðŸ“„ `usePolicyBindings.ts`
> Manages enforcement jurisdictions. Uses OpenAPI SDK.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (API Integration) */` |

**Components & Logic:**

* **`usePolicyBindings`**
  * **Logic Flow:**
    * `1. FETCH BINDINGS`
    * `2. CREATE BINDING`
    * `3. TOGGLE/UPDATE BINDING`
    * `4. DELETE BINDING`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/`

### ðŸ“„ `WorkflowsTool.tsx`
> The V2-Native wrapper for the Workflow Engine. Injected with P1-DIAG-02 probes.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`WorkflowsTool`**
  * **Logic Flow:**
    * `ðŸ”¬ BLACK BOX PROBE: P1-DIAG-02 (WorkflowsTool)`
    * `âš¡ SYNC ENGINE: Ensure Kernel is aware of Router URL changes`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/`

### ðŸ› ï¸ `CodeEditorDrawer.tsx`
> Raw XState JSON Editor with syntax validation and live graph sync.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`CodeEditorDrawer`**
  * ðŸ“ *The low-level interface for direct XState manipulation.*
  * **Logic Flow:**
    * `âš¡ SIGNAL TELEMETRY: Source Sync`
    * `Basic Schema Check`

---
### ðŸ“„ `EditorToolbar.tsx`
> The Control Deck for the Workflow Editor. Restored the Back Button for navigation.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe Guards) */` |

**Components & Logic:**

* **`EditorToolbar`**
  * ðŸ“ *The top navigation bar for the workflow editor.*

---
### ðŸ“„ `FlowCanvas.tsx`
> Renders the Interactive Node Graph with Auto-Layout. Rewired to V2 Nodes.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Invariant) */` |

**Components & Logic:**

* **`FlowCanvas`**

---
### ðŸ“„ `WorkflowEditor.tsx`
> The Canvas and Inspector workspace. Legacy dependencies completely severed.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`WorkflowEditor`**
  * **Logic Flow:**
    * `âš¡ DEEP LINKING BY DEFAULT`
    * `âš¡ REACTFLOW HANDLERS`
    * `âš¡ API MUTATION HANDLERS`

---
### ðŸ“„ `WorkflowExplorer.tsx`
> Renders a filterable gallery of workflows. Now strictly uses V2 imports.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`WorkflowExplorer`**
  * **Logic Flow:**
    * `âš¡ CONTEXT`
    * `âš¡ DEEP LINKING BY DEFAULT`
    * `âš¡ DATA FETCH`
    * `âš¡ LOGIC: Filter Workflows`
    * `âš¡ HANDLERS`
    * `âš¡ SAFE RETURN: Loading State`

---
### ðŸ“„ `WorkflowGenesis.tsx`
> UI for defining the root properties of a new State Machine. Rewired to V2.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Data Validation) */` |

**Components & Logic:**

* **`WorkflowGenesis`**
  * **Logic Flow:**
    * `âš¡ ROBUST DOMAIN RESOLUTION`
    * `âš¡ V2 HOOKS`
    * `Reset form on open`
    * `V2 uses 'updateWorkflow' (which runs POST) for creation`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/canvas/`

### ðŸ“„ `CanvasNodes.tsx`
> Renders ReactFlow Custom Nodes (Screen, Task, Standard) representing workflow states.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |

**Components & Logic:**

* **`CanvasNodeData`**
  * ðŸ“ *--- SHARED DOMAIN TYPES ---*
  * **Logic Flow:**
    * `============================================================================`
    * `1. SCREEN NODE (WIZARD VISUAL)`
    * `============================================================================`
* **`ScreenNode`**
  * **Logic Flow:**
    * `============================================================================`
    * `2. STANDARD NODE (GOVERNANCE VISUAL)`
    * `============================================================================`
* **`StandardNode`**
  * ðŸ“ *============================================================================*
  * **Logic Flow:**
    * `============================================================================`
    * `3. TASK NODE (JOB VISUAL)`
    * `============================================================================`
* **`TaskNode`**
  * ðŸ“ *============================================================================*

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/inspector/`

### ðŸ“„ `InspectorShell.tsx`
> Standardized outer frame for inspector panels. Preserves pixel-perfect legacy appearance.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`SelectionType`**
* **`InspectorShell`**
  * ðŸ“ *Renders the high-density container for node editing. [cite: 2855-2884]*
  * **Logic Flow:**
    * `âš¡ SIGNAL TELEMETRY: Render tracking`

---
### ðŸ“„ `JobNode.tsx`
> Configuration for Async Background Tasks (Queues, Handlers, Retries).

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`JobNode`**
  * ðŸ“ *Decoupled V2 editor for background task nodes. [cite: 2885-2923]*
  * **Logic Flow:**
    * `âš¡ SIGNAL TELEMETRY: Init`

---
### ðŸ“„ `StandardNode.tsx`
> Basic configuration for Lifecycle/Governance States (Color, Documentation).

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`StandardNode`**
  * ðŸ“ *Decoupled V2 editor for basic state nodes. [cite: 2954-2981]*
  * **Logic Flow:**
    * `âš¡ SIGNAL TELEMETRY: Init`

---
### ðŸ“„ `TransitionEdge.tsx`
> Manages the logic connecting two nodes, including events, guards, and side effects.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`TransitionEdge`**
  * ðŸ“ *Decoupled V2 inspector for Workflow Edges. [cite: 2988-3027]*
  * **Logic Flow:**
    * `âš¡ SIGNAL TELEMETRY: Component Init`

---
### ðŸ“„ `WizardNode.tsx`
> Orchestrates Wizard Step configuration. Manages step metadata and the field collection.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`WIZARD_COMPONENTS`**
  * ðŸ“ *Rich component registry for user-facing selection [cite: 3034-3048] */*
* **`WizardNode`**
  * **Logic Flow:**
    * `âš¡ SIGNAL TELEMETRY: Component Lifecycle`

---
### ðŸ“„ `WorkflowInspector.tsx`
> Orchestrates the contextual editing of Nodes. Added Editable Raw JSON tab.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`WorkflowInspector`**
  * **Logic Flow:**
    * `âš¡ DEEP LINKING BY DEFAULT`
    * `âš¡ LOCAL STATE: JSON Editor Buffer`
    * `âš¡ TELEMETRY PROBE: Selection Change`
    * `âš¡ SYNC JSON BUFFER: Keep the text area updated when nodeData changes externally`
    * `âš¡ HANDLER: Apply JSON Mutations`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/inspector/_atoms/`

### ðŸ“„ `FieldCard.tsx`
> Renders the draggable, space-optimized cards for individual form fields.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`FieldCard`**
  * ðŸ“ *Atomic component for managing the list of fields within a Wizard step. [cite: 3069-3101]*

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/`

### ðŸ“„ `constants.tsx`
> Centralized definitions for Workflow Types, Icons, and Metadata. Localized to V2.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only Data) */` |

**Components & Logic:**

* **`WorkflowTypeDef`**
  * **Logic Flow:**
    * `âš¡ V2 LOCALIZED CONSTANTS`
* **`WORKFLOW_TYPES`**
  * ðŸ“ *âš¡ V2 LOCALIZED CONSTANTS*
* **`DEFAULT_WORKFLOW_ICON`**
* **`getWorkflowMeta`**

---
## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/hooks/`

### ðŸ“„ `useCanvasHistory.ts`
> Provides Undo/Redo capability for ReactFlow with debounced snapshots.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 */` |

**Components & Logic:**

* **`useCanvasHistory`**
  * **Logic Flow:**
    * `âš¡ SNAPSHOT ENGINE`
    * `Limit history depth to 50`
    * `âš¡ UNDO`
    * `âš¡ REDO`

---
### ðŸ“„ `useDomainSchema.ts`
> Fetches and normalizes the Domain Schema from the Kernel for the V2 Workflow Engine.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Type Safety) */` |

**Components & Logic:**

* **`useDomainSchema`**
  * **Logic Flow:**
    * `âš¡ FIX: Namespaced Key 'workflow_schema' to prevent collision with Governance 'schema' key.`
    * `This ensures this hook always runs its own normalization logic (Array) instead of receiving a raw Object from cache.`
    * `1. Fetch from Backend`
    * `2. âš¡ NORMALIZATION LOGIC`

---
### ðŸ“„ `useEditorSession.ts`
> Manages the 'VIEW' vs 'EDIT' state and the Draft copy. Crash-proofed against undefined transitions.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (State Integrity) */` |

**Components & Logic:**

* **`useEditorSession`**
  * **Logic Flow:**
    * `âš¡ AUTO-RESET: When changing workflows, always revert to VIEW and clear draft.`
    * `ðŸ›¡ï¸ CRASH FIX: Safe extraction of definition`
    * `Look for 'transitions' first, fallback to 'definition', fallback to empty XState structure`
    * `Suppress heavy logging here as this fires rapidly on node drag`

---
### ðŸ“„ `useWorkflows.ts`
> React Query wrappers for the State Engine API. Fully instrumented with Narrator.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Data Access) */` |

**Components & Logic:**

* **`WorkflowDefinition`**
* **`useWorkflows`**
  * **Logic Flow:**
    * `1. Fetch List`
    * `2. Create / Update`
    * `The API expects the full definition wrapper`
    * `3. Delete`

---
## ðŸ“‚ `frontend/src/domains/meta_v2/`

### ðŸ“„ `manifest.tsx`
> Registers the V2 System Configurator in the Global Menu.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Public) */` |

**Components & Logic:**

* **`metaV2Manifest`**

---
## ðŸ“‚ `frontend/src/domains/system/api/`

### ðŸ“„ `index.ts`
> Typed fetchers for System Internals.

**Components & Logic:**

* **`SystemAPI`**

---
## ðŸ“‚ `frontend/src/domains/system/features/admin_console/`

### ðŸ“„ `ConfigDrawer.tsx`
> A dynamic form for editing SystemConfig values.

**Components & Logic:**

* **`ConfigDrawer`**
  * **Logic Flow:**
    * `âš¡ TELEMETRY: Log Access`
    * `Sync form with config prop`

---
### ðŸ“„ `SystemDashboard.tsx`
> Master Control Plane for System Administrators to toggle Modules, Circuits, and Global Settings.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Admin Control) */` |
| **invariant** | `'safety.isOn' must be strictly enforced before allowing any toggles. */` |
| **narrator** | `Logs intent and outcome for all system-level mutations. */` |
| **updated** | `Re-wired IconFactory to read from Database SSOT (module_icon) instead of hardcoded fallbacks. */` |

---
## ðŸ“‚ `frontend/src/domains/system/features/identity/`

### ðŸ“„ `SystemIdentityCard.tsx`
> A dense information display for the User Avatar Menu.

**Components & Logic:**

* **`SystemIdentityCard`**

---
## ðŸ“‚ `frontend/src/domains/system/hooks/`

### ðŸ“„ `useSystemControl.ts`
> Smartly routes toggle requests to either Domain Governance or Circuit Hypervisor.

**Components & Logic:**

* **`useSystemControl`**
  * **Logic Flow:**
    * `1. Fetch Domains (Modules & Scopes)`
    * `2. Fetch Screens (Raw Circuits)`
    * `We fetch all circuits of type 'SCREEN'`
    * `3. Fetch System Config`
    * `âš¡ POLYMORPHIC TOGGLER`
    * `BRANCH A: Circuit Target (Scope/Screen) -> Uses ':' as separator`
    * `BRANCH B: Domain Target (Simple Key) -> Uses legacy patch`
    * `Map UI/API to config keys`
    * `Invalidate everything to be safe`

---
### ðŸ“„ `useSystemPulse.ts`
> Polls the System API to maintain situational awareness.

**Components & Logic:**

* **`useSystemPulse`**
  * **Logic Flow:**
    * `âš¡ TELEMETRY: Only whisper if something changed or on first load`
    * `Boot Sequence`
    * `âš¡ HEARTBEAT: Poll every 60 seconds to detect version changes`

---
## ðŸ“‚ `frontend/src/domains/system/`

### ðŸ“„ `manifest.tsx`
> Registers the "System Internals" domain.

**Components & Logic:**

* **`systemManifest`**

---
### ðŸ“„ `types.ts`
> TypeScript definitions for System Domain.

**Components & Logic:**

* **`SystemIdentity`**
  * ðŸ“ *TypeScript definitions for System Domain.*
* **`SystemVersioning`**
* **`SystemHealth`**
  * **Logic Flow:**
    * `The Aggregate Payload`
* **`SystemPulse`**
  * ðŸ“ *The Aggregate Payload*
  * **Logic Flow:**
    * `âš¡ NEW: Governance Types`
* **`KernelScope`**
  * ðŸ“ *âš¡ NEW: Governance Types*
* **`KernelDomain`**
  * **Logic Flow:**
    * `âš¡ NEW: Hierarchy`
* **`SystemConfig`**

---
## ðŸ“‚ `frontend/src/domains/workspace/features/widget_runner/`

### ðŸ“„ `WidgetHost.tsx`
> Connects the URL Route to the Active App definition.

**Components & Logic:**

* **`WidgetHost`**
  * **Logic Flow:**
    * `1. PARSE URL TO FIND APP SCOPE`
    * `2. FIND APP DEFINITION`
    * `âš¡ 3. PRE-FLIGHT GOVERNANCE CHECK (Loud)`
    * `We use 'console.log' directly here for formatting, or extend Narrator`
    * `4. RENDER`

---
### ðŸ“„ `WidgetRegistry.tsx`
> Mounts the widget only after a LIVE, GRANULAR Governance Check.

**Components & Logic:**

* **`WidgetRegistry`**
  * **Logic Flow:**
    * `Parse Scope (e.g. "USER:USER_ADMIN" -> domain="USER", scope="USER_ADMIN")`
    * `âš¡ REAL-TIME GOVERNANCE STATE`
    * `We start in 'CHECKING' to prevent rendering the widget before we know it's safe.`
    * `âš¡ DIRECT CHECK: Bypass the Manifest Cache`
    * `We ask the kernel specifically about the system domains right now.`
    * `1. Evaluate Domain Level Switches`
    * `2. Evaluate Scope Level Switches (The Deep Check)`
    * `Check if specific UI circuit is HALTED`
    * `Scope defined in frontend but missing in backend registry?`
    * `Fail Open for development, but log warning.`
    * `Determine specific reason for user feedback`
    * `Fail Safe: Security best practice is Fail Closed (Deny).`
    * `âš¡ RENDER LOGIC`
    * `âš¡ MOUNT WIDGET (Permission Granted)`

---
## ðŸ“‚ `frontend/src/domains/workspace/hooks/`

### ðŸ“„ `useBricks.ts`
> Fetches available System Capabilities (Bricks) for the App Studio.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Read-Only) */` |
| **invariant** | `Must return a stable list of SystemBrick objects. */` |

**Components & Logic:**

* **`useBricks`**
  * **Logic Flow:**
    * `âš¡ FIX: Use the auto-generated verbose method name`

---
### ðŸ“„ `useWorkspace.tsx`
> Fetches Layout Data and normalizes it for the UI.

| Attribute | Value |
| :--- | :--- |
| **updated** | `Added robust Label Fallback to prevent "Ghost Apps" in Sidebar. */` |

**Components & Logic:**

* **`useWorkspace`**
  * **Logic Flow:**
    * `âš¡ SAFE GUARDS`

---
## ðŸ“‚ `frontend/src/domains/workspace/`

### ðŸ“„ `types.ts`
> Defines the shape of the Runtime Application and Release Metadata.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Core Types) */` |
| **invariant** | `Must match 'backend/app/domains/workspace/schemas.py' contracts. */` |
| **updated** | `Added 'meta' field to RuntimeLayout to support Versioning. */` |

**Components & Logic:**

* **`BrickType`**
  * ðŸ“ *--- 1. THE BRICK ---*
  * **Logic Flow:**
    * `--- 2. THE SCREEN ---`
* **`Screen`**
  * ðŸ“ *--- 2. THE SCREEN ---*
  * **Logic Flow:**
    * `âš¡ EAGER LOADED (Lobby Richness)`
    * `--- 3. THE APP ---`
* **`ActiveApp`**
  * ðŸ“ *--- 3. THE APP ---*
  * **Logic Flow:**
    * `âš¡ JSON RESPONSE ADAPTATION`
    * `The Layout API returns a simplified view, IDs might be implicit or missing in read-mode`
    * `Identity`
    * `âš¡ FIX: Match Backend JSON exactly ("type", not "scope_type")`
    * `Configuration (The Paint)`
    * `Backend sends "intent" in layout, but "config" in DB. We support both.`
    * `Placement`
    * `--- 4. RELEASE HISTORY ---`
* **`Release`**
  * ðŸ“ *--- 4. RELEASE HISTORY ---*
  * **Logic Flow:**
    * `--- 5. THE RUNTIME LAYOUT ---`
* **`RuntimeLayout`**
  * ðŸ“ *--- 5. THE RUNTIME LAYOUT ---*
  * **Logic Flow:**
    * `âš¡ VERSION CONTROL INTELLIGENCE`

---
## ðŸ“‚ `frontend/src/domains/workspace/views/`

### ðŸ“„ `WorkspaceRuntime.tsx`
> Bridges Logic to UI with crash protection and Governance Checks.

**Components & Logic:**

* **`WorkspaceRuntime`**
  * ðŸ“ *âš¡ NEW*
  * **Logic Flow:**
    * `1. DATA LINK`
    * `2. GOVERNANCE SYNC (Critical Fix)`
    * `When entering a Workspace, we MUST know the latest System State.`
    * `If an Admin just disabled a module, we can't rely on a 5-minute cache.`
    * `3. SECURITY GATE & LOGGING`
    * `âš¡ GOVERNANCE ROLL CALL`
    * `3. RENDER THE SHELL`

---
## ðŸ“‚ `frontend/src/lab/workflow/`

### ðŸ“„ `TestWorkflow.tsx`
> FILEPATH: frontend/src/lab/workflow/TestWorkflow.tsx */

**Components & Logic:**

* **`TestWorkflow`**
  * **Logic Flow:**
    * `âš¡ DYNAMIC STATE: Allow AI to overwrite the definition in memory`
    * `1. Fetch the Seeded Definition (Baseline)`
    * `âš¡ GATEWAY: Use standardized base`
    * `2. Handle AI Generation (Hot-Swap)`
    * `3. Handle Transitions`

---
## ðŸ“‚ `frontend/src/`

### ðŸ“„ `main.tsx`
> FILEPATH: frontend/src/main.tsx */

---
## ðŸ“‚ `frontend/src/pages/`

### ðŸ“„ `TestWorkflow.tsx`
> FILEPATH: frontend/src/pages/TestWorkflow.tsx */

**Components & Logic:**

* **`TestWorkflow`**
  * **Logic Flow:**
    * `ðŸŽ¨ THEME ENGINE HOOK`
    * `âš¡ GATEWAY: Use standardized base`
    * `--- STYLES (Dynamic based on Theme) ---`

---
## ðŸ“‚ `frontend/src/platform/auth/`

### ðŸ“„ `AuthContext.tsx`
> FILEPATH: frontend/src/platform/auth/AuthContext.tsx */

**Components & Logic:**

* **`AuthProvider`**
  * **Logic Flow:**
    * `Start the Machine`
    * `Helper Hook for easy access`
* **`useAuth`**
  * ðŸ“ *Helper Hook for easy access*

---
### ðŸ“„ `LoginScreen.tsx`
> FILEPATH: frontend/src/platform/auth/LoginScreen.tsx */

---
### ðŸ“„ `machine.ts`
> FILEPATH: frontend/src/platform/auth/machine.ts */

**Components & Logic:**

* **`authMachine`**
  * ðŸ“ *4. The Machine Definition*
  * **Logic Flow:**
    * `1. Boot Sequence`
    * `2. Login Flow`
    * `3. The Async "Thinking" State`
    * `4. The Platform`

---
## ðŸ“‚ `frontend/src/platform/core/`

### ðŸ“„ `ModuleRegistry.ts`
> Singleton registry for Feature Modules.

**Components & Logic:**

* **`ModuleManifest`**
* **`MenuItem`**
  * **Logic Flow:**
    * `Silent discovery to keep console clean, we log the result later`
    * `ðŸ” DIAGNOSTIC LOG`
    * `logger.trace('REGISTRY', 'Generated Menu Items', items);`
    * `STRATEGY A: NESTED LAYOUT (Parent "/key" -> Children "path")`
    * `STRATEGY B: FLAT ROUTES (Prefix "/key/path")`
    * `âš¡ ROUTING TELEMETRY (The "Help Me" Feature)`
    * `Parent`
    * `Children`
    * `Flat`
* **`ModuleRegistry`**

---
## ðŸ“‚ `frontend/src/platform/design/system/`

### ðŸ“„ `useNotification.ts`
> FILEPATH: frontend/src/platform/design/system/useNotification.ts */

**Components & Logic:**

* **`useNotification`**
  * **Logic Flow:**
    * `âš¡ HOOK INTO ANT DESIGN APP CONTEXT`
    * `This requires the component to be wrapped in <App> (which is done in App.tsx)`
    * `DX Wrapper: Provides semantic methods matching the old API`
    * `Advanced usage with Title + Description`

---
## ðŸ“‚ `frontend/src/platform/hooks/`

### ðŸ“„ `useUrlState.ts`
> Provides a useState-like interface that persists to the URL Query String.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel Utility) */` |
| **invariant** | `Must handle browser history without causing page reloads. */` |

**Components & Logic:**

* **`useUrlState`**
  * ðŸ“ *Creates a state variable that syncs with a URL query parameter.*
  * **Logic Flow:**
    * `1. READ: Lazy initializer to read from URL only once on boot`
    * `2. WRITE: Updates both Local State and URL`
    * `Access the current URL state directly from the browser to avoid race conditions`
    * `âš¡ HISTORY: Use replaceState to avoid cluttering the "Back" button history with every click`
    * `If you want "Back" to undo the selection, change this to pushState.`
    * `For simple UI tabs/filters, replaceState is usually better UX.`
    * `3. LISTEN: (Optional) If the user clicks "Back", sync the internal state`

---
## ðŸ“‚ `frontend/src/platform/kernel/`

### ðŸ“„ `BootLoader.tsx`
> FILEPATH: frontend/src/platform/kernel/BootLoader.tsx */

**Components & Logic:**

* **`BootLoader`**

---
### ðŸ“„ `SystemContext.tsx`
> Stores the Auto-Discovered System Manifest.

**Components & Logic:**

* **`SystemContextType`**
  * ðŸ“ *âš¡ EXPORTED INTERFACE*
  * **Logic Flow:**
    * `âš¡ SAFE DEFAULT: Prevents crash if accessed before provider mount (though unlikely)`
* **`SystemProvider`**
  * **Logic Flow:**
    * `âš¡ STABLE HANDLER: Force Refresh`
    * `Invalidate both manifest and specific queries to be safe`
* **`useSystem`**

---
### ðŸ“„ `types.ts`
> Shared definitions for the Operating System Core.

**Components & Logic:**

* **`ProcessStep`**
  * ðŸ“ *Shared definitions for the Operating System Core.*
* **`ProcessDefinition`**
* **`ModuleDefinition`**
  * **Logic Flow:**
    * `Legacy config support`
    * `âš¡ NEW: Navigation Node Contract (Matches Backend)`
* **`NavigationNode`**
  * ðŸ“ *âš¡ NEW: Navigation Node Contract (Matches Backend)*
  * **Logic Flow:**
    * `Architecture Metadata`
    * `Discovery`
    * `Config`
    * `Recursion`
* **`NavigationResponse`**
* **`SystemManifest`**
  * **Logic Flow:**
    * `âš¡ NEW: Secured Navigation Payload`

---
## ðŸ“‚ `frontend/src/platform/logging/`

### ðŸ“„ `Narrator.ts`
> The "Storyteller" Observability System.

**Components & Logic:**

* **`UniversalNarrator`**
  * **Logic Flow:**
    * `âš¡ CONFIGURATION: Maximum Verbosity`
    * `We try to detect environment, but default to true if we can't tell, to ensure logging works.`
    * `--- PUBLIC API ---`
    * `âš¡ NEW: Grouping Support`
    * `--- INTERNAL ---`
    * `Line 0: Error`
    * `Line 1: _resolveCaller`
    * `Line 2: _broadcast`
    * `Line 3: tell/scream/whisper`
    * `Line 4: The actual caller <--- Target`
    * `Find the first line that is NOT inside Narrator.ts`
    * `This regex looks for file paths that include /src/`
    * `Extract file path: "    at Context (http://localhost:3000/src/file.ts:10:20)"`
    * `Clean up: Remove http://localhost:port/`
    * `Time Delta Calculation`
    * `Format Delta: [+450ms] or [+1.2s] or [-----] if idle > 5s`
    * `âš¡ X-RAY: Inject Caller Context`
    * `âš¡ IMPROVED OUTPUT`
    * `1. Live Object (Chrome DevTools lets you expand this)`
    * `2. Serialized Backup (For Copy/Paste) - âš¡ LOUD MODE: Limit increased significantly`
    * `--- SENTINELS ---`
* **`logger`**

---
### ðŸ“„ `index.ts`
> Exports the Singleton Logger for application-wide use.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 0 (Kernel) */` |
| **invariant** | `Must always export a valid 'logger' instance. */` |

**Components & Logic:**

* **`logger`**
  * ðŸ“ *The Global Logger Instance.*
  * **Logic Flow:**
    * `Export Types if needed`

---
### ðŸ“„ `useTrace.ts`
> FILEPATH: frontend/src/platform/logging/useTrace.ts */

**Components & Logic:**

* **`useTrace`**
  * **Logic Flow:**
    * `1. Mount Log`
    * `2. Unmount Log`
    * `3. Update Log (Only if state changed deeply)`

---
## ðŸ“‚ `frontend/src/platform/routing/`

### ðŸ“„ `RouterFactory.tsx`
> Converts System Manifest into React Router Object.

**Components & Logic:**

* **`createDynamicRouter`**
  * ðŸ“ *--- FACTORY ---*
  * **Logic Flow:**
    * `1. Define Static Routes (System & Dev Tools)`
    * `âš¡ SYSTEM ADMIN CONSOLE`
    * `Meta Kernel Routes`
    * `âš¡ META V2 (The Kernel Lab)`
    * `âœ… NESTED INSIDE SHELL to inherit Top Bar & Theme`
    * `âš¡ DYNAMIC WORKSPACE ROUTES (The "Player")`
    * `2. Construct Router`
    * `âš¡ SHELL IMPORT FIX (Lazy load avoided for Core Shell to prevent flicker)`

---
## ðŸ“‚ `frontend/src/platform/shell/`

### ðŸ“„ `ShellLayout.tsx`
> Master Layout. Connects Backend Navigation to Ant Design Structure.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Must gracefully handle empty navigation states (Guest Mode). */` |

**Components & Logic:**

* **`ShellLayout`**
  * **Logic Flow:**
    * `âš¡ COMMAND-K STATE`
    * `âš¡ DIAGNOSTIC: Log Mount`
    * `âš¡ KEYBOARD LISTENER (Discovery Engine)`
    * `1. DATA PREP (Flatten for Search)`
    * `âš¡ SEARCH FILTER LOGIC`
    * `Match Label`
    * `Match Key`
    * `âš¡ MATCH SEARCH TAGS (The "Dark Mode" -> "Appearance" Magic)`
    * `2. NAVIGATION HANDLER`
    * `A. Intercept Actions`
    * `B. Standard Navigation`
    * `User Menu Items`
    * `Fallbacks if empty`
    * `âš¡ BUILD SIDEBAR (From DB)`

---
### ðŸ“„ `Sidebar.tsx`
> Renders a collapsible data-driven sidebar with integrated branding toggle.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 5 (Presentation) */` |

**Components & Logic:**

* **`SidebarProps`**
* **`Sidebar`**
  * **Logic Flow:**
    * `âš¡ HELPER: Recursive Menu Item Builder`
    * `âš¡ ACTIVE STATE RESOLUTION`

---
### ðŸ“„ `SidebarWrapper.tsx`
> Filters the menu structure based on Governance Rules.

**Components & Logic:**

* **`useSidebarSecurity`**
  * **Logic Flow:**
    * `If manifest isn't loaded yet, show default items (fail open/safe)`
    * `âš¡ FIX: Defensive Casting. item.id might be a number (DB ID).`
    * `Always allow System items (SYS) and Root (/)`
    * `Find config in Manifest`
    * `If module exists in manifest, obey its switches`
    * `Recursive check for children (Folders)`
    * `Optional: Hide empty folders if desired`
    * `if (item.children.length === 0) return false;`

---
### ðŸ“„ `ThemeContext.tsx`
> FILEPATH: frontend/src/platform/shell/ThemeContext.tsx */

**Components & Logic:**

* **`ThemeProvider`**
  * **Logic Flow:**
    * `1. Initialize State from LocalStorage`
    * `2. Actions`
    * `Update HTML attribute for global CSS hooks (e.g. scrollbars)`
    * `3. Compute Config`
    * `Helper: Is this a dark theme? (Void, Midnight, Cyberpunk are dark)`
    * `4. Effects`
* **`useTheme`**

---
### ðŸ“„ `ThemePicker.tsx`
> FILEPATH: frontend/src/platform/shell/ThemePicker.tsx */

**Components & Logic:**

* **`ThemePicker`**

---
### ðŸ“„ `theme.ts`
> FILEPATH: frontend/src/platform/shell/theme.ts */

**Components & Logic:**

* **`ThemePreset`**
  * ðŸ“ *--- TYPES ---*
* **`PRESET_COLORS`**
  * **Logic Flow:**
    * `--- PALETTE DEFINITIONS ---`
    * `1. VOID (Original Dark)`
    * `2. POLAR (Original Light)`
    * `3. MIDNIGHT (Deep Purple/Blue Focus)`
    * `4. ENTERPRISE (SaaS Standard)`
    * `5. CYBERPUNK (High Contrast Neon)`
* **`getThemeConfig`**
  * **Logic Flow:**
    * `Override with Preset Specifics`

---
## ðŸ“‚ `frontend/src/platform/ui/`

### ðŸ“„ `ProcessView.tsx`
> A standalone view for executing a specific process instance.

**Components & Logic:**

* **`ProcessView`**
  * **Logic Flow:**
    * `Hardcoded flow for now, will be dynamic in Level 5`

---
## ðŸ“‚ `frontend/src/platform/ui/animation/`

### ðŸ“„ `FadeIn.tsx`
> Standardized entry animation wrapper.

**Components & Logic:**

* **`FadeIn`**
  * **Logic Flow:**
    * `âš¡ TELEMETRY: Communicate the transition`

---
## ðŸ“‚ `frontend/src/platform/ui/icons/`

### ðŸ“„ `IconFactory.tsx`
> Converts string tokens into Ant Design Icons.

**Components & Logic:**

* **`IconFactory`**
  * **Logic Flow:**
    * `1. Pass-through if it's already a React Node (e.g. from static config)`
    * `2. Fallback for empty/null`
    * `Return an invisible span to keep layout stable`
    * `3. Parse "antd:IconName"`
    * `4. Resolve Component`
    * `5. Render or Warn`
    * `Fallback for missing icon`

---
## ðŸ“‚ `frontend/src/platform/ui/layout/`

### ðŸ“„ `MasterDetailShell.tsx`
> FILEPATH: frontend/src/platform/ui/layout/MasterDetailShell.tsx */

**Components & Logic:**

* **`MasterDetailShellProps`**
* **`MasterDetailShell`**
  * **Logic Flow:**
    * `1. STATE: Sidebar Collapse (with Persistence)`
    * `Trigger resize event for charts/grids to adjust`

---
## ðŸ“‚ `frontend/src/platform/ui/list/`

### ðŸ“„ `SmartListItem.tsx`
> FILEPATH: frontend/src/platform/ui/list/SmartListItem.tsx */

**Components & Logic:**

* **`SmartListItemProps`**
  * **Logic Flow:**
    * `Data`
    * `Status flags`
    * `Optional Tags (Full mode only)`
* **`SmartListItem`**
  * **Logic Flow:**
    * `--- MODE A: COMPACT (Dock Style) ---`
    * `--- MODE B: FULL (List Style) ---`

---
## ðŸ“‚ `frontend/src/platform/ui/widgets/`

### ðŸ“„ `ActionButtonWidget.tsx`
> FILEPATH: frontend/src/platform/ui/widgets/ActionButtonWidget.tsx

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Intent Logging)` |
| **invariant** | `Click must emit intent telemetry.` |
| **narrator** | `Logs user interaction and target scope.` |

**Components & Logic:**

* **`ActionButtonWidget`**
  * **Logic Flow:**
    * `1. Destructure Backend Config`
    * `Properties defined in DB: "label", "danger", "action_type", "target_scope"`
    * `2. Handle Interaction`
    * `âš¡ NARRATOR: Announce Intent`
    * `âš¡ SIMULATION (Until WizardContext is fully wired)`
    * `In a real implementation, this would call 'wizard.spawn(target_scope)'`

---
### ðŸ“„ `DescriptionListWidget.tsx`
> FILEPATH: frontend/src/platform/ui/widgets/DescriptionListWidget.tsx

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Pure Presentation)` |
| **invariant** | `Renders key-value pairs or static text strictly.` |
| **narrator** | `Logs visibility state.` |

**Components & Logic:**

* **`DescriptionListWidget`**
  * **Logic Flow:**
    * `1. Destructure Backend Config`
    * `fieldProps comes from the schema (e.g., { "value": "Set...", "column": 2 })`
    * `2. Resolve Content`
    * `Value can come from form data (value) or static config (fieldProps.value)`

---
### ðŸ“„ `SecurePasswordWidget.tsx`
> Password input with built-in generator, strength meter, and clipboard copy.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Robust Clipboard)` |

**Components & Logic:**

* **`SecurePasswordWidget`**
  * **Logic Flow:**
    * `âš¡ ROBUST CLIPBOARD FUNCTION`
    * `Guarantees copy works even in non-secure contexts (localhost via http)`
    * `Fallback for non-secure contexts`

---
### ðŸ“„ `UserSelectorWidget.tsx`
> Asynchronous dropdown that fetches Users from the Universal Resource API.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Role Filtered)` |

**Components & Logic:**

* **`UserSelectorWidget`**
  * **Logic Flow:**
    * `1. Destructure specific props injected by the Backend Registry`
    * `2. Define the Async Loader`
    * `Call the Universal Resource API`
    * `Transform to Ant Design Select options`

---
## ðŸ“‚ `frontend/src/platform/workflow/`

### ðŸ“„ `WorkflowActions.tsx`
> Renders state transition buttons using Backend-provided metadata and Governance rules.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **invariant** | `Disabled state must be strictly bound to 'allowed' flag. */` |
| **narrator** | `Traces user interactions with transition buttons. */` |

**Components & Logic:**

* **`WorkflowActions`**
  * **Logic Flow:**
    * `1. Backend-Driven Metadata (No more guessing by string names)`
    * `2. The "Dumb UI" Base Component`
    * `3. âš¡ UX UPGRADE: Explain WHY it's blocked instead of hiding it`

---
### ðŸ“„ `WorkflowPlayer.tsx`
> FILEPATH: frontend/src/platform/workflow/WorkflowPlayer.tsx */

**Components & Logic:**

* **`WorkflowPlayer`**
  * **Logic Flow:**
    * `Interaction State`
    * `1. Fetch Options on Mount or Status Change`
    * `âš¡ GATEWAY: Use standardized base`
    * `2. Handle Click`
    * `Check if this event requires a payload (Schema check)`
    * `Instant Execution`
    * `3. Execute`
    * `4. Render Form Fields (Dynamic)`

---
## ðŸ“‚ `frontend/src/platform/workflow/api/`

### ðŸ“„ `client.ts`
> FILEPATH: frontend/src/platform/workflow/api/client.ts */

**Components & Logic:**

* **`workflowApi`**
  * **Logic Flow:**
    * `âš¡ GATEWAY: Use normalized base + explicit versioning`

---
## ðŸ“‚ `frontend/src/platform/workflow/components/`

### ðŸ“„ `WizardPlayer.tsx`
> Smartly switches between Form-based (Input) and View-based (Grid) modes.

| Attribute | Value |
| :--- | :--- |
| **updated** | `Added Registry Gatekeeper to prevent premature layout calculation.` |

**Components & Logic:**

* **`WizardPlayer`**
  * **Logic Flow:**
    * `âš¡ REGISTRY ACCESS`
    * `âš¡ HYBRID DETECTION (MEMOIZED)`
    * `Only calculate this when the registry is ready to avoid false "Input" classification on fallbacks`
    * `Categories that REQUIRE a Form Context (User Input)`
    * `Log decision for debugging`
    * `logger.whisper("PLAYER", `Detected Input Widget: [${f.name}] (${def.key}) -> Category: ${def.category}`);`
    * `If we have ANY inputs, it's NOT a view step. It's a Form step.`
    * `Detect if this is a "Submit" action`
    * `âš¡ DYNAMIC LABEL LOGIC`
    * `âš¡ GATEKEEPER: Wait for BOTH logic and registry to be ready`

---
### ðŸ“„ `WorkflowPlayer.tsx`
> FILEPATH: frontend/src/platform/workflow/components/WorkflowPlayer.tsx */

**Components & Logic:**

* **`WorkflowPlayerProps`**
* **`WorkflowPlayer`**
  * **Logic Flow:**
    * `UI State`
    * `Check Schema`
    * `--- RENDERERS ---`
    * `Simple Widget Mapping (Expandable)`

---
## ðŸ“‚ `frontend/src/platform/workflow/`

### ðŸ“„ `index.ts`
> FILEPATH: frontend/src/platform/workflow/index.ts */

---
## ðŸ“‚ `frontend/src/platform/workflow/logic/`

### ðŸ“„ `types.ts`
> FILEPATH: frontend/src/platform/workflow/logic/types.ts */

**Components & Logic:**

* **`TransitionOption`**
  * ðŸ“ *FILEPATH: frontend/src/platform/workflow/logic/types.ts */*
* **`TransitionResponse`**
* **`WorkflowState`**

---
### ðŸ“„ `useWizardLogic.ts`
> Manages State, Data Collection, and Execution Mode.

**Components & Logic:**

* **`useWizardLogic`**
  * **Logic Flow:**
    * `1. CONTEXT`
    * `Treat '/app/' routes as Production environments`
    * `2. STATE`
    * `3. BOOT TELEMETRY`
    * `4. HYDRATION`
    * `5. FETCH DEFINITION`
    * `ðŸ”§ SHIM: POLYFILL CHECK`
    * `6. INITIALIZATION & RECOVERY`
    * `Only run if we have data and haven't set a step yet`
    * `âš¡ RESOLVE INITIAL STEP: Use API initial, or first key, or fallback`
    * `Verify step still exists in schema`
    * `Schema changed, draft invalid`
    * `7. AUTO-SAVE`
    * `8. TRANSITION ENGINE`
    * `Merge Data`
    * `Cleanup`

---
### ðŸ“„ `useWorkflow.ts`
> FILEPATH: frontend/src/platform/workflow/logic/useWorkflow.ts */

**Components & Logic:**

* **`useWorkflow`**
  * **Logic Flow:**
    * `Initial Load`
    * `Refresh options as state has changed`

---
## ðŸ“‚ `frontend/src/platform/workflow/`

### ðŸ“„ `useWorkflow.ts`
> Determines available actions via Backend Fused Manifest and executes transitions via Dedicated API.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (UI Safe) */` |
| **narrator** | `Logs API requests, transition attempts, and governance results. */` |

**Components & Logic:**

* **`TransitionOption`**
* **`useWorkflow`**
  * **Logic Flow:**
    * `1. Fetch Fused Manifest from Backend (The "Dumb UI" Approach)`
    * `2. Execute Transition via Specialized API`
    * `Invalidate the entity data so the UI refreshes`
    * `âš¡ GOVERNANCE ERROR PARSING`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/`

### ðŸ“„ `FieldFactory.tsx`
> Polymorphic Router that converts JSON Schema into React Components.

| Attribute | Value |
| :--- | :--- |
| **architecture** | `LEVEL 10 (Registry-Driven Routing)` |
| **updated** | `Implemented Category-Based Routing to fix 'SMART_GRID' mismatch.` |

**Components & Logic:**

* **`FieldFactory`**
  * **Logic Flow:**
    * `âš¡ 1. CONSULT THE REGISTRY (The Source of Truth)`
    * `This resolves 'SMART_GRID' (Data) -> Widget Definition { category: 'DATA_DISPLAY', ... }`
    * `âš¡ TELEMETRY: Trace layout decisions`
    * `âš¡ 2. ROUTING LOGIC (CATEGORY BASED)`
    * `We route based on the *Category* defined in the DB, not the hardcoded string.`
    * `--- LAYOUTS (Groups, Tabs, Sections) ---`
    * `--- DATA GRIDS (Smart Tables) ---`
    * `P2 Logic: Route all Heavy Tables to SmartGridRenderer`
    * `This CATCHES 'SMART_GRID', 'PRO_TABLE', 'EDITABLE_TABLE' automatically.`
    * `--- FEEDBACK (Results, Empty States) ---`
    * `--- COMPLEX INPUTS (Repeater/Nested) ---`
    * `Legacy support: Some structures might not be fully migrated to Categories yet`
    * `--- PRIMITIVES (Atoms) ---`
    * `Fallback for everything else (Inputs, Selects, etc.)`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/hooks/`

### ðŸ“„ `useFieldSentinel.ts`
> FILEPATH: frontend/src/platform/workflow/wizard-engine/hooks/useFieldSentinel.ts */

**Components & Logic:**

* **`useFieldSentinel`**
  * **Logic Flow:**
    * `1. Detect Async Rules (using the explicit rules array)`
    * `2. The Global Sniper Logic`
    * `ðŸ” DEBUG: Inspect Initialization`
    * `This tells us immediately if the Sentinel correctly identified the async requirement`
    * `ðŸ›¡ï¸ SAFETY CHECK: Ensure target exists and is an input-like element`
    * `ðŸŽ¯ SNIPER SCOPE: Does this element belong to us?`
    * `ðŸ” DEBUG: Why didn't we trigger?`
    * `logger.trace("SENTINEL", `ðŸ“ Input on [${field.name}]`);`
    * `--- ATTACHMENT ---`
    * `--- CLEANUP ---`

---
### ðŸ“„ `useWidgetRegistry.ts`
> Provides O(1) access to the System's UI Library.

**Components & Logic:**

* **`WidgetDefinition`**
* **`useWidgetRegistry`**
  * **Logic Flow:**
    * `1. CONSUME KERNEL CAPABILITIES`
    * `We get the raw list of widgets from the backend via the Context`
    * `2. INDEXING (O(n) -> O(1))`
    * `Convert the array to a Map for instant lookups during rendering`
    * `ðŸ›¡ï¸ NORMALIZE KEYS: DB keys are UPPERCASE.`
    * `We force upper here to be safe when looking up 'text_input' vs 'TEXT_INPUT'.`
    * `âš¡ CONNECTION VERIFICATION`
    * `Only whisper once to avoid spamming console on re-renders`
    * `logger.whisper("REGISTRY", `ðŸ”— Connected to Kernel. Indexed ${map.size} Widgets.`);`
    * `3. PUBLIC API`
    * `Expose the full list for the "Context Browser" or "Palette"`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/logic/`

### ðŸ“„ `LogicEngine.ts`
> A lightweight parser for conditional rendering strings (e.g. "host.role == 'admin'").

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Sandboxed Evaluation)` |
| **invariant** | `Evaluation must never crash the UI, even with invalid syntax.` |
| **narrator** | `Logs evaluation trace to F12.` |

**Components & Logic:**

* **`LogicEngine`**
  * **Logic Flow:**
    * `Regex to find "host.xyz" or "formData.xyz"`
    * `Captures 'xyz'`
    * `logger.trace("LOGIC", `ðŸ” Analyzed dependencies for "${expression}"`, { deps });`
    * `1. Trivial Cases`
    * `2. Prepare Sandbox`
    * `We map 'host' and 'formData' to the same context for convenience`
    * `Helper for simple "contains" checks`
    * `3. Execution`
    * `ðŸ›¡ï¸ SECURITY: Function constructor is safer than eval(), but still requires`
    * `strict input sanitization. In a Level 9 system, we'd use a parser (AST).`
    * `For now, we wrap in a try-catch sandbox.`
    * `Allow-list check (Basic prevention of window/alert access)`
    * `logger.trace("LOGIC", `âš¡ Evaluated: "${expression}"`, { result, context_sample: Object.keys(context) });`
    * `Fail Open or Closed?`
    * `For visibility (show_if), we fail CLOSED (hide it) to prevent broken UI.`
    * `For requirements (required_if), we fail OPEN (not required) to prevent blocking.`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/renderers/`

### ðŸ“„ `ComponentMap.tsx`
> Maps Backend Keys to Frontend Implementations with Deep Observability.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Proxy Wrapper)` |
| **updated** | `Registered 'DESCRIPTION_LIST' and 'ACTION_BUTTON'.` |

**Components & Logic:**

* **`COMPONENT_MAP`**
  * ðŸ“ *âš¡ THE MAPPING (Wrapped)*
  * **Logic Flow:**
    * `GROUP 1: TEXT`
    * `GROUP 2: CHOICE`
    * `GROUP 3: DATE`
    * `GROUP 4: VISUAL`
    * `GROUP 5: SECURITY`
    * `GROUP 6: DOMAIN`
    * `âš¡ GROUP 7: DATA & ACTIONS (The Missing Pieces)`

---
### ðŸ“„ `DynamicWidget.tsx`
> Intelligent wrapper that dehydrates Backend Config and injects Logic Responsiveness.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Sanitized Merge + Reactive Wrapper)` |
| **updated** | `Integrated 'DependencyWrapper' to enable 'show_if' and 'disabled_if' logic.` |

**Components & Logic:**

* **`DynamicWidget`**
  * **Logic Flow:**
    * `1. Get Definition from Backend Registry`
    * `2. Resolve Physical Component`
    * `3. Merge Props (Backend Defaults < Runtime Overrides < Logic)`
    * `Extract defaults from schema if available`
    * `âš¡ CRITICAL FIX: SANITIZE CUSTOM PROPS`
    * `We must REMOVE 'rules' from customProps because they contain`
    * `raw strings (e.g. "validator": "checkUniqueness") which crash`
    * `the form engine. The Logic Layer (commonProps) owns the rules.`
    * `Merge nested fieldProps deeply`
    * `ðŸ” DEEP NARRATOR INSPECTION`
    * `4. Fallback for Unknowns`
    * `5. EXTRACT LOGIC PROPS`
    * `These keys drive the DependencyWrapper and shouldn't necessarily pass to the widget`
    * `6. RENDER (Wrapped in Logic Engine)`

---
### ðŸ“„ `EmptyRenderer.tsx`
> Renders Ant Design Empty component.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Visual Consistency)` |
| **invariant** | `Must visually indicate 'No Data'.` |
| **narrator** | `Silent (Passive UI).` |

**Components & Logic:**

* **`EmptyRenderer`**
  * **Logic Flow:**
    * `Backend schema: { component: "EMPTY", fieldProps: { description: "No items found" } }`
    * `Map string image names to AntD constants if needed,`
    * `otherwise default to standard SIMPLE/PRESENTED logic or allow null.`

---
### ðŸ“„ `GroupRenderer.tsx`
> Renders ProFormGroup, ProCard (Section), or ProCard (Tabs).

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Infinite Recursion Safe)` |
| **invariant** | `Must render children via FieldFactory to maintain Logic capabilities.` |
| **narrator** | `Logs layout structure.` |

**Components & Logic:**

* **`GroupRenderer`**
  * **Logic Flow:**
    * `Default to first tab or a generic key if empty`
    * `1. Validate Structure`
    * `2. Resolve Children (Recursive Render Helper)`
    * `Inherit disabled state if parent is disabled`
    * `3. LAYOUT MODE: TABS`
    * `4. LAYOUT MODE: SECTION (Card)`
    * `If it has a label but no specific component type (or explicitly SECTION), treat as a Section`
    * `5. LAYOUT MODE: INLINE GROUP (Default)`
    * `ProFormGroup (Visual grouping for alignment, usually horizontal)`

---
### ðŸ“„ `PrimitiveRenderer.tsx`
> Delegates rendering to DynamicWidget with Level 9 Props Normalization.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Data Injection + State Enforcement)` |
| **updated** | `Integrated 'normalizeProps' to fix the "Locked Email" bug.` |

**Components & Logic:**

* **`PrimitiveRenderer`**
  * **Logic Flow:**
    * `0. DEFENSIVE: Snapshot rules`
    * `1. EVENT SENTINEL (Validation Sniper)`
    * `2. RULE HYDRATION (Async Validator Logic)`
    * `3. âš¡ PROPS NORMALIZATION (The Fix)`
    * `We delegate all prop calculation to the Level 9 Engine.`
    * `A. Run the Normalizer`
    * `B. Inject Runtime Bindings (Handlers & Data)`
    * `âš¡ DATA INJECTION: Support Read-Only widgets reading directly from context`
    * `âš¡ LOGIC INJECTION: Hydrated Rules & Sentinel`
    * `âš¡ ASYNC OPTIONS (If request URL exists)`
    * `4. RENDER`

---
### ðŸ“„ `ResultRenderer.tsx`
> Renders a Result page. Allows injecting buttons via 'columns' array.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Recursion Enabled)` |
| **invariant** | `Must support all standard AntD status codes (403, 404, 500, success).` |
| **narrator** | `Logs feedback events.` |

**Components & Logic:**

* **`ResultRenderer`**
  * **Logic Flow:**
    * `1. Destructure Config`
    * `Backend schema: { component: "RESULT", fieldProps: { status: "404", title: "Missing" } }`
    * `2. Telemetry`
    * `3. Resolve "Extra" (Buttons/Actions)`
    * `If the schema defines 'columns', we render them in the 'extra' slot of the Result`
    * `This allows backend-driven "Back to Home" or "Retry" buttons.`

---
### ðŸ“„ `SmartGridRenderer.tsx`
> Renders a Server-Side Data Grid with Context-Aware Actions.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Icon Safe + Dynamic Scope)` |
| **updated** | `Fixed logic to switch between 'create_flow' and 'edit_flow'. Added key-reset.` |

**Components & Logic:**

* **`SmartGridRenderer`**
  * **Logic Flow:**
    * `Local State for "Sub-Wizard"`
    * `1. CONFIGURATION EXTRACTION`
    * `âš¡ DYNAMIC SCOPE LOGIC`
    * `We read these from the Backend Schema (passed via 'field')`
    * `âš¡ CALCULATE ACTIVE SCOPE`
    * `âš¡ KEY CHANGE: Force remount if ID changes`

---
### ðŸ“„ `TableRenderer.tsx`
> Recursive component for rendering arrays of objects.

**Components & Logic:**

* **`TableRenderer`**
  * **Logic Flow:**
    * `Safety Check: Table must have columns`
    * `Force smaller width inside tables if not specified`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/`

### ðŸ“„ `types.ts`
> FILEPATH: frontend/src/platform/workflow/wizard-engine/types.ts

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Type Safety)` |
| **updated** | `Added 'formData' to RenderContext for Read-Only binding.` |

**Components & Logic:**

* **`WizardFieldSchema`**
  * ðŸ“ *FILEPATH: frontend/src/platform/workflow/wizard-engine/types.ts*
  * **Logic Flow:**
    * `Identity`
    * `State & Visibility`
    * `Data & Validation`
    * `Options (Select/Radio)`
    * `Structure (Nested/Grid)`
    * `âš¡ NEW: Defines columns for ProTable/SmartGrid components`
    * `Container Props`
    * `Extension Bag (for custom props not typed above)`
* **`WizardStepSchema`**
* **`RenderContext`**
  * **Logic Flow:**
    * `âš¡ DATA INJECTION: Allows widgets to read state without Form binding`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/utils/`

### ðŸ“„ `propsNormalizer.ts`
> Translates Backend JSON Schema (snake_case) to Ant Design React Props (camelCase).

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Strict Type Enforcement)` |
| **invariant** | `Backend State (read_only) must ALWAYS override Component Default State.` |
| **narrator** | `Silent utility, used by Renderers.` |

**Components & Logic:**

* **`normalizeProps`**
  * ðŸ“ *Normalizes backend field schema into strict React props.*
  * **Logic Flow:**
    * `1. EXTRACT RAW CONFIG`
    * `fieldProps bag contains the loose JSON from the DB`
    * `2. STATE NORMALIZATION (The "Locked Field" Fix)`
    * `We check ALL possible backend keys for "Read Only" intent.`
    * `3. LAYOUT NORMALIZATION`
    * `Map backend layout concepts to AntD Grid/Form props`
    * `4. CONSTRUCT BASE PROPS`
    * `Identity`
    * `Layout`
    * `Data Binding`
    * `âš¡ STATE ENFORCEMENT (Level 9 Invariant)`
    * `We set BOTH 'readonly' (ProForm) and 'disabled' to be safe.`
    * `For inputs, we also force HTML attributes via 'fieldProps'.`
    * `Visibility`
    * `5. COMPONENT-SPECIFIC SAFETY (Edge Cases)`
    * `Prevent dropdowns from opening if they are read-only`
    * `6. INJECT RAW PROPS (Low Priority)`
    * `We merge the remaining raw props, but specific keys above take precedence.`
    * `This allows the DB to pass 'addonAfter' or 'prefix' seamlessly.`
    * `âš¡ DEEP MERGE for fieldProps to ensure HTML attributes stick`
    * `HTML-level enforcement`

---
## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/wrappers/`

### ðŸ“„ `DependencyWrapper.tsx`
> Wraps widgets to provide Conditional Rendering and disabling logic.

| Attribute | Value |
| :--- | :--- |
| **security-level** | `LEVEL 9 (Reactive Isolation)` |
| **invariant** | `If 'show_if' evaluates false, children must not be in the DOM.` |
| **narrator** | `Logs dependency triggers.` |

**Components & Logic:**

* **`DependencyWrapper`**
  * **Logic Flow:**
    * `1. Calculate what fields to listen to`
    * `2. If no logic, render children directly (Performance)`
    * `If static boolean hidden=true, Handle upstream in renderer.`
    * `This wrapper specifically handles DYNAMIC dependencies.`
    * `3. Render the Reactor`
    * `values contains the current state of the dependent fields`
    * `A. Evaluate Visibility`
    * `logger.trace("UI", "ðŸ‘» Hidden by Logic", { showIf, values });`
    * `B. Evaluate Disabled State`
    * `C. Render Child`
    * `We pass the calculated state down if the child is a function`
    * `If child is a node, we clone it to inject disabled prop if supported,`
    * `but usually the child is the PrimitiveRenderer which handles its own props.`
    * `The 'disabled' prop injection here is a fallback.`

---
