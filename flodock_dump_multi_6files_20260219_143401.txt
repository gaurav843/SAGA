Project Code Dump generated on: 2026-02-19 14:34:01
==================================================
6 files included:
--------------------
backend\SYSTEM_ATLAS.md
frontend/src/pages/TestWorkflow.tsx
frontend/src/platform/workflow/WorkflowActions.tsx
frontend/src/platform/workflow/useWorkflow.ts
frontend\FRONTEND_ATLAS.md
main_prompt.txt

==================================================
CONTEXT ANALYSIS REPORT
==================================================
Target: frontend\src\platform\workflow\WorkflowActions.tsx
  - Direct Deps: 1
  - Used By:     0
  - Cross-Stack: 0
------------------------------
Target: frontend\src\platform\workflow\useWorkflow.ts
  - Direct Deps: 0
  - Used By:     1
  - Cross-Stack: 1
------------------------------
Target (Auto-Generated): frontend\FRONTEND_ATLAS.md
Target (Auto-Generated): backend\SYSTEM_ATLAS.md
Target (Instruction): main_prompt.txt
==================================================

==================================================

# Source code from: backend\SYSTEM_ATLAS.md
---------------------------------------------
   1 | # ðŸ—ºï¸ SYSTEM ATLAS: `backend/`
   2 | **Generated:** 2026-02-19 14:34
   3 | 
   4 | ---
   5 | ### ðŸ“„ `backend/alembic/env.py`
   6 | **Components & Logic:**
   7 | 
   8 | - Æ’ **`load_all_domain_models`**
   9 |     > *Scans the 'app/domains' directory.*
  10 |     * pkgutil.iter_modules returns (module_loader, name, ispkg)
  11 |     * Construct the potential module path (e.g., app.domains.shipping.models)
  12 |     * Check if models.py physically exists (Prevent Import Errors)
  13 |     * This is fine. Not every domain needs a database table.
  14 |     * Import the module. This executes the Class definitions,
  15 |     * registering them with the global Base.metadata.
  16 |     * **CRITICAL:** If a model file exists but crashes, we must stop migrations.
  17 | 
  18 | - Æ’ **`run_migrations_offline`**
  19 |     > *Run migrations in 'offline' mode.*
  20 | - Æ’ **`do_run_migrations`**
  21 | - Æ’ **`run_migrations_online`**
  22 |     > *Run migrations in 'online' mode.*
  23 | 
  24 | ---
  25 | ### ðŸ“„ `backend/app/api/v1/auth.py`
  26 | **Components & Logic:**
  27 | 
  28 | - Æ’ **`login`**
  29 |     > *OAuth2 compatible token login.*
  30 |     * **1.** Find User by Email
  31 |     * **2.** Validate Existence
  32 |     * **3.** GUARDRAIL: System User Check (Hard Logic)
  33 |     * **4.** Verify Password
  34 |     * **5.** Check Active Status
  35 |     * --- ðŸ›¡ï¸ KERNEL GOVERNANCE (The "Brain") ---
  36 |     * We ask the Logic Engine if this specific user is allowed to LOGIN right now.
  37 |     * --- ðŸ“ STATE UPDATE & AUDIT (The "Memory") ---
  38 |     * Update Last Login (Triggers a DB Write)
  39 |     * Publish Audit Event to SystemOutbox
  40 |     * **âš¡ FIX:** Added partition_key for Kafka Ordering
  41 |     * Commit Transaction (Saves User Update + Outbox Event atomically)
  42 |     * **6.** Mint Token
  43 | 
  44 | 
  45 | ### ðŸ“„ `backend/app/api/v1/meta.py`
  46 | **Components & Logic:**
  47 | 
  48 | - Æ’ **`list_policies`**
  49 | - Æ’ **`create_policy`**
  50 | - Æ’ **`update_policy`**
  51 | - Æ’ **`dry_run_policy`**
  52 | - Æ’ **`get_policy_history`**
  53 | - Æ’ **`restore_policy_version`**
  54 | - Æ’ **`list_bindings`**
  55 | - Æ’ **`create_binding`**
  56 | - Æ’ **`update_binding`**
  57 | - Æ’ **`delete_binding`**
  58 | - Æ’ **`create_attribute`**
  59 | - Æ’ **`update_attribute`**
  60 | - Æ’ **`delete_attribute`**
  61 | - Æ’ **`list_rules`**
  62 | - Æ’ **`create_rule`**
  63 | - Æ’ **`get_domain_schema`**
  64 |     > *SCHEMA FUSION ENDPOINT.*
  65 | - Æ’ **`list_domains`**
  66 |     * **1.** Dynamic Domains from DB (The "Wild" Ones)
  67 |     * Allows discovery of domains that exist only via custom attributes
  68 |     * **2.** System Domains from Registry (The "Official" Ones)
  69 |     * **âš¡ FIX:** Passing 'db' session as required by the new Manager to fetch Type Defs
  70 |     * **3.** Merge Strategy
  71 |     * A. Add Registered Domains (Source of Truth)
  72 |     * Pydantic model dump to dictionary for mutability
  73 |     * B. Add Dynamic Domains (if any found that aren't registered)
  74 | 
  75 | 
  76 | ### ðŸ“„ `backend/app/api/v1/resource.py`
  77 | **Components & Logic:**
  78 | 
  79 | - Æ’ **`deep_merge`**
  80 |     > *Recursively merges dictionaries to preserve nested data.*
  81 | - Æ’ **`get_domain_context`**
  82 |     > *Retrieves the full Registry Contract for a domain.*
  83 | - Æ’ **`validate_and_cast`**
  84 |     > *Enforces Strict Typing for Dynamic Fields based on AttributeDefinition.*
  85 | - Æ’ **`sanitize_payload`**
  86 |     > *1. Splits payload into Columns vs Extras.*
  87 |     * Check if the model actually has the configured container
  88 |     * **1.** Fetch Dynamic Definitions (The Law)
  89 |     * **âš¡ SECURITY:** Transformation Pipeline
  90 |     * --- A. STATIC COLUMNS ---
  91 |     * âš¡ METADATA DRIVEN PROTECTION
  92 |     * If the Model says "is_system", we skip it. No magic strings.
  93 |     * Fallback: If DB controls the default (e.g. auto-increment, triggers), skip unless explicit.
  94 |     * --- B. DYNAMIC ATTRIBUTES ---
  95 |     * Dynamic Attributes marked as system are also protected
  96 |     * Allow bulk update of the container itself if passed directly
  97 |     * If strict mode is off, we might allow ad-hoc extras, but for now we only allow defined attributes
  98 |     * or explicit updates to the container.
  99 |     * Store unknown fields in extras?
 100 |     * Policy: If it's not a column and not in dictionary, we treat it as ad-hoc extra.
 101 | 
 102 | - Æ’ **`serialize_model`**
 103 |     * **1.** Flatten Columns
 104 |     * **2.** Flatten Dynamic Container (e.g. preferences)
 105 |     * Columns take precedence, so only add if not already present
 106 | 
 107 | - Æ’ **`check_availability`**
 108 |     > *Checks if a value exists in the database.*
 109 |     * âš¡ META-TYPE CHECK: Availability not supported for CONFIG
 110 |     * Config keys are unique, so we check SystemConfig
 111 |     * **1.** Column Existence Check
 112 |     * **2.** PERFORMANCE GUARDRAIL
 113 |     * **3.** Execution
 114 |     * Case-insensitive check for emails/strings
 115 | 
 116 | - Æ’ **`list_resources`**
 117 |     > *UNIVERSAL SEARCH ENGINE.*
 118 |     * âš¡ BRANCH 1: CONFIG DOMAIN (Global)
 119 |     * Return list of SystemConfig items, potentially filtered by category
 120 |     * Simple filter support for Config
 121 |     * Serializer for Config
 122 |     * âš¡ BRANCH 2: STANDARD DOMAIN (Entity)
 123 |     * **1.** Start with Base Query
 124 |     * **2.** Extract Filters (Exclude Control Params)
 125 |     * **3.** Apply Tri-Layer Filtering logic
 126 |     * LAYER 1: Physical Column
 127 |     * LAYER 2: Dynamic Attribute (JSONB)
 128 |     * âš¡ Checks the configured container (custom_attributes OR preferences)
 129 |     * Safe JSONB lookup using SQLAlchemy text
 130 |     * LAYER 3: Ignore unknown params (Safety)
 131 |     * **4.** Calculate Total (Filtered)
 132 |     * **5.** Apply Pagination
 133 | 
 134 | - Æ’ **`get_resource`**
 135 |     * âš¡ META-TYPE CHECK
 136 |     * Config items usually accessed by Key, but if ID provided:
 137 | 
 138 | - Æ’ **`create_resource`**
 139 |     * âš¡ BRANCH 1: CONFIG DOMAIN
 140 |     * Create a new SystemConfig Entry
 141 |     * Payload expected: { key, value, label, category, type }
 142 |     * Check existence
 143 |     * âš¡ HOT SWAP TRIGGER
 144 |     * âš¡ BRANCH 2: STANDARD DOMAIN
 145 | 
 146 | - Æ’ **`update_resource`**
 147 |     * âš¡ BRANCH 1: CONFIG DOMAIN
 148 |     * âš¡ HOT SWAP TRIGGER
 149 |     * âš¡ BRANCH 2: STANDARD DOMAIN
 150 |     * âš¡ DYNAMIC CONTAINER MERGE LOGIC
 151 | 
 152 | - Æ’ **`delete_resource`**
 153 |     * âš¡ META-TYPE CHECK: Config Deletion
 154 |     * âš¡ HOT SWAP TRIGGER
 155 | 
 156 | 
 157 | ### ðŸ“„ `backend/app/api/v1/system.py`
 158 | **Components & Logic:**
 159 | 
 160 | - Æ’ **`get_system_manifest`**
 161 |     > *BOOTSTRAP ENDPOINT.*
 162 |     * âš¡ ACQUIRE ACTOR CONTEXT (For RBAC)
 163 |     * The ContextMiddleware has already hydrated this from the JWT.
 164 |     * Pass actor to kernel to filter navigation nodes
 165 | 
 166 | - Æ’ **`get_system_capabilities`**
 167 |     > *THE AI MANIFEST.*
 168 |     * **1.** Fetch Base Capabilities (Static Enums)
 169 |     * **2.** Augment with Context Schema
 170 |     * **3.** âš¡ HYDRATE DYNAMIC WIDGETS (The Upgrade)
 171 |     * We replace the static enum list with the rich DB definitions if available.
 172 |     * Transform to strict schema for AI consumption
 173 |     * Fallback (or empty if none registered)
 174 |     * We keep the static enum as a fallback if the DB is empty
 175 |     * Fail open: Return static caps, don't crash the endpoint
 176 | 
 177 | - Æ’ **`get_system_pulse`**
 178 | - Æ’ **`list_domains`**
 179 | - Æ’ **`patch_domain`**
 180 | - Æ’ **`list_circuits`**
 181 |     > *Fetches raw Circuit Breakers.*
 182 |     * Simple serialization
 183 | 
 184 | - Æ’ **`set_circuit_state`**
 185 |     > *Directly toggles a switch in the Hypervisor.*
 186 | - Æ’ **`list_config`**
 187 | - Æ’ **`update_config`**
 188 | 
 189 | ### ðŸ“„ `backend/app/api/v1/workflow.py`
 190 | **Components & Logic:**
 191 | 
 192 | - ðŸ“¦ **`TransitionRequest`**
 193 | - ðŸ“¦ **`TransitionOption`**
 194 | - ðŸ“¦ **`TransitionResponse`**
 195 | - Æ’ **`_load_machine_and_entity`**
 196 |     > *Shared logic to hydrate context.*
 197 |     * **1.** Resolve Model
 198 |     * **2.** Fetch Entity
 199 |     * **3.** Fetch Definition
 200 | 
 201 | - Æ’ **`get_transition_options`**
 202 |     > *Menu Builder. Returns valid next steps for this specific entity.*
 203 |     * Resolve Current State
 204 |     * If None, maybe it's new? Or broken? defaulting to empty options unless we want to support "INIT"
 205 |     * Get structural paths
 206 |     * Machine structure: _transition_map[current][event] = { target: ... }
 207 |     * **TODO:** Run Guard Check here? (Optional Level 6 Feature: "Grey out" buttons if guard fails)
 208 |     * For now, we return all structurally valid moves.
 209 | 
 210 | - Æ’ **`execute_transition`**
 211 |     > *Executes a State Transition with Context.*
 212 |     * Calculate Config
 213 |     * âš¡ DATA PERSISTENCE LAYER (The Fix)
 214 |     * Apply the payload to the entity, skipping protected fields.
 215 |     * Type conversion safety could go here (e.g. Enums), but we rely on Pydantic/SQLAlchemy for now
 216 |     * ðŸ›¡ï¸ ATTACH SIDECAR (For Hooks/Auditing that need raw context)
 217 |     * This attribute is ephemeral and won't be saved to DB unless model supports it
 218 |     * Update State
 219 | 
 220 | 
 221 | ---
 222 | ### ðŸ“„ `backend/app/core/ai/router.py`
 223 | **Components & Logic:**
 224 | 
 225 | - ðŸ“¦ **`AIRequest`**
 226 | - Æ’ **`generate_schema`**
 227 |     * We pass context to the service, which extracts the 'mode' from the SYSTEM_INSTRUCTION item
 228 | 
 229 | 
 230 | ### ðŸ“„ `backend/app/core/ai/service.py`
 231 | **Components & Logic:**
 232 | 
 233 | - ðŸ“¦ **`AIService`**
 234 |     > *The Intelligence Layer.*
 235 |   * ðŸ”¹ **`__init__`**
 236 |       * Initialize the new GenAI Client
 237 | 
 238 |   * ðŸ”¹ **`generate_schema`**
 239 |       > *Generates content based on User Intent + System Context + Operation Mode.*
 240 |       * **1.** ANALYZE CONTEXT & MODE
 241 |       * Default to WIZARD if no instruction found
 242 |       * âš¡ DETECT MODE FROM FRONTEND
 243 |       * **2.** CONSTRUCT SYSTEM PROMPT BASED ON MODE
 244 |       * --- CHAT MODE ---
 245 |       * --- WIZARD / JOB / GOVERNANCE MODES ---
 246 |       * **3.** EXECUTE GENERATION
 247 |       * **4.** PARSE OUTPUT
 248 |       * For chat, we return a structured wrapper so the frontend still receives a List[Dict]
 249 |       * For Wizard/Job, we enforce JSON
 250 |       * Heuristic fallback if wrapped in markdown
 251 |       * Attempt to fix single object return
 252 |       * Fallback logic for partial JSON
 253 | 
 254 | 
 255 | ---
 256 | ### ðŸ“„ `backend/app/core/config.py`
 257 | **Components & Logic:**
 258 | 
 259 | - ðŸ“¦ **`Settings`**
 260 | 
 261 | ### ðŸ“„ `backend/app/core/context.py`
 262 | **Components & Logic:**
 263 | 
 264 | - ðŸ“¦ **`GlobalContext`**
 265 |     > *Static Accessor for the Runtime Context.*
 266 |   * ðŸ”¹ **`get_request_id`**
 267 |       > *Returns the unique trace ID for the current operation.*
 268 |   * ðŸ”¹ **`set_request_id`**
 269 |       > *Sets the trace ID. usually called by Middleware.*
 270 |   * ðŸ”¹ **`get_current_user`**
 271 |       > *Returns the currently authenticated user as a dictionary.*
 272 |   * ðŸ”¹ **`set_current_user`**
 273 |       > *Hydrates the user context.*
 274 |   * ðŸ”¹ **`get_actor_id`**
 275 |       > *Helper to safely get the User ID (0 for System).*
 276 |   * ðŸ”¹ **`is_system_user`**
 277 |       > *True if running as background worker or system process.*
 278 |   * ðŸ”¹ **`set_admin_mode`**
 279 |       > *Allows bypassing certain policies (Emergency Override).*
 280 |   * ðŸ”¹ **`is_admin_mode`**
 281 | 
 282 | ---
 283 | ### ðŸ“„ `backend/app/core/database/base.py`
 284 | **Components & Logic:**
 285 | 
 286 | - ðŸ“¦ **`Base`**
 287 |     > *The shared registry for all database models.*
 288 | 
 289 | ### ðŸ“„ `backend/app/core/database/session.py`
 290 | **Components & Logic:**
 291 | 
 292 | - Æ’ **`get_db`**
 293 | 
 294 | ---
 295 | ### ðŸ“„ `backend/app/core/kernel/actions.py`
 296 | **Components & Logic:**
 297 | 
 298 | - ðŸ“¦ **`ActionType`**
 299 |     > *The available effects a Rule can trigger.*
 300 | - ðŸ“¦ **`LogicResult`**
 301 |     > *The 'Report Card' returned by the Logic Engine after checking all rules.*
 302 |   * ðŸ”¹ **`merge`**
 303 |       > *Helper to combine results from multiple rule checks.*
 304 | 
 305 | ---
 306 | ### ðŸ“„ `backend/app/core/kernel/context/base.py`
 307 | **Components & Logic:**
 308 | 
 309 | - ðŸ“¦ **`ContextField`**
 310 | - ðŸ“¦ **`ContextProvider`**
 311 |     > *The Plugin Interface for Environmental Context.*
 312 |   * ðŸ”¹ **`namespace`**
 313 |       > *The root key for this context (e.g. 'system', 'actor').*
 314 |   * ðŸ”¹ **`provide_schema`**
 315 |       > *INTROSPECTION: Returns the list of available variables.*
 316 |   * ðŸ”¹ **`provide_runtime`**
 317 |       > *EXECUTION: Returns the actual values at runtime.*
 318 | 
 319 | ### ðŸ“„ `backend/app/core/kernel/context/config.py`
 320 | **Components & Logic:**
 321 | 
 322 | - ðŸ“¦ **`ConfigProvider`**
 323 |     > *The Bridge between the System Config Database and the Policy Engine.*
 324 |   * ðŸ”¹ **`namespace`**
 325 |   * ðŸ”¹ **`provide_schema`**
 326 |       > *INTROSPECTION: Allows the Frontend Rule Builder to see available Config Keys.*
 327 |   * ðŸ”¹ **`provide_runtime`**
 328 |       > *EXECUTION: Returns the actual Key-Value pairs for the Logic Engine.*
 329 |       * **1.** Check Cache
 330 |       * **2.** Cache Miss -> Fetch from DB
 331 | 
 332 |   * ðŸ”¹ **`_is_cache_valid`**
 333 |       > *Checks if the RAM cache is fresh.*
 334 |   * ðŸ”¹ **`_refresh_cache`**
 335 |       > *Reloads the configuration from the database.*
 336 |       * âš¡ FETCH ALL ACTIVE CONFIGS
 337 |       * key is UPPERCASE by convention in SystemConfig
 338 |       * Update State
 339 | 
 340 |   * ðŸ”¹ **`invalidate`**
 341 |       > *EXTERNAL SIGNAL: Called by SystemOutbox Consumer or API to force a refresh.*
 342 | 
 343 | ### ðŸ“„ `backend/app/core/kernel/context/defaults.py`
 344 | **Components & Logic:**
 345 | 
 346 | - ðŸ“¦ **`SystemProvider`**
 347 |     > *Provides the Space-Time Continuum (Time, Env, Version).*
 348 |   * ðŸ”¹ **`namespace`**
 349 |   * ðŸ”¹ **`provide_schema`**
 350 |   * ðŸ”¹ **`provide_runtime`**
 351 | - ðŸ“¦ **`ActorProvider`**
 352 |     > *Provides the Agent of Change (User, Role).*
 353 |   * ðŸ”¹ **`namespace`**
 354 |   * ðŸ”¹ **`provide_schema`**
 355 |   * ðŸ”¹ **`provide_runtime`**
 356 |       * Fallback for Background Workers / Seeds
 357 | 
 358 | 
 359 | ### ðŸ“„ `backend/app/core/kernel/context/manager.py`
 360 | **Components & Logic:**
 361 | 
 362 | - ðŸ“¦ **`ContextManager`**
 363 |     > *Singleton Orchestrator.*
 364 |   * ðŸ”¹ **`__init__`**
 365 |   * ðŸ”¹ **`register`**
 366 |       > *Plugins call this to hook into the Kernel.*
 367 |   * ðŸ”¹ **`get_schema`**
 368 |       > *Used by API to serve capabilities to Frontend.*
 369 |   * ðŸ”¹ **`resolve`**
 370 |       > *Used by LogicInterceptor to build the Envelope.*
 371 |       * In strict fractal design, failures in context should not crash the transaction.
 372 |       * We log and return empty for that namespace.
 373 | 
 374 | 
 375 | ---
 376 | ### ðŸ“„ `backend/app/core/kernel/decorators.py`
 377 | **Components & Logic:**
 378 | 
 379 | - Æ’ **`kernel_register`**
 380 |     > *Decorator to register a SQLAlchemy Model as a Kernel Business Domain.*
 381 |     * **1.** Prepare Scopes (Level 6 Compliance Patch)
 382 |     * âš¡ SMART DEFAULTING
 383 |     * We interpret the legacy string list into typed configurations
 384 |     * Master Lifecycle Scope
 385 |     * Default to Generic Action
 386 |     * **2.** Define Auto-Reflection Schema Provider
 387 |     * A. Scan Columns (Primitives)
 388 |     * Map SQL Types to Meta-Kernel Types
 389 |     * Defaults
 390 |     * Special Case: 'email'
 391 |     * âš¡ INTELLIGENT SYSTEM DETECTION
 392 |     * A field is 'system' (read-only) if it's managed by the kernel
 393 |     * âš¡ CORRECTED FLAGS
 394 |     * B. âš¡ NEW: Scan Relationships (Associations)
 395 |     * Determine type: List (One-to-Many) or Single (Many-to-One)
 396 |     * Target table name
 397 |     * We map these as special types
 398 |     * Usually we don't edit relationships directly here
 399 |     * **3.** Define Default Context Loader
 400 |     * **4.** Construct the Contract
 401 |     * âš¡ META-TYPE INJECTION (The Fix)
 402 |     * This passes the user's intent (e.g. DomainType.CONFIG) to the Registry.
 403 |     * **5.** Execute Registration
 404 | 
 405 | 
 406 | ### ðŸ“„ `backend/app/core/kernel/enforcer.py`
 407 | **Components & Logic:**
 408 | 
 409 | - ðŸ“¦ **`DomainEnforcer`**
 410 |     > *The Enforcer Layer.*
 411 |   * ðŸ”¹ **`_extract_targets`**
 412 |       > *Parses the URL to find the target Domain AND Scope.*
 413 |       * Expected formats:
 414 |       * **1.** /api/v1/resource/DOMAIN/... (Domain only)
 415 |       * **2.** /api/v1/meta/states/DOMAIN/SCOPE (Domain + Scope)
 416 |       * **3.** /api/v1/workflow/DOMAIN/SCOPE/... (Domain + Scope)
 417 |       * Handle Meta States: /api/v1/meta/states/{DOMAIN}/{SCOPE}
 418 |       * Handle Workflows: /api/v1/workflow/{DOMAIN}/{SCOPE}/...
 419 |       * Handle Resource: /api/v1/resource/{DOMAIN}/... (Domain only usually)
 420 |       * Resource IDs are not scopes, so scope_key remains None
 421 | 
 422 |   * ðŸ”¹ **`is_api_allowed`**
 423 |       > *Validates if the target domain AND scope are open via the Circuit Breaker.*
 424 |       * **1.** System bypass (Always allow SYS/AUTH to prevent lockouts)
 425 |       * **2.** Level 1 Check: Domain Circuit
 426 |       * **3.** Level 2 Check: Scope Circuit (if a scope was identified)
 427 |       * Check specific scope switch
 428 |       * Special Case: UI requests to API might fail here if we don't distinguish planes.
 429 |       * But Enforcer is an API Guard, so we check API plane.
 430 |       * Note: Ideally, the Frontend UI plane should have hidden the link,
 431 |       * but this acts as the hard gate.
 432 | 
 433 | 
 434 | ### ðŸ“„ `backend/app/core/kernel/events.py`
 435 | **Components & Logic:**
 436 | 
 437 | - ðŸ“¦ **`EventError`**
 438 |     > *Base exception for Event definition errors.*
 439 | - ðŸ“¦ **`SystemEvent`**
 440 |     > *The Source of Truth for a System Event.*
 441 |   * ðŸ”¹ **`__post_init__`**
 442 |       > *Validates the Contract immediately upon instantiation.*
 443 |   * ðŸ”¹ **`_validate_naming_convention`**
 444 |       > *Enforces Strict Naming: DOMAIN:VERB (UPPERCASE)*
 445 |   * ðŸ”¹ **`_validate_version_format`**
 446 |       > *âš¡ Enforces SemVer Format (X.Y.Z)*
 447 |       * Supports 1.0.0, 1.0.0-alpha, etc.
 448 |       * Legacy support: If passed as int, convert (but warn) - No, strict fail is better for Level 9.
 449 |       * Auto-convert int to SemVer (1 -> 1.0.0) if legacy code exists?
 450 |       * No, Architect demands strictness.
 451 |       * But for transition, we might allow it momentarily if needed.
 452 |       * Let's enforce string.
 453 | 
 454 |   * ðŸ”¹ **`_validate_schema_structure`**
 455 |       > *Ensures payload_schema is a dictionary (JSON compatible).*
 456 | - ðŸ“¦ **`Schemas`**
 457 | 
 458 | ### ðŸ“„ `backend/app/core/kernel/interceptor.py`
 459 | **Components & Logic:**
 460 | 
 461 | - ðŸ“¦ **`LogicInterceptor`**
 462 |     > *The Universal Gateway.*
 463 |   * ðŸ”¹ **`register`**
 464 |   * ðŸ”¹ **`before_flush`**
 465 |       * âš¡ NOISE FILTER: Skip Outbox to prevent infinite loops
 466 | 
 467 |   * ðŸ”¹ **`_process_object`**
 468 |       * **1.** âš¡ DYNAMIC DOMAIN RESOLUTION (No more hardcoded dicts)
 469 |       * We assume the domain matches the class name, unless overridden by the model itself.
 470 |       * Fallback for internal Kernel structures (Optional but safe)
 471 |       * **2.** âš¡ PRE-FLIGHT: Freeze & Calculate Changes
 472 |       * Construct default envelope
 473 |       * **3.** ðŸ§  THE BRAIN: GOVERNANCE ENGINE (Decoupled Sidecar)
 474 |       * Apply mutations if permitted
 475 |       * âš¡ FAIL-OPEN RESILIENCE: If Brain crashes, allow the body to survive.
 476 |       * **4.** ðŸƒ THE BODY: WORKFLOW ENGINE (Decoupled)
 477 |       * Need an ephemeral async session just to fetch state defs for the workflow engine
 478 |       * **5.** ðŸ¤ THE HANDSHAKE: Governance checks Workflow's Transition Request
 479 |       * Schedule side-effects (Actions)
 480 |       * **6.** âš¡ CHANGE DATA CAPTURE (CDC)
 481 | 
 482 |   * ðŸ”¹ **`_schedule_workflow_effect`**
 483 |   * ðŸ”¹ **`_json_friendly`**
 484 |   * ðŸ”¹ **`_freeze_entity`**
 485 |   * ðŸ”¹ **`_serialize_entity`**
 486 |   * ðŸ”¹ **`_apply_mutations`**
 487 |   * ðŸ”¹ **`_buffer_side_effects`**
 488 |   * ðŸ”¹ **`_calculate_changeset`**
 489 | 
 490 | ### ðŸ“„ `backend/app/core/kernel/kernel.py`
 491 | **Components & Logic:**
 492 | 
 493 | - ðŸ“¦ **`Kernel`**
 494 |     > *The Event Publisher.*
 495 |   * ðŸ”¹ **`__init__`**
 496 |       * Stateless singleton pattern
 497 | 
 498 |   * ðŸ”¹ **`publish`**
 499 |       > *Ingests an event into the System Outbox.*
 500 |       * **1.** RESOLVE METADATA
 501 |       * **2.** RESOLVE CONTEXT
 502 |       * We grab the Trace ID from the request context to link API logs with Kafka logs
 503 |       * **3.** RESOLVE PARTITION KEY (Critical for Kafka)
 504 |       * If not provided, we try to use entity_id. If that's missing, we fallback to "global".
 505 |       * **WARNING:** "global" puts everything on one partition (ordering guaranteed but low throughput).
 506 |       * **4.** ENVELOPE CONSTRUCTION
 507 |       * **5.** WRITE TO OUTBOX
 508 |       * In Level 100, we DO raise. If the event cannot be logged, the transaction is unsafe.
 509 | 
 510 |   * ðŸ”¹ **`commit`**
 511 |       > *Finalizes the transaction.*
 512 | 
 513 | ### ðŸ“„ `backend/app/core/kernel/logic_engine.py`
 514 | **Components & Logic:**
 515 | 
 516 | - ðŸ“¦ **`LogicEngine`**
 517 |     > *[DEPRECATED] v1 Logic Engine.*
 518 |   * ðŸ”¹ **`__init__`**
 519 |   * ðŸ”¹ **`evaluate`**
 520 |       * Simple passthrough logic for legacy RuleDefinitions
 521 |       * (Preserved from original implementation to prevent crashing legacy tests)
 522 |       * **1.** Build Context
 523 | 
 524 | 
 525 | ### ðŸ“„ `backend/app/core/kernel/models.py`
 526 | **Components & Logic:**
 527 | 
 528 | - ðŸ“¦ **`SystemOutbox`**
 529 |     > *TRANSACTIONAL OUTBOX (The Kafka Waiting Room).*
 530 |   * ðŸ”¹ **`to_dict`**
 531 |       > *Serialization helper for the Relay.*
 532 | 
 533 | ---
 534 | ### ðŸ“„ `backend/app/core/kernel/payload/factory.py`
 535 | **Components & Logic:**
 536 | 
 537 | - ðŸ“¦ **`ChangeContext`**
 538 |     > *A Context Manager that watches an Entity and the Database Session*
 539 |   * ðŸ”¹ **`__init__`**
 540 |       * State Storage
 541 |       * Capture trace if available from request
 542 | 
 543 |   * ðŸ”¹ **`set_entity`**
 544 |       > *Allows setting the entity late (e.g., if it was just created inside the block).*
 545 |   * ðŸ”¹ **`add_extended_data`**
 546 |       > *Injects ad-hoc data into the 'extended_data' block of the payload.*
 547 |   * ðŸ”¹ **`_serialize_value`**
 548 |       > *Helper to safely serialize DB values.*
 549 |   * ðŸ”¹ **`_snapshot`**
 550 |       > *Serializes a SQLAlchemy model into a clean dictionary using Inspection.*
 551 |       * Map columns
 552 | 
 553 |   * ðŸ”¹ **`_enrich`**
 554 |       > *Delegates to the PayloadManager to find domain-specific enrichment logic.*
 555 |   * ðŸ”¹ **`_calculate_changes`**
 556 |       > *Generates the Delta (Old vs New).*
 557 |       * Simple equality check
 558 | 
 559 |   * ðŸ”¹ **`_detect_impact`**
 560 |       > *Scans the generic DB session to find ALL tables touched in this transaction.*
 561 |       * Check New, Dirty, and Deleted objects in the session
 562 | 
 563 |   * ðŸ”¹ **`__enter__`**
 564 |       * Capture "Before" State
 565 | 
 566 |   * ðŸ”¹ **`__exit__`**
 567 |       * If code crashed (Exception raised), don't build payload.
 568 |       * Let the exception propagate.
 569 |       * Capture "After" State
 570 |       * If entity was set late (creation), snapshot it now
 571 |       * **1.** Logic Calculation
 572 |       * **2.** Federated Enrichment
 573 |       * Merge manual extended data with domain strategy data
 574 |       * **3.** Build Context (Actor)
 575 |       * **4.** CONSTRUCT THE ENTERPRISE PAYLOAD
 576 | 
 577 | 
 578 | ### ðŸ“„ `backend/app/core/kernel/payload/manager.py`
 579 | **Components & Logic:**
 580 | 
 581 | - ðŸ“¦ **`PayloadManager`**
 582 |     > *Central Registry for Event Payload Strategies.*
 583 |   * ðŸ”¹ **`__init__`**
 584 |       * Maps Model Class -> Strategy Function
 585 | 
 586 |   * ðŸ”¹ **`register`**
 587 |       > *Registers a strategy function for a specific SQLAlchemy model.*
 588 |   * ðŸ”¹ **`get_strategy`**
 589 |       > *Retrieves the strategy function for a given model instance.*
 590 | 
 591 | ---
 592 | ### ðŸ“„ `backend/app/core/kernel/registry/base.py`
 593 | **Components & Logic:**
 594 | 
 595 | - ðŸ“¦ **`DomainType`**
 596 |     > *Defines the visibility and lifecycle of a Domain.*
 597 | - ðŸ“¦ **`DomainContext`**
 598 |     > *The Dynamic Contract.*
 599 |   * ðŸ”¹ **`__init__`**
 600 |       * **âš¡ RESTORED:** Meta-Type Classification
 601 |       * âš¡ v3 UPGRADE: Multi-Entity Support
 602 |       * New: {"PREFS": PrefModel, "LOG": LogModel}
 603 |       * Metadata
 604 |       * **âš¡ OPTIONAL:** Schema Discriminator for Polymorphic Domains
 605 |       * âš¡ ENTITY REGISTRY LOGIC (The Shim)
 606 |       * Auto-register root if not in entities (Backward Compatibility)
 607 | 
 608 |   * ðŸ”¹ **`validate`**
 609 |       > *Strict Validation of the Contract.*
 610 |       * Check Entities if present
 611 | 
 612 | - ðŸ“¦ **`ScopeConfig`**
 613 |     > *Helper for defining Scopes (Workflows).*
 614 | 
 615 | ### ðŸ“„ `backend/app/core/kernel/registry/event_registry.py`
 616 | **Components & Logic:**
 617 | 
 618 | - ðŸ“¦ **`Signals`**
 619 |     > *Static container for all System Events.*
 620 | 
 621 | ### ðŸ“„ `backend/app/core/kernel/registry/manager.py`
 622 | **Components & Logic:**
 623 | 
 624 | - ðŸ“¦ **`RegistryManager`**
 625 |   * ðŸ”¹ **`__new__`**
 626 |   * ðŸ”¹ **`register`**
 627 |       > *Code-First Registration (during boot).*
 628 |       * Validate v3 Contract
 629 | 
 630 |   * ðŸ”¹ **`get_domain`**
 631 |       > *Direct access to the Domain Context by key (UPPERCASE).*
 632 |   * ðŸ”¹ **`get_schema`**
 633 |       > *Retrieves the Static Schema for a Domain.*
 634 |       * âš¡ EXECUTE CONTRACT
 635 |       * We pass the discriminator (default "DEFAULT") to allow polymorphic schemas
 636 | 
 637 |   * ðŸ”¹ **`refresh_from_db`**
 638 |       > *Syncs the In-Memory Registry with the Database State.*
 639 |       * Fetch only active keys from the DB to determine current state
 640 |       * If key is in active_keys, it's active. Otherwise, it's disabled.
 641 |       * Fail Open: Don't disable everything if DB fails
 642 | 
 643 |   * ðŸ”¹ **`get_all_summaries`**
 644 |       > *Returns full domain state including Dynamic Type Metadata.*
 645 |       * âš¡ Eager load the 'type_def' and 'scopes' relationships
 646 |       * Pydantic 'from_attributes=True' handles the mapping automatically
 647 |       * (e.g. type_key -> type)
 648 | 
 649 |   * ðŸ”¹ **`sync_to_db`**
 650 |       > *Ensures the Database matches the Code.*
 651 |       * --- 1. SYNC DOMAIN ---
 652 |       * **âš¡ FIX:** Handle Enum or String for domain_type
 653 |       * --- 2. SYNC ENTITIES (v3) ---
 654 |       * Construct full python path if possible
 655 |       * --- 3. SYNC SCOPES ---
 656 |       * Handle Tuple Routing (Legacy/v2 shim) or Dict (v3)
 657 |       * ("DOMAIN", {config})
 658 |       * If routing matches current domain, use it.
 659 |       * v3 Validation: Check Target Entity
 660 | 
 661 | 
 662 | ### ðŸ“„ `backend/app/core/kernel/registry/schemas.py`
 663 | **Components & Logic:**
 664 | 
 665 | - ðŸ“¦ **`DomainTypeRead`**
 666 |     > *Metadata about the Domain Classification.*
 667 | - ðŸ“¦ **`ScopeSummary`**
 668 | - ðŸ“¦ **`DomainSummary`**
 669 |     > *The High-Level Manifest of a System Module.*
 670 | 
 671 | ---
 672 | ### ðŸ“„ `backend/app/core/kernel/relay.py`
 673 | **Components & Logic:**
 674 | 
 675 | - ðŸ“¦ **`KafkaRelay`**
 676 |   * ðŸ”¹ **`__init__`**
 677 |   * ðŸ”¹ **`connect_kafka`**
 678 |   * ðŸ”¹ **`start`**
 679 |   * ðŸ”¹ **`process_batch`**
 680 |       * Poll Pending
 681 | 
 682 | 
 683 | ### ðŸ“„ `backend/app/core/kernel/system.py`
 684 | **Components & Logic:**
 685 | 
 686 | - ðŸ“¦ **`SystemManifest`**
 687 |     > *The Single Source of Truth for the System's capabilities.*
 688 |   * ðŸ”¹ **`generate`**
 689 |       > *Generates the full system manifest including modules, routes, circuit states, AND navigation.*
 690 |       * Ensure RAM cache is up to date with DB
 691 |       * **1.** Fetch Domains
 692 |       * **2.** Apply Circuit Breaker Logic (Hypervisor)
 693 |       * **1.** Determine Kernel State (Physical)
 694 |       * **2.** Determine UI Plane State (Hypervisor)
 695 |       * **3.** Merge Logic
 696 |       * **4.** Inject State into Config for Frontend Awareness
 697 |       * âš¡ HIERARCHY INJECTION
 698 |       * **5.** âš¡ GENERATE SECURED NAVIGATION
 699 |       * We pass the actor context (e.g. {"role": "admin"}) to the NavigationService.
 700 |       * It will evaluate any 'required_policy' hooks on the menu nodes.
 701 |       * If no actor is provided, we pass an empty context (Guest Mode).
 702 | 
 703 |   * ðŸ”¹ **`get_capabilities`**
 704 |       > *Returns the Meta-Kernel capabilities (Widgets, Actions, Context).*
 705 |       * âš¡ LAZY ACTIVATION: Context Defaults
 706 |       * **âš¡ OPTIMIZATION:** We do NOT load dynamic widgets here anymore.
 707 |       * âš¡ DYNAMIC CONTEXT SCHEMA
 708 | 
 709 |   * ðŸ”¹ **`_scan_enum`**
 710 |   * ðŸ”¹ **`_build_action_capabilities`**
 711 |       > *âš¡ NEW: Constructs a Frontend-Ready grouped list of Action Capabilities.*
 712 | 
 713 | ### ðŸ“„ `backend/app/core/kernel/worker.py`
 714 | **Components & Logic:**
 715 | 
 716 | - ðŸ“¦ **`BackgroundWorker`**
 717 |   * ðŸ”¹ **`__init__`**
 718 |   * ðŸ”¹ **`start`**
 719 |       * Don't crash the loop, just pause
 720 | 
 721 |   * ðŸ”¹ **`process_batch`**
 722 |       * **1.** FETCH PENDING (Limit 10 to prevent clogging)
 723 | 
 724 |   * ðŸ”¹ **`handle_event`**
 725 |       > *The Switchboard. Routes events to their specific handlers.*
 726 |       * âš¡ ROUTING LOGIC
 727 |       * --- HANDLER: WORKFLOW TRANSITIONS ---
 728 |       * --- HANDLER: AUDIT ---
 729 |       * --- MARK SUCCESS ---
 730 |       * --- MARK FAILURE ---
 731 | 
 732 |   * ðŸ”¹ **`_handle_workflow_action`**
 733 |       > *Executes business logic triggered by State Changes.*
 734 |       * In a real app, this calls SendGrid/SES
 735 | 
 736 | 
 737 | ---
 738 | ### ðŸ“„ `backend/app/core/loader.py`
 739 | **Components & Logic:**
 740 | 
 741 | - Æ’ **`load_domains`**
 742 |     > *1. Scans 'app/domains/' for sub-packages.*
 743 |     * Path to the domains directory
 744 |     * Iterate over all folders in app/domains
 745 |     * pkgutil.iter_modules returns (module_loader, name, ispkg)
 746 |     * Dynamically import the module (e.g., app.domains.auth)
 747 |     * Check for the 'router' attribute (The Plug)
 748 |     * âš¡ CRITICAL FIX: Auto-Namespace the Route
 749 |     * **OLD:** prefix="/api/v1"
 750 |     * **NEW:** prefix="/api/v1/auth"
 751 |     * Register the Router
 752 | 
 753 | 
 754 | ---
 755 | ### ðŸ“„ `backend/app/core/meta/api.py`
 756 | 
 757 | ### ðŸ“„ `backend/app/core/meta/constants.py`
 758 | **Components & Logic:**
 759 | 
 760 | - ðŸ“¦ **`BindingType`**
 761 |     > *The Jurisdiction Class. Defines WHAT we are binding to.*
 762 | - ðŸ“¦ **`AttributeType`**
 763 |     > *The Data Type. Defines how the value is stored and validated.*
 764 | - ðŸ“¦ **`WidgetType`**
 765 |     > *The Interface Hint. Defines how the field is rendered.*
 766 | - ðŸ“¦ **`RuleEventType`**
 767 |     > *The Trigger.*
 768 | - ðŸ“¦ **`RuleActionType`**
 769 |     > *The Consequence.*
 770 | - ðŸ“¦ **`PolicyResolutionStrategy`**
 771 |     > *The Governance Logic.*
 772 | - ðŸ“¦ **`ViewEngineType`**
 773 |     > *The Renderer.*
 774 | - ðŸ“¦ **`ScopeType`**
 775 |     > *The Context Hierarchy. Defines the 'Type' of a KernelScope.*
 776 | 
 777 | ### ðŸ“„ `backend/app/core/meta/engine.py`
 778 | **Components & Logic:**
 779 | 
 780 | - ðŸ“¦ **`PolicyEngine`**
 781 |     > *The Universal Logic Executor.*
 782 |   * ðŸ”¹ **`evaluate`**
 783 |       > *The Main Entry Point.*
 784 |       * **1.** Prepare Data Context (Sandbox Envelope)
 785 |       * We wrap the data to allow 'context.meta' or 'context.actor' access if needed later.
 786 |       * Strategy: Pass object directly. Rules should be written as `host.weight > 10`.
 787 |       * **2.** Iterate Policies
 788 |       * **3.** Merge Results based on Governance Strategy
 789 |       * **4.** Apply Resolution Strategy ( The Judge )
 790 | 
 791 |   * ðŸ”¹ **`_evaluate_single_policy`**
 792 |       > *Executes one Policy Bundle (which may contain multiple Rules).*
 793 |       * Policies store rules as a JSONB list: [{ "logic": "...", "action": "BLOCK", ... }]
 794 |       * A. Execute JMESPath
 795 |       * Boolean expressions: `host.age > 18` returns True/False.
 796 |       * B. Handle Match (Triggered)
 797 |       * âš¡ RESOLVE DYNAMIC VALUES
 798 |       * If action involves data, we must check if the value is a reference (e.g. actor.id)
 799 |       * **SAFEGUARD:** Bad rule syntax should not crash the system.
 800 |       * âš¡ FAIL OPEN: Treat crash as WARNING, not BLOCK.
 801 | 
 802 |   * ðŸ”¹ **`_resolve_value`**
 803 |       > *Detects if a value is a reference (e.g. 'actor.id') and resolves it against the context.*
 804 |       * Heuristic: If it looks like a known context path, try to resolve it.
 805 |       * This matches the 'Value Source' logic in the Frontend Policy Editor.
 806 |       * If resolution works, return it. If it returns None, it might mean the field is missing,
 807 |       * but we return None rather than the string literal "actor.id".
 808 |       * If JMESPath crashes, fallback to the string literal
 809 | 
 810 |   * ðŸ”¹ **`_apply_strategy`**
 811 |       > *Decides the final outcome based on the strategy.*
 812 |       * Default: Any violation kills the transaction
 813 |       * If (Total - Violations) > 0, then Pass.
 814 | 
 815 |   * ðŸ”¹ **`_serialize`**
 816 |       > *Helper to convert SQLAlchemy objects to Dict for JMESPath.*
 817 |   * ðŸ”¹ **`_log_summary`**
 818 | 
 819 | ---
 820 | ### ðŸ“„ `backend/app/core/meta/features/groups/router.py`
 821 | **Components & Logic:**
 822 | 
 823 | - Æ’ **`create_group`**
 824 | - Æ’ **`list_groups`**
 825 | - Æ’ **`get_group`**
 826 | - Æ’ **`update_group`**
 827 | - Æ’ **`delete_group`**
 828 | 
 829 | ### ðŸ“„ `backend/app/core/meta/features/groups/service.py`
 830 | **Components & Logic:**
 831 | 
 832 | - ðŸ“¦ **`GroupService`**
 833 |     > *The Librarian. Manages collections of Policies.*
 834 |   * ðŸ”¹ **`_generate_key`**
 835 |       > *Auto-generates a system key from a human name if not provided.*
 836 |   * ðŸ”¹ **`create_group`**
 837 |       > *Creates a new Policy Group.*
 838 |       * **1.** Validate Key Uniqueness
 839 |       * **2.** Validate Policy Keys (Optional but recommended)
 840 |       * We trust the user provided valid keys, or we could verify them here.
 841 |       * **3.** Create Entity
 842 | 
 843 |   * ðŸ”¹ **`get_groups`**
 844 |       > *Lists all Policy Groups.*
 845 |   * ðŸ”¹ **`get_group_by_id`**
 846 |       > *Fetches a single group.*
 847 |   * ðŸ”¹ **`update_group`**
 848 |       > *Updates metadata or membership order.*
 849 |       * Apply Updates
 850 | 
 851 |   * ðŸ”¹ **`delete_group`**
 852 |       > *Soft Delete (Deactivate) or Hard Delete if no dependencies.*
 853 |       * **TODO:** Check if bound to any active PolicyBinding before deleting?
 854 |       * For Level 5 safety, we just Deactivate.
 855 | 
 856 | 
 857 | ---
 858 | ### ðŸ“„ `backend/app/core/meta/features/simulator/logic/interpreter.py`
 859 | **Components & Logic:**
 860 | 
 861 | - ðŸ“¦ **`XStateInterpreter`**
 862 |     > *A lightweight, fault-tolerant interpreter for XState v5 definitions.*
 863 |   * ðŸ”¹ **`__init__`**
 864 |   * ðŸ”¹ **`get_initial_state`**
 865 |       > *Returns the starting state of the machine.*
 866 |   * ðŸ”¹ **`transition`**
 867 |       > *Determines the next state based on the current state and the incoming event.*
 868 |       * **1.** Validate Current State
 869 |       * **2.** Look for Transitions ('on' block)
 870 |       * **3.** Match Event
 871 |       * XState allows 'on': { "EVENT": "TARGET" } OR 'on': { "EVENT": { "target": "TARGET" } }
 872 |       * **4.** Resolve Target
 873 |       * Short syntax: "EVENT": "TARGET"
 874 |       * Object syntax: "EVENT": { "target": "TARGET", "actions": [...] }
 875 |       * Array syntax (Guards): "EVENT": [{ "target": "T1", "guard": "cond" }]
 876 |       * For Phase 1, we just take the first unconditional match or the first one.
 877 |       * **TODO:** Implement Guard Logic evaluation here.
 878 |       * **5.** Final Validation
 879 | 
 880 | 
 881 | ---
 882 | ### ðŸ“„ `backend/app/core/meta/features/simulator/router.py`
 883 | **Components & Logic:**
 884 | 
 885 | - Æ’ **`inspect_entity`**
 886 | - Æ’ **`run_simulation`**
 887 |     * Client Error (Invalid ID, Domain, etc.)
 888 |     * Server Error
 889 | 
 890 | 
 891 | ### ðŸ“„ `backend/app/core/meta/features/simulator/schemas.py`
 892 | **Components & Logic:**
 893 | 
 894 | - ðŸ“¦ **`SimulationRequest`**
 895 |     > *The Input Vector.*
 896 | - ðŸ“¦ **`SimulationResult`**
 897 |     > *The Output Report.*
 898 | 
 899 | ### ðŸ“„ `backend/app/core/meta/features/simulator/service.py`
 900 | **Components & Logic:**
 901 | 
 902 | - ðŸ“¦ **`RuntimeService`**
 903 |   * ðŸ”¹ **`inspect_entity`**
 904 |       > *FORENSIC PROBE: Fetches the exact database state of an entity.*
 905 |       * **1.** Resolve Domain Model
 906 |       * **2.** Fetch Row
 907 |       * **3.** Serialize & Flatten (The Fix)
 908 |       * A. Static Columns
 909 |       * Handle Datetime serialization
 910 |       * B. Dynamic Attributes (Flattening)
 911 |       * This pulls 'test' out of 'custom_attributes' and puts it at the root.
 912 | 
 913 |   * ðŸ”¹ **`simulate_transaction`**
 914 |       > *Executes a business event in a safe Sandbox Transaction.*
 915 |       * **1.** Resolve Domain Model
 916 |       * **2.** Load Entity
 917 |       * Capture Pre-State
 918 |       * **3.** Load State Machine
 919 |       * **4.** Calculate Transition
 920 |       * **5.** Apply Changes
 921 |       * A. Apply Payload updates
 922 |       * B. Apply State Transition
 923 |       * **6.** Trigger Interceptor
 924 |       * **7.** Inspect Side Effects
 925 |       * **8.** THE ROLLBACK
 926 | 
 927 | 
 928 | ---
 929 | ### ðŸ“„ `backend/app/core/meta/features/states/logic/enforcer.py`
 930 | **Components & Logic:**
 931 | 
 932 | - ðŸ“¦ **`StateEnforcer`**
 933 |   * ðŸ”¹ **`fetch_definitions`**
 934 |       > *âš¡ SIDECAR IO: Fetches active state machines for a domain.*
 935 |   * ðŸ”¹ **`enforce_logic`**
 936 |       > *CPU LOGIC: Evaluates transitions.*
 937 |       * âš¡ DECOUPLING POINT:
 938 |       * We no longer evaluate the guard here.
 939 |       * We attach the 'guard' and 'actions' to the object sidecar.
 940 |       * The Interceptor will see this and trigger the Governance Signal.
 941 | 
 942 | 
 943 | ### ðŸ“„ `backend/app/core/meta/features/states/logic/machine.py`
 944 | **Components & Logic:**
 945 | 
 946 | - ðŸ“¦ **`StateMachine`**
 947 |     > *A Read-Only engine that validates transitions against an XState definition.*
 948 |   * ðŸ”¹ **`__init__`**
 949 |       > *Args:*
 950 |       * Cache strict transitions for O(1) lookup
 951 | 
 952 |   * ðŸ”¹ **`_normalize_transition`**
 953 |       > *SAFEGUARD: Converts legacy string targets into object definitions.*
 954 |   * ðŸ”¹ **`_build_lookup_table`**
 955 |       > *Parses the nested XState structure into a flat lookup map.*
 956 |   * ðŸ”¹ **`get_transition_config`**
 957 |       > *Finds the configuration (Rules/Actions) for moving A -> B.*
 958 |   * ðŸ”¹ **`validate_transition_structure`**
 959 |   * ðŸ”¹ **`get_side_effects`**
 960 |       > *Retrieves 'actions' defined in the transition (Edge).*
 961 |   * ðŸ”¹ **`get_state_node`**
 962 |       > *Returns the full definition of a specific state node.*
 963 | 
 964 | ### ðŸ“„ `backend/app/core/meta/features/states/logic/validator.py`
 965 | **Components & Logic:**
 966 | 
 967 | - ðŸ“¦ **`ScopeValidator`**
 968 |     > *Enforces Level 7 Constraints dynamically.*
 969 |   * ðŸ”¹ **`validate`**
 970 |       > *Main Entry Point.*
 971 |       * **1.** Fetch Rule Definition from DB (The Source of Truth)
 972 |       * **2.** Extract JSON Schema
 973 |       * **3.** Execute Validation
 974 |       * We validate the ENTIRE definition against the schema stored in DB
 975 |       * Format the error nicely for the API response
 976 | 
 977 | 
 978 | ---
 979 | ### ðŸ“„ `backend/app/core/meta/features/states/models.py`
 980 | **Components & Logic:**
 981 | 
 982 | - ðŸ“¦ **`WorkflowType`**
 983 |     > *Defines a Category of State Machine.*
 984 |   * ðŸ”¹ **`__repr__`**
 985 | 
 986 | ### ðŸ“„ `backend/app/core/meta/features/states/router.py`
 987 | **Components & Logic:**
 988 | 
 989 | - Æ’ **`list_workflow_types`**
 990 |     > *Fetches the Dynamic Workflow Registry (V3).*
 991 | - Æ’ **`create_state_machine`**
 992 | - Æ’ **`list_state_machines`**
 993 | - Æ’ **`get_flow_definition`**
 994 | - Æ’ **`get_flow_history`**
 995 | - Æ’ **`get_flow_version`**
 996 | - Æ’ **`delete_workflow`**
 997 | 
 998 | ### ðŸ“„ `backend/app/core/meta/features/states/schemas.py`
 999 | **Components & Logic:**
1000 | 
1001 | - Æ’ **`validate_xstate_structure`**
1002 |     > *Forensic audit of the State Machine JSON.*
1003 | - ðŸ“¦ **`WorkflowTypeRead`**
1004 |     > *Exposes the 'Class' definition of a workflow (e.g. WIZARD).*
1005 | - ðŸ“¦ **`StateMachineCreate`**
1006 |   * ðŸ”¹ **`check_structure`**
1007 | - ðŸ“¦ **`StateMachineUpdate`**
1008 |   * ðŸ”¹ **`check_structure`**
1009 | - ðŸ“¦ **`StateMachineRead`**
1010 |   * ðŸ”¹ **`version`**
1011 | 
1012 | ### ðŸ“„ `backend/app/core/meta/features/states/seeds.py`
1013 | **Components & Logic:**
1014 | 
1015 | - Æ’ **`seed_workflow_types`**
1016 |     > *Idempotent seeder for Workflow Types.*
1017 | 
1018 | ### ðŸ“„ `backend/app/core/meta/features/states/service.py`
1019 | **Components & Logic:**
1020 | 
1021 | - ðŸ“¦ **`StateService`**
1022 |   * ðŸ”¹ **`get_workflow_types`**
1023 |       > *Retrieves the catalogue of available Workflow "Animals" (e.g. WIZARD, JOB).*
1024 |       * Order by key for consistent UI rendering
1025 | 
1026 |   * ðŸ”¹ **`create_machine`**
1027 |       > *Registers a State Machine (Ledger Strategy).*
1028 |       * --- 0. LEVEL 7 INTEGRITY CHECK ---
1029 |       * **âš¡ UPDATE:** Pass 'db' to allow dynamic rule lookup
1030 |       * --- 1. Determine Next Version (SemVer + Legacy) ---
1031 |       * We fetch the absolute latest version to calculate the increment
1032 |       * Patch Increment Strategy (1.0.0 -> 1.0.1)
1033 |       * Initialize at 1.0.0
1034 |       * --- 2. Archive Old Versions ---
1035 |       * --- 3. Create New Version ---
1036 |       * SemVer
1037 |       * Legacy
1038 | 
1039 |   * ðŸ”¹ **`get_machines`**
1040 |   * ðŸ”¹ **`get_machine_by_scope`**
1041 |   * ðŸ”¹ **`get_machine_history`**
1042 |   * ðŸ”¹ **`delete_machine`**
1043 |       > *Safe Deletion Protocol.*
1044 | 
1045 | ---
1046 | ### ðŸ“„ `backend/app/core/meta/features/topology/router.py`
1047 | **Components & Logic:**
1048 | 
1049 | - Æ’ **`get_domain_topology`**
1050 |     > *âš¡ TOPOLOGY GRAPH ENDPOINT*
1051 |     * The Service handles the DB stitching (Entities + Policies + Scopes)
1052 |     * âš¡ TELEMETRY PROBE: Print full stack trace to console for debugging 500s
1053 | 
1054 | 
1055 | ### ðŸ“„ `backend/app/core/meta/features/topology/schemas.py`
1056 | **Components & Logic:**
1057 | 
1058 | - ðŸ“¦ **`TopologyNodeType`**
1059 |     > *Defines the biological classification of a System Node.*
1060 | - ðŸ“¦ **`TopologyNode`**
1061 |     > *A single node in the System Hierarchy.*
1062 | 
1063 | ### ðŸ“„ `backend/app/core/meta/features/topology/service.py`
1064 | **Components & Logic:**
1065 | 
1066 | - ðŸ“¦ **`TopologyService`**
1067 |     > *The Cartographer of the Database.*
1068 |   * ðŸ”¹ **`get_domain_topology`**
1069 |       > *Generates the Concrete Children for a specific Domain.*
1070 |       * âš¡ 0A. FETCH DYNAMIC WORKFLOW TYPES (Async)
1071 |       * âš¡ 0B. FETCH DOMAIN METADATA (Async)
1072 |       * **âš¡ SAFETY:** Resolve attributes defensively
1073 |       * ---------------------------------------------------------
1074 |       * **1.** âš¡ ENTITY NODE (Data Dictionary)
1075 |       * ---------------------------------------------------------
1076 |       * ---------------------------------------------------------
1077 |       * **2.** âš¡ GOVERNANCE NODE (Policies)
1078 |       * ---------------------------------------------------------
1079 |       * ---------------------------------------------------------
1080 |       * **3.** âš¡ WORKFLOW NODES (Scopes)
1081 |       * ---------------------------------------------------------
1082 |       * âš¡ FETCH TYPE DEFINITION
1083 |       * âš¡ DEFAULT ICONS
1084 |       * ---------------------------------------------------------
1085 |       * âš¡ GROUPING LOGIC (The "Hierarchy Builder")
1086 |       * ---------------------------------------------------------
1087 |       * Initialize vars
1088 |       * CASE A: WORKFLOWS (Wizards, Jobs, Views, Governance Flows)
1089 |       * We group these under "WORKFLOWS" -> "TYPE"
1090 |       * Parent Folder
1091 |       * Child Folder (The Sub-Tree)
1092 |       * Use the Label from the Workflow Type Definition (e.g. "Interactive Wizard")
1093 |       * Fallback if type def missing
1094 |       * CASE B: FALLBACK
1095 |       * ---------------------------------------------------------
1096 |       * âš¡ HIERARCHY METADATA
1097 |       * ---------------------------------------------------------
1098 |       * **4.** âš¡ CHILD DOMAINS (Sub-Modules)
1099 |       * ---------------------------------------------------------
1100 | 
1101 | 
1102 | ---
1103 | ### ðŸ“„ `backend/app/core/meta/features/views/router.py`
1104 | **Components & Logic:**
1105 | 
1106 | - Æ’ **`create_view`**
1107 | - Æ’ **`list_views`**
1108 | - Æ’ **`update_view`**
1109 | - Æ’ **`bind_view`**
1110 | - Æ’ **`list_bindings`**
1111 |     > *Returns the routing table for UI views.*
1112 | - Æ’ **`delete_binding`**
1113 | - Æ’ **`resolve_view`**
1114 |     * In a real app, role comes from the JWT Token.
1115 |     * We allow explicit override here for testing/simulation.
1116 | 
1117 | 
1118 | ### ðŸ“„ `backend/app/core/meta/features/views/schemas.py`
1119 | **Components & Logic:**
1120 | 
1121 | - ðŸ“¦ **`ViewBase`**
1122 |   * ðŸ”¹ **`validate_key`**
1123 |   * ðŸ”¹ **`validate_schema_structure`**
1124 |       > *POLYMORPHIC VALIDATION:*
1125 |       * Logic for Form.io components
1126 | 
1127 | - ðŸ“¦ **`ViewCreate`**
1128 | - ðŸ“¦ **`ViewUpdate`**
1129 | - ðŸ“¦ **`ViewRead`**
1130 | - ðŸ“¦ **`ViewBindingBase`**
1131 | - ðŸ“¦ **`ViewBindingCreate`**
1132 | - ðŸ“¦ **`ViewBindingUpdate`**
1133 | - ðŸ“¦ **`ViewBindingRead`**
1134 | 
1135 | ### ðŸ“„ `backend/app/core/meta/features/views/service.py`
1136 | **Components & Logic:**
1137 | 
1138 | - ðŸ“¦ **`ViewService`**
1139 |     > *The Orchestrator for the UI Backbone.*
1140 |   * ðŸ”¹ **`create_view_async`**
1141 |       * Check Uniqueness (Only check against LATEST)
1142 |       * Serialize - by_alias=True ensures 'schema' key is used for DB
1143 |       * Initial Version: 1.00
1144 | 
1145 |   * ðŸ”¹ **`update_view_async`**
1146 |       > *AUTO-LIVE STRATEGY:*
1147 |       * **1.** Fetch Parent
1148 |       * **2.** Calculate Next Version
1149 |       * **3.** Prepare New Data
1150 |       * **4.** Create New Head
1151 |       * **5.** Deprecate Parent (Mark as not latest)
1152 |       * **6.** AUTO-LIVE: Promote Bindings
1153 |       * Find all bindings pointing to the OLD view and move them to the NEW view
1154 | 
1155 |   * ðŸ”¹ **`get_views`**
1156 |       * Only return LATEST versions for the list
1157 | 
1158 |   * ðŸ”¹ **`create_binding`**
1159 |       * **âš¡ FIX:** Eager load the relationship
1160 | 
1161 |   * ðŸ”¹ **`get_bindings`**
1162 |       > *Retrieves all View Bindings for a given Domain.*
1163 |   * ðŸ”¹ **`delete_binding`**
1164 |       > *SMART UNBIND:*
1165 |       * PHASE 1: DEACTIVATE
1166 |       * PHASE 2: HARD DELETE
1167 | 
1168 |   * ðŸ”¹ **`resolve_view`**
1169 |       > *Determines the BEST view for a given context using 'Weighted Specificity'.*
1170 |       * **1.** Fetch Candidates (All active bindings for this domain)
1171 |       * **2.** Score Candidates
1172 |       * Only consider bindings where the View itself is active
1173 |       * A. Role Check
1174 |       * B. State Check
1175 |       * C. Priority
1176 | 
1177 | 
1178 | ---
1179 | ### ðŸ“„ `backend/app/core/meta/features/widgets/models.py`
1180 | **Components & Logic:**
1181 | 
1182 | - ðŸ“¦ **`WidgetDefinition`**
1183 |     > *The 'App Store' entry for a UI Component.*
1184 |   * ðŸ”¹ **`version`**
1185 |   * ðŸ”¹ **`__repr__`**
1186 | 
1187 | ### ðŸ“„ `backend/app/core/meta/features/widgets/schemas.py`
1188 | **Components & Logic:**
1189 | 
1190 | - ðŸ“¦ **`WidgetCreate`**
1191 | - ðŸ“¦ **`WidgetUpdate`**
1192 | - ðŸ“¦ **`WidgetRead`**
1193 |   * ðŸ”¹ **`version`**
1194 | 
1195 | ---
1196 | ### ðŸ“„ `backend/app/core/meta/features/widgets/seeds/atoms.py`
1197 | 
1198 | ### ðŸ“„ `backend/app/core/meta/features/widgets/seeds/molecules.py`
1199 | 
1200 | ### ðŸ“„ `backend/app/core/meta/features/widgets/seeds/structures.py`
1201 | 
1202 | ---
1203 | ### ðŸ“„ `backend/app/core/meta/features/widgets/service.py`
1204 | **Components & Logic:**
1205 | 
1206 | - ðŸ“¦ **`WidgetService`**
1207 |   * ðŸ”¹ **`register_widget`**
1208 |       > *Creates a new Widget Definition (v1.0.0).*
1209 |       * Uniqueness Check (Key only)
1210 | 
1211 |   * ðŸ”¹ **`get_widgets`**
1212 |       > *Lists all LATEST widgets.*
1213 |   * ðŸ”¹ **`get_widget_by_key`**
1214 | 
1215 | ---
1216 | ### ðŸ“„ `backend/app/core/meta/models.py`
1217 | **Components & Logic:**
1218 | 
1219 | - ðŸ“¦ **`AttributeDefinition`**
1220 |   * ðŸ”¹ **`__repr__`**
1221 | - ðŸ“¦ **`PolicyDefinition`**
1222 |   * ðŸ”¹ **`version_display`**
1223 | - ðŸ“¦ **`PolicyGroup`**
1224 |     > *âš¡ ENTERPRISE FEATURE: Explicit Policy Grouping.*
1225 | - ðŸ“¦ **`PolicyBinding`**
1226 |     > *The Switchboard. Connects a Policy OR a Group to a Context.*
1227 | - ðŸ“¦ **`StateDefinition`**
1228 |   * ðŸ”¹ **`version_display`**
1229 | - ðŸ“¦ **`ViewDefinition`**
1230 | - ðŸ“¦ **`ViewBinding`**
1231 | - ðŸ“¦ **`RuleDefinition`**
1232 | 
1233 | ### ðŸ“„ `backend/app/core/meta/registry.py`
1234 | 
1235 | ### ðŸ“„ `backend/app/core/meta/schemas.py`
1236 | **Components & Logic:**
1237 | 
1238 | - ðŸ“¦ **`SelectOption`**
1239 | - ðŸ“¦ **`AttributeConfig`**
1240 | - ðŸ“¦ **`AttributeBase`**
1241 | - ðŸ“¦ **`AttributeCreate`**
1242 | - ðŸ“¦ **`AttributeUpdate`**
1243 | - ðŸ“¦ **`AttributeRead`**
1244 | - ðŸ“¦ **`PolicyRule`**
1245 | - ðŸ“¦ **`PolicyBase`**
1246 | - ðŸ“¦ **`PolicyCreate`**
1247 | - ðŸ“¦ **`PolicyUpdate`**
1248 | - ðŸ“¦ **`PolicyRead`**
1249 |   * ðŸ”¹ **`version_display`**
1250 | - ðŸ“¦ **`PolicyGroupBase`**
1251 |   * ðŸ”¹ **`validate_key`**
1252 | - ðŸ“¦ **`PolicyGroupCreate`**
1253 | - ðŸ“¦ **`PolicyGroupUpdate`**
1254 | - ðŸ“¦ **`PolicyGroupRead`**
1255 | - ðŸ“¦ **`PolicyBindingBase`**
1256 |   * ðŸ”¹ **`check_source`**
1257 | - ðŸ“¦ **`PolicyBindingCreate`**
1258 | - ðŸ“¦ **`PolicyBindingUpdate`**
1259 | - ðŸ“¦ **`PolicyBindingRead`**
1260 | - ðŸ“¦ **`RuleEffect`**
1261 | - ðŸ“¦ **`RuleCreate`**
1262 | - ðŸ“¦ **`RuleRead`**
1263 | - ðŸ“¦ **`DryRunRequest`**
1264 | - ðŸ“¦ **`DryRunResult`**
1265 | 
1266 | ### ðŸ“„ `backend/app/core/meta/service.py`
1267 | **Components & Logic:**
1268 | 
1269 | - ðŸ“¦ **`MetaService`**
1270 |   * ðŸ”¹ **`validate_rule_syntax`**
1271 |   * ðŸ”¹ **`create_policy`**
1272 |   * ðŸ”¹ **`update_policy`**
1273 |   * ðŸ”¹ **`dry_run_policy`**
1274 |   * ðŸ”¹ **`get_policy_history`**
1275 |   * ðŸ”¹ **`restore_policy`**
1276 |   * ðŸ”¹ **`get_policies`**
1277 |       > *âš¡ TAG-DRIVEN ARCHITECTURE: Filters policies by their domain tag.*
1278 |       * JSONB contains check: tags @> '["domain:XYZ"]'
1279 | 
1280 |   * ðŸ”¹ **`create_binding`**
1281 |   * ðŸ”¹ **`update_binding`**
1282 |   * ðŸ”¹ **`delete_binding`**
1283 |   * ðŸ”¹ **`get_bindings`**
1284 |   * ðŸ”¹ **`create_attribute`**
1285 |   * ðŸ”¹ **`get_attributes`**
1286 |   * ðŸ”¹ **`update_attribute`**
1287 |   * ðŸ”¹ **`delete_attribute`**
1288 |   * ðŸ”¹ **`create_rule`**
1289 |   * ðŸ”¹ **`get_rules`**
1290 |   * ðŸ”¹ **`get_fused_schema`**
1291 |       > *The Brain: Combines Immutable Code (Registry) with Flexible Data (DB).*
1292 |       * **âš¡ LOGGING:** Trace the Fusion Step
1293 |       * **1.** FETCH STATIC SCHEMA (The Bedrock)
1294 |       * **2.** FETCH DYNAMIC SCHEMA (The Overlay)
1295 |       * Use local method to avoid circular dependency issues
1296 |       * Dynamic overrides Static if key matches
1297 |       * Return empty schema instead of crashing, allowing UI to recover
1298 | 
1299 |   * ðŸ”¹ **`invalidate_cache`**
1300 | 
1301 | ---
1302 | ### ðŸ“„ `backend/app/core/schema_generator.py`
1303 | **Components & Logic:**
1304 | 
1305 | - Æ’ **`generate_schema`**
1306 |     > *Introspects SQLAlchemy models and returns a dictionary representation.*
1307 |     * We use the Class Name as the key (e.g., "User") for the Frontend to map easily.
1308 |     * Inspect the class members to find SQLAlchemy columns
1309 |     * Extract Column Metadata
1310 |     * Note: We access .property.columns[0] to get the actual Column object
1311 |     * âš¡ ARCHITECTURAL INVARIANT: Skip Dynamic Containers
1312 |     * Clean up type name (e.g., "VARCHAR(255)" -> "VARCHAR")
1313 |     * Skip relationships or non-column attributes for now
1314 | 
1315 | 
1316 | ### ðŸ“„ `backend/app/core/security.py`
1317 | **Components & Logic:**
1318 | 
1319 | - Æ’ **`verify_password`**
1320 |     > *Verifies a plain-text password against the stored hash.*
1321 | - Æ’ **`get_password_hash`**
1322 |     > *Generates a secure hash for a new password.*
1323 | - Æ’ **`create_access_token`**
1324 |     > *Mints a new JWT Access Token.*
1325 |     * Expiration
1326 |     * Token Type
1327 | 
1328 | 
1329 | ---
1330 | ### ðŸ“„ `backend/app/core/utilities/async_bridge.py`
1331 | **Components & Logic:**
1332 | 
1333 | - ðŸ“¦ **`AsyncBridge`**
1334 |     > *The Connector between the Blocking DB Layer and the Non-Blocking Logic Layer.*
1335 |   * ðŸ”¹ **`run_sync`**
1336 |       > *Executes a coroutine synchronously by spawning a fresh Event Loop in a separate thread.*
1337 |       * âš¡ 1. CAPTURE CONTEXT
1338 |       * Snapshot the current state (User, Request ID, etc.)
1339 |       * This allows the background thread to "know" who initiated the save.
1340 |       * âš¡ 2. SETUP SIDECAR LOOP
1341 |       * âš¡ 3. EXECUTE WITHIN CONTEXT
1342 |       * We wrap the execution in ctx.run() so the coroutine sees the vars.
1343 |       * Note: We must wrap the loop.run_until_complete call itself,
1344 |       * or create a wrapper task that runs in context.
1345 |       * Best practice: ctx.run(task)
1346 |       * The loop itself doesn't need the context, the coroutine does.
1347 |       * However, ctx.run() takes a callable.
1348 |       * We simply run the loop logic.
1349 |       * This ensures the async task inherits the context
1350 |       * But simpler: we just run the whole block in context if possible.
1351 |       * Actually, contextvars context applies to the *thread* execution stack.
1352 |       * So executing ctx.run(func) sets the context for 'func'.
1353 |       * âš¡ 4. SPAWN THREAD WITH CONTEXT
1354 |       * We pass 'target' to ctx.run, so 'target' runs with the variables set.
1355 |       * But we are starting a NEW thread. ctx.run() only works in the CURRENT thread.
1356 |       * To pass context to a NEW thread, we must run ctx.run INSIDE the new thread.
1357 |       * "Re-hydrate" the context inside the new thread
1358 |       * Block until the Sidecar finishes (Gatekeeper behavior)
1359 | 
1360 | 
1361 | ---
1362 | ### ðŸ“„ `backend/app/core/utils/reflection.py`
1363 | **Components & Logic:**
1364 | 
1365 | - Æ’ **`reflect_model_schema`**
1366 |     > *Introspects a SQLAlchemy Model and returns a structured Context Graph.*
1367 |     * Indentation for logging readability
1368 |     * **1.** SCALAR FIELDS
1369 |     * âš¡ ARCHITECTURAL INVARIANT: Skip Dynamic Containers
1370 |     * The bucket itself is not a field, it holds the fields.
1371 |     * --- A. Type Mapping ---
1372 |     * Map SQLAlchemy Types to UI Types
1373 |     * --- B. Metadata Extraction (The Explicit Strategy) ---
1374 |     * We look for the 'info' dict on the column definition first.
1375 |     * Fallback to Heuristics if missing.
1376 |     * Label: Override or Auto-Generate
1377 |     * System/Read-Only Status
1378 |     * **1.** Explicit Override
1379 |     * **2.** Heuristic Fallback (Safety Net)
1380 |     * Final Decision Logic
1381 |     * Special Case: 'hashed_password'
1382 |     * Should be "password" widget, but never readable.
1383 |     * --- C. Construct Field Definition ---
1384 |     * Alias for logic engine
1385 |     * Placeholder for extended config
1386 |     * Inject options if found via Enum or Info
1387 |     * **2.** RELATIONSHIPS (The Graph)
1388 |     * Only recurse if we haven't hit the limit
1389 |     * Determine Cardinality
1390 |     * Recursive Call
1391 |     * **3.** CONSTRUCT OUTPUT
1392 | 
1393 | 
1394 | ---
1395 | ### ðŸ“„ `backend/app/domains/auth/features/preferences/models.py`
1396 | **Components & Logic:**
1397 | 
1398 | - ðŸ“¦ **`UserPreferences`**
1399 |     > *The UI/UX State Sidecar.*
1400 |   * ðŸ”¹ **`__repr__`**
1401 |       > *String representation for logging.*
1402 | 
1403 | ### ðŸ“„ `backend/app/domains/auth/features/preferences/seeds.py`
1404 | **Components & Logic:**
1405 | 
1406 | - Æ’ **`seed_preferences_schema`**
1407 |     > *Idempotent seeder for User Preference Attributes.*
1408 |     * Check existence
1409 |     * ðŸ”’ LOCK IT
1410 | 
1411 | 
1412 | ### ðŸ“„ `backend/app/domains/auth/features/preferences/service.py`
1413 | **Components & Logic:**
1414 | 
1415 | - ðŸ“¦ **`PreferenceService`**
1416 |     > *The Librarian for User State.*
1417 |   * ðŸ”¹ **`get_preferences`**
1418 |       > *Fetches preferences. Auto-creates the row if missing (Lazy Init).*
1419 |       * Merge with defaults to ensure new keys appear for old users
1420 |       * Note: In a real implementation, we might want a deep merge utility here.
1421 |       * For now, we trust the stored JSON but could overlay it on DEFAULT_PREFERENCES.
1422 | 
1423 |   * ðŸ”¹ **`initialize_defaults`**
1424 |       > *Creates the Sidecar row with Factory Settings.*
1425 |       * If race condition (already created), just return existing
1426 | 
1427 |   * ðŸ”¹ **`get_default_schema`**
1428 |       > *Returns the structure of the preferences for UI generation.*
1429 | 
1430 | ### ðŸ“„ `backend/app/domains/auth/features/preferences/workflows.py`
1431 | 
1432 | ---
1433 | ### ðŸ“„ `backend/app/domains/auth/models.py`
1434 | **Components & Logic:**
1435 | 
1436 | - ðŸ“¦ **`User`**
1437 |     > *The Central Identity Entity.*
1438 |   * ðŸ”¹ **`to_dict`**
1439 | - Æ’ **`provide_schema`**
1440 | - Æ’ **`user_context_loader`**
1441 | 
1442 | ### ðŸ“„ `backend/app/domains/auth/registry.py`
1443 | 
1444 | ### ðŸ“„ `backend/app/domains/auth/schemas.py`
1445 | **Components & Logic:**
1446 | 
1447 | - ðŸ“¦ **`UserBase`**
1448 | - ðŸ“¦ **`UserCreate`**
1449 | - ðŸ“¦ **`UserLogin`**
1450 | - ðŸ“¦ **`UserRead`**
1451 | - ðŸ“¦ **`Token`**
1452 | - ðŸ“¦ **`TokenPayload`**
1453 | 
1454 | ### ðŸ“„ `backend/app/domains/auth/seeds.py`
1455 | **Components & Logic:**
1456 | 
1457 | - Æ’ **`seed_assets`**
1458 |     > *Wave 2: Core Assets*
1459 |     * --- 1. ADMIN USER ---
1460 |     * --- 2. WORKFLOW REGISTRATION (Refactored) ---
1461 |     * âš¡ CORE IDENTITY FLOWS (USER)
1462 |     * âš¡ SIDECAR FLOWS (USER_PREFS)
1463 |     * This fixes the missing "User Settings" workflow
1464 |     * --- 3. PREFERENCE SCHEMA ---
1465 |     * --- 4. âš¡ GOVERNANCE BINDING (Compliance) ---
1466 |     * The User Domain voluntarily accepts the System's Laws
1467 | 
1468 | - Æ’ **`_register_domain_workflows`**
1469 |     > *Helper to register workflows for a specific Domain Context.*
1470 |     * Handle Tuple vs Dict scopes (Legacy shim)
1471 |     * âš¡ CRITICAL FILTER: Only register State Machines (WIZARD, GOVERNANCE).
1472 |     * We EXCLUDE 'JOB' and 'VIEW' because they don't have XState definitions.
1473 | 
1474 | - Æ’ **`seed_governance`**
1475 |     > *Binds the USER domain to Global System Policies.*
1476 |     * âš¡ THE COMPLIANCE LIST
1477 |     * "We agree to follow these System Policies"
1478 |     * **1.** Find the Law
1479 |     * **2.** Check for existing Binding
1480 |     * **3.** Sign the Contract
1481 | 
1482 | 
1483 | ---
1484 | ### ðŸ“„ `backend/app/domains/auth/workflows/lifecycle.py`
1485 | 
1486 | ### ðŸ“„ `backend/app/domains/auth/workflows/signup.py`
1487 | 
1488 | ### ðŸ“„ `backend/app/domains/auth/workflows/user_admin.py`
1489 | 
1490 | ### ðŸ“„ `backend/app/domains/auth/workflows/user_create.py`
1491 | 
1492 | ### ðŸ“„ `backend/app/domains/auth/workflows/user_edit.py`
1493 | 
1494 | ---
1495 | ### ðŸ“„ `backend/app/domains/meta_v2/features/governance/enforcer.py`
1496 | **Components & Logic:**
1497 | 
1498 | - ðŸ“¦ **`GovernanceEnforcer`**
1499 |   * ðŸ”¹ **`fetch_and_evaluate`**
1500 |       > *âš¡ SIDECAR IO: Spawns an independent DB session to fetch Policies,*
1501 |       * **1.** Resolve Environment Context
1502 |       * **2.** Fetch Active Bindings
1503 |       * **3.** Evaluate (Or Pass gracefully if no rules)
1504 | 
1505 |   * ðŸ”¹ **`evaluate_guard_sync`**
1506 |       > *Evaluates a single transition guard expression synchronously.*
1507 | 
1508 | ---
1509 | ### ðŸ“„ `backend/app/domains/system/features/domain_types/models.py`
1510 | **Components & Logic:**
1511 | 
1512 | - ðŸ“¦ **`KernelDomainType`**
1513 |     > *The Meta-Definition for a Domain Category.*
1514 |   * ðŸ”¹ **`__repr__`**
1515 |       > *String representation for logging.*
1516 | 
1517 | ### ðŸ“„ `backend/app/domains/system/features/domain_types/seeds.py`
1518 | **Components & Logic:**
1519 | 
1520 | - Æ’ **`seed_domain_types`**
1521 |     > *Idempotent seeder for Kernel Domain Types.*
1522 |     * Upsert Logic: Insert or Update if exists
1523 | 
1524 | 
1525 | ---
1526 | ### ðŸ“„ `backend/app/domains/system/features/navigation/models.py`
1527 | **Components & Logic:**
1528 | 
1529 | - ðŸ“¦ **`SystemMenuNode`**
1530 |     > *The Global UI Shell Navigation Registry.*
1531 |   * ðŸ”¹ **`__repr__`**
1532 | 
1533 | ### ðŸ“„ `backend/app/domains/system/features/navigation/schemas.py`
1534 | **Components & Logic:**
1535 | 
1536 | - ðŸ“¦ **`NavigationNode`**
1537 |     > *A single item in the navigation tree.*
1538 | - ðŸ“¦ **`NavigationResponse`**
1539 |     > *The full payload injected into the System Manifest.*
1540 | 
1541 | ### ðŸ“„ `backend/app/domains/system/features/navigation/seeds.py`
1542 | **Components & Logic:**
1543 | 
1544 | - Æ’ **`seed_navigation`**
1545 |     > *Idempotent seeder for the OS Navigation Menu.*
1546 | 
1547 | ### ðŸ“„ `backend/app/domains/system/features/navigation/service.py`
1548 | **Components & Logic:**
1549 | 
1550 | - ðŸ“¦ **`NavigationService`**
1551 |     > *The Architect of the UI Shell.*
1552 |   * ðŸ”¹ **`get_secured_navigation`**
1553 |       > *Fetches all active nodes and filters them via the Policy Engine.*
1554 |       * **1.** Fetch all active nodes
1555 |       * **2.** Extract unique policy requirements to minimize DB hits
1556 |       * **3.** Assemble filtered structure
1557 |       * ðŸ›¡ï¸ SECURITY GATE
1558 |       * ðŸ“¦ SERIALIZE
1559 | 
1560 | 
1561 | ---
1562 | ### ðŸ“„ `backend/app/domains/system/logic/governance.py`
1563 | **Components & Logic:**
1564 | 
1565 | - ðŸ“¦ **`GovernanceService`**
1566 |   * ðŸ”¹ **`_serialize`**
1567 |       > *Converts SQLAlchemy models to Dictionary.*
1568 |       * Handle 'scopes' relationship manually
1569 |       * **âš¡ FIX:** Handle 'type_def' relationship manually so UI receives api_strategy
1570 | 
1571 |   * ðŸ”¹ **`list_domains`**
1572 |       > *Fetches Domains + Scopes + Circuit States.*
1573 |       * **1.** Fetch Hierarchy (Now including type_def)
1574 |       * **2.** Fetch All Circuits (Optimization: Single Query instead of N+1)
1575 |       * **3.** Create Lookup Map
1576 |       * Key: "scope:USER:SIGNUP_FLOW::UI" -> "HALTED"
1577 |       * **4.** Inject State into Scopes
1578 |       * Reconstruct Target URI
1579 |       * Lookup UI State
1580 |       * Lookup API State
1581 |       * Attach to Scope Object
1582 | 
1583 |   * ðŸ”¹ **`patch_domain`**
1584 |   * ðŸ”¹ **`list_config`**
1585 |   * ðŸ”¹ **`update_config`**
1586 | 
1587 | ### ðŸ“„ `backend/app/domains/system/logic/hypervisor.py`
1588 | **Components & Logic:**
1589 | 
1590 | - ðŸ“¦ **`SystemHypervisor`**
1591 |     > *The Central Logic for Operational State.*
1592 |   * ðŸ”¹ **`check_state`**
1593 |       > *Checks if a specific Target is allowed to operate on a specific Plane.*
1594 |       * **1.** READ CACHE (Fast Path)
1595 |       * **2.** CACHE MISS -> FETCH DB (Slow Path)
1596 |       * **3.** POPULATE CACHE
1597 |       * Default: Implicitly Nominal
1598 |       * **4.** Return Result
1599 | 
1600 |   * ðŸ”¹ **`_interpret_status`**
1601 |       > *Converts raw status string to Boolean Permission.*
1602 |   * ðŸ”¹ **`_update_local_cache`**
1603 |       > *Internal helper to set cache with timestamp.*
1604 |   * ðŸ”¹ **`set_state`**
1605 |       > *Upserts a Circuit Breaker state.*
1606 |       * **1.** ORM Lookup
1607 |       * **2.** Update or Create
1608 |       * SQLAlchemy tracks this as 'dirty'
1609 |       * **3.** Flush to trigger Interceptor
1610 |       * **4.** Cache Update
1611 | 
1612 |   * ðŸ”¹ **`ensure_circuit`**
1613 |       > *Idempotent Registration. Ensures a switch exists.*
1614 | 
1615 | ### ðŸ“„ `backend/app/domains/system/logic/seeder.py`
1616 | **Components & Logic:**
1617 | 
1618 | - ðŸ“¦ **`SystemSeeder`**
1619 |     > *Bootstrapper for the System Domain.*
1620 |   * ðŸ”¹ **`seed`**
1621 |       > *Idempotent Seeder.*
1622 |       * --- PHASE 1: System Config ---
1623 |       * --- PHASE 1.5: Meta-Kernel Assets (The Library) ---
1624 |       * âš¡ This ensures the Widget Registry is populated before any UI renders
1625 |       * --- PHASE 2: Code Registry (Domains & Scopes) ---
1626 |       * We use the RegistryManager directly to get the latest Code Definitions
1627 |       * **âš¡ FIX:** Passing 'db' to fetch Dynamic Types and awaiting the result
1628 |       * DomainSummary is a Pydantic model now
1629 |       * 2.1 Seed DOMAIN Circuits (API, UI, WORKER)
1630 |       * âš¡ CACHE UPDATE: ensure_circuit now updates the Hypervisor memory map too
1631 |       * 2.2 Seed SCOPE Circuits (Recursive)
1632 |       * All scopes get API and UI controls
1633 |       * Only JOB scopes get a Worker control
1634 |       * --- PHASE 3: Data Registry (Screens) ---
1635 |       * We fetch screens dynamically from the DB
1636 |       * Screens are UI Containers, they only have a UI Plane
1637 |       * Commit all new circuits
1638 | 
1639 | 
1640 | ### ðŸ“„ `backend/app/domains/system/logic/state.py`
1641 | **Components & Logic:**
1642 | 
1643 | - ðŸ“¦ **`SystemState`**
1644 |     > *The Central Nervous System Observer.*
1645 |   * ðŸ”¹ **`get_pulse`**
1646 |       > *Returns the unified System State.*
1647 |       * **1.** Gather Intelligence
1648 |       * **2.** Construct Identity
1649 |       * Immutable Code (v2.5.0)
1650 |       * Database Structure (Hash)
1651 |       * User Logic (SemVer)
1652 | 
1653 |   * ðŸ”¹ **`_get_schema_version`**
1654 |       > *Queries the Alembic Version Table directly.*
1655 |   * ðŸ”¹ **`_get_content_version`**
1656 |       > *Calculates the 'System Content Version'.*
1657 |       * Find the highest semantic version label in the Release Table
1658 |       * Note: String comparison is used here as a heuristic.
1659 |       * In a strict environment, we would use SemVer sorting logic.
1660 | 
1661 | 
1662 | ---
1663 | ### ðŸ“„ `backend/app/domains/system/models.py`
1664 | **Components & Logic:**
1665 | 
1666 | - ðŸ“¦ **`KernelDomain`**
1667 |     > *The Master Registry of all installed Modules.*
1668 |   * ðŸ”¹ **`__repr__`**
1669 | - ðŸ“¦ **`KernelEntity`**
1670 |     > *âš¡ NEW v3: The Physical Table Registry (Aggregate Components).*
1671 |   * ðŸ”¹ **`__repr__`**
1672 | - ðŸ“¦ **`KernelScope`**
1673 |     > *The Workflow Topology Definition.*
1674 |   * ðŸ”¹ **`__repr__`**
1675 | - ðŸ“¦ **`KernelScopeImpact`**
1676 |     > *âš¡ NEW v3: The Impact Graph (Dependency Map).*
1677 | - ðŸ“¦ **`SystemConfig`**
1678 |     > *THE CONTROL KNOBS.*
1679 |   * ðŸ”¹ **`__repr__`**
1680 |   * ðŸ”¹ **`typed_value`**
1681 |       > *Auto-converts value_raw based on value_type.*
1682 | - ðŸ“¦ **`CircuitBreaker`**
1683 |     > *The System Hypervisor's Memory.*
1684 |   * ðŸ”¹ **`__repr__`**
1685 | 
1686 | ### ðŸ“„ `backend/app/domains/system/registry.py`
1687 | 
1688 | ### ðŸ“„ `backend/app/domains/system/seeds.py`
1689 | **Components & Logic:**
1690 | 
1691 | - Æ’ **`seed_static`**
1692 |     > *Writes the Constitution, Core Bricks, and UI Shell to the Meta-Kernel.*
1693 |     * **1.** Seed Policies
1694 |     * **2.** Seed System Domain & Bricks
1695 |     * Ensure SYS Domain
1696 |     * Ensure SYS Scopes
1697 |     * **3.** âš¡ HYDRATE WORKFLOW TYPES (State Engine V3)
1698 |     * **4.** âš¡ HYDRATE NAVIGATION (Fractal UI Shell)
1699 |     * This ensures the Sidebar and Avatar Menu are populated on boot.
1700 | 
1701 | - Æ’ **`seed_assets`**
1702 | - Æ’ **`seed_history`**
1703 | 
1704 | ---
1705 | ### ðŸ“„ `backend/app/domains/workspace/models.py`
1706 | **Components & Logic:**
1707 | 
1708 | - ðŸ“¦ **`Screen`**
1709 |     > *THE CANVAS.*
1710 |   * ðŸ”¹ **`__repr__`**
1711 | - ðŸ“¦ **`ActiveApp`**
1712 |     > *THE DRAFT INSTANCE.*
1713 |   * ðŸ”¹ **`__repr__`**
1714 | - ðŸ“¦ **`Release`**
1715 |     > *THE COMMIT (Snapshot).*
1716 |   * ðŸ”¹ **`__repr__`**
1717 | - ðŸ“¦ **`ReleaseItem`**
1718 |     > *THE FROZEN ARTIFACT.*
1719 |   * ðŸ”¹ **`__repr__`**
1720 | 
1721 | ### ðŸ“„ `backend/app/domains/workspace/router.py`
1722 | **Components & Logic:**
1723 | 
1724 | - Æ’ **`create_screen`**
1725 | - Æ’ **`list_screens`**
1726 | - Æ’ **`list_bricks`**
1727 | - Æ’ **`install_app`**
1728 | - Æ’ **`configure_app`**
1729 | - Æ’ **`uninstall_app`**
1730 | - Æ’ **`publish_release`**
1731 |     > *Triggers a Snapshot of the current Draft.*
1732 | - Æ’ **`list_releases`**
1733 | - Æ’ **`resolve_layout`**
1734 |     > *Returns the layout tree.*
1735 | 
1736 | ### ðŸ“„ `backend/app/domains/workspace/schemas.py`
1737 | **Components & Logic:**
1738 | 
1739 | - ðŸ“¦ **`ScreenBase`**
1740 | - ðŸ“¦ **`ScreenCreate`**
1741 | - ðŸ“¦ **`ScreenUpdate`**
1742 | - ðŸ“¦ **`ScreenRead`**
1743 | - ðŸ“¦ **`ScreenList`**
1744 | - ðŸ“¦ **`ActiveAppBase`**
1745 | - ðŸ“¦ **`ActiveAppCreate`**
1746 | - ðŸ“¦ **`ActiveAppUpdate`**
1747 | - ðŸ“¦ **`ActiveAppRead`**
1748 | - ðŸ“¦ **`BrickList`**
1749 | - ðŸ“¦ **`ReleaseCreate`**
1750 | - ðŸ“¦ **`ReleaseRead`**
1751 | 
1752 | ### ðŸ“„ `backend/app/domains/workspace/seeds.py`
1753 | **Components & Logic:**
1754 | 
1755 | - Æ’ **`seed_assets`**
1756 |     > *Wave 2: Create Default Screens.*
1757 |     * **1.** The Admin Console (Meta Studio)
1758 |     * This matches the Frontend Route '/meta'
1759 |     * **2.** Example Business App (Logistics)
1760 | 
1761 | 
1762 | ### ðŸ“„ `backend/app/domains/workspace/service.py`
1763 | **Components & Logic:**
1764 | 
1765 | - ðŸ“¦ **`WorkspaceService`**
1766 |   * ðŸ”¹ **`create_screen`**
1767 |   * ðŸ”¹ **`list_screens`**
1768 |       * **âš¡ ENRICHMENT:** Eager load live_release to show version info in Lobby
1769 |       * **âš¡ SORTING:** Show most recently updated screens first
1770 | 
1771 |   * ðŸ”¹ **`list_available_bricks`**
1772 |       * **âš¡ FILTER:** Only UI-compatible bricks (Use Enum SSOT)
1773 |       * We explicitly exclude ScopeType.JOB as it's a backend-only construct
1774 | 
1775 |   * ðŸ”¹ **`install_app`**
1776 |       * âš¡ TOUCH PARENT: Update screen.updated_at so it moves to top of list
1777 | 
1778 |   * ðŸ”¹ **`update_app`**
1779 |       * âš¡ TOUCH PARENT
1780 | 
1781 |   * ðŸ”¹ **`uninstall_app`**
1782 |       * âš¡ TOUCH PARENT
1783 | 
1784 |   * ðŸ”¹ **`publish_release`**
1785 |       * Auto-increment internal counter
1786 |       * Snapshot Logic
1787 | 
1788 |   * ðŸ”¹ **`list_releases`**
1789 |   * ðŸ”¹ **`resolve_layout`**
1790 |       * âš¡ HISTORY LOOKUP: Fetch the absolute latest release to inform the UI
1791 |       * **MODE:** LIVE (Render from Snapshot)
1792 |       * **MODE:** DRAFT (Render from ActiveApps)
1793 | 
1794 | 
1795 | ---
1796 | ### ðŸ“„ `backend/app/main.py`
1797 | **Components & Logic:**
1798 | 
1799 | - Æ’ **`lifespan`**
1800 |     * âš¡ PHASE 1: KERNEL BOOT (Read-Only Cache Hydration)
1801 |     * âš¡ ARCHITECTURAL INVARIANT: The API Server only READS during boot.
1802 |     * Seeding is strictly delegated to the standalone `seed.py` Orchestrator.
1803 |     * We don't raise here to allow the API to start in "Safe Mode" if DB fails,
1804 |     * but in Level 100 we might want to crash. For now, we log loud.
1805 | 
1806 | - Æ’ **`create_application`**
1807 |     * âš¡ GLOBAL INTERCEPTOR (Business Logic Gates)
1808 |     * **1.** MAINTENANCE CHECK (Global)
1809 |     * **2.** âš¡ DOMAIN ENFORCEMENT (Kill Switch)
1810 |     * âš¡ INFRASTRUCTURE MIDDLEWARE (Execution Order: Bottom-Up)
1811 |     * **3.** CORS (Outermost)
1812 |     * **2.** CONTEXT HYDRATION (Injects User/TraceID)
1813 |     * **1.** ROUTER MOUNTING
1814 | 
1815 | 
1816 | ---
1817 | ### ðŸ“„ `backend/app/middleware/context.py`
1818 | **Components & Logic:**
1819 | 
1820 | - ðŸ“¦ **`ContextMiddleware`**
1821 |     > *Ensures every request has a Trace ID and populates the GlobalContext*
1822 |   * ðŸ”¹ **`dispatch`**
1823 |       * **1.** âš¡ TRACE ID (Generate or Propagate)
1824 |       * **2.** âš¡ AUTHENTICATION INSPECTION
1825 |       * We manually decode the JWT here to ensure the Context is available
1826 |       * even if the endpoint doesn't strictly require auth (e.g. for logging).
1827 |       * Decode JWT
1828 |       * Hydrate Context from Token Claims
1829 |       * Note: Ideally the token contains role/email.
1830 |       * If not, we set safe defaults that the ActorProvider can return.
1831 |       * âš¡ FAIL OPEN (For Middleware):
1832 |       * We don't block the request here. We just don't set the context.
1833 |       * The Domain Enforcer or Endpoint Dependency will handle 401s.
1834 |       * **3.** âš¡ SET GLOBAL CONTEXT
1835 |       * **4.** âš¡ EXECUTE REQUEST
1836 |       * **5.** âš¡ INJECT TRACE ID INTO RESPONSE HEADER
1837 | 
1838 | 
1839 | ---
1840 | ### ðŸ“„ `backend/audit_hardcoding.py`
1841 | **Components & Logic:**
1842 | 
1843 | - ðŸ“¦ **`HardCodingVisitor`**
1844 |   * ðŸ”¹ **`__init__`**
1845 |   * ðŸ”¹ **`visit_Assign`**
1846 |       > *Checks variable assignments (e.g., x = '12345').*
1847 |       * If assigning to UPPER_CASE, it's a Constant (Acceptable).
1848 | 
1849 |   * ðŸ”¹ **`visit_Call`**
1850 |       > *Checks function arguments (e.g., connect('192.168.1.1')).*
1851 |       * Skip logging calls (usually safe text)
1852 | 
1853 |   * ðŸ”¹ **`_check_value`**
1854 |       * **1.** Check for specific dangerous patterns
1855 |       * Filter out simple path routes like "/api/v1" or relative paths
1856 |       * **2.** Check for "Magic Strings" in logic (longer than 10 chars, no spaces)
1857 |       * if len(value) > 15 and " " not in value and not value.startswith("antd:"):
1858 |       * self.issues.append({
1859 |       * "file": self.filename,
1860 |       * "line": lineno,
1861 |       * "type": "â„¹ï¸ Magic String",
1862 |       * "value": value,
1863 |       * "context": context
1864 |       * })
1865 |       * **3.** Check for "Magic Numbers"
1866 | 
1867 | - Æ’ **`scan_file`**
1868 | - Æ’ **`main`**
1869 |     * Filter Ignored Directories
1870 | 
1871 | 
1872 | ### ðŸ“„ `backend/cartographer.py`
1873 | **Components & Logic:**
1874 | 
1875 | - ðŸ“¦ **`SemanticNode`**
1876 |     > *Represents a code unit (Class, Function) and its metadata.*
1877 |   * ðŸ”¹ **`__init__`**
1878 | - ðŸ“¦ **`FileAnalysis`**
1879 |     > *Holds the scan results for a single file.*
1880 |   * ðŸ”¹ **`__init__`**
1881 | - ðŸ“¦ **`SemanticVisitor`**
1882 |   * ðŸ”¹ **`__init__`**
1883 |   * ðŸ”¹ **`_parse_tags`**
1884 |       > *Extracts @tag: value from docstrings.*
1885 |   * ðŸ”¹ **`_extract_narrative`**
1886 |       > *Scans function body for comments and cleans them.*
1887 |       * ' in line:
1888 |       * ', 1)[1].strip()
1889 | 
1890 |   * ðŸ”¹ **`visit_Module`**
1891 |   * ðŸ”¹ **`visit_ClassDef`**
1892 |   * ðŸ”¹ **`visit_FunctionDef`**
1893 |   * ðŸ”¹ **`visit_AsyncFunctionDef`**
1894 |   * ðŸ”¹ **`_visit_function`**
1895 | - ðŸ“¦ **`Cartographer`**
1896 |     > *The Main Orchestrator.*
1897 |   * ðŸ”¹ **`__init__`**
1898 |   * ðŸ”¹ **`run`**
1899 |   * ðŸ”¹ **`_scan_codebase`**
1900 |   * ðŸ”¹ **`_prettify_comment`**
1901 |       > *Transforms raw comments into rich Markdown.*
1902 |   * ðŸ”¹ **`_render_atlas`**
1903 |       * **1.** Folder Header (Optional, good for grouping)
1904 |       * **âš¡ FIX:** Construct the FULL DISPLAY PATH
1905 |       * "backend" + "app/core/system.py" = "backend/app/core/system.py"
1906 |       * Logic for Role Icons
1907 |       * **2.** File Header with FULL PATH
1908 |       * Description
1909 |       * Nodes
1910 | 
1911 |   * ðŸ”¹ **`_render_node`**
1912 | 
1913 | ### ðŸ“„ `backend/check_ai.py`
1914 | **Components & Logic:**
1915 | 
1916 | - Æ’ **`main`**
1917 |     * Mask key for security
1918 |     * **2.** Initialize Client (New SDK)
1919 |     * **3.** List Models
1920 |     * The new SDK list method returns an iterable of models
1921 |     * **4.** Thinking Model Check
1922 |     * We have to re-iterate or store the list, but list() returns a generator usually.
1923 |     * Let's just do a specific check if we didn't see it above (visual check is good enough for diag).
1924 |     * Actually, let's verify connectivity with a quick test.
1925 |     * Use a generic flash model for safety test
1926 | 
1927 | 
1928 | ### ðŸ“„ `backend/consumer.py`
1929 | **Components & Logic:**
1930 | 
1931 | - Æ’ **`consume`**
1932 | 
1933 | ### ðŸ“„ `backend/nuke.py`
1934 | **Components & Logic:**
1935 | 
1936 | - Æ’ **`smart_nuke`**
1937 |     > *Connects to the Maintenance DB (postgres) to drop/create the Target DB (flodock).*
1938 |     * **1.** Parse Config to get target DB name
1939 |     * **2.** Construct Maintenance Connection (Connect to 'postgres' instead of target)
1940 |     * We replace the path (database name) with 'postgres'
1941 |     * Isolation level AUTOCOMMIT is required to run DROP DATABASE
1942 |     * **3.** Kill Active Connections (The "Force" move)
1943 |     * **4.** Drop Database
1944 |     * **5.** Create Database
1945 |     * **6.** Grant Permissions (Optional but good practice)
1946 |     * await conn.execute(text(f"GRANT ALL PRIVILEGES ON DATABASE {target_db} TO {parsed.username};"))
1947 |     * If we failed to connect to 'postgres', maybe the credentials only allow connecting to specific DBs?
1948 | 
1949 | 
1950 | ### ðŸ“„ `backend/probe_diagnostics.py`
1951 | **Components & Logic:**
1952 | 
1953 | - Æ’ **`run_diagnostics`**
1954 |     * **1.** INSPECT COLUMNS (The Truth)
1955 |     * We use `run_sync` to use the standard SQLAlchemy inspector
1956 |     * **2.** CHECK DATA
1957 |     * Show the latest event
1958 | 
1959 | 
1960 | ---
1961 | ### ðŸ“„ `backend/scripts/kafka/consume.py`
1962 | **Components & Logic:**
1963 | 
1964 | - Æ’ **`consume`**
1965 | 
1966 | ### ðŸ“„ `backend/scripts/kafka/install.py`
1967 | **Components & Logic:**
1968 | 
1969 | - Æ’ **`get_paths`**
1970 |     * resolve relative to this script: backend/scripts/kafka/
1971 | 
1972 | - Æ’ **`download_progress`**
1973 | - Æ’ **`force_remove`**
1974 |     > *Retries deletion to handle Windows file locks.*
1975 | - Æ’ **`install`**
1976 |     * **1.** PREPARE DIR
1977 |     * **2.** CHECK EXISTING
1978 |     * **3.** DOWNLOAD
1979 |     * **4.** EXTRACT
1980 |     * Python 3.12+ filter fix
1981 |     * **5.** RENAME & MOVE
1982 |     * Cleanup Zip
1983 |     * **6.** CONFIGURE
1984 |     * Paths must use forward slashes for Java on Windows
1985 |     * Patch Server
1986 |     * Patch Zookeeper
1987 | 
1988 | 
1989 | ### ðŸ“„ `backend/scripts/kafka/patch_config.py`
1990 | **Components & Logic:**
1991 | 
1992 | - Æ’ **`get_paths`**
1993 |     * resolve relative to this script: ../../../infrastructure/kafka
1994 | 
1995 | - Æ’ **`patch_file`**
1996 |     * Add missing keys
1997 | 
1998 | - Æ’ **`main`**
1999 |     * Define Paths
2000 |     * Define Data Directories (Force Forward Slashes for Java)
2001 |     * **1.** Patch Server Properties
2002 |     * **2.** Patch Zookeeper Properties
2003 | 
2004 | 
2005 | ### ðŸ“„ `backend/scripts/kafka/run_cluster.py`
2006 | **Components & Logic:**
2007 | 
2008 | - Æ’ **`get_paths`**
2009 | - Æ’ **`find_java_home`**
2010 | - Æ’ **`run_service_blocking`**
2011 |     > *Runs the service in the CURRENT process.*
2012 |     * Minimal Path + Wbem
2013 |     * Construct Command
2014 |     * **FIX:** Use raw string for Windows wildcard path
2015 | 
2016 | - Æ’ **`main`**
2017 | 
2018 | ---
2019 | ### ðŸ“„ `backend/seed.py`
2020 | **Components & Logic:**
2021 | 
2022 | - Æ’ **`get_domain_modules`**
2023 |     > *Scans 'app/domains' and returns a list of active modules.*
2024 | - Æ’ **`run_wave`**
2025 |     > *Executes a specific wave across ALL domains simultaneously.*
2026 | - Æ’ **`run_seeding_process`**
2027 |     > *The Main Execution Flow.*
2028 |     * âš¡ PHASE 0: ZERO-TOUCH BOOTSTRAP (The "Smart Start")
2029 |     * Dynamically load all Domain Models into memory so SQLAlchemy knows they exist
2030 |     * Force SQLAlchemy to construct the physical tables if they are missing
2031 |     * --- RESET MODE (Reverse Waves) ---
2032 |     * âš¡ PHASE 0.5: KERNEL HYDRATION
2033 |     * --- SEED MODE (Forward Waves) ---
2034 |     * Guard: Don't run History in Prod unless explicit
2035 | 
2036 | - Æ’ **`main`**
2037 | 
2038 | ### ðŸ“„ `backend/trigger_circuit.py`
2039 | **Components & Logic:**
2040 | 
2041 | - Æ’ **`fire_circuit_event`**
2042 |     * âš¡ MANUALLY REGISTER INTERCEPTOR (Required for standalone scripts)
2043 |     * **1.** Ensure it exists (Prime the cache/db)
2044 |     * **2.** Toggle State (The Mutation)
2045 |     * This calls the refactored ORM method
2046 |     * **3.** Commit (Triggers Interceptor)
2047 | 
2048 | 
2049 | ### ðŸ“„ `backend/trigger_event.py`
2050 | **Components & Logic:**
2051 | 
2052 | - Æ’ **`fire_test_event`**
2053 |     * **âš¡ CRITICAL:** We must register the interceptor manually for this script context
2054 |     * In the real app, main.py does this.
2055 |     * **1.** Fetch User
2056 |     * **2.** Modify State (Trigger Dirty Check)
2057 |     * We update a field to force SQLAlchemy to mark it 'dirty'
2058 |     * **3.** Commit (Triggers Interceptor -> Outbox)
2059 | 
2060 | 
2061 | ### ðŸ“„ `backend/trigger_meta.py`
2062 | **Components & Logic:**
2063 | 
2064 | - Æ’ **`fire_meta_event`**
2065 |     * Register Interceptor
2066 |     * Verify Registration
2067 |     * **1.** Create Policy
2068 |     * **2.** Commit (Triggers Interceptor)
2069 | 
2070 | 

================================================================================

# Source code from: frontend\src\pages\TestWorkflow.tsx
---------------------------------------------------------
   1 | /* FILEPATH: frontend/src/pages/TestWorkflow.tsx */
   2 | /* @file Workflow Lab Bench */
   3 | /* @author The Engineer */
   4 | /* @description A standalone harness to test the WorkflowPlayer fractal module.
   5 |  * UPDATED: Uses Centralized Kernel Config via Alias.
   6 |  */
   7 | 
   8 | import React, { useState, useEffect } from 'react';
   9 | import { Card, Typography, Descriptions, Tag, Button, message, Divider, Alert, theme } from 'antd';
  10 | import { ReloadOutlined, UserAddOutlined, ExperimentOutlined, ThunderboltOutlined } from '@ant-design/icons';
  11 | import axios from 'axios';
  12 | 
  13 | import { WorkflowPlayer } from '../platform/workflow';
  14 | // âš¡ FRACTAL IMPORT
  15 | import { API_BASE_URL } from '@kernel/config';
  16 | 
  17 | const { Title, Text } = Typography;
  18 | 
  19 | const TEST_DOMAIN = "USER";
  20 | const TEST_ID = 1;
  21 | 
  22 | export const TestWorkflow: React.FC = () => {
  23 |     // ðŸŽ¨ THEME ENGINE HOOK
  24 |     const { token } = theme.useToken();
  25 |     
  26 |     const [entity, setEntity] = useState<any>(null);
  27 |     const [loading, setLoading] = useState(false);
  28 |     const [lastUpdate, setLastUpdate] = useState(new Date());
  29 | 
  30 |     const fetchSubject = async () => {
  31 |         setLoading(true);
  32 |         try {
  33 |             // âš¡ GATEWAY: Use standardized base
  34 |             const res = await axios.get(`${API_BASE_URL}/api/v1/resource/${TEST_DOMAIN}/${TEST_ID}`);
  35 |             setEntity(res.data);
  36 |         } catch (err: any) {
  37 |             if (err.response?.status === 404) {
  38 |                 setEntity(null);
  39 |             } else {
  40 |                 message.error("Failed to load test subject");
  41 |             }
  42 |         } finally {
  43 |             setLoading(false);
  44 |         }
  45 |     };
  46 | 
  47 |     useEffect(() => {
  48 |         fetchSubject();
  49 |     }, [lastUpdate]);
  50 | 
  51 |     const spawnSubject = async () => {
  52 |         try {
  53 |             await axios.post(`${API_BASE_URL}/api/v1/resource/${TEST_DOMAIN}`, {
  54 |                 email: `test_user_${Date.now()}@example.com`,
  55 |                 role: "user",
  56 |                 status: "DRAFT",
  57 |                 is_active: true
  58 |             });
  59 |             message.success("Spawned new Test Subject!");
  60 |             fetchSubject();
  61 |         } catch (err) {
  62 |             message.error("Failed to spawn subject.");
  63 |         }
  64 |     };
  65 | 
  66 |     const handleWorkflowComplete = () => {
  67 |         message.success("Workflow Action Completed. State Updated.");
  68 |         setLastUpdate(new Date());
  69 |     };
  70 | 
  71 |     // --- STYLES (Dynamic based on Theme) ---
  72 |     const pageStyle: React.CSSProperties = {
  73 |         padding: 40,
  74 |         maxWidth: 900,
  75 |         margin: '0 auto',
  76 |         minHeight: '100vh',
  77 |         background: token.colorBgLayout, // âš¡ Adapts to Dark/Light mode
  78 |         color: token.colorText
  79 |     };
  80 | 
  81 |     const headerStyle: React.CSSProperties = {
  82 |         marginBottom: 24,
  83 |         paddingBottom: 24,
  84 |         borderBottom: `1px solid ${token.colorBorderSecondary}`,
  85 |         display: 'flex',
  86 |         alignItems: 'center',
  87 |         gap: 16
  88 |     };
  89 | 
  90 |     return (
  91 |         <div style={pageStyle}>
  92 |             {/* HEADER */}
  93 |             <div style={headerStyle}>
  94 |                 <div style={{ 
  95 |                     background: token.colorPrimaryBg, 
  96 |                     padding: 12, 
  97 |                     borderRadius: token.borderRadiusLG,
  98 |                     display: 'flex', 
  99 |                     alignItems: 'center', 
 100 |                     justifyContent: 'center'
 101 |                 }}>
 102 |                     <ExperimentOutlined style={{ fontSize: 32, color: token.colorPrimary }} />
 103 |                 </div>
 104 |                 <div>
 105 |                     <Title level={2} style={{ margin: 0 }}>Workflow Lab Bench</Title>
 106 |                     <Text type="secondary">Runtime Verification Environment for <b>{TEST_DOMAIN}</b> Domain</Text>
 107 |                 </div>
 108 |             </div>
 109 | 
 110 |             {/* 1. SUBJECT MONITOR */}
 111 |             <Card 
 112 |                 title={<span><ThunderboltOutlined /> Subject Monitor</span>}
 113 |                 extra={<Button icon={<ReloadOutlined />} onClick={fetchSubject} loading={loading} type="text">Refresh</Button>}
 114 |                 style={{ marginBottom: 24, boxShadow: token.boxShadowTertiary }}
 115 |                 bordered={false}
 116 |             >
 117 |                 {entity ? (
 118 |                     <Descriptions bordered size="small" column={{ xs: 1, sm: 2 }}>
 119 |                         <Descriptions.Item label="Entity ID">{entity.id}</Descriptions.Item>
 120 |                         <Descriptions.Item label="Domain">{TEST_DOMAIN}</Descriptions.Item>
 121 |                         <Descriptions.Item label="Email">{entity.email}</Descriptions.Item>
 122 |                         <Descriptions.Item label="Current Status">
 123 |                             <Tag bordered={false} color={getStatusColor(entity.status)}>
 124 |                                 {entity.status || "UNKNOWN"}
 125 |                             </Tag>
 126 |                         </Descriptions.Item>
 127 |                         
 128 |                         {/* Show the sidecar context if it was persisted (debug only) */}
 129 |                         <Descriptions.Item label="Last Event Payload" span={2}>
 130 |                             <Text code style={{ fontSize: 12 }}>
 131 |                                 {JSON.stringify(entity._runtime_context || {}, null, 2)}
 132 |                             </Text>
 133 |                         </Descriptions.Item>
 134 |                     </Descriptions>
 135 |                 ) : (
 136 |                     <div style={{ textAlign: 'center', padding: 32, background: token.colorFillAlter, borderRadius: token.borderRadius }}>
 137 |                         <Alert 
 138 |                             type="info" 
 139 |                             message="Lab Bench Empty" 
 140 |                             description="No active subject found to run experiments on."
 141 |                             style={{ marginBottom: 16, background: 'transparent', border: 'none' }}
 142 |                         />
 143 |                         <Button type="primary" icon={<UserAddOutlined />} onClick={spawnSubject}>
 144 |                             Spawn Test Subject
 145 |                         </Button>
 146 |                     </div>
 147 |                 )}
 148 |             </Card>
 149 | 
 150 |             {/* 2. WORKFLOW CONTROLLER */}
 151 |             {entity && (
 152 |                 <Card 
 153 |                     title="2. Workflow Controller" 
 154 |                     bordered={false}
 155 |                     style={{ 
 156 |                         boxShadow: token.boxShadow, 
 157 |                         border: `1px solid ${token.colorBorder}` 
 158 |                     }}
 159 |                 >
 160 |                     <div style={{ marginBottom: 24 }}>
 161 |                         <div style={{ marginBottom: 8 }}>
 162 |                             <Text strong>Available Actions</Text>
 163 |                         </div>
 164 |                         <Text type="secondary" style={{ fontSize: 13 }}>
 165 |                             The buttons below are rendered dynamically based on the current state 
 166 |                             <Tag style={{ marginLeft: 8 }}>{entity.status}</Tag>
 167 |                         </Text>
 168 |                     </div>
 169 | 
 170 |                     <div style={{ 
 171 |                         padding: 24, 
 172 |                         background: token.colorFillAlter, 
 173 |                         borderRadius: token.borderRadiusLG,
 174 |                         border: `1px dashed ${token.colorBorder}`
 175 |                     }}>
 176 |                         {/* ðŸ‘‡ FRACTAL COMPONENT */}
 177 |                         <WorkflowPlayer 
 178 |                             domain={TEST_DOMAIN} 
 179 |                             id={entity.id} 
 180 |                             onComplete={handleWorkflowComplete}
 181 |                         />
 182 |                     </div>
 183 |                     
 184 |                     <Divider plain style={{ fontSize: 12, color: token.colorTextQuaternary }}>
 185 |                         Fractal Architecture v2.0
 186 |                     </Divider>
 187 |                 </Card>
 188 |             )}
 189 |         </div>
 190 |     );
 191 | };
 192 | 
 193 | function getStatusColor(status: string) {
 194 |     const map: Record<string, string> = {
 195 |         'DRAFT': 'orange',
 196 |         'REVIEW': 'processing',
 197 |         'ACTIVE': 'success',
 198 |         'ARCHIVED': 'default',
 199 |         'REJECTED': 'error'
 200 |     };
 201 |     return map[status] || 'default';
 202 | }

================================================================================

# Source code from: frontend\src\platform\workflow\WorkflowActions.tsx
------------------------------------------------------------------------
   1 | /* FILEPATH: frontend/src/platform/workflow/WorkflowActions.tsx */
   2 | /* @file Workflow Action Bar */
   3 | /* @author The Engineer */
   4 | /* @description Renders the "Next Step" buttons for an entity.
   5 |  */
   6 | 
   7 | import React from 'react';
   8 | import { Button, Space, theme } from 'antd';
   9 | import { 
  10 |     CheckCircleOutlined, 
  11 |     CloseCircleOutlined, 
  12 |     ArrowRightOutlined,
  13 |     RocketOutlined
  14 | } from '@ant-design/icons';
  15 | import { useWorkflow } from './useWorkflow';
  16 | 
  17 | interface WorkflowActionsProps {
  18 |     domain: string;
  19 |     entityId: string | number;
  20 |     currentState: string;
  21 | }
  22 | 
  23 | export const WorkflowActions: React.FC<WorkflowActionsProps> = ({ domain, entityId, currentState }) => {
  24 |     const { token } = theme.useToken();
  25 |     const { availableActions, send, isTransitioning } = useWorkflow(domain, entityId, currentState);
  26 | 
  27 |     if (availableActions.length === 0) return null;
  28 | 
  29 |     // Helper to guess icon/color based on event name semantics
  30 |     const getActionProps = (name: string) => {
  31 |         const lower = name.toLowerCase();
  32 |         if (lower.includes('approve') || lower.includes('pass')) 
  33 |             return { icon: <CheckCircleOutlined />, type: 'primary' as const, danger: false };
  34 |         if (lower.includes('reject') || lower.includes('cancel')) 
  35 |             return { icon: <CloseCircleOutlined />, type: 'default' as const, danger: true };
  36 |         if (lower.includes('publish') || lower.includes('activate')) 
  37 |             return { icon: <RocketOutlined />, type: 'primary' as const, danger: false };
  38 |         
  39 |         return { icon: <ArrowRightOutlined />, type: 'default' as const, danger: false };
  40 |     };
  41 | 
  42 |     return (
  43 |         <div style={{ 
  44 |             padding: '12px 16px', 
  45 |             background: token.colorFillAlter, 
  46 |             borderTop: `1px solid ${token.colorSplit}`,
  47 |             display: 'flex',
  48 |             justifyContent: 'flex-end',
  49 |             alignItems: 'center',
  50 |             gap: 12
  51 |         }}>
  52 |             <span style={{ fontSize: 12, color: token.colorTextSecondary }}>
  53 |                 Current Status: <strong>{currentState}</strong>
  54 |             </span>
  55 |             <Space>
  56 |                 {availableActions.map(action => {
  57 |                     const props = getActionProps(action.name);
  58 |                     return (
  59 |                         <Button 
  60 |                             key={action.name}
  61 |                             icon={props.icon}
  62 |                             type={props.type}
  63 |                             danger={props.danger}
  64 |                             loading={isTransitioning}
  65 |                             onClick={() => send(action.name)}
  66 |                         >
  67 |                             {action.name}
  68 |                         </Button>
  69 |                     );
  70 |                 })}
  71 |             </Space>
  72 |         </div>
  73 |     );
  74 | };
  75 | 

================================================================================

# Source code from: frontend\src\platform\workflow\useWorkflow.ts
-------------------------------------------------------------------
   1 | /* FILEPATH: frontend/src/platform/workflow/useWorkflow.ts */
   2 | /* @file Workflow Runtime Hook */
   3 | /* @author The Engineer */
   4 | /* @description Determines available actions for a specific entity instance.
   5 |  * USAGE: const { actions, send } = useWorkflow('USER', '123', 'DRAFT');
   6 |  * UPDATED: Uses Centralized Kernel Config via Alias.
   7 |  */
   8 | 
   9 | import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
  10 | import axios from 'axios';
  11 | import { App } from 'antd';
  12 | // âš¡ FRACTAL IMPORT
  13 | import { API_BASE_URL } from '@kernel/config';
  14 | 
  15 | export interface WorkflowAction {
  16 |   name: string; // e.g. "APPROVE"
  17 |   target: string; // e.g. "active"
  18 | }
  19 | 
  20 | export const useWorkflow = (domain: string, entityId: string | number, currentState: string) => {
  21 |   const { message } = App.useApp();
  22 |   const queryClient = useQueryClient();
  23 | 
  24 |   // 1. Fetch Definition to compute Next Steps
  25 |   // Optimization: We fetch the definition for the *Domain*, not the specific entity instance every time
  26 |   const { data: machine } = useQuery({
  27 |     queryKey: ['meta', 'states', domain, 'LIFECYCLE'], // Assuming default scope for now
  28 |     queryFn: async () => {
  29 |         // âš¡ GATEWAY: Use standardized base
  30 |         const res = await axios.get(`${API_BASE_URL}/api/v1/meta/states/${domain}/LIFECYCLE`); // Get active
  31 |         return res.data;
  32 |     },
  33 |     enabled: !!domain
  34 |   });
  35 | 
  36 |   // 2. Compute Available Actions
  37 |   const availableActions: WorkflowAction[] = [];
  38 | 
  39 |   if (machine && currentState) {
  40 |       // XState V5 Structure: machine.transitions.states[currentState].on
  41 |       const stateNode = machine.transitions?.states?.[currentState];
  42 |       if (stateNode && stateNode.on) {
  43 |           Object.entries(stateNode.on).forEach(([event, target]) => {
  44 |               // Handle string target or object target
  45 |               const targetState = typeof target === 'string' ? target : (target as any).target;
  46 |               availableActions.push({ name: event, target: targetState });
  47 |           });
  48 |       }
  49 |   }
  50 | 
  51 |   // 3. Execute Transition
  52 |   const transitionMutation = useMutation({
  53 |       mutationFn: async (action: string) => {
  54 |           // We patch the Resource directly. The Backend Enforcer will validate it.
  55 |           // Note: In a real app, we might want a dedicated /transition endpoint,
  56 |           // but patching status is the RESTful way we chose.
  57 |           
  58 |           // First, find the target state for this action to send the payload
  59 |           const actionDef = availableActions.find(a => a.name === action);
  60 |           if (!actionDef) throw new Error("Invalid Action");
  61 | 
  62 |           return axios.patch(`${API_BASE_URL}/api/v1/resource/${domain}/${entityId}`, {
  63 |               status: actionDef.target
  64 |           });
  65 |       },
  66 |       onSuccess: () => {
  67 |           message.success("State Updated");
  68 |           // Invalidate the entity data so the UI refreshes
  69 |           queryClient.invalidateQueries({ queryKey: ['resource', domain, entityId] });
  70 |       },
  71 |       onError: (err: any) => {
  72 |           message.error(err.response?.data?.detail || "Transition Failed");
  73 |       }
  74 |   });
  75 | 
  76 |   return {
  77 |       availableActions,
  78 |       send: transitionMutation.mutate,
  79 |       isTransitioning: transitionMutation.isPending
  80 |   };
  81 | };
  82 | 

================================================================================

# Source code from: frontend\FRONTEND_ATLAS.md
------------------------------------------------
   1 | # ðŸ—ºï¸ FLODOCK SYSTEM ATLAS (Prism V10)
   2 | **Generated:** 2026-02-19 14:34
   3 | **Mode:** Total Recall (Full Comment Extraction).
   4 | 
   5 | ---
   6 | ## ðŸ“‚ `frontend/src/`
   7 | 
   8 | ### ðŸ“„ `App.tsx`
   9 | > Root Provider Stack with fixed locale and fluid height.
  10 | 
  11 | ---
  12 | ## ðŸ“‚ `frontend/src/_kernel/`
  13 | 
  14 | ### ðŸ“„ `CapabilitiesContext.tsx`
  15 | > FILEPATH: frontend/src/_kernel/CapabilitiesContext.tsx */
  16 | 
  17 | **Components & Logic:**
  18 | 
  19 | * **`CapabilitiesProvider`**
  20 |   * **Logic Flow:**
  21 |     * `Execute the Handshake`
  22 |     * `Hook for consuming the capabilities`
  23 | * **`useCapabilities`**
  24 |   * ðŸ“ *Hook for consuming the capabilities*
  25 | 
  26 | ---
  27 | ### ðŸ“„ `SystemRegistry.ts`
  28 | > Keeps the app alive by catching legacy calls from 'CapabilitiesContext' or 'SystemContext'.
  29 | 
  30 | | Attribute | Value |
  31 | | :--- | :--- |
  32 | | **status** | `ZOMBIE (Logic Removed, Interfaces Preserved)` |
  33 | 
  34 | **Components & Logic:**
  35 | 
  36 | * **`CapabilityItem`**
  37 |   * ðŸ“ *--- TYPES (Kept for compatibility to prevent TS errors) ---*
  38 | * **`ContextField`**
  39 | * **`SystemCapabilities`**
  40 |   * **Logic Flow:**
  41 |     * `--- SAFE MODE DEFAULTS ---`
  42 | * **`SystemRegistry`**
  43 | 
  44 | ---
  45 | ### ðŸ“„ `config.ts`
  46 | > FILEPATH: frontend/src/_kernel/config.ts */
  47 | 
  48 | **Components & Logic:**
  49 | 
  50 | * **`API_BASE_URL`**
  51 |   * ðŸ“ *localhost:8000';*
  52 |   * **Logic Flow:**
  53 |     * `3. Application Metadata`
  54 | * **`APP_VERSION`**
  55 |   * ðŸ“ *3. Application Metadata*
  56 | * **`IS_DEV`**
  57 | * **`IS_DEBUG`**
  58 | 
  59 | ---
  60 | ## ðŸ“‚ `frontend/src/api/core/`
  61 | 
  62 | ### ðŸ“„ `ApiError.ts`
  63 | > generated using openapi-typescript-codegen -- do not edit */
  64 | 
  65 | **Components & Logic:**
  66 | 
  67 | * **`ApiError`**
  68 | 
  69 | ---
  70 | ### ðŸ“„ `ApiRequestOptions.ts`
  71 | > generated using openapi-typescript-codegen -- do not edit */
  72 | 
  73 | **Components & Logic:**
  74 | 
  75 | * **`ApiRequestOptions`**
  76 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
  77 | 
  78 | ---
  79 | ### ðŸ“„ `ApiResult.ts`
  80 | > generated using openapi-typescript-codegen -- do not edit */
  81 | 
  82 | **Components & Logic:**
  83 | 
  84 | * **`ApiResult`**
  85 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
  86 | 
  87 | ---
  88 | ### ðŸ“„ `CancelablePromise.ts`
  89 | > generated using openapi-typescript-codegen -- do not edit */
  90 | 
  91 | **Components & Logic:**
  92 | 
  93 | * **`CancelError`**
  94 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
  95 | * **`OnCancel`**
  96 | * **`CancelablePromise`**
  97 | 
  98 | ---
  99 | ### ðŸ“„ `OpenAPI.ts`
 100 | > generated using openapi-typescript-codegen -- do not edit */
 101 | 
 102 | **Components & Logic:**
 103 | 
 104 | * **`OpenAPIConfig`**
 105 | * **`OpenAPI`**
 106 | 
 107 | ---
 108 | ### ðŸ“„ `request.ts`
 109 | > generated using openapi-typescript-codegen -- do not edit */
 110 | 
 111 | **Components & Logic:**
 112 | 
 113 | * **`request`**
 114 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 115 | 
 116 | ---
 117 | ## ðŸ“‚ `frontend/src/api/`
 118 | 
 119 | ### ðŸ“„ `index.ts`
 120 | > generated using openapi-typescript-codegen -- do not edit */
 121 | 
 122 | ---
 123 | ## ðŸ“‚ `frontend/src/api/models/`
 124 | 
 125 | ### ðŸ“„ `AIRequest.ts`
 126 | > generated using openapi-typescript-codegen -- do not edit */
 127 | 
 128 | **Components & Logic:**
 129 | 
 130 | * **`AIRequest`**
 131 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 132 | 
 133 | ---
 134 | ### ðŸ“„ `ActiveAppCreate.ts`
 135 | > generated using openapi-typescript-codegen -- do not edit */
 136 | 
 137 | **Components & Logic:**
 138 | 
 139 | * **`ActiveAppCreate`**
 140 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 141 | 
 142 | ---
 143 | ### ðŸ“„ `ActiveAppRead.ts`
 144 | > generated using openapi-typescript-codegen -- do not edit */
 145 | 
 146 | **Components & Logic:**
 147 | 
 148 | * **`ActiveAppRead`**
 149 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 150 | 
 151 | ---
 152 | ### ðŸ“„ `ActiveAppUpdate.ts`
 153 | > generated using openapi-typescript-codegen -- do not edit */
 154 | 
 155 | **Components & Logic:**
 156 | 
 157 | * **`ActiveAppUpdate`**
 158 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 159 | 
 160 | ---
 161 | ### ðŸ“„ `AttributeConfig.ts`
 162 | > generated using openapi-typescript-codegen -- do not edit */
 163 | 
 164 | **Components & Logic:**
 165 | 
 166 | * **`AttributeConfig`**
 167 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 168 | 
 169 | ---
 170 | ### ðŸ“„ `AttributeCreate.ts`
 171 | > generated using openapi-typescript-codegen -- do not edit */
 172 | 
 173 | **Components & Logic:**
 174 | 
 175 | * **`AttributeCreate`**
 176 | 
 177 | ---
 178 | ### ðŸ“„ `AttributeRead.ts`
 179 | > generated using openapi-typescript-codegen -- do not edit */
 180 | 
 181 | **Components & Logic:**
 182 | 
 183 | * **`AttributeRead`**
 184 | 
 185 | ---
 186 | ### ðŸ“„ `AttributeType.ts`
 187 | > generated using openapi-typescript-codegen -- do not edit */
 188 | 
 189 | **Components & Logic:**
 190 | 
 191 | * **`AttributeType`**
 192 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 193 | 
 194 | ---
 195 | ### ðŸ“„ `AttributeUpdate.ts`
 196 | > generated using openapi-typescript-codegen -- do not edit */
 197 | 
 198 | **Components & Logic:**
 199 | 
 200 | * **`AttributeUpdate`**
 201 | 
 202 | ---
 203 | ### ðŸ“„ `BindingType.ts`
 204 | > generated using openapi-typescript-codegen -- do not edit */
 205 | 
 206 | **Components & Logic:**
 207 | 
 208 | * **`BindingType`**
 209 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 210 | 
 211 | ---
 212 | ### ðŸ“„ `BrickList.ts`
 213 | > generated using openapi-typescript-codegen -- do not edit */
 214 | 
 215 | **Components & Logic:**
 216 | 
 217 | * **`BrickList`**
 218 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 219 | 
 220 | ---
 221 | ### ðŸ“„ `DataCircuitCreate.ts`
 222 | > generated using openapi-typescript-codegen -- do not edit */
 223 | 
 224 | **Components & Logic:**
 225 | 
 226 | * **`DataCircuitCreate`**
 227 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 228 | 
 229 | ---
 230 | ### ðŸ“„ `DataCircuitRead.ts`
 231 | > generated using openapi-typescript-codegen -- do not edit */
 232 | 
 233 | **Components & Logic:**
 234 | 
 235 | * **`DataCircuitRead`**
 236 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 237 | 
 238 | ---
 239 | ### ðŸ“„ `DataCircuitUpdate.ts`
 240 | > generated using openapi-typescript-codegen -- do not edit */
 241 | 
 242 | **Components & Logic:**
 243 | 
 244 | * **`DataCircuitUpdate`**
 245 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 246 | 
 247 | ---
 248 | ### ðŸ“„ `DryRunRequest.ts`
 249 | > generated using openapi-typescript-codegen -- do not edit */
 250 | 
 251 | **Components & Logic:**
 252 | 
 253 | * **`DryRunRequest`**
 254 | 
 255 | ---
 256 | ### ðŸ“„ `DryRunResult.ts`
 257 | > generated using openapi-typescript-codegen -- do not edit */
 258 | 
 259 | **Components & Logic:**
 260 | 
 261 | * **`DryRunResult`**
 262 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 263 | 
 264 | ---
 265 | ### ðŸ“„ `HTTPValidationError.ts`
 266 | > generated using openapi-typescript-codegen -- do not edit */
 267 | 
 268 | **Components & Logic:**
 269 | 
 270 | * **`HTTPValidationError`**
 271 | 
 272 | ---
 273 | ### ðŸ“„ `NexusTraceRead.ts`
 274 | > generated using openapi-typescript-codegen -- do not edit */
 275 | 
 276 | **Components & Logic:**
 277 | 
 278 | * **`NexusTraceRead`**
 279 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 280 | 
 281 | ---
 282 | ### ðŸ“„ `PolicyBase.ts`
 283 | > generated using openapi-typescript-codegen -- do not edit */
 284 | 
 285 | **Components & Logic:**
 286 | 
 287 | * **`PolicyBase`**
 288 | 
 289 | ---
 290 | ### ðŸ“„ `PolicyBindingCreate.ts`
 291 | > generated using openapi-typescript-codegen -- do not edit */
 292 | 
 293 | **Components & Logic:**
 294 | 
 295 | * **`PolicyBindingCreate`**
 296 | 
 297 | ---
 298 | ### ðŸ“„ `PolicyBindingRead.ts`
 299 | > generated using openapi-typescript-codegen -- do not edit */
 300 | 
 301 | **Components & Logic:**
 302 | 
 303 | * **`PolicyBindingRead`**
 304 | 
 305 | ---
 306 | ### ðŸ“„ `PolicyBindingUpdate.ts`
 307 | > generated using openapi-typescript-codegen -- do not edit */
 308 | 
 309 | **Components & Logic:**
 310 | 
 311 | * **`PolicyBindingUpdate`**
 312 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 313 | 
 314 | ---
 315 | ### ðŸ“„ `PolicyCreate.ts`
 316 | > generated using openapi-typescript-codegen -- do not edit */
 317 | 
 318 | **Components & Logic:**
 319 | 
 320 | * **`PolicyCreate`**
 321 | 
 322 | ---
 323 | ### ðŸ“„ `PolicyGroupCreate.ts`
 324 | > generated using openapi-typescript-codegen -- do not edit */
 325 | 
 326 | **Components & Logic:**
 327 | 
 328 | * **`PolicyGroupCreate`**
 329 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 330 | 
 331 | ---
 332 | ### ðŸ“„ `PolicyGroupRead.ts`
 333 | > generated using openapi-typescript-codegen -- do not edit */
 334 | 
 335 | **Components & Logic:**
 336 | 
 337 | * **`PolicyGroupRead`**
 338 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 339 | 
 340 | ---
 341 | ### ðŸ“„ `PolicyGroupUpdate.ts`
 342 | > generated using openapi-typescript-codegen -- do not edit */
 343 | 
 344 | **Components & Logic:**
 345 | 
 346 | * **`PolicyGroupUpdate`**
 347 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 348 | 
 349 | ---
 350 | ### ðŸ“„ `PolicyRead.ts`
 351 | > generated using openapi-typescript-codegen -- do not edit */
 352 | 
 353 | **Components & Logic:**
 354 | 
 355 | * **`PolicyRead`**
 356 | 
 357 | ---
 358 | ### ðŸ“„ `PolicyResolutionStrategy.ts`
 359 | > generated using openapi-typescript-codegen -- do not edit */
 360 | 
 361 | **Components & Logic:**
 362 | 
 363 | * **`PolicyResolutionStrategy`**
 364 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 365 | 
 366 | ---
 367 | ### ðŸ“„ `PolicyRule.ts`
 368 | > generated using openapi-typescript-codegen -- do not edit */
 369 | 
 370 | **Components & Logic:**
 371 | 
 372 | * **`PolicyRule`**
 373 | 
 374 | ---
 375 | ### ðŸ“„ `PolicyUpdate.ts`
 376 | > generated using openapi-typescript-codegen -- do not edit */
 377 | 
 378 | **Components & Logic:**
 379 | 
 380 | * **`PolicyUpdate`**
 381 | 
 382 | ---
 383 | ### ðŸ“„ `ReleaseCreate.ts`
 384 | > generated using openapi-typescript-codegen -- do not edit */
 385 | 
 386 | **Components & Logic:**
 387 | 
 388 | * **`ReleaseCreate`**
 389 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 390 | 
 391 | ---
 392 | ### ðŸ“„ `ReleaseRead.ts`
 393 | > generated using openapi-typescript-codegen -- do not edit */
 394 | 
 395 | **Components & Logic:**
 396 | 
 397 | * **`ReleaseRead`**
 398 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 399 | 
 400 | ---
 401 | ### ðŸ“„ `RuleActionType.ts`
 402 | > generated using openapi-typescript-codegen -- do not edit */
 403 | 
 404 | **Components & Logic:**
 405 | 
 406 | * **`RuleActionType`**
 407 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 408 | 
 409 | ---
 410 | ### ðŸ“„ `RuleCreate.ts`
 411 | > generated using openapi-typescript-codegen -- do not edit */
 412 | 
 413 | **Components & Logic:**
 414 | 
 415 | * **`RuleCreate`**
 416 | 
 417 | ---
 418 | ### ðŸ“„ `RuleEffect.ts`
 419 | > generated using openapi-typescript-codegen -- do not edit */
 420 | 
 421 | **Components & Logic:**
 422 | 
 423 | * **`RuleEffect`**
 424 | 
 425 | ---
 426 | ### ðŸ“„ `RuleEventType.ts`
 427 | > generated using openapi-typescript-codegen -- do not edit */
 428 | 
 429 | **Components & Logic:**
 430 | 
 431 | * **`RuleEventType`**
 432 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 433 | 
 434 | ---
 435 | ### ðŸ“„ `RuleRead.ts`
 436 | > generated using openapi-typescript-codegen -- do not edit */
 437 | 
 438 | **Components & Logic:**
 439 | 
 440 | * **`RuleRead`**
 441 | 
 442 | ---
 443 | ### ðŸ“„ `ScopeType.ts`
 444 | > generated using openapi-typescript-codegen -- do not edit */
 445 | 
 446 | **Components & Logic:**
 447 | 
 448 | * **`ScopeType`**
 449 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 450 | 
 451 | ---
 452 | ### ðŸ“„ `ScreenCreate.ts`
 453 | > generated using openapi-typescript-codegen -- do not edit */
 454 | 
 455 | **Components & Logic:**
 456 | 
 457 | * **`ScreenCreate`**
 458 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 459 | 
 460 | ---
 461 | ### ðŸ“„ `ScreenList.ts`
 462 | > generated using openapi-typescript-codegen -- do not edit */
 463 | 
 464 | **Components & Logic:**
 465 | 
 466 | * **`ScreenList`**
 467 | 
 468 | ---
 469 | ### ðŸ“„ `ScreenRead.ts`
 470 | > generated using openapi-typescript-codegen -- do not edit */
 471 | 
 472 | **Components & Logic:**
 473 | 
 474 | * **`ScreenRead`**
 475 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 476 | 
 477 | ---
 478 | ### ðŸ“„ `SelectOption.ts`
 479 | > generated using openapi-typescript-codegen -- do not edit */
 480 | 
 481 | **Components & Logic:**
 482 | 
 483 | * **`SelectOption`**
 484 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 485 | 
 486 | ---
 487 | ### ðŸ“„ `StateMachineCreate.ts`
 488 | > generated using openapi-typescript-codegen -- do not edit */
 489 | 
 490 | **Components & Logic:**
 491 | 
 492 | * **`StateMachineCreate`**
 493 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 494 | 
 495 | ---
 496 | ### ðŸ“„ `StateMachineRead.ts`
 497 | > generated using openapi-typescript-codegen -- do not edit */
 498 | 
 499 | **Components & Logic:**
 500 | 
 501 | * **`StateMachineRead`**
 502 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 503 | 
 504 | ---
 505 | ### ðŸ“„ `Token.ts`
 506 | > generated using openapi-typescript-codegen -- do not edit */
 507 | 
 508 | **Components & Logic:**
 509 | 
 510 | * **`Token`**
 511 | 
 512 | ---
 513 | ### ðŸ“„ `TransitionOption.ts`
 514 | > generated using openapi-typescript-codegen -- do not edit */
 515 | 
 516 | **Components & Logic:**
 517 | 
 518 | * **`TransitionOption`**
 519 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 520 | 
 521 | ---
 522 | ### ðŸ“„ `TransitionRequest.ts`
 523 | > generated using openapi-typescript-codegen -- do not edit */
 524 | 
 525 | **Components & Logic:**
 526 | 
 527 | * **`TransitionRequest`**
 528 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 529 | 
 530 | ---
 531 | ### ðŸ“„ `TransitionResponse.ts`
 532 | > generated using openapi-typescript-codegen -- do not edit */
 533 | 
 534 | **Components & Logic:**
 535 | 
 536 | * **`TransitionResponse`**
 537 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 538 | 
 539 | ---
 540 | ### ðŸ“„ `UserLogin.ts`
 541 | > generated using openapi-typescript-codegen -- do not edit */
 542 | 
 543 | **Components & Logic:**
 544 | 
 545 | * **`UserLogin`**
 546 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 547 | 
 548 | ---
 549 | ### ðŸ“„ `UserRead.ts`
 550 | > generated using openapi-typescript-codegen -- do not edit */
 551 | 
 552 | **Components & Logic:**
 553 | 
 554 | * **`UserRead`**
 555 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 556 | 
 557 | ---
 558 | ### ðŸ“„ `ValidationError.ts`
 559 | > generated using openapi-typescript-codegen -- do not edit */
 560 | 
 561 | **Components & Logic:**
 562 | 
 563 | * **`ValidationError`**
 564 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 565 | 
 566 | ---
 567 | ### ðŸ“„ `WidgetType.ts`
 568 | > generated using openapi-typescript-codegen -- do not edit */
 569 | 
 570 | **Components & Logic:**
 571 | 
 572 | * **`WidgetType`**
 573 |   * ðŸ“ *generated using openapi-typescript-codegen -- do not edit */*
 574 | 
 575 | ---
 576 | ## ðŸ“‚ `frontend/src/api/services/`
 577 | 
 578 | ### ðŸ“„ `AiCortexService.ts`
 579 | > generated using openapi-typescript-codegen -- do not edit */
 580 | 
 581 | **Components & Logic:**
 582 | 
 583 | * **`AiCortexService`**
 584 | 
 585 | ---
 586 | ### ðŸ“„ `AuthService.ts`
 587 | > generated using openapi-typescript-codegen -- do not edit */
 588 | 
 589 | **Components & Logic:**
 590 | 
 591 | * **`AuthService`**
 592 | 
 593 | ---
 594 | ### ðŸ“„ `MetaKernelService.ts`
 595 | > FILEPATH: frontend/src/api/services/MetaKernelService.ts
 596 | 
 597 | **Components & Logic:**
 598 | 
 599 | * **`MetaKernelService`**
 600 | 
 601 | ---
 602 | ### ðŸ“„ `NexusBrokerService.ts`
 603 | > generated using openapi-typescript-codegen -- do not edit */
 604 | 
 605 | **Components & Logic:**
 606 | 
 607 | * **`NexusBrokerService`**
 608 | 
 609 | ---
 610 | ### ðŸ“„ `PolicyGroupsService.ts`
 611 | > generated using openapi-typescript-codegen -- do not edit */
 612 | 
 613 | **Components & Logic:**
 614 | 
 615 | * **`PolicyGroupsService`**
 616 | 
 617 | ---
 618 | ### ðŸ“„ `SystemCoreService.ts`
 619 | > generated using openapi-typescript-codegen -- do not edit */
 620 | 
 621 | **Components & Logic:**
 622 | 
 623 | * **`SystemCoreService`**
 624 | 
 625 | ---
 626 | ### ðŸ“„ `UniversalResourceService.ts`
 627 | > generated using openapi-typescript-codegen -- do not edit */
 628 | 
 629 | **Components & Logic:**
 630 | 
 631 | * **`UniversalResourceService`**
 632 | 
 633 | ---
 634 | ### ðŸ“„ `WorkflowEngineService.ts`
 635 | > generated using openapi-typescript-codegen -- do not edit */
 636 | 
 637 | **Components & Logic:**
 638 | 
 639 | * **`WorkflowEngineService`**
 640 | 
 641 | ---
 642 | ### ðŸ“„ `WorkflowsService.ts`
 643 | > generated using openapi-typescript-codegen -- do not edit */
 644 | 
 645 | **Components & Logic:**
 646 | 
 647 | * **`WorkflowsService`**
 648 | 
 649 | ---
 650 | ### ðŸ“„ `WorkspaceService.ts`
 651 | > generated using openapi-typescript-codegen -- do not edit */
 652 | 
 653 | **Components & Logic:**
 654 | 
 655 | * **`WorkspaceService`**
 656 | 
 657 | ---
 658 | ## ðŸ“‚ `frontend/src/`
 659 | 
 660 | ### ðŸ“„ `config.ts`
 661 | > FILEPATH: frontend/src/config.ts */
 662 | 
 663 | **Components & Logic:**
 664 | 
 665 | * **`API_BASE_URL`**
 666 |   * ðŸ“ *localhost:8000';*
 667 |   * **Logic Flow:**
 668 |     * `3. Application Metadata`
 669 | * **`APP_VERSION`**
 670 |   * ðŸ“ *Remove any remaining trailing slashes*
 671 | * **`IS_DEV`**
 672 | * **`IS_DEBUG`**
 673 | 
 674 | ---
 675 | ## ðŸ“‚ `frontend/src/domains/meta/_kernel/`
 676 | 
 677 | ### ðŸ“„ `CapabilitiesContext.tsx`
 678 | > Fetches and provides System Introspection Data.
 679 | 
 680 | | Attribute | Value |
 681 | | :--- | :--- |
 682 | | **security-level** | `LEVEL 0 (Kernel)` |
 683 | | **invariant** | `Must be the ONLY instance in the app.` |
 684 | | **updated** | `Added Strict Array Sanitization to prevent 'NEURAL LINK SEVERED' crash.` |
 685 | 
 686 | **Components & Logic:**
 687 | 
 688 | * **`CapabilityItem`**
 689 | * **`ContextField`**
 690 | * **`SystemCapabilities`**
 691 | * **`CapabilitiesProvider`**
 692 |   * **Logic Flow:**
 693 |     * `âš¡ SANITIZATION LAYER: Ensure no null arrays to prevent crashes`
 694 | * **`useCapabilities`**
 695 | 
 696 | ---
 697 | ### ðŸ“„ `MetaContext.tsx`
 698 | > Manages Domain Selection, Scope, and Deep Linking. Bridges the URL to the Application State.
 699 | 
 700 | | Attribute | Value |
 701 | | :--- | :--- |
 702 | | **security-level** | `LEVEL 0 (Kernel) */` |
 703 | 
 704 | **Components & Logic:**
 705 | 
 706 | * **`MetaProvider`**
 707 |   * **Logic Flow:**
 708 |     * `1. DATA: Fetch Topology (Domains -> Scopes)`
 709 |     * `2. STATE: Universal URL Persistence`
 710 |     * `3. DERIVED STATE: Resolve Objects from Keys`
 711 |     * `4. ACTIONS (The Interface Implementation)`
 712 |     * `Clear children when parent changes`
 713 |     * `5. SIDE EFFECTS`
 714 |     * `6. CONSTRUCT CONTEXT`
 715 | * **`useMetaContext`**
 716 | 
 717 | ---
 718 | ### ðŸ“„ `types.ts`
 719 | > Shared type definitions for the Meta Module state.
 720 | 
 721 | | Attribute | Value |
 722 | | :--- | :--- |
 723 | | **security-level** | `LEVEL 0 (Kernel Definition) */` |
 724 | | **invariant** | `Must match Backend Pydantic Models in 'app.core.kernel.registry.schemas'. */` |
 725 | | **updated** | `Added 'selectedItem' for Global Deep Linking. */` |
 726 | 
 727 | **Components & Logic:**
 728 | 
 729 | * **`ScopeConfig`**
 730 |   * ðŸ“ *Shared type definitions for the Meta Module state.*
 731 |   * **Logic Flow:**
 732 |     * `For Governance/Sub-Flow: Which DB column does this control?`
 733 |     * `For Wizards: "CREATE" or "EDIT"`
 734 |     * `For Jobs: "high_priority" etc.`
 735 |     * `Generic Configuration`
 736 |     * `âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)`
 737 | * **`DomainTypeProperties`**
 738 |   * ðŸ“ *âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)*
 739 | * **`DomainTypeDefinition`**
 740 |   * **Logic Flow:**
 741 |     * `âš¡ FIX: Added strictly typed properties bag to receive Backend Contract`
 742 | * **`DomainSummary`**
 743 |   * **Logic Flow:**
 744 |     * `âš¡ DYNAMIC TYPE (Data-Driven)`
 745 |     * `Matches 'backend/app/domains/system/features/domain_types/models.py'`
 746 |     * `âš¡ TOPOLOGY METADATA (Level 100)`
 747 |     * `Visuals`
 748 |     * `Capabilities`
 749 | * **`MetaContextState`**
 750 |   * **Logic Flow:**
 751 |     * `Selection State (Deep Linking)`
 752 |     * `âš¡ GLOBAL ITEM STATE (Fixes Refresh Amnesia)`
 753 |     * `Data Access`
 754 | 
 755 | ---
 756 | ## ðŸ“‚ `frontend/src/domains/meta/_shell/`
 757 | 
 758 | ### ðŸ“„ `MetaLayout.tsx`
 759 | > FILEPATH: frontend/src/domains/meta/_shell/MetaLayout.tsx */
 760 | 
 761 | **Components & Logic:**
 762 | 
 763 | * **`MetaLayout`**
 764 | 
 765 | ---
 766 | ### ðŸ“„ `MetaRoot.tsx`
 767 | > Provides the MetaContext and persistent Layout Shell for the Meta Kernel.
 768 | 
 769 | **Components & Logic:**
 770 | 
 771 | * **`MetaRoot`**
 772 | 
 773 | ---
 774 | ### ðŸ“„ `MetaSidebar.tsx`
 775 | > High-density navigation for the System Configuration module.
 776 | 
 777 | | Attribute | Value |
 778 | | :--- | :--- |
 779 | | **updated** | `Added 'Cortex Studio' link. */` |
 780 | 
 781 | **Components & Logic:**
 782 | 
 783 | * **`MetaSidebar`**
 784 |   * **Logic Flow:**
 785 |     * `âš¡ PERSISTENCE`
 786 |     * `âš¡ SYSTEM LINK`
 787 |     * `âš¡ THE APP STORE`
 788 |     * `Import for Studio icon was missing in previous file provided, adding generic import if needed,`
 789 |     * `but sticking to icons available in imports above.`
 790 |     * `Wait, I missed AppstoreAddOutlined in the imports list above.`
 791 |     * `I will add it to the imports to be safe.`
 792 |     * `âš¡ RE-ADDING MISSING ICON IMPORT MANUALLY TO ENSURE SAFETY`
 793 | 
 794 | ---
 795 | ## ðŸ“‚ `frontend/src/domains/meta/components/`
 796 | 
 797 | ### ðŸ“„ `DomainTree.tsx`
 798 | > A hierarchical visual grid to select Domains. Supports nesting (Parent -> Child).
 799 | 
 800 | | Attribute | Value |
 801 | | :--- | :--- |
 802 | | **security-level** | `LEVEL 9 (Read-Only) */` |
 803 | 
 804 | **Components & Logic:**
 805 | 
 806 | * **`DomainTree`**
 807 |   * **Logic Flow:**
 808 |     * `âš¡ TOPOLOGY ENGINE: Build the Tree`
 809 |     * `1. Initialize Nodes`
 810 |     * `2. Link Parents & Children`
 811 |     * `If parent exists in the map, link it. Otherwise, treat as root.`
 812 |     * `3. Sort by Module then Label`
 813 |     * `âš¡ RENDERER: Recursive Node`
 814 |     * `Card Style`
 815 | 
 816 | ---
 817 | ### ðŸ“„ `RuleBuilder.tsx`
 818 | > FILEPATH: frontend/src/domains/meta/components/RuleBuilder.tsx */
 819 | 
 820 | **Components & Logic:**
 821 | 
 822 | * **`RuleBuilder`**
 823 |   * ðŸ“ *--- COMPONENT ---*
 824 |   * **Logic Flow:**
 825 |     * `1. Context Intelligence`
 826 |     * `2. Kernel Capabilities (Dynamic Introspection)`
 827 |     * `3. Form State`
 828 |     * `4. Logic State (Simplified Builder)`
 829 |     * `5. Effect State`
 830 |     * `--- HELPERS ---`
 831 |     * `Compile Visual Conditions to JMESPath String`
 832 | 
 833 | ---
 834 | ## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/`
 835 | 
 836 | ### ðŸ“„ `AppStudioView.tsx`
 837 | > Orchestrates Lobby, Canvas, and Brick Library. Passes Meta History to Editor.
 838 | 
 839 | | Attribute | Value |
 840 | | :--- | :--- |
 841 | | **security-level** | `LEVEL 9 (Deep Linking) */` |
 842 | 
 843 | **Components & Logic:**
 844 | 
 845 | * **`AppStudioView`**
 846 |   * **Logic Flow:**
 847 |     * `1. GLOBAL STATE (URL)`
 848 |     * `2. LOGIC HOOK (Actions & Screens List)`
 849 |     * `3. DERIVED STATE`
 850 |     * `4. DATA HOOK (Layout & Content)`
 851 |     * `We only fetch layout if we have an active screen`
 852 |     * `âš¡ NORMALIZE APPS FOR EDITOR`
 853 |     * `--- HANDLERS ---`
 854 |     * `âš¡ DND HANDLER (Delegated from Editor)`
 855 |     * `CASE A: Dropped on a ZONE`
 856 |     * `CASE B: Dropped on a FOLDER (Container)`
 857 |     * `âš¡ CONTEXT MENU HANDLER (The "Easy Way")`
 858 |     * `--- RENDER: LOBBY MODE ---`
 859 |     * `--- RENDER: EDITOR MODE ---`
 860 |     * `âš¡ INJECT HISTORY: Pass the meta from the layout response`
 861 | 
 862 | ---
 863 | ## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/components/`
 864 | 
 865 | ### ðŸ“„ `AppConfigurator.tsx`
 866 | > The Inspector. Now supports Parent/Child relationships with strict Container filtering.
 867 | 
 868 | | Attribute | Value |
 869 | | :--- | :--- |
 870 | | **security-level** | `LEVEL 9 (UI Safe) */` |
 871 | | **invariant** | `Must handle missing 'config' objects gracefully. Only nesting under CONTAINERS is allowed. */` |
 872 | 
 873 | **Components & Logic:**
 874 | 
 875 | * **`AppConfigurator`**
 876 |   * **Logic Flow:**
 877 |     * `âš¡ HIERARCHY LOGIC: Build Tree Options for Parent Selection`
 878 |     * `âš¡ STRICT FILTER: Only allow nesting under CONTAINERS in the SIDEBAR`
 879 |     * `FIX: Check both 'type' (Runtime) and 'scope_type' (Static) to ensure compatibility`
 880 |     * `âš¡ FIX: Safe access to config.label with fallbacks`
 881 |     * `ðŸ›¡ï¸ SAFE ACCESS`
 882 |     * `Identity`
 883 |     * `Placement & Hierarchy`
 884 |     * `Behavior (Polymorphic)`
 885 |     * `Security`
 886 |     * `âš¡ DYNAMIC FIELDS based on Brick Type`
 887 | 
 888 | ---
 889 | ### ðŸ“„ `AppStudioLobby.tsx`
 890 | > The "Welcome Screen" for the App Studio. Lists existing apps and allows creation.
 891 | 
 892 | | Attribute | Value |
 893 | | :--- | :--- |
 894 | | **security-level** | `LEVEL 9 (Read-Only List) */` |
 895 | | **invariant** | `Must display all available screens from the registry. */` |
 896 | 
 897 | **Components & Logic:**
 898 | 
 899 | * **`AppStudioLobby`**
 900 |   * **Logic Flow:**
 901 |     * `âš¡ GOVERNANCE FILTER: Hide screens locked by backend policy (mode='strict')`
 902 |     * `We strictly filter out any screen that claims to be "strict" in its security policy.`
 903 | 
 904 | ---
 905 | ### ðŸ“„ `BrickLibrary.tsx`
 906 | > The "Smart" Palette with Context Menu for instant placement.
 907 | 
 908 | | Attribute | Value |
 909 | | :--- | :--- |
 910 | | **security-level** | `LEVEL 9 (Safe Return) */` |
 911 | | **invariant** | `Must filter by text and type. Must handle empty data gracefully. */` |
 912 | | **updated** | `Fixed missing 'Space' import to prevent ReferenceError. */` |
 913 | 
 914 | **Components & Logic:**
 915 | 
 916 | * **`BrickLibrary`**
 917 |   * **Logic Flow:**
 918 |     * `âš¡ FILTER LOGIC`
 919 |     * `âš¡ GROUPING LOGIC`
 920 |     * `âš¡ CONTEXT MENU FACTORY`
 921 | 
 922 | ---
 923 | ### ðŸ“„ `CreateAppModal.tsx`
 924 | > A form to define the Identity (Name, Route, Purpose) of a new Application before it exists.
 925 | 
 926 | | Attribute | Value |
 927 | | :--- | :--- |
 928 | | **security-level** | `LEVEL 9 (Input Validation) */` |
 929 | | **invariant** | `Route Slug must be URL-safe (lowercase, hyphens). */` |
 930 | 
 931 | **Components & Logic:**
 932 | 
 933 | * **`CreateAppModal`**
 934 |   * **Logic Flow:**
 935 |     * `âš¡ AUTO-SLUG LOGIC`
 936 |     * `When title changes, auto-generate a slug if the user hasn't manually edited it.`
 937 |     * `Only auto-set if the slug field is pristine or matches the previous auto-gen`
 938 | 
 939 | ---
 940 | ### ðŸ“„ `DraggableBrick.tsx`
 941 | > A palette item that uses @dnd-kit to be compatible with the Screen Canvas.
 942 | 
 943 | | Attribute | Value |
 944 | | :--- | :--- |
 945 | | **security-level** | `LEVEL 9 (DND-Kit Integrated) */` |
 946 | | **invariant** | `Must pass 'brick' data to the drag context. */` |
 947 | 
 948 | **Components & Logic:**
 949 | 
 950 | * **`DraggableBrick`**
 951 |   * **Logic Flow:**
 952 |     * `âš¡ DND-KIT HOOK`
 953 | 
 954 | ---
 955 | ### ðŸ“„ `IconFactory.tsx`
 956 | > Renders icons from Token Strings. Supports 'antd:' prefix.
 957 | 
 958 | **Components & Logic:**
 959 | 
 960 | * **`IconFactory`**
 961 |   * **Logic Flow:**
 962 |     * `1. Handle Empty`
 963 |     * `2. Parse Token`
 964 |     * `3. Render Strategy: Ant Design`
 965 |     * `Fallback`
 966 | 
 967 | ---
 968 | ### ðŸ“„ `IconPicker.tsx`
 969 | > Visual grid for selecting icons. Dynamically loads entire Ant Design library.
 970 | 
 971 | **Components & Logic:**
 972 | 
 973 | * **`IconPicker`**
 974 |   * **Logic Flow:**
 975 |     * `âš¡ SEARCH ENGINE: Filters 800+ icons instantly`
 976 | 
 977 | ---
 978 | ### ðŸ“„ `ScreenCanvas.tsx`
 979 | > Renders the Application Wireframe with nested Container support.
 980 | 
 981 | | Attribute | Value |
 982 | | :--- | :--- |
 983 | | **security-level** | `LEVEL 9 (UI Safe) */` |
 984 | | **invariant** | `Must visually represent the layout structure accurately, including hierarchy. */` |
 985 | 
 986 | **Components & Logic:**
 987 | 
 988 | * **`ScreenCanvas`**
 989 | 
 990 | ---
 991 | ### ðŸ“„ `StudioEditor.tsx`
 992 | > The full-screen IDE interface. Displays Version History in Header.
 993 | 
 994 | | Attribute | Value |
 995 | | :--- | :--- |
 996 | | **security-level** | `LEVEL 9 (UI Partition) */` |
 997 | | **narrator** | `ðŸ•µï¸ TELEMETRY + VERSIONING ENABLED */` |
 998 | 
 999 | **Components & Logic:**
1000 | 
1001 | * **`StudioEditor`**
1002 |   * **Logic Flow:**
1003 |     * `ðŸ•µï¸ TELEMETRY`
1004 |     * `âš¡ PUBLISH STATE`
1005 |     * `âš¡ SEMVER CALCULATOR`
1006 |     * `âš¡ FIX: Pass the user-edited version string`
1007 | 
1008 | ---
1009 | ## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/hooks/`
1010 | 
1011 | ### ðŸ“„ `useAppStudio.ts`
1012 | > Manages IDE Actions. Updates 'publishApp' to support explicit version labels.
1013 | 
1014 | | Attribute | Value |
1015 | | :--- | :--- |
1016 | | **security-level** | `LEVEL 9 (Direct Fetch Implementation) */` |
1017 | 
1018 | **Components & Logic:**
1019 | 
1020 | * **`useAppStudio`**
1021 |   * **Logic Flow:**
1022 |     * `1. DATA (Bricks Only - Workspace is managed by View)`
1023 |     * `Normalize Library Data`
1024 |     * `2. STATE`
1025 |     * `âš¡ HELPER: Direct Fetcher`
1026 |     * `âš¡ ACTION: Fetch Screens List (With Race Condition Fix)`
1027 |     * `3. ACTIONS`
1028 |     * `âš¡ FIX: Accept versionLabel explicitly`
1029 | 
1030 | ---
1031 | ## ðŸ“‚ `frontend/src/domains/meta/features/app_studio/`
1032 | 
1033 | ### ðŸ“„ `index.ts`
1034 | > Exports the main view. Used by the Router.
1035 | 
1036 | ---
1037 | ### ðŸ“„ `types.ts`
1038 | > Added 'Release' interface for version history.
1039 | 
1040 | **Components & Logic:**
1041 | 
1042 | * **`BrickType`**
1043 |   * ðŸ“ *Added 'Release' interface for version history.*
1044 | * **`SystemBrick`**
1045 |   * **Logic Flow:**
1046 |     * `2. THE SCREEN`
1047 | * **`Screen`**
1048 |   * ðŸ“ *2. THE SCREEN*
1049 |   * **Logic Flow:**
1050 |     * `3. THE APP`
1051 | * **`ActiveApp`**
1052 |   * ðŸ“ *3. THE APP*
1053 |   * **Logic Flow:**
1054 |     * `âš¡ NEW: RELEASE HISTORY`
1055 | * **`Release`**
1056 |   * ðŸ“ *âš¡ NEW: RELEASE HISTORY*
1057 | * **`ZoneType`**
1058 | * **`DragItem`**
1059 | 
1060 | ---
1061 | ## ðŸ“‚ `frontend/src/domains/meta/features/cortex/`
1062 | 
1063 | ### ðŸ“„ `CortexView.tsx`
1064 | > Standalone view for the AI Architect.
1065 | 
1066 | | Attribute | Value |
1067 | | :--- | :--- |
1068 | | **updated** | `Added Domain Picker and Back Navigation to the Active Toolbar. */` |
1069 | 
1070 | **Components & Logic:**
1071 | 
1072 | * **`CortexView`**
1073 | 
1074 | ---
1075 | ## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/`
1076 | 
1077 | ### ðŸ“„ `DictionaryView.tsx`
1078 | > Master Controller. Fixes 'config' vs 'configuration' crash and Layout Regressions.
1079 | 
1080 | | Attribute | Value |
1081 | | :--- | :--- |
1082 | | **security-level** | `LEVEL 9 (UI Safe) */` |
1083 | 
1084 | **Components & Logic:**
1085 | 
1086 | * **`DictionaryView`**
1087 |   * **Logic Flow:**
1088 |     * `1. GLOBAL CONTEXT`
1089 |     * `Sync URL -> Context`
1090 |     * `2. FEATURE LOGIC`
1091 |     * `Local UI State`
1092 |     * `3. HANDLERS`
1093 |     * `4. COMPUTED: Safe Data Resolution`
1094 |     * `âš¡ CONTRACT FIX: Ensure we map DB config to 'configuration'`
1095 |     * `Return Fresh Draft for "New" mode`
1096 |     * `âš¡ SECURITY CHECK: Is this a System Field?`
1097 |     * `âš¡ STATE: Are we in "New Mode"?`
1098 |     * `--- RENDER: STATE A (LOBBY) ---`
1099 |     * `--- RENDER: STATE B (MASTER-DETAIL EDITOR) ---`
1100 | 
1101 | ---
1102 | ## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/components/`
1103 | 
1104 | ### ðŸ“„ `AttributeEditor.tsx`
1105 | > The Master Controller for editing Attributes. Uses 'configuration' correctly.
1106 | 
1107 | | Attribute | Value |
1108 | | :--- | :--- |
1109 | | **security-level** | `LEVEL 9 (UI Safe) */` |
1110 | 
1111 | **Components & Logic:**
1112 | 
1113 | * **`AttributeEditor`**
1114 |   * **Logic Flow:**
1115 |     * `âš¡ SYNC: Update local state if parent selection changes`
1116 |     * `âš¡ LOGIC: Auto-switch widget if data type changes`
1117 |     * `âš¡ CONTRACT FIX: Updates 'configuration', NOT 'config'`
1118 |     * `We allow config updates even if locked, generally (e.g. placeholder)`
1119 |     * `but maybe not logic. For now, allow it.`
1120 |     * `âš¡ LOGIC: Auto-Slugify`
1121 |     * `Label is editable even if locked (usually)`
1122 |     * `Widget CAN change usually, unless strict`
1123 |     * `âš¡ CRITICAL FIX: Pass 'configuration', not 'config'`
1124 | 
1125 | ---
1126 | ### ðŸ“„ `AttributeExplorer.tsx`
1127 | > Navigable list of Domain Attributes.
1128 | 
1129 | **Components & Logic:**
1130 | 
1131 | * **`AttributeExplorer`**
1132 |   * **Logic Flow:**
1133 |     * `ðŸ§  SMART SORTING`
1134 |     * `âš¡ FIX: Use 'key' (string) instead of 'id' (number) for uniqueness`
1135 |     * `System fields all have ID 0, which caused Duplicate Key errors.`
1136 | 
1137 | ---
1138 | ### ðŸ“„ `DomainPicker.tsx`
1139 | > A visual grid to select which Domain Schema to edit.
1140 | 
1141 | | Attribute | Value |
1142 | | :--- | :--- |
1143 | | **updated** | `Fixed visual overlap by switching to Vertical Layout. Increased Card Size. */` |
1144 | 
1145 | **Components & Logic:**
1146 | 
1147 | * **`DomainPicker`**
1148 |   * **Logic Flow:**
1149 |     * `âš¡ RENDERER: Capability Popover Content`
1150 |     * `Governance Check`
1151 |     * `Visual States`
1152 | 
1153 | ---
1154 | ## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/components/editor/`
1155 | 
1156 | ### ðŸ“„ `ConfigPanels.tsx`
1157 | > Fractal sub-component for handling Type-Specific settings. CRASH PROOFED.
1158 | 
1159 | **Components & Logic:**
1160 | 
1161 | * **`ConfigPanels`**
1162 |   * **Logic Flow:**
1163 |     * `âš¡ CRASH GUARD: Ensure we have an object to read from [cite: 1090]`
1164 |     * `--- 1. NUMBER CONFIGURATION ---`
1165 |     * `--- 2. TEXT CONFIGURATION ---`
1166 |     * `--- 3. SELECTION CONFIGURATION ---`
1167 |     * `--- 4. DATE / DATETIME ---`
1168 |     * `--- 5. REFERENCE (COMPLEX) ---`
1169 |     * `--- 6. FILE ---`
1170 | 
1171 | ---
1172 | ### ðŸ“„ `PreviewPanel.tsx`
1173 | > FILEPATH: frontend/src/domains/meta/features/dictionary/components/editor/PreviewPanel.tsx */
1174 | 
1175 | **Components & Logic:**
1176 | 
1177 | * **`PreviewPanel`**
1178 |   * **Logic Flow:**
1179 |     * `--- TEXT WIDGETS ---`
1180 |     * `--- NUMBER WIDGETS ---`
1181 |     * `--- SELECTION WIDGETS ---`
1182 |     * `--- DATE WIDGETS ---`
1183 |     * `--- BOOLEAN WIDGETS ---`
1184 |     * `--- FILE WIDGETS ---`
1185 |     * `--- COMPLEX WIDGETS ---`
1186 |     * `Fallback`
1187 | 
1188 | ---
1189 | ## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/hooks/`
1190 | 
1191 | ### ðŸ“„ `useDictionary.ts`
1192 | > FILEPATH: frontend/src/domains/meta/features/dictionary/hooks/useDictionary.ts */
1193 | 
1194 | **Components & Logic:**
1195 | 
1196 | * **`useDictionary`**
1197 |   * **Logic Flow:**
1198 |     * `1. FETCH ATTRIBUTES`
1199 |     * `âš¡ GATEWAY: Use standardized base`
1200 |     * `2. SAVE (CREATE / UPDATE)`
1201 |     * `Update Existing`
1202 |     * `Create New`
1203 |     * `3. DELETE`
1204 |     * `Data`
1205 |     * `Actions`
1206 |     * `State`
1207 | 
1208 | ---
1209 | ## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/logic/`
1210 | 
1211 | ### ðŸ“„ `schemaNormalizer.ts`
1212 | > FILEPATH: frontend/src/domains/meta/features/dictionary/logic/schemaNormalizer.ts */
1213 | 
1214 | **Components & Logic:**
1215 | 
1216 | * **`normalizeSchema`**
1217 |   * **Logic Flow:**
1218 |     * `Scenario A: It's already an Array`
1219 |     * `Scenario B: It's a Hybrid Schema Object`
1220 |     * `Check possible containers`
1221 | 
1222 | ---
1223 | ## ðŸ“‚ `frontend/src/domains/meta/features/dictionary/types/`
1224 | 
1225 | ### ðŸ“„ `constants.ts`
1226 | > FILEPATH: frontend/src/domains/meta/features/dictionary/types/constants.ts */
1227 | 
1228 | **Components & Logic:**
1229 | 
1230 | * **`AttributeType`**
1231 |   * ðŸ“ *Values that EXIST at runtime (Enums, Objects).*
1232 | * **`WidgetType`**
1233 |   * **Logic Flow:**
1234 |     * `Text`
1235 |     * `Numeric`
1236 |     * `Choice`
1237 |     * `Boolean`
1238 |     * `Date`
1239 |     * `Advanced`
1240 |     * `ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type`
1241 | * **`WIDGET_COMPATIBILITY`**
1242 |   * ðŸ“ *ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type*
1243 |   * **Logic Flow:**
1244 |     * `ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions`
1245 | * **`HELP_TEXT`**
1246 |   * ðŸ“ *ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions*
1247 | * **`DEFAULT_DRAFT_CONFIG`**
1248 | 
1249 | ---
1250 | ### ðŸ“„ `index.ts`
1251 | > FILEPATH: frontend/src/domains/meta/features/dictionary/types/index.ts */
1252 | 
1253 | **Components & Logic:**
1254 | 
1255 | * **`DEFAULT_DRAFT`**
1256 |   * ðŸ“ *3. Default Constant*
1257 | 
1258 | ---
1259 | ### ðŸ“„ `types.ts`
1260 | > FILEPATH: frontend/src/domains/meta/features/dictionary/types/types.ts */
1261 | 
1262 | **Components & Logic:**
1263 | 
1264 | * **`SelectOption`**
1265 | * **`AttributeConfig`**
1266 |   * **Logic Flow:**
1267 |     * `Text`
1268 |     * `Number`
1269 |     * `Date`
1270 |     * `Options`
1271 |     * `Reference`
1272 |     * `File`
1273 |     * `JSON`
1274 |     * `General`
1275 | * **`AttributeDefinition`**
1276 | * **`AttributeDraft`**
1277 | 
1278 | ---
1279 | ## ðŸ“‚ `frontend/src/domains/meta/features/governance/`
1280 | 
1281 | ### ðŸ“„ `GovernanceView.tsx`
1282 | > The Master Controller for the Rule Engine.
1283 | 
1284 | **Components & Logic:**
1285 | 
1286 | * **`GovernanceView`**
1287 |   * **Logic Flow:**
1288 |     * `1. GLOBAL CONTEXT (The Session)`
1289 |     * `âš¡ GLOBAL STATE: Deep Linking`
1290 |     * `Local UI State (Transient)`
1291 |     * `2. LOGIC (Only runs if domain is selected)`
1292 |     * `3. HANDLERS`
1293 |     * `4. COMPUTED`
1294 |     * `--- RENDER: STATE A (LOBBY) ---`
1295 |     * `--- RENDER: STATE B (EDITOR) ---`
1296 | 
1297 | ---
1298 | ## ðŸ“‚ `frontend/src/domains/meta/features/governance/components/`
1299 | 
1300 | ### ðŸ“„ `JmesPathHelp.tsx`
1301 | > FILEPATH: frontend/src/domains/meta/features/governance/components/JmesPathHelp.tsx */
1302 | 
1303 | **Components & Logic:**
1304 | 
1305 | * **`JmesPathHelp`**
1306 |   * **Logic Flow:**
1307 |     * `--- CONTENT DATA ---`
1308 |     * `--- RENDERERS ---`
1309 | 
1310 | ---
1311 | ### ðŸ“„ `PolicyEditor.tsx`
1312 | > Advanced Policy Editor with Multi-Vector Consequence Stacks.
1313 | 
1314 | | Attribute | Value |
1315 | | :--- | :--- |
1316 | | **security-level** | `LEVEL 9 (UI Validation) */` |
1317 | 
1318 | **Components & Logic:**
1319 | 
1320 | * **`PolicyEditor`**
1321 |   * **Logic Flow:**
1322 |     * `âš¡ HYDRATED DATA SOURCE`
1323 |     * `--- HANDLERS ---`
1324 |     * `âš¡ AUTO-KEY GENERATION`
1325 |     * `Only auto-generate key if it's a NEW policy (no ID) to avoid breaking existing bindings`
1326 |     * `âš¡ MULTI-CONSEQUENCE MANAGEMENT`
1327 |     * `--- RENDER HELPERS ---`
1328 | 
1329 | ---
1330 | ### ðŸ“„ `PolicyExplorer.tsx`
1331 | > FILEPATH: frontend/src/domains/meta/features/governance/components/PolicyExplorer.tsx */
1332 | 
1333 | **Components & Logic:**
1334 | 
1335 | * **`PolicyExplorer`**
1336 |   * **Logic Flow:**
1337 |     * `Helper to format v1.05`
1338 |     * `Default to v1.00 if missing (legacy data)`
1339 |     * `âš¡ SHOW VERSION`
1340 | 
1341 | ---
1342 | ## ðŸ“‚ `frontend/src/domains/meta/features/governance/components/editor/`
1343 | 
1344 | ### ðŸ“„ `EnforcementPanel.tsx`
1345 | > FILEPATH: frontend/src/domains/meta/features/governance/components/editor/EnforcementPanel.tsx */
1346 | 
1347 | **Components & Logic:**
1348 | 
1349 | * **`EnforcementPanel`**
1350 |   * **Logic Flow:**
1351 |     * `Filter bindings for *this* policy`
1352 |     * `State for New Binding`
1353 | 
1354 | ---
1355 | ### ðŸ“„ `HistoryDrawer.tsx`
1356 | > FILEPATH: frontend/src/domains/meta/features/governance/components/editor/HistoryDrawer.tsx */
1357 | 
1358 | **Components & Logic:**
1359 | 
1360 | * **`HistoryDrawer`**
1361 |   * **Logic Flow:**
1362 |     * `âš¡ GATEWAY: Use standardized base`
1363 |     * `âš¡ FIX: Use the Hook-based Modal, not the Static one`
1364 | 
1365 | ---
1366 | ### ðŸ“„ `LogicBuilder.tsx`
1367 | > Recursive Subject-Verb-Object Composer for Governance Rules.
1368 | 
1369 | **Components & Logic:**
1370 | 
1371 | * **`LogicBuilder`**
1372 |   * **Logic Flow:**
1373 |     * `1. STATE`
1374 |     * `2. PARSER (Simulated for this iteration - usually requires AST)`
1375 |     * `We default to Code Mode if we detect complex logic we can't parse yet.`
1376 |     * `Simple heuristic: If it looks like a flat tree, try to load it.`
1377 |     * `For Level 100 SVO, we assume new rules start empty or simple.`
1378 |     * `If complex, we stay in code mode.`
1379 |     * `3. COMPILER (Tree -> JMESPath)`
1380 |     * `RULE`
1381 |     * `4. HANDLERS`
1382 |     * `Find parent and push child`
1383 |     * `--- RENDERERS ---`
1384 |     * `RULE (Leaf)`
1385 | 
1386 | ---
1387 | ### ðŸ“„ `TestPanel.tsx`
1388 | > FILEPATH: frontend/src/domains/meta/features/governance/components/editor/TestPanel.tsx */
1389 | 
1390 | **Components & Logic:**
1391 | 
1392 | * **`TestPanel`**
1393 |   * **Logic Flow:**
1394 |     * `Default mock data based on standard "host" envelope`
1395 | 
1396 | ---
1397 | ## ðŸ“‚ `frontend/src/domains/meta/features/governance/components/editor/logic/`
1398 | 
1399 | ### ðŸ“„ `SubjectPicker.tsx`
1400 | > Smart Context Selector with Lazy Loading, Module Grouping, and State Hydration.
1401 | 
1402 | | Attribute | Value |
1403 | | :--- | :--- |
1404 | | **security-level** | `LEVEL 9 (Data Access) */` |
1405 | 
1406 | **Components & Logic:**
1407 | 
1408 | * **`SubjectPicker`**
1409 |   * **Logic Flow:**
1410 |     * `âš¡ STATE HYDRATION: Restore tab and domain from existing value`
1411 |     * `Check known roots`
1412 |     * `Assume Global Domain (e.g., "user.email" -> Domain "USER")`
1413 |     * `Ensure it's not one of our reserved keywords`
1414 |     * `âš¡ LAZY LOAD: Global Domain List`
1415 |     * `âš¡ DATA TRANSFORM: Group Domains by Module`
1416 |     * `âš¡ LAZY LOAD: Specific Domain Schema`
1417 |     * `--- RENDERERS ---`
1418 | 
1419 | ---
1420 | ## ðŸ“‚ `frontend/src/domains/meta/features/governance/hooks/`
1421 | 
1422 | ### ðŸ“„ `useGovernance.ts`
1423 | > Manages Policy State and Fuses Domain Schema with System Context.
1424 | 
1425 | | Attribute | Value |
1426 | | :--- | :--- |
1427 | | **security-level** | `LEVEL 9 (Schema Fusion)` |
1428 | | **updated** | `Aligned API calls with generated OpenAPI SDK. Preserved Delete logic.` |
1429 | 
1430 | **Components & Logic:**
1431 | 
1432 | * **`useGovernance`**
1433 |   * **Logic Flow:**
1434 |     * `1. FETCH POLICIES (The Law)`
1435 |     * `âš¡ FIX: Use generated SDK name`
1436 |     * `2. FETCH FUSED SCHEMA (The Vocabulary)`
1437 |     * `âš¡ LEVEL 100: Context Fusion`
1438 |     * `The API returns the "Fused" schema (Static + Dynamic + Context)`
1439 |     * `âš¡ FIX: Use generated SDK name`
1440 |     * `3. CREATE POLICY`
1441 |     * `âš¡ FIX: Use generated SDK name`
1442 |     * `4. UPDATE POLICY`
1443 |     * `âš¡ FIX: Use generated SDK name`
1444 |     * `5. DELETE POLICY (Restored)`
1445 |     * `âš¡ FIX: Use 'any' cast if SDK signature varies, but call correct delete endpoint`
1446 |     * `Assuming standard naming pattern from codegen`
1447 |     * `6. DRY RUN`
1448 |     * `âš¡ FIX: Use generated SDK name`
1449 |     * `Data`
1450 |     * `Actions`
1451 |     * `State`
1452 | 
1453 | ---
1454 | ### ðŸ“„ `usePolicyBindings.ts`
1455 | > FILEPATH: frontend/src/domains/meta/features/governance/hooks/usePolicyBindings.ts */
1456 | 
1457 | **Components & Logic:**
1458 | 
1459 | * **`PolicyBinding`**
1460 | * **`PolicyBindingDraft`**
1461 | * **`usePolicyBindings`**
1462 |   * **Logic Flow:**
1463 |     * `1. FETCH BINDINGS`
1464 |     * `2. CREATE BINDING`
1465 |     * `3. TOGGLE/UPDATE BINDING`
1466 |     * `4. DELETE BINDING`
1467 | 
1468 | ---
1469 | ## ðŸ“‚ `frontend/src/domains/meta/features/governance/types/`
1470 | 
1471 | ### ðŸ“„ `index.ts`
1472 | > Contracts for Policy Management and Logic Building.
1473 | 
1474 | | Attribute | Value |
1475 | | :--- | :--- |
1476 | | **security-level** | `LEVEL 9 (Type Safety) */` |
1477 | 
1478 | **Components & Logic:**
1479 | 
1480 | * **`Consequence`**
1481 |   * ðŸ“ *--- CONSEQUENCES (The Verdicts) ---*
1482 |   * **Logic Flow:**
1483 |     * `--- RULES ---`
1484 | * **`Rule`**
1485 |   * ðŸ“ *--- RULES ---*
1486 |   * **Logic Flow:**
1487 |     * `âš¡ ENTERPRISE UPGRADE: Multi-Vector Consequences`
1488 |     * `Metadata`
1489 |     * `--- POLICIES ---`
1490 | * **`Policy`**
1491 |   * ðŸ“ *--- POLICIES ---*
1492 |   * **Logic Flow:**
1493 |     * `Ledger Metadata`
1494 | * **`PolicyDraft`**
1495 | * **`DEFAULT_POLICY_DRAFT`**
1496 |   * **Logic Flow:**
1497 |     * `--- SCHEMA REFLECTION (For Dropdowns) ---`
1498 | * **`SelectOption`**
1499 |   * ðŸ“ *--- SCHEMA REFLECTION (For Dropdowns) ---*
1500 | * **`SchemaField`**
1501 |   * **Logic Flow:**
1502 |     * `âš¡ GROUPING: For the Omni-Picker`
1503 |     * `--- SIMULATION ---`
1504 | * **`DryRunRequest`**
1505 |   * ðŸ“ *--- SIMULATION ---*
1506 | * **`DryRunResult`**
1507 | 
1508 | ---
1509 | ## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/`
1510 | 
1511 | ### ðŸ“„ `PolicyGroupsView.tsx`
1512 | > Main view for managing Policy Bundles (Groups).
1513 | 
1514 | **Components & Logic:**
1515 | 
1516 | * **`PolicyGroupsView`**
1517 |   * **Logic Flow:**
1518 |     * `1. GLOBAL CONTEXT (Editor State via ?select=...)`
1519 |     * `2. UNIVERSAL URL STATE (View State)`
1520 |     * `3. Data`
1521 |     * `4. Computed (Filter)`
1522 |     * `--- COMPUTED EDITOR STATE ---`
1523 |     * `--- ACTIONS ---`
1524 |     * `--- TABLE COLUMNS ---`
1525 | 
1526 | ---
1527 | ## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/components/`
1528 | 
1529 | ### ðŸ“„ `GroupEditor.tsx`
1530 | > FILEPATH: frontend/src/domains/meta/features/policy_groups/components/GroupEditor.tsx */
1531 | 
1532 | **Components & Logic:**
1533 | 
1534 | * **`GroupEditor`**
1535 |   * **Logic Flow:**
1536 |     * `âš¡ AUTO-CAPS HANDLER`
1537 |     * `Validation failed`
1538 | 
1539 | ---
1540 | ## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/hooks/`
1541 | 
1542 | ### ðŸ“„ `usePolicyGroups.ts`
1543 | > FILEPATH: frontend/src/domains/meta/features/policy_groups/hooks/usePolicyGroups.ts */
1544 | 
1545 | **Components & Logic:**
1546 | 
1547 | * **`usePolicyGroups`**
1548 |   * **Logic Flow:**
1549 |     * `1. FETCH GROUPS`
1550 |     * `2. CREATE GROUP`
1551 |     * `3. UPDATE GROUP`
1552 |     * `4. DELETE GROUP`
1553 | 
1554 | ---
1555 | ## ðŸ“‚ `frontend/src/domains/meta/features/policy_groups/`
1556 | 
1557 | ### ðŸ“„ `types.ts`
1558 | > FILEPATH: frontend/src/domains/meta/features/policy_groups/types.ts */
1559 | 
1560 | **Components & Logic:**
1561 | 
1562 | * **`PolicyGroup`**
1563 |   * ðŸ“ *TypeScript interfaces for Policy Bundles.*
1564 |   * **Logic Flow:**
1565 |     * `The ordered list of policy keys to execute`
1566 | * **`GroupDraft`**
1567 | * **`DEFAULT_GROUP_DRAFT`**
1568 | 
1569 | ---
1570 | ## ðŸ“‚ `frontend/src/domains/meta/features/runner/`
1571 | 
1572 | ### ðŸ“„ `RunnerView.tsx`
1573 | > The "Launchpad" for Business Processes.
1574 | 
1575 | **Components & Logic:**
1576 | 
1577 | * **`RunnerView`**
1578 |   * **Logic Flow:**
1579 |     * `1. UNIVERSAL URL STATE (Search Persistence)`
1580 |     * `2. DISCOVERY ENGINE`
1581 |     * `Flatten the Domain->Scope hierarchy into a list of "Apps"`
1582 |     * `âš¡ FILTER: Only show Wizards (Interactive Processes)`
1583 |     * `3. ROUTING LOGIC`
1584 |     * `4. RENDER: RUNTIME HOST (The Overlay)`
1585 |     * `5. RENDER: DASHBOARD (The Grid)`
1586 | 
1587 | ---
1588 | ### ðŸ“„ `RuntimeHost.tsx`
1589 | > The "Focus Mode" container for running a Wizard.
1590 | 
1591 | **Components & Logic:**
1592 | 
1593 | * **`RuntimeHost`**
1594 |   * **Logic Flow:**
1595 |     * `1. RESOLVE CONTEXT (Metadata)`
1596 | 
1597 | ---
1598 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/`
1599 | 
1600 | ### ðŸ“„ `StatesView.tsx`
1601 | > The Orchestrator for State Machines. Uses Tree Topology for Navigation.
1602 | 
1603 | | Attribute | Value |
1604 | | :--- | :--- |
1605 | | **security-level** | `LEVEL 9 (UI Safe) */` |
1606 | 
1607 | **Components & Logic:**
1608 | 
1609 | * **`StatesView`**
1610 |   * **Logic Flow:**
1611 |     * `1. GLOBAL CONTEXT (Deep Linking for Selection)`
1612 |     * `Resolve active state from context (Handle DEFAULT case)`
1613 |     * `2. UNIVERSAL URL STATE (Persistence)`
1614 |     * `Sync URL -> Context`
1615 |     * `âš¡ NODE SYNC: If URL has node, sync to context. If URL has NO node, clear context.`
1616 |     * `We use '' to represent no selection in the URL, effectively null`
1617 |     * `3. DATA LOADING`
1618 |     * `We only fetch workflows if a domain is selected`
1619 |     * `4. Local UI State (Transient)`
1620 |     * `Auto-open right panel if we have a deep link selection`
1621 |     * `Effect: Keep right panel sync with selection`
1622 |     * `If panel closed but item selected, deselect item (two-way bind)`
1623 |     * `Clean URL`
1624 |     * `5. Data Hooks`
1625 |     * `Find the definition for the selected scope`
1626 |     * `âš¡ HELPER: Resolve Workflow Type Logic`
1627 |     * `We need to know if this is a WIZARD, JOB, or GOVERNANCE flow to render the right tools.`
1628 |     * `A. Check Registry`
1629 |     * `B. Check Metadata`
1630 |     * `C. Fallback`
1631 |     * `âš¡ SMART TYPE RESOLUTION`
1632 |     * `Some keys might be "WIZARD" (Backend enum) vs "WIZARD_FLOW" (UI Constant)`
1633 |     * `We normalize here.`
1634 |     * `âš¡ FILTERED LIST`
1635 |     * `6. Session Manager`
1636 |     * `Manages the "Draft" state vs "Live" state`
1637 |     * `7. Navigation Guard`
1638 |     * `Close panels`
1639 |     * `If we have a domain but no scope selected,`
1640 |     * `AND we have workflows, maybe auto-select the first one?`
1641 |     * `No, better to show a list/gallery view.`
1642 |     * `Optional: Auto-select first?`
1643 |     * `handleSelectWorkflow(workflows[0].scope_key);`
1644 |     * `Sync Reset (If scope invalid for domain)`
1645 |     * `Only reset if we are sure it's loaded and truly missing`
1646 |     * `selectScope(''); // Commented out to prevent flash resets during load`
1647 |     * `Canvas Update`
1648 |     * `Sync URL for F5 safety`
1649 |     * `--- RENDER: STATE A (LOBBY) ---`
1650 |     * `âš¡ REFACTOR: Use DomainTree instead of Flat Picker`
1651 |     * `--- RENDER: STATE B (WORKFLOW GALLERY) ---`
1652 | 
1653 | ---
1654 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/`
1655 | 
1656 | ### ðŸ“„ `CodeEditorDrawer.tsx`
1657 | > FILEPATH: frontend/src/domains/meta/features/states/components/CodeEditorDrawer.tsx */
1658 | 
1659 | **Components & Logic:**
1660 | 
1661 | * **`CodeEditorDrawer`**
1662 |   * **Logic Flow:**
1663 |     * `Sync when opening or when definition changes externally`
1664 |     * `Basic Schema Check to prevent graph crashes`
1665 | 
1666 | ---
1667 | ### ðŸ“„ `DomainPicker.tsx`
1668 | > FILEPATH: frontend/src/domains/meta/features/states/components/DomainPicker.tsx */
1669 | 
1670 | **Components & Logic:**
1671 | 
1672 | * **`DomainPicker`**
1673 |   * **Logic Flow:**
1674 |     * `âš¡ SAFETY: Ensure we have an array`
1675 |     * `Only block with spinner if we have NO data to show`
1676 |     * `Fix for AntD v5 style warning`
1677 | 
1678 | ---
1679 | ### ðŸ“„ `EditorToolbar.tsx`
1680 | > The Control Deck for the Workflow Editor.
1681 | 
1682 | | Attribute | Value |
1683 | | :--- | :--- |
1684 | | **security-level** | `LEVEL 9 (UI Safe Guards)` |
1685 | | **invariant** | `Delete button only visible in VIEW mode.` |
1686 | | **fix** | `Changed Edit icon to 'EditOutlined'. Added z-index.` |
1687 | 
1688 | **Components & Logic:**
1689 | 
1690 | * **`EditorToolbar`**
1691 | 
1692 | ---
1693 | ### ðŸ“„ `EventRegistryModal.tsx`
1694 | > FILEPATH: frontend/src/domains/meta/features/states/components/EventRegistryModal.tsx */
1695 | 
1696 | **Components & Logic:**
1697 | 
1698 | * **`EventRegistryModal`**
1699 |   * **Logic Flow:**
1700 |     * `âš¡ MOCK DEFAULT EVENTS (In production, fetch from CapabilitiesContext)`
1701 |     * `Merge system defaults with any custom ones passed in`
1702 |     * `Deduplicate by key`
1703 |     * `Simple creation logic for now - just returns the uppercase search text`
1704 |     * `Hover effect handled via CSS or inline mouse events if needed`
1705 | 
1706 | ---
1707 | ### ðŸ“„ `FlowCanvas.tsx`
1708 | > Provides the ReactFlow surface.
1709 | 
1710 | | Attribute | Value |
1711 | | :--- | :--- |
1712 | | **security-level** | `LEVEL 9 (UI Invariant)` |
1713 | | **invariant** | `NodeTypes must be Memoized. Wrapper must be 100% Width/Height.` |
1714 | | **narrator** | `Logs layout recalculations.` |
1715 | 
1716 | **Components & Logic:**
1717 | 
1718 | * **`FlowCanvas`**
1719 |   * **Logic Flow:**
1720 |     * `âš¡ CRITICAL FIX: Provider wraps everything`
1721 | 
1722 | ---
1723 | ### ðŸ“„ `InspectorPanel.tsx`
1724 | > The Right-Hand Panel that decides WHICH tools to show.
1725 | 
1726 | **Components & Logic:**
1727 | 
1728 | * **`InspectorPanel`**
1729 |   * ðŸ“ *The Inspector Panel handles the contextual editing of Nodes, Edges, and Workflow Properties.*
1730 |   * **Logic Flow:**
1731 |     * `âš¡ PERSISTENT TAB STATE`
1732 |     * `"config" or "json"`
1733 |     * `âš¡ FETCH REAL DB CONTEXT`
1734 |     * `âš¡ FETCH WIDGET REGISTRY (Safe Access)`
1735 |     * `âš¡ FIX: Use 'allWidgets' directly. The hook returns an array, not a Map 'registry'.`
1736 |     * `Resolve Node Data`
1737 |     * `âš¡ POLYMORPHIC RESOLUTION`
1738 |     * `Deep update the node data`
1739 |     * `Update parent`
1740 |     * `âš¡ APPEND FIELDS (Don't Overwrite)`
1741 |     * `Persist Update`
1742 |     * `Deep update parent structure to ensure React Flow sees the change`
1743 |     * `For Generic/Governance, maybe append to description?`
1744 |     * `Implementation for future expansion`
1745 | 
1746 | ---
1747 | ### ðŸ“„ `NodeCard.tsx`
1748 | > FILEPATH: frontend/src/domains/meta/features/states/components/NodeCard.tsx */
1749 | 
1750 | **Components & Logic:**
1751 | 
1752 | * **`NodeCard`**
1753 |   * **Logic Flow:**
1754 |     * `âš¡ START NODE STYLING`
1755 |     * `ðŸŽ¨ Dynamic Styling based on Selection`
1756 | 
1757 | ---
1758 | ### ðŸ“„ `OSExplorerModal.tsx`
1759 | > FILEPATH: frontend/src/domains/meta/features/states/components/OSExplorerModal.tsx */
1760 | 
1761 | **Components & Logic:**
1762 | 
1763 | * **`OSExplorerModal`**
1764 |   * **Logic Flow:**
1765 |     * `Safe access`
1766 |     * `âš¡ DATA TRANSFORMATION: Registry -> AntD Tree Data`
1767 |     * `Mock fields for visual feedback`
1768 |     * `âš¡ FILTER LOGIC`
1769 | 
1770 | ---
1771 | ### ðŸ“„ `WorkflowGenesis.tsx`
1772 | > FILEPATH: frontend/src/domains/meta/features/states/components/WorkflowGenesis.tsx */
1773 | 
1774 | **Components & Logic:**
1775 | 
1776 | * **`WorkflowGenesis`**
1777 |   * **Logic Flow:**
1778 |     * `Default: Governance`
1779 |     * `âš¡ FIX: Removed aggressive maxHeight/overflow on body.`
1780 |     * `AntD handles this natively better.`
1781 |     * `âš¡ CONSTANT DRIVEN OPTIONS`
1782 | 
1783 | ---
1784 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/canvas/`
1785 | 
1786 | ### ðŸ“„ `CanvasPalette.tsx`
1787 | > FILEPATH: frontend/src/domains/meta/features/states/components/canvas/CanvasPalette.tsx */
1788 | 
1789 | **Components & Logic:**
1790 | 
1791 | * **`CanvasPalette`**
1792 | 
1793 | ---
1794 | ### ðŸ“„ `FloatingToolbar.tsx`
1795 | > FILEPATH: frontend/src/domains/meta/features/states/components/canvas/FloatingToolbar.tsx */
1796 | 
1797 | **Components & Logic:**
1798 | 
1799 | * **`FloatingToolbar`**
1800 | 
1801 | ---
1802 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/canvas/nodes/`
1803 | 
1804 | ### ðŸ“„ `ScreenNode.tsx`
1805 | > FILEPATH: frontend/src/domains/meta/features/states/components/canvas/nodes/ScreenNode.tsx */
1806 | 
1807 | **Components & Logic:**
1808 | 
1809 | * **`ScreenNode`**
1810 |   * **Logic Flow:**
1811 |     * `Extract Metadata`
1812 | 
1813 | ---
1814 | ### ðŸ“„ `StandardNode.tsx`
1815 | > FILEPATH: frontend/src/domains/meta/features/states/components/canvas/nodes/StandardNode.tsx */
1816 | 
1817 | **Components & Logic:**
1818 | 
1819 | * **`StandardNode`**
1820 | 
1821 | ---
1822 | ### ðŸ“„ `TaskNode.tsx`
1823 | > FILEPATH: frontend/src/domains/meta/features/states/components/canvas/nodes/TaskNode.tsx */
1824 | 
1825 | **Components & Logic:**
1826 | 
1827 | * **`TaskNode`**
1828 |   * **Logic Flow:**
1829 |     * `Extract Metadata`
1830 | 
1831 | ---
1832 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/`
1833 | 
1834 | ### ðŸ“„ `InspectorShell.tsx`
1835 | > The outer frame of the Inspector Panel. Provides the Header, Close Action, and AI Trigger.
1836 | 
1837 | | Attribute | Value |
1838 | | :--- | :--- |
1839 | | **security-level** | `LEVEL 9 (UI Safe) */` |
1840 | | **invariant** | `Must always provide a Close button. AI button is optional. */` |
1841 | 
1842 | **Components & Logic:**
1843 | 
1844 | * **`InspectorShell`**
1845 |   * ðŸ“ *Standardized container for all Inspector panels.*
1846 |   * **Logic Flow:**
1847 |     * `ðŸ” DEBUG TRACE`
1848 |     * `--- RENDERERS ---`
1849 | 
1850 | ---
1851 | ### ðŸ“„ `JobNode.tsx`
1852 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/JobNode.tsx */
1853 | 
1854 | **Components & Logic:**
1855 | 
1856 | * **`JobNode`**
1857 | 
1858 | ---
1859 | ### ðŸ“„ `NodeInspector.tsx`
1860 | > Determines which specific Inspector to render based on the passed Workflow Type.
1861 | 
1862 | | Attribute | Value |
1863 | | :--- | :--- |
1864 | | **security-level** | `LEVEL 9 (Data Integrity) */` |
1865 | | **invariant** | `Must handle null data gracefully. */` |
1866 | 
1867 | **Components & Logic:**
1868 | 
1869 | * **`NodeInspector`**
1870 |   * ðŸ“ *The Brain of the Inspector. Routes to the correct editor.*
1871 |   * **Logic Flow:**
1872 |     * `ðŸ”Š LOUD NARRATOR: Inspect Selection Context`
1873 |     * `âš¡ ROUTER LOGIC: Trust the Panel's decision (workflowType)`
1874 |     * `1. WIZARD SCOPE (Form Builder 2.0)`
1875 |     * `2. JOB SCOPE (DevOps Config)`
1876 |     * `3. DEFAULT / GOVERNANCE (Standard Config)`
1877 | 
1878 | ---
1879 | ### ðŸ“„ `StandardNode.tsx`
1880 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/StandardNode.tsx */
1881 | 
1882 | **Components & Logic:**
1883 | 
1884 | * **`StandardNode`**
1885 |   * **Logic Flow:**
1886 |     * `Convert AntD Color object to Hex string`
1887 | 
1888 | ---
1889 | ### ðŸ“„ `TransitionEdge.tsx`
1890 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/TransitionEdge.tsx */
1891 | 
1892 | **Components & Logic:**
1893 | 
1894 | * **`TransitionEdge`**
1895 | 
1896 | ---
1897 | ### ðŸ“„ `WizardNode.tsx`
1898 | > Specialized editor for UI Workflows with Space-Optimized Field Cards.
1899 | 
1900 | | Attribute | Value |
1901 | | :--- | :--- |
1902 | | **security-level** | `LEVEL 9 (UI Safe) */` |
1903 | | **invariant** | `Must write to 'meta' key to persist in XState. */` |
1904 | 
1905 | **Components & Logic:**
1906 | 
1907 | * **`WizardNode`**
1908 |   * **Logic Flow:**
1909 |     * `âš¡ DEEP EXTRACTION (Backend XState Structure)`
1910 |     * `âš¡ REACTIVE HYDRATION`
1911 |     * `âš¡ FIELD HANDLERS`
1912 | 
1913 | ---
1914 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/governance/`
1915 | 
1916 | ### ðŸ“„ `GovernanceEngine.tsx`
1917 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/governance/GovernanceEngine.tsx */
1918 | 
1919 | **Components & Logic:**
1920 | 
1921 | * **`GovernanceEngine`**
1922 | 
1923 | ---
1924 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/jobs/`
1925 | 
1926 | ### ðŸ“„ `JobConfigurator.tsx`
1927 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/jobs/JobConfigurator.tsx */
1928 | 
1929 | **Components & Logic:**
1930 | 
1931 | * **`JobConfigurator`**
1932 |   * **Logic Flow:**
1933 |     * `Extract config safely`
1934 |     * `âš¡ INPUT MAPPING HANDLERS`
1935 |     * `If renaming key`
1936 |     * `Just updating value`
1937 | 
1938 | ---
1939 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/`
1940 | 
1941 | ### ðŸ“„ `AIComposer.tsx`
1942 | > Orchestrates the Context Browser and Prompt Interface with Isolated Theme Support.
1943 | 
1944 | | Attribute | Value |
1945 | | :--- | :--- |
1946 | | **security-level** | `LEVEL 9 (UI Safe) */` |
1947 | | **invariant** | `State must be lifted here to persist across tabs. */` |
1948 | | **updated** | `Connected 'selectedDomains' to Assembler for Multi-Domain Sync. */` |
1949 | 
1950 | **Components & Logic:**
1951 | 
1952 | * **`AIComposer`**
1953 |   * ðŸ“ *The centralized orchestrator for AI-assisted form generation.*
1954 |   * **Logic Flow:**
1955 |     * `Optional Injections`
1956 |     * `--- 1. UI STATE ---`
1957 |     * `--- 2. SELECTION STATE & DYNAMIC DOMAIN ---`
1958 |     * `âš¡ DYNAMIC PIVOT: Active Domain determines what the LEFT PANEL shows`
1959 |     * `--- 3. DATA RESOLUTION (For Left Panel Display Only) ---`
1960 |     * `We still fetch the active schema to detect loading state for the UI`
1961 |     * `--- 4. LOGIC HOOK (The Omniscient Assembler) ---`
1962 |     * `âš¡ INJECTED DATA`
1963 |     * `domainFields & schemaDomain REMOVED -> Assembler fetches on its own`
1964 |     * `âš¡ SELECTION STATE`
1965 |     * `--- 5. HANDLERS ---`
1966 |     * `--- 6. RENDER ---`
1967 | 
1968 | ---
1969 | ### ðŸ“„ `FieldConfigDrawer.tsx`
1970 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/wizard/FieldConfigDrawer.tsx */
1971 | 
1972 | **Components & Logic:**
1973 | 
1974 | * **`FieldConfigDrawer`**
1975 |   * **Logic Flow:**
1976 |     * `Reset form when opening`
1977 |     * `Determine initial mode based on key naming convention`
1978 |     * `Clean up internal flags`
1979 |     * `âš¡ LOGIC: Map DB Types to UI Components`
1980 |     * `Disable required if system field implies logic, but let user override`
1981 | 
1982 | ---
1983 | ### ðŸ“„ `WizardInspector.tsx`
1984 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/wizard/WizardInspector.tsx */
1985 | 
1986 | **Components & Logic:**
1987 | 
1988 | * **`WizardInspector`**
1989 |   * **Logic Flow:**
1990 |     * `Manage Detail View locally`
1991 |     * `âš¡ AI HANDLER: Appends generated fields`
1992 |     * `Merge strategy: Append to end`
1993 | 
1994 | ---
1995 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/components/ContextBrowser/`
1996 | 
1997 | ### ðŸ“„ `ComponentGallery.tsx`
1998 | > Visual grid for selecting UI Primitives to make available to the AI.
1999 | 
2000 | | Attribute | Value |
2001 | | :--- | :--- |
2002 | | **security-level** | `LEVEL 9 (Read-Only) */` |
2003 | | **invariant** | `Must handle empty widget lists gracefully. */` |
2004 | | **updated** | `Fixed Data Binding (label -> name) and aligned Theme Tokens. */` |
2005 | 
2006 | **Components & Logic:**
2007 | 
2008 | * **`ComponentGallery`**
2009 |   * ðŸ“ *Renders a filterable grid of UI components.*
2010 |   * **Logic Flow:**
2011 |     * `âš¡ COMPUTE CATEGORIES`
2012 |     * `âš¡ FILTER LIST`
2013 |     * `âš¡ THEME FIX: Replaced hardcoded HEX with Tokens`
2014 |     * `âš¡ THEME FIX: Background adapts to Dark Mode`
2015 |     * `âš¡ THEME FIX: Color adapts`
2016 | 
2017 | ---
2018 | ### ðŸ“„ `DataPicker.tsx`
2019 | > Allows selection of Data Domains to inject Schema Context.
2020 | 
2021 | | Attribute | Value |
2022 | | :--- | :--- |
2023 | | **security-level** | `LEVEL 9 (Read-Only) */` |
2024 | | **invariant** | `Must clearly indicate the 'Current' domain. */` |
2025 | | **updated** | `Tokenized colors for Dark Mode compatibility. */` |
2026 | 
2027 | **Components & Logic:**
2028 | 
2029 | * **`DataPicker`**
2030 |   * ðŸ“ *Renders a list of available Data Domains.*
2031 |   * **Logic Flow:**
2032 |     * `âš¡ THEME FIX: Use Tokens instead of Hardcoded Hex`
2033 | 
2034 | ---
2035 | ### ðŸ“„ `GovernancePicker.tsx`
2036 | > Provides granular selection of Policy Groups and specific Domain Policies.
2037 | 
2038 | | Attribute | Value |
2039 | | :--- | :--- |
2040 | | **security-level** | `LEVEL 9 (Read-Only) */` |
2041 | | **invariant** | `Must distinguishing between 'GROUP:' and 'POLICY:' prefixes for the assembler. */` |
2042 | 
2043 | **Components & Logic:**
2044 | 
2045 | * **`GovernancePicker`**
2046 |   * ðŸ“ *Renders a dual-view picker for Governance constraints.*
2047 |   * **Logic Flow:**
2048 |     * `âš¡ FILTER LOGIC`
2049 |     * `âš¡ THEME MAPPING: Use semantic tokens instead of hardcoded hex`
2050 |     * `âš¡ THEME FIX: Dynamic Background`
2051 |     * `âš¡ THEME FIX: Dynamic Border`
2052 |     * `âš¡ THEME FIX: Input Background`
2053 | 
2054 | ---
2055 | ### ðŸ“„ `WorkflowPicker.tsx`
2056 | > Allows the user to select existing Workflows to inject as reference context for the AI.
2057 | 
2058 | | Attribute | Value |
2059 | | :--- | :--- |
2060 | | **security-level** | `LEVEL 9 (Read-Only) */` |
2061 | | **invariant** | `Must filter displayed workflows by the current Domain context. */` |
2062 | | **narrator** | `Logs search interactions. */` |
2063 | | **updated** | `Replaced hardcoded HEX colors with System Theme Tokens. */` |
2064 | 
2065 | **Components & Logic:**
2066 | 
2067 | * **`WorkflowPicker`**
2068 |   * ðŸ“ *Renders a searchable list of workflows grouped by intent.*
2069 |   * **Logic Flow:**
2070 |     * `âš¡ FILTER & GROUP LOGIC`
2071 |     * `1. Text Filter`
2072 |     * `âš¡ THEME FIX: Swapped hardcoded background for Token`
2073 |     * `âš¡ THEME FIX: Swapped #f9f0ff for Token`
2074 |     * `âš¡ THEME FIX: Swapped #d3adf7 for Token`
2075 | 
2076 | ---
2077 | ### ðŸ“„ `index.tsx`
2078 | > Tabbed interface for browsing and selecting AI Context sources.
2079 | 
2080 | | Attribute | Value |
2081 | | :--- | :--- |
2082 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2083 | | **invariant** | `Must retain selection state across tab switches. */` |
2084 | 
2085 | **Components & Logic:**
2086 | 
2087 | * **`ContextBrowser`**
2088 |   * ðŸ“ *The main container for the Context Selection Interface.*
2089 |   * **Logic Flow:**
2090 |     * `âš¡ DYNAMIC STYLING (Semantic)`
2091 |     * `We rely on the parent ConfigProvider (Dark Algorithm) to set token values correctly.`
2092 | 
2093 | ---
2094 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/components/`
2095 | 
2096 | ### ðŸ“„ `PromptInterface.tsx`
2097 | > The text input and control deck for sending instructions to the Cortex.
2098 | 
2099 | | Attribute | Value |
2100 | | :--- | :--- |
2101 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2102 | | **invariant** | `Handles DATABASE_SCHEMA rendering. */` |
2103 | | **updated** | `Added 'DATABASE_SCHEMA' case to fix 'Unknown' label. */` |
2104 | 
2105 | **Components & Logic:**
2106 | 
2107 | * **`PromptInterface`**
2108 | 
2109 | ---
2110 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizard/hooks/`
2111 | 
2112 | ### ðŸ“„ `useContextAssembler.ts`
2113 | > Marshals Data, Rules, Flows, and UI Components into a structured AI Payload.
2114 | 
2115 | | Attribute | Value |
2116 | | :--- | :--- |
2117 | | **security-level** | `LEVEL 9 (Sanitized Input) */` |
2118 | | **invariant** | `Sync is Manual & Omniscient. Fetches all selected domains on demand. */` |
2119 | 
2120 | **Components & Logic:**
2121 | 
2122 | * **`CommandMode`**
2123 |   * **Logic Flow:**
2124 |     * `domainFields: SchemaField[]; // âŒ REMOVED: Single source`
2125 |     * `schemaDomain?: string;       // âŒ REMOVED: Single source`
2126 | * **`useContextAssembler`**
2127 |   * **Logic Flow:**
2128 |     * `âš¡ STATE`
2129 |     * `âš¡ CHANGE DETECTION`
2130 |     * `âš¡ HELPER: Normalize API Response`
2131 |     * `âš¡ SYNC ENGINE (Omniscient)`
2132 |     * `ðŸ• Artificial Delay for UX`
2133 |     * `0. System Instruction`
2134 |     * `A. Database Context (MULTI-DOMAIN FETCH)`
2135 |     * `âš¡ PARALLEL FETCH: Get all schemas at once`
2136 |     * `B. Governance`
2137 |     * `C. Workflows`
2138 |     * `D. UI Toolkit`
2139 |     * `E. Draft`
2140 |     * `âš¡ COMMIT`
2141 |     * `Update Signature`
2142 |     * `âš¡ FEEDBACK`
2143 | 
2144 | ---
2145 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/components/inspector/wizards/`
2146 | 
2147 | ### ðŸ“„ `WizardArchitect.tsx`
2148 | > FILEPATH: frontend/src/domains/meta/features/states/components/inspector/wizards/WizardArchitect.tsx */
2149 | 
2150 | **Components & Logic:**
2151 | 
2152 | * **`WizardArchitect`**
2153 |   * **Logic Flow:**
2154 |     * `1. Extract Schema safely`
2155 |     * `2. Actions`
2156 |     * `FieldConfigDrawer doesn't strictly need readOnly because we prevent opening it,`
2157 |     * `but if we wanted "View Details", we'd pass it here too.`
2158 | 
2159 | ---
2160 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/`
2161 | 
2162 | ### ðŸ“„ `constants.tsx`
2163 | > FILEPATH: frontend/src/domains/meta/features/states/constants.tsx */
2164 | 
2165 | **Components & Logic:**
2166 | 
2167 | * **`WorkflowTypeDef`**
2168 | * **`WORKFLOW_TYPES`**
2169 | * **`DEFAULT_WORKFLOW_ICON`**
2170 | * **`getWorkflowMeta`**
2171 | 
2172 | ---
2173 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/hooks/`
2174 | 
2175 | ### ðŸ“„ `useCanvasHistory.ts`
2176 | > FILEPATH: frontend/src/domains/meta/features/states/hooks/useCanvasHistory.ts */
2177 | 
2178 | **Components & Logic:**
2179 | 
2180 | * **`useCanvasHistory`**
2181 |   * **Logic Flow:**
2182 |     * `We don't store 'present' in state here to avoid duping ReactFlow's internal state.`
2183 |     * `Instead, we capture snapshots.`
2184 |     * `âš¡ SNAPSHOT ENGINE`
2185 |     * `Limit history depth to 50`
2186 |     * `Debounced version for drag events`
2187 |     * `âš¡ UNDO`
2188 |     * `âš¡ REDO`
2189 | 
2190 | ---
2191 | ### ðŸ“„ `useDomainSchema.ts`
2192 | > Fetches and normalizes the Domain Schema from the Kernel.
2193 | 
2194 | | Attribute | Value |
2195 | | :--- | :--- |
2196 | | **security-level** | `LEVEL 9 (Type Safety) */` |
2197 | | **updated** | `Now returns full Context Identity to prevent Assembler Race Conditions. */` |
2198 | 
2199 | **Components & Logic:**
2200 | 
2201 | * **`useDomainSchema`**
2202 |   * **Logic Flow:**
2203 |     * `1. Fetch from Backend`
2204 |     * `Response Format: { domain: "USER", fields: { "email": { ... }, "role": { ... } } }`
2205 |     * `2. âš¡ NORMALIZATION LOGIC`
2206 |     * `The backend returns { domain: "USER", fields: { key: def } }`
2207 |     * `We need to convert that Dictionary into a List [ def1, def2 ]`
2208 |     * `Scenario A: Standard V2 Dictionary`
2209 |     * `Scenario B: Legacy Array (Rare fallback)`
2210 |     * `Scenario C: Flat Object Fallback`
2211 |     * `âš¡ EXPOSE FULL CONTEXT`
2212 | 
2213 | ---
2214 | ### ðŸ“„ `useDomains.ts`
2215 | > FILEPATH: frontend/src/domains/meta/features/states/hooks/useDomains.ts */
2216 | 
2217 | **Components & Logic:**
2218 | 
2219 | * **`useDomains`**
2220 |   * **Logic Flow:**
2221 |     * `Fetch generic domains via Kernel Service`
2222 |     * `Note: The API returns `any`, we cast to DomainSummary[] based on known shape`
2223 |     * `If response is wrapped in 'modules' (manifest style), extract it`
2224 | 
2225 | ---
2226 | ### ðŸ“„ `useEditorSession.ts`
2227 | > Manages the 'VIEW' vs 'EDIT' state and the Draft copy.
2228 | 
2229 | | Attribute | Value |
2230 | | :--- | :--- |
2231 | | **security-level** | `LEVEL 9 (State Integrity)` |
2232 | | **invariant** | `Mode defaults to VIEW. Draft is cleared on Discard.` |
2233 | 
2234 | **Components & Logic:**
2235 | 
2236 | * **`useEditorSession`**
2237 |   * **Logic Flow:**
2238 |     * `âš¡ AUTO-RESET: When changing workflows, always revert to VIEW and clear draft.`
2239 |     * `Initialize draft with current definition if not exists`
2240 |     * `âš¡ FIX: Removed auto-setMode('EDIT').`
2241 |     * `We now require explicit entry via "Edit Workflow" button.`
2242 |     * `This prevents the Toolbar from flipping if the Canvas auto-layouts on load.`
2243 | 
2244 | ---
2245 | ### ðŸ“„ `useFlowEditor.ts`
2246 | > FILEPATH: frontend/src/domains/meta/features/states/hooks/useFlowEditor.ts */
2247 | 
2248 | **Components & Logic:**
2249 | 
2250 | * **`useFlowEditor`**
2251 |   * **Logic Flow:**
2252 |     * `1. FETCH MACHINES`
2253 |     * `âš¡ GATEWAY: Use standardized base`
2254 |     * `2. SAVE (CREATE / UPDATE)`
2255 |     * `POST creates a new VERSION in the ledger strategy`
2256 | 
2257 | ---
2258 | ### ðŸ“„ `useWorkflows.ts`
2259 | > React Query wrappers for the State Engine API.
2260 | 
2261 | | Attribute | Value |
2262 | | :--- | :--- |
2263 | | **security-level** | `LEVEL 9 (Type Safety)` |
2264 | | **invariant** | `Cache invalidation must occur on mutation success.` |
2265 | | **updated** | `Changed 'version' type from number to string (SemVer).` |
2266 | 
2267 | **Components & Logic:**
2268 | 
2269 | * **`WorkflowDefinition`**
2270 | * **`useWorkflows`**
2271 |   * **Logic Flow:**
2272 |     * `1. Fetch List`
2273 |     * `2. Create / Update`
2274 |     * `3. Delete`
2275 | 
2276 | ---
2277 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/logic/`
2278 | 
2279 | ### ðŸ“„ `xstateAdapter.ts`
2280 | > FILEPATH: frontend/src/domains/meta/features/states/logic/xstateAdapter.ts */
2281 | 
2282 | **Components & Logic:**
2283 | 
2284 | * **`toGraph`**
2285 |   * ðŸ“ *Converts backend JSON into Graph Nodes/Edges and back.*
2286 |   * **Logic Flow:**
2287 |     * `1. Build Nodes`
2288 |     * `Default layout if no positions saved (Simple grid fallback)`
2289 |     * `2. Build Edges (Transitions)`
2290 | * **`toXState`**
2291 |   * ðŸ“ *CONVERTER: Frontend Graph -> Backend JSON*
2292 |   * **Logic Flow:**
2293 |     * `1. Serialize Nodes (State + Metadata)`
2294 |     * `Persist Layout Positions`
2295 |     * `2. Serialize Edges (Transitions)`
2296 |     * `Safety check: ensure source/target nodes actually exist in the definition`
2297 |     * `XState simple syntax: "EVENT": "TARGET"`
2298 |     * `TODO: Expand this to object syntax if we add actions/guards later`
2299 | 
2300 | ---
2301 | ## ðŸ“‚ `frontend/src/domains/meta/features/states/types/`
2302 | 
2303 | ### ðŸ“„ `index.ts`
2304 | > FILEPATH: frontend/src/domains/meta/features/states/types/index.ts */
2305 | 
2306 | **Components & Logic:**
2307 | 
2308 | * **`StateDefinition`**
2309 |   * ðŸ“ *--- BACKEND CONTRACT (XState JSON) ---*
2310 |   * **Logic Flow:**
2311 |     * `âš¡ NEW: The Composite Column Target`
2312 |     * `Default is 'status'. Can be 'approval_state', 'shipping_stage', etc.`
2313 |     * `Strict XState v5 Schema`
2314 | * **`XStateDefinition`**
2315 |   * ðŸ“ *Strict XState v5 Schema*
2316 | * **`XStateNode`**
2317 |   * **Logic Flow:**
2318 |     * `--- FRONTEND MODEL (ProFlow / ReactFlow) ---`
2319 | * **`FlowNodeData`**
2320 |   * ðŸ“ *--- FRONTEND MODEL (ProFlow / ReactFlow) ---*
2321 |   * **Logic Flow:**
2322 |     * `Metadata for the Inspector`
2323 | * **`FlowEdgeData`**
2324 | * **`StateMachineDraft`**
2325 |   * **Logic Flow:**
2326 |     * `âš¡ NEW: Must specify which column to control`
2327 | 
2328 | ---
2329 | ## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/`
2330 | 
2331 | ### ðŸ“„ `SwitchboardView.tsx`
2332 | > The Main Control Panel for Governance.
2333 | 
2334 | **Components & Logic:**
2335 | 
2336 | * **`SwitchboardView`**
2337 |   * **Logic Flow:**
2338 |     * `1. GLOBAL CONTEXT (Deep Link for Modal)`
2339 |     * `2. UNIVERSAL URL STATE (Search Persistence)`
2340 |     * `3. Data Hooks`
2341 |     * `Local loading state for individual row actions`
2342 |     * `--- MODAL STATE (Derived from Global) ---`
2343 |     * `--- GROUPING LOGIC ---`
2344 |     * `Sort: Active first, then by Priority`
2345 |     * `--- RENDER HELPERS ---`
2346 |     * `STEP 1: DEACTIVATE`
2347 |     * `STEP 2: REMOVE`
2348 | 
2349 | ---
2350 | ## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/components/`
2351 | 
2352 | ### ðŸ“„ `AssignmentModal.tsx`
2353 | > FILEPATH: frontend/src/domains/meta/features/switchboard/components/AssignmentModal.tsx */
2354 | 
2355 | **Components & Logic:**
2356 | 
2357 | * **`AssignmentModal`**
2358 |   * **Logic Flow:**
2359 |     * `UI State`
2360 |     * `âš¡ LOGIC: Send either ID or GroupID`
2361 | 
2362 | ---
2363 | ### ðŸ“„ `GroupPolicyModal.tsx`
2364 | > FILEPATH: frontend/src/domains/meta/features/switchboard/components/GroupPolicyModal.tsx */
2365 | 
2366 | **Components & Logic:**
2367 | 
2368 | * **`GroupPolicyModal`**
2369 |   * **Logic Flow:**
2370 |     * `âš¡ MUTATION: Patch Policy`
2371 |     * `âš¡ GATEWAY: Use standardized base`
2372 |     * `âš¡ BULK OPERATION: Update each selected policy`
2373 |     * `We append the new tag to existing tags to avoid overwriting.`
2374 | 
2375 | ---
2376 | ## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/hooks/`
2377 | 
2378 | ### ðŸ“„ `useSwitchboard.ts`
2379 | > FILEPATH: frontend/src/domains/meta/features/switchboard/hooks/useSwitchboard.ts */
2380 | 
2381 | **Components & Logic:**
2382 | 
2383 | * **`useSwitchboard`**
2384 |   * **Logic Flow:**
2385 |     * `1. FETCH AVAILABLE POLICIES (The Atoms)`
2386 |     * `2. FETCH AVAILABLE GROUPS (The Bundles) - âš¡ NEW`
2387 |     * `3. FETCH ACTIVE BINDINGS (The Assignments)`
2388 |     * `4. CREATE ASSIGNMENT`
2389 |     * `5. UPDATE ASSIGNMENT`
2390 |     * `6. REMOVE ASSIGNMENT`
2391 |     * `Data`
2392 |     * `Actions`
2393 | 
2394 | ---
2395 | ## ðŸ“‚ `frontend/src/domains/meta/features/switchboard/`
2396 | 
2397 | ### ðŸ“„ `types.ts`
2398 | > FILEPATH: frontend/src/domains/meta/features/switchboard/types.ts */
2399 | 
2400 | **Components & Logic:**
2401 | 
2402 | * **`PolicyDefinition`**
2403 |   * ðŸ“ *--- 1. THE ATOM (Policy) ---*
2404 |   * **Logic Flow:**
2405 |     * `--- 2. THE ASSIGNMENT (Binding) ---`
2406 | * **`PolicyBinding`**
2407 |   * ðŸ“ *--- 2. THE ASSIGNMENT (Binding) ---*
2408 |   * **Logic Flow:**
2409 |     * `Source Polymorphism (One is always set)`
2410 |     * `Expanded Relations (For UI display)`
2411 |     * `Target Polymorphism`
2412 |     * `--- 3. OPTIONS ---`
2413 | * **`BindingScope`**
2414 |   * ðŸ“ *--- 3. OPTIONS ---*
2415 | * **`BindingDraft`**
2416 |   * **Logic Flow:**
2417 |     * `âš¡ Logic: Must provide either policy_id OR policy_group_id`
2418 | 
2419 | ---
2420 | ## ðŸ“‚ `frontend/src/domains/meta/`
2421 | 
2422 | ### ðŸ“„ `manifest.tsx`
2423 | > Registers the System Configuration Module.
2424 | 
2425 | | Attribute | Value |
2426 | | :--- | :--- |
2427 | | **fix** | `Lazy Loaded MetaRoot to prevent Circular Dependency with Sidebar.` |
2428 | 
2429 | **Components & Logic:**
2430 | 
2431 | * **`metaManifest`**
2432 | 
2433 | ---
2434 | ## ðŸ“‚ `frontend/src/domains/meta/types/`
2435 | 
2436 | ### ðŸ“„ `constants.ts`
2437 | > Shared Enums for the Meta-Kernel (Dictionary, Governance, Workflow).
2438 | 
2439 | | Attribute | Value |
2440 | | :--- | :--- |
2441 | | **invariant** | `Must match 'backend/app/core/meta/constants.py' exactly. */` |
2442 | 
2443 | **Components & Logic:**
2444 | 
2445 | * **`BindingType`**
2446 |   * ðŸ“ *Shared Enums for the Meta-Kernel (Dictionary, Governance, Workflow).*
2447 | * **`AttributeType`**
2448 | * **`WidgetType`**
2449 |   * **Logic Flow:**
2450 |     * `Text`
2451 |     * `Numeric`
2452 |     * `Choice`
2453 |     * `Boolean`
2454 |     * `Date`
2455 |     * `Advanced`
2456 | * **`RuleEventType`**
2457 | * **`RuleActionType`**
2458 | * **`PolicyResolutionStrategy`**
2459 | * **`ViewEngineType`**
2460 | * **`ScopeType`**
2461 |   * **Logic Flow:**
2462 |     * `âš¡ SYSTEM BRICKS (The "App" Types)`
2463 | 
2464 | ---
2465 | ### ðŸ“„ `index.ts`
2466 | > Centralizes type definitions for the Meta Domain. Acts as the SSOT for Domain/Scope shapes.
2467 | 
2468 | | Attribute | Value |
2469 | | :--- | :--- |
2470 | | **security-level** | `LEVEL 0 (Core Types) */` |
2471 | 
2472 | **Components & Logic:**
2473 | 
2474 | * **`DomainTypeProperties`**
2475 |   * ðŸ“ *--- KERNEL PROPERTIES ---*
2476 | * **`DomainTypeDefinition`**
2477 |   * **Logic Flow:**
2478 |     * `--- SUMMARIES (Lists) ---`
2479 | * **`ScopeSummary`**
2480 |   * ðŸ“ *--- SUMMARIES (Lists) ---*
2481 |   * **Logic Flow:**
2482 |     * `âš¡ RUNTIME STATE (Injected by Hypervisor)`
2483 | * **`DomainSummary`**
2484 |   * **Logic Flow:**
2485 |     * `Dynamic Type`
2486 |     * `Topology`
2487 |     * `âš¡ HIERARCHY (The Tree Link)`
2488 |     * `Visuals`
2489 |     * `Capabilities`
2490 |     * `Runtime Config`
2491 |     * `--- CONTEXT STATE ---`
2492 | * **`MetaContextState`**
2493 |   * ðŸ“ *--- CONTEXT STATE ---*
2494 |   * **Logic Flow:**
2495 |     * `Selection`
2496 |     * `Data`
2497 |     * `Actions`
2498 | 
2499 | ---
2500 | ## ðŸ“‚ `frontend/src/domains/meta/views/`
2501 | 
2502 | ### ðŸ“„ `MetaDashboard.tsx`
2503 | > The clean entry point for the new System Configurator.
2504 | 
2505 | ---
2506 | ## ðŸ“‚ `frontend/src/domains/meta_v2/`
2507 | 
2508 | ### ðŸ“„ `MetaV2Root.tsx`
2509 | > Bootstraps the Meta V2 Kernel Context and Routing.
2510 | 
2511 | | Attribute | Value |
2512 | | :--- | :--- |
2513 | | **security-level** | `LEVEL 0 (Kernel Boot) */` |
2514 | | **updated** | `Injected WorkflowsTool routes to prevent Router Unmount crashes. */` |
2515 | 
2516 | **Components & Logic:**
2517 | 
2518 | * **`MetaV2Root`**
2519 |   * **Logic Flow:**
2520 |     * `âš¡ DIAGNOSTIC: Log Entry`
2521 | 
2522 | ---
2523 | ## ðŸ“‚ `frontend/src/domains/meta_v2/_kernel/`
2524 | 
2525 | ### ðŸ“„ `KernelContext.tsx`
2526 | > Bootstraps the Meta-Kernel V2. Loads Registry, Types, and Capabilities.
2527 | 
2528 | | Attribute | Value |
2529 | | :--- | :--- |
2530 | | **security-level** | `LEVEL 0 (Kernel Boot) */` |
2531 | 
2532 | **Components & Logic:**
2533 | 
2534 | * **`KernelContext`**
2535 | * **`KernelProvider`**
2536 |   * **Logic Flow:**
2537 |     * `2. STATE: Universal URL Persistence`
2538 |     * `3. ACTIONS`
2539 |     * `âš¡ PARALLEL FETCHING: Use raw requests for both to bypass OpenAPI generated name mismatches`
2540 |     * `Handle potential response wrappers (e.g. { modules: [...] } vs [...])`
2541 |     * `4. EFFECTS: Boot`
2542 |     * `5. DERIVED STATE (Selection Resolution)`
2543 |     * `Resolve Objects from Keys (O(n) but n is small)`
2544 |     * `âš¡ CRITICAL FIX: Add selectContext as an alias to selectDomain so UniversalTree works`
2545 | * **`useKernel`**
2546 | 
2547 | ---
2548 | ### ðŸ“„ `logic.ts`
2549 | > Calculates features based on Backend Domain Properties. Zero UI dependencies.
2550 | 
2551 | | Attribute | Value |
2552 | | :--- | :--- |
2553 | | **security-level** | `LEVEL 9 (Logic Safe) */` |
2554 | | **updated** | `Removed 'SYS' magic string. Now uses strict type checking. */` |
2555 | 
2556 | **Components & Logic:**
2557 | 
2558 | * **`calculateCapabilities`**
2559 |   * ðŸ“ *Decodes the Domain Properties into UI Capabilities.*
2560 |   * **Logic Flow:**
2561 |     * `ðŸ›¡ï¸ SAFETY: Handle missing type definitions gracefully (Legacy fallback)`
2562 |     * `1. Dictionary: Only if the domain supports Custom Attributes (Metadata)`
2563 |     * `2. Workflows: Only if the domain logs Activity/State Transitions`
2564 |     * `3. Governance: If it has an API, it needs Rules.`
2565 |     * `We exclude 'NONE' (Virtual domains) but include 'READ_ONLY'.`
2566 |     * `4. Data Browser: Only if we can CRUD the data via standard API.`
2567 | * **`buildActiveContext`**
2568 |   * ðŸ“ *Factory that builds the Context Object from a selected Domain.*
2569 |   * **Logic Flow:**
2570 |     * `âš¡ FIX: Use the Domain Type classification, NOT the hardcoded 'SYS' key.`
2571 | 
2572 | ---
2573 | ### ðŸ“„ `types.ts`
2574 | > Strict type definitions for the Context-Driven Architecture.
2575 | 
2576 | | Attribute | Value |
2577 | | :--- | :--- |
2578 | | **security-level** | `LEVEL 0 (Kernel) */` |
2579 | | **invariant** | `Must match Backend Pydantic Models in 'app.core.kernel.registry.schemas'. */` |
2580 | | **updated** | `Added 'WorkflowTypeRead' for V3 Dynamic Workflow Types. */` |
2581 | 
2582 | **Components & Logic:**
2583 | 
2584 | * **`ScopeConfig`**
2585 |   * ðŸ“ *Strict type definitions for the Context-Driven Architecture.*
2586 | * **`DomainTypeProperties`**
2587 |   * **Logic Flow:**
2588 |     * `âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)`
2589 | * **`DomainTypeDefinition`**
2590 |   * ðŸ“ *âš¡ LEVEL 7: DYNAMIC TYPE DEFINITION (From DB: kernel_domain_types)*
2591 |   * **Logic Flow:**
2592 |     * `âš¡ V3: DYNAMIC WORKFLOW TYPE (From DB: meta_workflow_types)`
2593 | * **`WorkflowTypeRead`**
2594 |   * ðŸ“ *âš¡ V3: DYNAMIC WORKFLOW TYPE (From DB: meta_workflow_types)*
2595 |   * **Logic Flow:**
2596 |     * `--- SUMMARIES (Lists) ---`
2597 | * **`ScopeSummary`**
2598 |   * ðŸ“ *--- SUMMARIES (Lists) ---*
2599 |   * **Logic Flow:**
2600 |     * `âš¡ RUNTIME STATE (Injected by Hypervisor)`
2601 | * **`DomainSummary`**
2602 |   * **Logic Flow:**
2603 |     * `âš¡ DYNAMIC TYPE (Data-Driven)`
2604 |     * `âš¡ TOPOLOGY METADATA (Level 100)`
2605 |     * `âš¡ HIERARCHY (The Tree Link)`
2606 |     * `Visuals`
2607 |     * `Capabilities`
2608 |     * `Runtime Config`
2609 |     * `--- CONTEXT STATE ---`
2610 | * **`MetaContextState`**
2611 |   * ðŸ“ *--- CONTEXT STATE ---*
2612 |   * **Logic Flow:**
2613 |     * `1. Registry (The Menu)`
2614 |     * `âš¡ V3 STATE: The Rules of Physics`
2615 |     * `2. Selection (The Focus)`
2616 |     * `âš¡ GLOBAL ITEM STATE (Fixes Refresh Amnesia)`
2617 |     * `Stores the full object so we don't have to re-find it constantly`
2618 |     * `3. Data Access`
2619 |     * `4. Actions`
2620 | 
2621 | ---
2622 | ### ðŸ“„ `useKernel.ts`
2623 | > PREVENTS CRASHES. Re-exports the hook from KernelContext so existing imports work.
2624 | 
2625 | | Attribute | Value |
2626 | | :--- | :--- |
2627 | | **security-level** | `LEVEL 0 (Public) */` |
2628 | 
2629 | ---
2630 | ## ðŸ“‚ `frontend/src/domains/meta_v2/_shell/`
2631 | 
2632 | ### ðŸ“„ `MetaUIContext.tsx`
2633 | > Centralizes UI state (Sidebar collapse, Tree expansion) with LocalStorage persistence.
2634 | 
2635 | **Components & Logic:**
2636 | 
2637 | * **`MetaUIProvider`**
2638 |   * **Logic Flow:**
2639 |     * `--- 1. LAYOUT STATE ---`
2640 |     * `--- 2. TREE STATE ---`
2641 |     * `--- ACTIONS ---`
2642 | * **`useMetaUI`**
2643 | 
2644 | ---
2645 | ### ðŸ“„ `StudioLayout.tsx`
2646 | > The Master Layout (3-Pane) powered by MetaUIContext.
2647 | 
2648 | | Attribute | Value |
2649 | | :--- | :--- |
2650 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2651 | | **invariant** | `Must use <Outlet /> for center pane to respect MetaV2Root nested routes. */` |
2652 | 
2653 | **Components & Logic:**
2654 | 
2655 | * **`StudioLayout`**
2656 |   * ðŸ“ *âš¡ WRAPPER TO PROVIDE CONTEXT*
2657 | 
2658 | ---
2659 | ## ðŸ“‚ `frontend/src/domains/meta_v2/components/`
2660 | 
2661 | ### ðŸ› ï¸ `ContextInspector.tsx`
2662 | > Visualizes the Active Kernel Context.
2663 | 
2664 | **Components & Logic:**
2665 | 
2666 | * **`ContextInspector`**
2667 |   * **Logic Flow:**
2668 |     * `âš¡ FIX: Access Global Theme Tokens`
2669 |     * `Helper to render boolean capabilities visually`
2670 |     * `âš¡ FIX: Use Semantic Tokens for Background/Border`
2671 | 
2672 | ---
2673 | ### ðŸ“„ `DomainTopology.tsx`
2674 | > Renders the System Hierarchy using a Recursive Engine for infinite nesting support.
2675 | 
2676 | | Attribute | Value |
2677 | | :--- | :--- |
2678 | | **security-level** | `LEVEL 9 (UI Safe)` |
2679 | | **updated** | `Added support for 'ACTION' node type to render "Create" placeholders distinctively.` |
2680 | 
2681 | **Components & Logic:**
2682 | 
2683 | * **`DomainTopology`**
2684 |   * ðŸ“ *Renders the System Hierarchy using a Recursive Engine.*
2685 |   * **Logic Flow:**
2686 |     * `1. DATA`
2687 |     * `2. STATE`
2688 |     * `3. ROUTING LOGIC`
2689 |     * `âš¡ V2 ROUTING HOOK: Workflow Editor Integration`
2690 |     * `âš¡ UX: If it's the Workflows folder, navigate to the Workflow Lobby`
2691 |     * `âš¡ ACTION HANDLER (For Placeholders)`
2692 |     * `Actions like "Create First Workflow" route to the lobby`
2693 |     * `Default: External Route`
2694 |     * `4. NORMALIZATION ENGINE (The Flattening & Recursive Builder)`
2695 |     * `Helper: Recursive Filter & Map`
2696 |     * `Check self match`
2697 |     * `Process children recursively`
2698 |     * `If searched, only return if self matches or has matching children`
2699 |     * `If we have matches in children, expand this node`
2700 |     * `TRANSFORM: Cluster -> Domain -> Section -> Item -> UniversalTreeNode`
2701 |     * `Root Items`
2702 |     * `metadata for display`
2703 |     * `Sections (Folders)`
2704 |     * `Run Filter`
2705 |     * `5. RECURSIVE RENDERER`
2706 |     * `Determine styles based on type`
2707 | 
2708 | ---
2709 | ### ðŸ“„ `UniversalTree.tsx`
2710 | > Renders the System Hierarchy.
2711 | 
2712 | | Attribute | Value |
2713 | | :--- | :--- |
2714 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2715 | | **updated** | `Injected Auto-Collapse UX on selection to maximize focus area. */` |
2716 | 
2717 | **Components & Logic:**
2718 | 
2719 | * **`UniversalTree`**
2720 |   * **Logic Flow:**
2721 |     * `âš¡ CONNECT TO SHELL STATE`
2722 |     * `3. HANDLERS`
2723 |     * `âš¡ UX AUTOFOCUS: Collapse the main sidebar to maximize screen real estate`
2724 |     * `4. RENDERER (Custom Node)`
2725 |     * `âš¡ RESPONSIVE MODE: ICON ONLY`
2726 |     * `âš¡ FULL MODE: TREE`
2727 | 
2728 | ---
2729 | ### ðŸ“„ `useDomainTree.ts`
2730 | > Transforms flat Domain list into a Hierarchy.
2731 | 
2732 | | Attribute | Value |
2733 | | :--- | :--- |
2734 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2735 | | **updated** | `Removed hardcoded 'SYS' check. Uses Backend 'display_weight' for sorting. */` |
2736 | 
2737 | **Components & Logic:**
2738 | 
2739 | * **`KernelTreeNode`**
2740 | * **`useDomainTree`**
2741 |   * **Logic Flow:**
2742 |     * `1. Initialize Nodes`
2743 |     * `âš¡ READ DYNAMIC WEIGHT (Default to 50 if missing)`
2744 |     * `2. Link Hierarchy`
2745 |     * `Normalize parent key (handles v2 vs v3 differences)`
2746 |     * `3. Sort & Polish`
2747 |     * `âš¡ DYNAMIC SORT: Compare weights first (lower number = higher up)`
2748 |     * `Fallback to alphabetical label sorting`
2749 | 
2750 | ---
2751 | ### ðŸ“„ `useTopology.ts`
2752 | > Fetches and groups the System Topology Graph from the API.
2753 | 
2754 | | Attribute | Value |
2755 | | :--- | :--- |
2756 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2757 | | **updated** | `Injected "Zero-Touch" Workflow Placeholder for empty domains. */` |
2758 | 
2759 | **Components & Logic:**
2760 | 
2761 | * **`TopologyItem`**
2762 |   * ðŸ“ *âš¡ SHARED TYPES*
2763 | * **`TopologySection`**
2764 | * **`TopologyDomain`**
2765 | * **`DomainCluster`**
2766 | * **`useTopology`**
2767 |   * **Logic Flow:**
2768 |     * `1. âš¡ FETCH TOPOLOGY GRAPH (Server-Side Source of Truth)`
2769 |     * `2. âš¡ THE DUMB PIPE (Zero Frontend Opinions)`
2770 |     * `âš¡ DB-DRIVEN MATCHING: Trust the Backend's Section Assignment completely.`
2771 |     * `If the backend commanded a group, build or append to it.`
2772 |     * `âš¡ ROOT ENTITIES: Nodes without a section_key remain at the root`
2773 |     * `âš¡ ZERO-TOUCH WORKFLOWS: If capability exists but no workflows, offer creation.`
2774 |     * `This ensures the "Workflows" folder always appears if the domain supports it.`
2775 |     * `Ensure section exists`
2776 |     * `Inject Placeholder if empty`
2777 |     * `Sort dynamic folders alphabetically by their DB label`
2778 |     * `Construct the "Self" Domain representation`
2779 |     * `Wrap in a Cluster (to maintain compatibility with DomainTopology.tsx renderer)`
2780 | 
2781 | ---
2782 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/`
2783 | 
2784 | ### ðŸ“„ `DictionaryTool.tsx`
2785 | > The V2-Native wrapper for the Data Dictionary.
2786 | 
2787 | **Components & Logic:**
2788 | 
2789 | * **`DictionaryTool`**
2790 |   * **Logic Flow:**
2791 |     * `âš¡ ROUTING LOGIC: Capture both Path Param and Query Param`
2792 |     * `1. RESOLVE CONTEXT (V2 Way)`
2793 |     * `Prioritize Prop -> Path Param -> Query Param -> Active Context`
2794 |     * `âš¡ SYNC ENGINE: Ensure Kernel is aware of Router URL changes`
2795 |     * `2. FEATURE LOGIC`
2796 |     * `3. LOCAL UI STATE`
2797 |     * `âš¡ UX STATE: Auto-Collapse the list when editing`
2798 |     * `4. COMPUTED DRAFT`
2799 |     * `5. HANDLERS`
2800 |     * `Go back to Topology (parent route)`
2801 |     * `âš¡ UX: Expand list again after saving so they can pick the next item`
2802 |     * `âš¡ UX: Auto-collapse when user selects a field to edit`
2803 | 
2804 | ---
2805 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/components/`
2806 | 
2807 | ### ðŸ“„ `AttributeEditor.tsx`
2808 | > The Master Controller for editing Attributes.
2809 | 
2810 | **Components & Logic:**
2811 | 
2812 | * **`AttributeEditor`**
2813 |   * **Logic Flow:**
2814 |     * `âš¡ SYNC: Update local state if parent selection changes`
2815 |     * `âš¡ LOGIC: Auto-switch widget if data type changes`
2816 |     * `âš¡ CONTRACT FIX: Updates 'configuration', NOT 'config'`
2817 |     * `We allow config updates even if locked, generally (e.g. placeholder)`
2818 |     * `âš¡ LOGIC: Auto-Slugify`
2819 | 
2820 | ---
2821 | ### ðŸ“„ `AttributeExplorer.tsx`
2822 | > Navigable list of Domain Attributes.
2823 | 
2824 | **Components & Logic:**
2825 | 
2826 | * **`AttributeExplorer`**
2827 |   * **Logic Flow:**
2828 |     * `âš¡ DEEP LINKING: Replaced local state with URL state for search persistence`
2829 |     * `ðŸ§  SMART SORTING`
2830 |     * `ID sort for stability`
2831 |     * `System fields first`
2832 |     * `Alphabetical`
2833 |     * `âš¡ FIX: Use 'key' (string) instead of 'id' (number) for uniqueness`
2834 | 
2835 | ---
2836 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/components/editor/`
2837 | 
2838 | ### ðŸ“„ `ConfigPanels.tsx`
2839 | > Fractal sub-component for handling Type-Specific settings. CRASH PROOFED.
2840 | 
2841 | **Components & Logic:**
2842 | 
2843 | * **`ConfigPanels`**
2844 |   * **Logic Flow:**
2845 |     * `âš¡ CRASH GUARD: Ensure we have an object to read from`
2846 |     * `--- 1. NUMBER CONFIGURATION ---`
2847 |     * `--- 2. TEXT CONFIGURATION ---`
2848 |     * `--- 3. SELECTION CONFIGURATION ---`
2849 |     * `--- 4. DATE / DATETIME ---`
2850 |     * `--- 5. REFERENCE (COMPLEX) ---`
2851 |     * `--- 6. FILE ---`
2852 | 
2853 | ---
2854 | ### ðŸ“„ `PreviewPanel.tsx`
2855 | > Renders the widget in real-time.
2856 | 
2857 | **Components & Logic:**
2858 | 
2859 | * **`PreviewPanel`**
2860 |   * **Logic Flow:**
2861 |     * `--- TEXT WIDGETS ---`
2862 |     * `--- NUMBER WIDGETS ---`
2863 |     * `--- SELECTION WIDGETS ---`
2864 |     * `--- DATE WIDGETS ---`
2865 |     * `--- BOOLEAN WIDGETS ---`
2866 |     * `--- FILE WIDGETS ---`
2867 |     * `--- COMPLEX WIDGETS ---`
2868 |     * `Fallback`
2869 | 
2870 | ---
2871 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/hooks/`
2872 | 
2873 | ### ðŸ“„ `useDictionary.ts`
2874 | > Encapsulates all Data Access Logic for Domain Attributes.
2875 | 
2876 | **Components & Logic:**
2877 | 
2878 | * **`useDictionary`**
2879 |   * **Logic Flow:**
2880 |     * `1. FETCH ATTRIBUTES`
2881 |     * `âš¡ GATEWAY: Use standardized base`
2882 |     * `2. SAVE (CREATE / UPDATE)`
2883 |     * `Update Existing`
2884 |     * `Create New`
2885 |     * `3. DELETE`
2886 |     * `Data`
2887 |     * `Actions`
2888 |     * `State`
2889 | 
2890 | ---
2891 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/logic/`
2892 | 
2893 | ### ðŸ“„ `schemaNormalizer.ts`
2894 | > Logic Adapter.
2895 | 
2896 | **Components & Logic:**
2897 | 
2898 | * **`normalizeSchema`**
2899 |   * ðŸ“ *V2 Types now contain Enums too*
2900 |   * **Logic Flow:**
2901 |     * `Scenario A: It's already an Array`
2902 |     * `Scenario B: It's a Hybrid Schema Object`
2903 |     * `Check possible containers`
2904 | 
2905 | ---
2906 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/dictionary/types/`
2907 | 
2908 | ### ðŸ“„ `constants.ts`
2909 | > Values that EXIST at runtime (Enums, Objects).
2910 | 
2911 | **Components & Logic:**
2912 | 
2913 | * **`AttributeType`**
2914 |   * ðŸ“ *Values that EXIST at runtime (Enums, Objects).*
2915 | * **`WidgetType`**
2916 |   * **Logic Flow:**
2917 |     * `Text`
2918 |     * `Numeric`
2919 |     * `Choice`
2920 |     * `Boolean`
2921 |     * `Date`
2922 |     * `Advanced`
2923 |     * `ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type`
2924 | * **`WIDGET_COMPATIBILITY`**
2925 |   * ðŸ“ *ðŸ›¡ï¸ THE MATRIX: Defines valid Widgets for each Data Type*
2926 |   * **Logic Flow:**
2927 |     * `ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions`
2928 | * **`HELP_TEXT`**
2929 |   * ðŸ“ *ðŸ“˜ THE KNOWLEDGE BASE: User-friendly descriptions*
2930 | * **`DEFAULT_DRAFT_CONFIG`**
2931 | 
2932 | ---
2933 | ### ðŸ“„ `index.ts`
2934 | > Re-exports Types and Constants explicitly to prevent bundler confusion.
2935 | 
2936 | **Components & Logic:**
2937 | 
2938 | * **`DEFAULT_DRAFT`**
2939 |   * ðŸ“ *3. Default Constant*
2940 | 
2941 | ---
2942 | ### ðŸ“„ `types.ts`
2943 | > Types that DISAPPEAR at runtime. Pure Interfaces.
2944 | 
2945 | | Attribute | Value |
2946 | | :--- | :--- |
2947 | | **security-level** | `LEVEL 0 (Core Types) */` |
2948 | 
2949 | **Components & Logic:**
2950 | 
2951 | * **`AttributeType`**
2952 |   * ðŸ“ *Types that DISAPPEAR at runtime. Pure Interfaces.*
2953 | * **`WidgetType`**
2954 | * **`SelectOption`**
2955 | * **`AttributeConfig`**
2956 |   * **Logic Flow:**
2957 |     * `Text`
2958 |     * `Number`
2959 |     * `Date`
2960 |     * `Options`
2961 |     * `Reference`
2962 |     * `File`
2963 |     * `JSON`
2964 |     * `General`
2965 | * **`AttributeDefinition`**
2966 | * **`AttributeDraft`**
2967 | 
2968 | ---
2969 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/`
2970 | 
2971 | ### ðŸ“„ `GovernanceTool.tsx`
2972 | > Master Controller for the V2 Rule Engine. URL-driven, fully decoupled.
2973 | 
2974 | | Attribute | Value |
2975 | | :--- | :--- |
2976 | | **security-level** | `LEVEL 9 (UI Safe) */` |
2977 | | **updated** | `Added 'Tag' import to fix Runtime Crash. */` |
2978 | 
2979 | **Components & Logic:**
2980 | 
2981 | * **`GovernanceTool`**
2982 |   * **Logic Flow:**
2983 |     * `âš¡ ROUTING STATE`
2984 |     * `âš¡ V2 UI STATE (Centralized Shell)`
2985 |     * `âš¡ GLOBAL URL STATE (Deep Linking)`
2986 |     * `âš¡ LOGIC HOOK`
2987 |     * `âš¡ TELEMETRY`
2988 |     * `--- HANDLERS ---`
2989 |     * `âš¡ TAG-DRIVEN CONTEXT: Automatically associate this policy with the active domain`
2990 |     * `--- COMPUTED ---`
2991 |     * `--- RENDER: EMPTY STATE (No Domain) ---`
2992 |     * `--- RENDER: WORKSPACE ---`
2993 | 
2994 | ---
2995 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/components/editor/`
2996 | 
2997 | ### ðŸ“„ `ConsequenceStack.tsx`
2998 | > Renders the action stack for a rule. Driven by dynamic Backend Capabilities (Dumb UI Pattern).
2999 | 
3000 | | Attribute | Value |
3001 | | :--- | :--- |
3002 | | **security-level** | `LEVEL 9 (UI Safe) */` |
3003 | 
3004 | **Components & Logic:**
3005 | 
3006 | * **`ConsequenceStack`**
3007 |   * **Logic Flow:**
3008 |     * `âš¡ THE DUMB UI LINK: Read Actions directly from the Kernel's Context Schema`
3009 |     * `Derived options for target fields`
3010 | 
3011 | ---
3012 | ### ðŸ“„ `EnforcementPanel.tsx`
3013 | > UI for binding a Policy to a Context.
3014 | 
3015 | **Components & Logic:**
3016 | 
3017 | * **`EnforcementPanel`**
3018 |   * **Logic Flow:**
3019 |     * `Filter bindings for *this* policy`
3020 |     * `State for New Binding (Transient form state, does not need URL sync)`
3021 | 
3022 | ---
3023 | ### ðŸ“„ `HistoryDrawer.tsx`
3024 | > Displays version timeline with Expandable JSON views.
3025 | 
3026 | **Components & Logic:**
3027 | 
3028 | * **`HistoryDrawer`**
3029 |   * **Logic Flow:**
3030 |     * `âš¡ GATEWAY: OpenAPI SDK replaces Axios`
3031 | 
3032 | ---
3033 | ### ðŸ“„ `PolicyEditor.tsx`
3034 | > Advanced Policy Editor utilizing isolated Fractal Components and URL state.
3035 | 
3036 | | Attribute | Value |
3037 | | :--- | :--- |
3038 | | **security-level** | `LEVEL 9 (UI Validation) */` |
3039 | 
3040 | **Components & Logic:**
3041 | 
3042 | * **`PolicyEditor`**
3043 |   * **Logic Flow:**
3044 |     * `âš¡ HYDRATED DATA SOURCE`
3045 |     * `âš¡ DEEP LINKING BY DEFAULT (Cures History Drawer Amnesia)`
3046 |     * `--- HANDLERS ---`
3047 | 
3048 | ---
3049 | ### ðŸ“„ `TestPanel.tsx`
3050 | > A sandbox to test logic before deploying it to production.
3051 | 
3052 | **Components & Logic:**
3053 | 
3054 | * **`TestPanel`**
3055 |   * **Logic Flow:**
3056 |     * `Default mock data based on standard "host" envelope`
3057 | 
3058 | ---
3059 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/components/editor/logic/`
3060 | 
3061 | ### ðŸ“„ `LogicBuilder.tsx`
3062 | > Recursive Subject-Verb-Object Composer for Governance Rules.
3063 | 
3064 | **Components & Logic:**
3065 | 
3066 | * **`LogicBuilder`**
3067 |   * **Logic Flow:**
3068 |     * `PARSER (Heuristic Fallback to Code Mode)`
3069 |     * `COMPILER`
3070 |     * `HANDLERS`
3071 |     * `RENDERERS`
3072 | 
3073 | ---
3074 | ### ðŸ“„ `SubjectPicker.tsx`
3075 | > Smart Context Selector.
3076 | 
3077 | **Components & Logic:**
3078 | 
3079 | * **`SubjectPicker`**
3080 |   * **Logic Flow:**
3081 |     * `âš¡ THE DUMB UI LINK: Read Context directly from Kernel Capabilities`
3082 |     * `âš¡ STATE HYDRATION: Restore tab and domain from existing value`
3083 |     * `Check Host`
3084 |     * `Check Dynamic Context Roots (e.g. actor., system., config.)`
3085 |     * `Assume Global Domain (e.g., "user.email" -> Domain "USER")`
3086 |     * `Ensure it's not a known root`
3087 |     * `âš¡ LAZY LOAD: Global Domain List`
3088 |     * `âš¡ LAZY LOAD: Specific Domain Schema`
3089 |     * `--- RENDERERS ---`
3090 |     * `âš¡ DYNAMIC CASCADER (Builds options from Backend schema payload)`
3091 | 
3092 | ---
3093 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/components/list/`
3094 | 
3095 | ### ðŸ“„ `PolicyExplorer.tsx`
3096 | > Navigable list of Governance Policies.
3097 | 
3098 | **Components & Logic:**
3099 | 
3100 | * **`PolicyExplorer`**
3101 |   * **Logic Flow:**
3102 |     * `âš¡ DEEP LINKING: Replaced useState with useUrlState`
3103 |     * `âš¡ TELEMETRY: Trace Component Lifecycle`
3104 |     * `Helper to format v1.05`
3105 |     * `Default to v1.00 if missing (legacy data)`
3106 |     * `âš¡ SHOW VERSION`
3107 | 
3108 | ---
3109 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/governance/hooks/`
3110 | 
3111 | ### ðŸ“„ `useGovernance.ts`
3112 | > Manages Policy State and Fuses Domain Schema with System Context. Uses OpenAPI SDK.
3113 | 
3114 | | Attribute | Value |
3115 | | :--- | :--- |
3116 | | **security-level** | `LEVEL 9 (Schema Fusion) */` |
3117 | | **updated** | `Added Data Normalization to convert Schema Dictionary -> Array. Fixes 'filter is not a function' crash. */` |
3118 | 
3119 | **Components & Logic:**
3120 | 
3121 | * **`useGovernance`**
3122 |   * **Logic Flow:**
3123 |     * `1. FETCH POLICIES (The Law)`
3124 |     * `Note: In standard architecture, policies are fetched globally and bound locally.`
3125 |     * `2. FETCH FUSED SCHEMA (The Vocabulary)`
3126 |     * `âš¡ ADAPTER: Normalize Dictionary to Array for UI Consumption`
3127 |     * `If it's already an array, pass it through (Legacy Safe)`
3128 |     * `If it's a Dictionary, convert to Array and inject 'group' for grouping logic`
3129 |     * `3. CREATE POLICY`
3130 |     * `4. UPDATE POLICY`
3131 |     * `5. DELETE POLICY`
3132 |     * `Explicit cast to 'any' to handle OpenAPI Codegen delete signature if it varies`
3133 |     * `6. DRY RUN`
3134 |     * `Data`
3135 |     * `Actions`
3136 |     * `State`
3137 | 
3138 | ---
3139 | ### ðŸ“„ `usePolicyBindings.ts`
3140 | > Manages enforcement jurisdictions. Uses OpenAPI SDK.
3141 | 
3142 | | Attribute | Value |
3143 | | :--- | :--- |
3144 | | **security-level** | `LEVEL 9 (API Integration) */` |
3145 | 
3146 | **Components & Logic:**
3147 | 
3148 | * **`usePolicyBindings`**
3149 |   * **Logic Flow:**
3150 |     * `1. FETCH BINDINGS`
3151 |     * `2. CREATE BINDING`
3152 |     * `3. TOGGLE/UPDATE BINDING`
3153 |     * `4. DELETE BINDING`
3154 | 
3155 | ---
3156 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/`
3157 | 
3158 | ### ðŸ“„ `WorkflowsTool.tsx`
3159 | > The V2-Native wrapper for the Workflow Engine. Injected with P1-DIAG-02 probes.
3160 | 
3161 | | Attribute | Value |
3162 | | :--- | :--- |
3163 | | **security-level** | `LEVEL 9 (UI Safe) */` |
3164 | 
3165 | **Components & Logic:**
3166 | 
3167 | * **`WorkflowsTool`**
3168 |   * **Logic Flow:**
3169 |     * `ðŸ”¬ BLACK BOX PROBE: P1-DIAG-02 (WorkflowsTool)`
3170 |     * `âš¡ SYNC ENGINE: Ensure Kernel is aware of Router URL changes`
3171 | 
3172 | ---
3173 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/`
3174 | 
3175 | ### ðŸ› ï¸ `CodeEditorDrawer.tsx`
3176 | > Raw XState JSON Editor with syntax validation and live graph sync.
3177 | 
3178 | | Attribute | Value |
3179 | | :--- | :--- |
3180 | | **security-level** | `LEVEL 9 */` |
3181 | 
3182 | **Components & Logic:**
3183 | 
3184 | * **`CodeEditorDrawer`**
3185 |   * ðŸ“ *The low-level interface for direct XState manipulation.*
3186 |   * **Logic Flow:**
3187 |     * `âš¡ SIGNAL TELEMETRY: Source Sync`
3188 |     * `Basic Schema Check`
3189 | 
3190 | ---
3191 | ### ðŸ“„ `EditorToolbar.tsx`
3192 | > The Control Deck for the Workflow Editor. Restored the Back Button for navigation.
3193 | 
3194 | | Attribute | Value |
3195 | | :--- | :--- |
3196 | | **security-level** | `LEVEL 9 (UI Safe Guards) */` |
3197 | 
3198 | **Components & Logic:**
3199 | 
3200 | * **`EditorToolbar`**
3201 |   * ðŸ“ *The top navigation bar for the workflow editor.*
3202 | 
3203 | ---
3204 | ### ðŸ“„ `FlowCanvas.tsx`
3205 | > Renders the Interactive Node Graph with Auto-Layout. Rewired to V2 Nodes.
3206 | 
3207 | | Attribute | Value |
3208 | | :--- | :--- |
3209 | | **security-level** | `LEVEL 9 (UI Invariant) */` |
3210 | 
3211 | **Components & Logic:**
3212 | 
3213 | * **`FlowCanvas`**
3214 | 
3215 | ---
3216 | ### ðŸ“„ `WorkflowEditor.tsx`
3217 | > The Canvas and Inspector workspace. Legacy dependencies completely severed.
3218 | 
3219 | | Attribute | Value |
3220 | | :--- | :--- |
3221 | | **security-level** | `LEVEL 9 (UI Safe) */` |
3222 | 
3223 | **Components & Logic:**
3224 | 
3225 | * **`WorkflowEditor`**
3226 |   * **Logic Flow:**
3227 |     * `âš¡ DEEP LINKING BY DEFAULT`
3228 |     * `âš¡ REACTFLOW HANDLERS`
3229 |     * `âš¡ API MUTATION HANDLERS`
3230 | 
3231 | ---
3232 | ### ðŸ“„ `WorkflowExplorer.tsx`
3233 | > Renders a filterable gallery of workflows. Now strictly uses V2 imports.
3234 | 
3235 | | Attribute | Value |
3236 | | :--- | :--- |
3237 | | **security-level** | `LEVEL 9 (UI Safe) */` |
3238 | 
3239 | **Components & Logic:**
3240 | 
3241 | * **`WorkflowExplorer`**
3242 |   * **Logic Flow:**
3243 |     * `âš¡ CONTEXT`
3244 |     * `âš¡ DEEP LINKING BY DEFAULT`
3245 |     * `âš¡ DATA FETCH`
3246 |     * `âš¡ LOGIC: Filter Workflows`
3247 |     * `âš¡ HANDLERS`
3248 |     * `âš¡ SAFE RETURN: Loading State`
3249 | 
3250 | ---
3251 | ### ðŸ“„ `WorkflowGenesis.tsx`
3252 | > UI for defining the root properties of a new State Machine. Rewired to V2.
3253 | 
3254 | | Attribute | Value |
3255 | | :--- | :--- |
3256 | | **security-level** | `LEVEL 9 (Data Validation) */` |
3257 | 
3258 | **Components & Logic:**
3259 | 
3260 | * **`WorkflowGenesis`**
3261 |   * **Logic Flow:**
3262 |     * `âš¡ ROBUST DOMAIN RESOLUTION`
3263 |     * `âš¡ V2 HOOKS`
3264 |     * `Reset form on open`
3265 |     * `V2 uses 'updateWorkflow' (which runs POST) for creation`
3266 | 
3267 | ---
3268 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/canvas/`
3269 | 
3270 | ### ðŸ“„ `CanvasNodes.tsx`
3271 | > Renders ReactFlow Custom Nodes (Screen, Task, Standard) representing workflow states.
3272 | 
3273 | | Attribute | Value |
3274 | | :--- | :--- |
3275 | | **security-level** | `LEVEL 9 (UI Safe) */` |
3276 | 
3277 | **Components & Logic:**
3278 | 
3279 | * **`CanvasNodeData`**
3280 |   * ðŸ“ *--- SHARED DOMAIN TYPES ---*
3281 |   * **Logic Flow:**
3282 |     * `============================================================================`
3283 |     * `1. SCREEN NODE (WIZARD VISUAL)`
3284 |     * `============================================================================`
3285 | * **`ScreenNode`**
3286 |   * **Logic Flow:**
3287 |     * `============================================================================`
3288 |     * `2. STANDARD NODE (GOVERNANCE VISUAL)`
3289 |     * `============================================================================`
3290 | * **`StandardNode`**
3291 |   * ðŸ“ *============================================================================*
3292 |   * **Logic Flow:**
3293 |     * `============================================================================`
3294 |     * `3. TASK NODE (JOB VISUAL)`
3295 |     * `============================================================================`
3296 | * **`TaskNode`**
3297 |   * ðŸ“ *============================================================================*
3298 | 
3299 | ---
3300 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/inspector/`
3301 | 
3302 | ### ðŸ“„ `InspectorShell.tsx`
3303 | > Standardized outer frame for inspector panels. Preserves pixel-perfect legacy appearance.
3304 | 
3305 | | Attribute | Value |
3306 | | :--- | :--- |
3307 | | **security-level** | `LEVEL 9 */` |
3308 | 
3309 | **Components & Logic:**
3310 | 
3311 | * **`SelectionType`**
3312 | * **`InspectorShell`**
3313 |   * ðŸ“ *Renders the high-density container for node editing. [cite: 2855-2884]*
3314 |   * **Logic Flow:**
3315 |     * `âš¡ SIGNAL TELEMETRY: Render tracking`
3316 | 
3317 | ---
3318 | ### ðŸ“„ `JobNode.tsx`
3319 | > Configuration for Async Background Tasks (Queues, Handlers, Retries).
3320 | 
3321 | | Attribute | Value |
3322 | | :--- | :--- |
3323 | | **security-level** | `LEVEL 9 */` |
3324 | 
3325 | **Components & Logic:**
3326 | 
3327 | * **`JobNode`**
3328 |   * ðŸ“ *Decoupled V2 editor for background task nodes. [cite: 2885-2923]*
3329 |   * **Logic Flow:**
3330 |     * `âš¡ SIGNAL TELEMETRY: Init`
3331 | 
3332 | ---
3333 | ### ðŸ“„ `StandardNode.tsx`
3334 | > Basic configuration for Lifecycle/Governance States (Color, Documentation).
3335 | 
3336 | | Attribute | Value |
3337 | | :--- | :--- |
3338 | | **security-level** | `LEVEL 9 */` |
3339 | 
3340 | **Components & Logic:**
3341 | 
3342 | * **`StandardNode`**
3343 |   * ðŸ“ *Decoupled V2 editor for basic state nodes. [cite: 2954-2981]*
3344 |   * **Logic Flow:**
3345 |     * `âš¡ SIGNAL TELEMETRY: Init`
3346 | 
3347 | ---
3348 | ### ðŸ“„ `TransitionEdge.tsx`
3349 | > Manages the logic connecting two nodes, including events, guards, and side effects.
3350 | 
3351 | | Attribute | Value |
3352 | | :--- | :--- |
3353 | | **security-level** | `LEVEL 9 */` |
3354 | 
3355 | **Components & Logic:**
3356 | 
3357 | * **`TransitionEdge`**
3358 |   * ðŸ“ *Decoupled V2 inspector for Workflow Edges. [cite: 2988-3027]*
3359 |   * **Logic Flow:**
3360 |     * `âš¡ SIGNAL TELEMETRY: Component Init`
3361 | 
3362 | ---
3363 | ### ðŸ“„ `WizardNode.tsx`
3364 | > Orchestrates Wizard Step configuration. Manages step metadata and the field collection.
3365 | 
3366 | | Attribute | Value |
3367 | | :--- | :--- |
3368 | | **security-level** | `LEVEL 9 */` |
3369 | 
3370 | **Components & Logic:**
3371 | 
3372 | * **`WIZARD_COMPONENTS`**
3373 |   * ðŸ“ *Rich component registry for user-facing selection [cite: 3034-3048] */*
3374 | * **`WizardNode`**
3375 |   * **Logic Flow:**
3376 |     * `âš¡ SIGNAL TELEMETRY: Component Lifecycle`
3377 | 
3378 | ---
3379 | ### ðŸ“„ `WorkflowInspector.tsx`
3380 | > Orchestrates the contextual editing of Nodes. Added Editable Raw JSON tab.
3381 | 
3382 | | Attribute | Value |
3383 | | :--- | :--- |
3384 | | **security-level** | `LEVEL 9 */` |
3385 | 
3386 | **Components & Logic:**
3387 | 
3388 | * **`WorkflowInspector`**
3389 |   * **Logic Flow:**
3390 |     * `âš¡ DEEP LINKING BY DEFAULT`
3391 |     * `âš¡ LOCAL STATE: JSON Editor Buffer`
3392 |     * `âš¡ TELEMETRY PROBE: Selection Change`
3393 |     * `âš¡ SYNC JSON BUFFER: Keep the text area updated when nodeData changes externally`
3394 |     * `âš¡ HANDLER: Apply JSON Mutations`
3395 | 
3396 | ---
3397 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/components/inspector/_atoms/`
3398 | 
3399 | ### ðŸ“„ `FieldCard.tsx`
3400 | > Renders the draggable, space-optimized cards for individual form fields.
3401 | 
3402 | | Attribute | Value |
3403 | | :--- | :--- |
3404 | | **security-level** | `LEVEL 9 */` |
3405 | 
3406 | **Components & Logic:**
3407 | 
3408 | * **`FieldCard`**
3409 |   * ðŸ“ *Atomic component for managing the list of fields within a Wizard step. [cite: 3069-3101]*
3410 | 
3411 | ---
3412 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/`
3413 | 
3414 | ### ðŸ“„ `constants.tsx`
3415 | > Centralized definitions for Workflow Types, Icons, and Metadata. Localized to V2.
3416 | 
3417 | | Attribute | Value |
3418 | | :--- | :--- |
3419 | | **security-level** | `LEVEL 9 (Read-Only Data) */` |
3420 | 
3421 | **Components & Logic:**
3422 | 
3423 | * **`WorkflowTypeDef`**
3424 |   * **Logic Flow:**
3425 |     * `âš¡ V2 LOCALIZED CONSTANTS`
3426 | * **`WORKFLOW_TYPES`**
3427 |   * ðŸ“ *âš¡ V2 LOCALIZED CONSTANTS*
3428 | * **`DEFAULT_WORKFLOW_ICON`**
3429 | * **`getWorkflowMeta`**
3430 | 
3431 | ---
3432 | ## ðŸ“‚ `frontend/src/domains/meta_v2/features/workflows/hooks/`
3433 | 
3434 | ### ðŸ“„ `useCanvasHistory.ts`
3435 | > Provides Undo/Redo capability for ReactFlow with debounced snapshots.
3436 | 
3437 | | Attribute | Value |
3438 | | :--- | :--- |
3439 | | **security-level** | `LEVEL 9 */` |
3440 | 
3441 | **Components & Logic:**
3442 | 
3443 | * **`useCanvasHistory`**
3444 |   * **Logic Flow:**
3445 |     * `âš¡ SNAPSHOT ENGINE`
3446 |     * `Limit history depth to 50`
3447 |     * `âš¡ UNDO`
3448 |     * `âš¡ REDO`
3449 | 
3450 | ---
3451 | ### ðŸ“„ `useDomainSchema.ts`
3452 | > Fetches and normalizes the Domain Schema from the Kernel for the V2 Workflow Engine.
3453 | 
3454 | | Attribute | Value |
3455 | | :--- | :--- |
3456 | | **security-level** | `LEVEL 9 (Type Safety) */` |
3457 | 
3458 | **Components & Logic:**
3459 | 
3460 | * **`useDomainSchema`**
3461 |   * **Logic Flow:**
3462 |     * `âš¡ FIX: Namespaced Key 'workflow_schema' to prevent collision with Governance 'schema' key.`
3463 |     * `This ensures this hook always runs its own normalization logic (Array) instead of receiving a raw Object from cache.`
3464 |     * `1. Fetch from Backend`
3465 |     * `2. âš¡ NORMALIZATION LOGIC`
3466 | 
3467 | ---
3468 | ### ðŸ“„ `useEditorSession.ts`
3469 | > Manages the 'VIEW' vs 'EDIT' state and the Draft copy. Crash-proofed against undefined transitions.
3470 | 
3471 | | Attribute | Value |
3472 | | :--- | :--- |
3473 | | **security-level** | `LEVEL 9 (State Integrity) */` |
3474 | 
3475 | **Components & Logic:**
3476 | 
3477 | * **`useEditorSession`**
3478 |   * **Logic Flow:**
3479 |     * `âš¡ AUTO-RESET: When changing workflows, always revert to VIEW and clear draft.`
3480 |     * `ðŸ›¡ï¸ CRASH FIX: Safe extraction of definition`
3481 |     * `Look for 'transitions' first, fallback to 'definition', fallback to empty XState structure`
3482 |     * `Suppress heavy logging here as this fires rapidly on node drag`
3483 | 
3484 | ---
3485 | ### ðŸ“„ `useWorkflows.ts`
3486 | > React Query wrappers for the State Engine API. Fully instrumented with Narrator.
3487 | 
3488 | | Attribute | Value |
3489 | | :--- | :--- |
3490 | | **security-level** | `LEVEL 9 (Data Access) */` |
3491 | 
3492 | **Components & Logic:**
3493 | 
3494 | * **`WorkflowDefinition`**
3495 | * **`useWorkflows`**
3496 |   * **Logic Flow:**
3497 |     * `1. Fetch List`
3498 |     * `2. Create / Update`
3499 |     * `The API expects the full definition wrapper`
3500 |     * `3. Delete`
3501 | 
3502 | ---
3503 | ## ðŸ“‚ `frontend/src/domains/meta_v2/`
3504 | 
3505 | ### ðŸ“„ `manifest.tsx`
3506 | > Registers the V2 System Configurator in the Global Menu.
3507 | 
3508 | | Attribute | Value |
3509 | | :--- | :--- |
3510 | | **security-level** | `LEVEL 0 (Public) */` |
3511 | 
3512 | **Components & Logic:**
3513 | 
3514 | * **`metaV2Manifest`**
3515 | 
3516 | ---
3517 | ## ðŸ“‚ `frontend/src/domains/system/api/`
3518 | 
3519 | ### ðŸ“„ `index.ts`
3520 | > Typed fetchers for System Internals.
3521 | 
3522 | **Components & Logic:**
3523 | 
3524 | * **`SystemAPI`**
3525 | 
3526 | ---
3527 | ## ðŸ“‚ `frontend/src/domains/system/features/admin_console/`
3528 | 
3529 | ### ðŸ“„ `ConfigDrawer.tsx`
3530 | > A dynamic form for editing SystemConfig values.
3531 | 
3532 | **Components & Logic:**
3533 | 
3534 | * **`ConfigDrawer`**
3535 |   * **Logic Flow:**
3536 |     * `âš¡ TELEMETRY: Log Access`
3537 |     * `Sync form with config prop`
3538 | 
3539 | ---
3540 | ### ðŸ“„ `SystemDashboard.tsx`
3541 | > Master Control Plane for System Administrators to toggle Modules, Circuits, and Global Settings.
3542 | 
3543 | | Attribute | Value |
3544 | | :--- | :--- |
3545 | | **security-level** | `LEVEL 9 (Admin Control) */` |
3546 | | **invariant** | `'safety.isOn' must be strictly enforced before allowing any toggles. */` |
3547 | | **narrator** | `Logs intent and outcome for all system-level mutations. */` |
3548 | | **updated** | `Re-wired IconFactory to read from Database SSOT (module_icon) instead of hardcoded fallbacks. */` |
3549 | 
3550 | ---
3551 | ## ðŸ“‚ `frontend/src/domains/system/features/identity/`
3552 | 
3553 | ### ðŸ“„ `SystemIdentityCard.tsx`
3554 | > A dense information display for the User Avatar Menu.
3555 | 
3556 | **Components & Logic:**
3557 | 
3558 | * **`SystemIdentityCard`**
3559 | 
3560 | ---
3561 | ## ðŸ“‚ `frontend/src/domains/system/hooks/`
3562 | 
3563 | ### ðŸ“„ `useSystemControl.ts`
3564 | > Smartly routes toggle requests to either Domain Governance or Circuit Hypervisor.
3565 | 
3566 | **Components & Logic:**
3567 | 
3568 | * **`useSystemControl`**
3569 |   * **Logic Flow:**
3570 |     * `1. Fetch Domains (Modules & Scopes)`
3571 |     * `2. Fetch Screens (Raw Circuits)`
3572 |     * `We fetch all circuits of type 'SCREEN'`
3573 |     * `3. Fetch System Config`
3574 |     * `âš¡ POLYMORPHIC TOGGLER`
3575 |     * `BRANCH A: Circuit Target (Scope/Screen) -> Uses ':' as separator`
3576 |     * `BRANCH B: Domain Target (Simple Key) -> Uses legacy patch`
3577 |     * `Map UI/API to config keys`
3578 |     * `Invalidate everything to be safe`
3579 | 
3580 | ---
3581 | ### ðŸ“„ `useSystemPulse.ts`
3582 | > Polls the System API to maintain situational awareness.
3583 | 
3584 | **Components & Logic:**
3585 | 
3586 | * **`useSystemPulse`**
3587 |   * **Logic Flow:**
3588 |     * `âš¡ TELEMETRY: Only whisper if something changed or on first load`
3589 |     * `Boot Sequence`
3590 |     * `âš¡ HEARTBEAT: Poll every 60 seconds to detect version changes`
3591 | 
3592 | ---
3593 | ## ðŸ“‚ `frontend/src/domains/system/`
3594 | 
3595 | ### ðŸ“„ `manifest.tsx`
3596 | > Registers the "System Internals" domain.
3597 | 
3598 | **Components & Logic:**
3599 | 
3600 | * **`systemManifest`**
3601 | 
3602 | ---
3603 | ### ðŸ“„ `types.ts`
3604 | > TypeScript definitions for System Domain.
3605 | 
3606 | **Components & Logic:**
3607 | 
3608 | * **`SystemIdentity`**
3609 |   * ðŸ“ *TypeScript definitions for System Domain.*
3610 | * **`SystemVersioning`**
3611 | * **`SystemHealth`**
3612 |   * **Logic Flow:**
3613 |     * `The Aggregate Payload`
3614 | * **`SystemPulse`**
3615 |   * ðŸ“ *The Aggregate Payload*
3616 |   * **Logic Flow:**
3617 |     * `âš¡ NEW: Governance Types`
3618 | * **`KernelScope`**
3619 |   * ðŸ“ *âš¡ NEW: Governance Types*
3620 | * **`KernelDomain`**
3621 |   * **Logic Flow:**
3622 |     * `âš¡ NEW: Hierarchy`
3623 | * **`SystemConfig`**
3624 | 
3625 | ---
3626 | ## ðŸ“‚ `frontend/src/domains/workspace/features/widget_runner/`
3627 | 
3628 | ### ðŸ“„ `WidgetHost.tsx`
3629 | > Connects the URL Route to the Active App definition.
3630 | 
3631 | **Components & Logic:**
3632 | 
3633 | * **`WidgetHost`**
3634 |   * **Logic Flow:**
3635 |     * `1. PARSE URL TO FIND APP SCOPE`
3636 |     * `2. FIND APP DEFINITION`
3637 |     * `âš¡ 3. PRE-FLIGHT GOVERNANCE CHECK (Loud)`
3638 |     * `We use 'console.log' directly here for formatting, or extend Narrator`
3639 |     * `4. RENDER`
3640 | 
3641 | ---
3642 | ### ðŸ“„ `WidgetRegistry.tsx`
3643 | > Mounts the widget only after a LIVE, GRANULAR Governance Check.
3644 | 
3645 | **Components & Logic:**
3646 | 
3647 | * **`WidgetRegistry`**
3648 |   * **Logic Flow:**
3649 |     * `Parse Scope (e.g. "USER:USER_ADMIN" -> domain="USER", scope="USER_ADMIN")`
3650 |     * `âš¡ REAL-TIME GOVERNANCE STATE`
3651 |     * `We start in 'CHECKING' to prevent rendering the widget before we know it's safe.`
3652 |     * `âš¡ DIRECT CHECK: Bypass the Manifest Cache`
3653 |     * `We ask the kernel specifically about the system domains right now.`
3654 |     * `1. Evaluate Domain Level Switches`
3655 |     * `2. Evaluate Scope Level Switches (The Deep Check)`
3656 |     * `Check if specific UI circuit is HALTED`
3657 |     * `Scope defined in frontend but missing in backend registry?`
3658 |     * `Fail Open for development, but log warning.`
3659 |     * `Determine specific reason for user feedback`
3660 |     * `Fail Safe: Security best practice is Fail Closed (Deny).`
3661 |     * `âš¡ RENDER LOGIC`
3662 |     * `âš¡ MOUNT WIDGET (Permission Granted)`
3663 | 
3664 | ---
3665 | ## ðŸ“‚ `frontend/src/domains/workspace/hooks/`
3666 | 
3667 | ### ðŸ“„ `useBricks.ts`
3668 | > Fetches available System Capabilities (Bricks) for the App Studio.
3669 | 
3670 | | Attribute | Value |
3671 | | :--- | :--- |
3672 | | **security-level** | `LEVEL 9 (Read-Only) */` |
3673 | | **invariant** | `Must return a stable list of SystemBrick objects. */` |
3674 | 
3675 | **Components & Logic:**
3676 | 
3677 | * **`useBricks`**
3678 |   * **Logic Flow:**
3679 |     * `âš¡ FIX: Use the auto-generated verbose method name`
3680 | 
3681 | ---
3682 | ### ðŸ“„ `useWorkspace.tsx`
3683 | > Fetches Layout Data and normalizes it for the UI.
3684 | 
3685 | | Attribute | Value |
3686 | | :--- | :--- |
3687 | | **updated** | `Added robust Label Fallback to prevent "Ghost Apps" in Sidebar. */` |
3688 | 
3689 | **Components & Logic:**
3690 | 
3691 | * **`useWorkspace`**
3692 |   * **Logic Flow:**
3693 |     * `âš¡ SAFE GUARDS`
3694 | 
3695 | ---
3696 | ## ðŸ“‚ `frontend/src/domains/workspace/`
3697 | 
3698 | ### ðŸ“„ `types.ts`
3699 | > Defines the shape of the Runtime Application and Release Metadata.
3700 | 
3701 | | Attribute | Value |
3702 | | :--- | :--- |
3703 | | **security-level** | `LEVEL 0 (Core Types) */` |
3704 | | **invariant** | `Must match 'backend/app/domains/workspace/schemas.py' contracts. */` |
3705 | | **updated** | `Added 'meta' field to RuntimeLayout to support Versioning. */` |
3706 | 
3707 | **Components & Logic:**
3708 | 
3709 | * **`BrickType`**
3710 |   * ðŸ“ *--- 1. THE BRICK ---*
3711 |   * **Logic Flow:**
3712 |     * `--- 2. THE SCREEN ---`
3713 | * **`Screen`**
3714 |   * ðŸ“ *--- 2. THE SCREEN ---*
3715 |   * **Logic Flow:**
3716 |     * `âš¡ EAGER LOADED (Lobby Richness)`
3717 |     * `--- 3. THE APP ---`
3718 | * **`ActiveApp`**
3719 |   * ðŸ“ *--- 3. THE APP ---*
3720 |   * **Logic Flow:**
3721 |     * `âš¡ JSON RESPONSE ADAPTATION`
3722 |     * `The Layout API returns a simplified view, IDs might be implicit or missing in read-mode`
3723 |     * `Identity`
3724 |     * `âš¡ FIX: Match Backend JSON exactly ("type", not "scope_type")`
3725 |     * `Configuration (The Paint)`
3726 |     * `Backend sends "intent" in layout, but "config" in DB. We support both.`
3727 |     * `Placement`
3728 |     * `--- 4. RELEASE HISTORY ---`
3729 | * **`Release`**
3730 |   * ðŸ“ *--- 4. RELEASE HISTORY ---*
3731 |   * **Logic Flow:**
3732 |     * `--- 5. THE RUNTIME LAYOUT ---`
3733 | * **`RuntimeLayout`**
3734 |   * ðŸ“ *--- 5. THE RUNTIME LAYOUT ---*
3735 |   * **Logic Flow:**
3736 |     * `âš¡ VERSION CONTROL INTELLIGENCE`
3737 | 
3738 | ---
3739 | ## ðŸ“‚ `frontend/src/domains/workspace/views/`
3740 | 
3741 | ### ðŸ“„ `WorkspaceRuntime.tsx`
3742 | > Bridges Logic to UI with crash protection and Governance Checks.
3743 | 
3744 | **Components & Logic:**
3745 | 
3746 | * **`WorkspaceRuntime`**
3747 |   * ðŸ“ *âš¡ NEW*
3748 |   * **Logic Flow:**
3749 |     * `1. DATA LINK`
3750 |     * `2. GOVERNANCE SYNC (Critical Fix)`
3751 |     * `When entering a Workspace, we MUST know the latest System State.`
3752 |     * `If an Admin just disabled a module, we can't rely on a 5-minute cache.`
3753 |     * `3. SECURITY GATE & LOGGING`
3754 |     * `âš¡ GOVERNANCE ROLL CALL`
3755 |     * `3. RENDER THE SHELL`
3756 | 
3757 | ---
3758 | ## ðŸ“‚ `frontend/src/lab/workflow/`
3759 | 
3760 | ### ðŸ“„ `TestWorkflow.tsx`
3761 | > FILEPATH: frontend/src/lab/workflow/TestWorkflow.tsx */
3762 | 
3763 | **Components & Logic:**
3764 | 
3765 | * **`TestWorkflow`**
3766 |   * **Logic Flow:**
3767 |     * `âš¡ DYNAMIC STATE: Allow AI to overwrite the definition in memory`
3768 |     * `1. Fetch the Seeded Definition (Baseline)`
3769 |     * `âš¡ GATEWAY: Use standardized base`
3770 |     * `2. Handle AI Generation (Hot-Swap)`
3771 |     * `3. Handle Transitions`
3772 | 
3773 | ---
3774 | ## ðŸ“‚ `frontend/src/`
3775 | 
3776 | ### ðŸ“„ `main.tsx`
3777 | > FILEPATH: frontend/src/main.tsx */
3778 | 
3779 | ---
3780 | ## ðŸ“‚ `frontend/src/pages/`
3781 | 
3782 | ### ðŸ“„ `TestWorkflow.tsx`
3783 | > FILEPATH: frontend/src/pages/TestWorkflow.tsx */
3784 | 
3785 | **Components & Logic:**
3786 | 
3787 | * **`TestWorkflow`**
3788 |   * **Logic Flow:**
3789 |     * `ðŸŽ¨ THEME ENGINE HOOK`
3790 |     * `âš¡ GATEWAY: Use standardized base`
3791 |     * `--- STYLES (Dynamic based on Theme) ---`
3792 | 
3793 | ---
3794 | ## ðŸ“‚ `frontend/src/platform/auth/`
3795 | 
3796 | ### ðŸ“„ `AuthContext.tsx`
3797 | > FILEPATH: frontend/src/platform/auth/AuthContext.tsx */
3798 | 
3799 | **Components & Logic:**
3800 | 
3801 | * **`AuthProvider`**
3802 |   * **Logic Flow:**
3803 |     * `Start the Machine`
3804 |     * `Helper Hook for easy access`
3805 | * **`useAuth`**
3806 |   * ðŸ“ *Helper Hook for easy access*
3807 | 
3808 | ---
3809 | ### ðŸ“„ `LoginScreen.tsx`
3810 | > FILEPATH: frontend/src/platform/auth/LoginScreen.tsx */
3811 | 
3812 | ---
3813 | ### ðŸ“„ `machine.ts`
3814 | > FILEPATH: frontend/src/platform/auth/machine.ts */
3815 | 
3816 | **Components & Logic:**
3817 | 
3818 | * **`authMachine`**
3819 |   * ðŸ“ *4. The Machine Definition*
3820 |   * **Logic Flow:**
3821 |     * `1. Boot Sequence`
3822 |     * `2. Login Flow`
3823 |     * `3. The Async "Thinking" State`
3824 |     * `4. The Platform`
3825 | 
3826 | ---
3827 | ## ðŸ“‚ `frontend/src/platform/core/`
3828 | 
3829 | ### ðŸ“„ `ModuleRegistry.ts`
3830 | > Singleton registry for Feature Modules.
3831 | 
3832 | **Components & Logic:**
3833 | 
3834 | * **`ModuleManifest`**
3835 | * **`MenuItem`**
3836 |   * **Logic Flow:**
3837 |     * `Silent discovery to keep console clean, we log the result later`
3838 |     * `ðŸ” DIAGNOSTIC LOG`
3839 |     * `logger.trace('REGISTRY', 'Generated Menu Items', items);`
3840 |     * `STRATEGY A: NESTED LAYOUT (Parent "/key" -> Children "path")`
3841 |     * `STRATEGY B: FLAT ROUTES (Prefix "/key/path")`
3842 |     * `âš¡ ROUTING TELEMETRY (The "Help Me" Feature)`
3843 |     * `Parent`
3844 |     * `Children`
3845 |     * `Flat`
3846 | * **`ModuleRegistry`**
3847 | 
3848 | ---
3849 | ## ðŸ“‚ `frontend/src/platform/design/system/`
3850 | 
3851 | ### ðŸ“„ `useNotification.ts`
3852 | > FILEPATH: frontend/src/platform/design/system/useNotification.ts */
3853 | 
3854 | **Components & Logic:**
3855 | 
3856 | * **`useNotification`**
3857 |   * **Logic Flow:**
3858 |     * `âš¡ HOOK INTO ANT DESIGN APP CONTEXT`
3859 |     * `This requires the component to be wrapped in <App> (which is done in App.tsx)`
3860 |     * `DX Wrapper: Provides semantic methods matching the old API`
3861 |     * `Advanced usage with Title + Description`
3862 | 
3863 | ---
3864 | ## ðŸ“‚ `frontend/src/platform/hooks/`
3865 | 
3866 | ### ðŸ“„ `useUrlState.ts`
3867 | > Provides a useState-like interface that persists to the URL Query String.
3868 | 
3869 | | Attribute | Value |
3870 | | :--- | :--- |
3871 | | **security-level** | `LEVEL 0 (Kernel Utility) */` |
3872 | | **invariant** | `Must handle browser history without causing page reloads. */` |
3873 | 
3874 | **Components & Logic:**
3875 | 
3876 | * **`useUrlState`**
3877 |   * ðŸ“ *Creates a state variable that syncs with a URL query parameter.*
3878 |   * **Logic Flow:**
3879 |     * `1. READ: Lazy initializer to read from URL only once on boot`
3880 |     * `2. WRITE: Updates both Local State and URL`
3881 |     * `Access the current URL state directly from the browser to avoid race conditions`
3882 |     * `âš¡ HISTORY: Use replaceState to avoid cluttering the "Back" button history with every click`
3883 |     * `If you want "Back" to undo the selection, change this to pushState.`
3884 |     * `For simple UI tabs/filters, replaceState is usually better UX.`
3885 |     * `3. LISTEN: (Optional) If the user clicks "Back", sync the internal state`
3886 | 
3887 | ---
3888 | ## ðŸ“‚ `frontend/src/platform/kernel/`
3889 | 
3890 | ### ðŸ“„ `BootLoader.tsx`
3891 | > FILEPATH: frontend/src/platform/kernel/BootLoader.tsx */
3892 | 
3893 | **Components & Logic:**
3894 | 
3895 | * **`BootLoader`**
3896 | 
3897 | ---
3898 | ### ðŸ“„ `SystemContext.tsx`
3899 | > Stores the Auto-Discovered System Manifest.
3900 | 
3901 | **Components & Logic:**
3902 | 
3903 | * **`SystemContextType`**
3904 |   * ðŸ“ *âš¡ EXPORTED INTERFACE*
3905 |   * **Logic Flow:**
3906 |     * `âš¡ SAFE DEFAULT: Prevents crash if accessed before provider mount (though unlikely)`
3907 | * **`SystemProvider`**
3908 |   * **Logic Flow:**
3909 |     * `âš¡ STABLE HANDLER: Force Refresh`
3910 |     * `Invalidate both manifest and specific queries to be safe`
3911 | * **`useSystem`**
3912 | 
3913 | ---
3914 | ### ðŸ“„ `types.ts`
3915 | > Shared definitions for the Operating System Core.
3916 | 
3917 | **Components & Logic:**
3918 | 
3919 | * **`ProcessStep`**
3920 |   * ðŸ“ *Shared definitions for the Operating System Core.*
3921 | * **`ProcessDefinition`**
3922 | * **`ModuleDefinition`**
3923 |   * **Logic Flow:**
3924 |     * `Legacy config support`
3925 |     * `âš¡ NEW: Navigation Node Contract (Matches Backend)`
3926 | * **`NavigationNode`**
3927 |   * ðŸ“ *âš¡ NEW: Navigation Node Contract (Matches Backend)*
3928 |   * **Logic Flow:**
3929 |     * `Architecture Metadata`
3930 |     * `Discovery`
3931 |     * `Config`
3932 |     * `Recursion`
3933 | * **`NavigationResponse`**
3934 | * **`SystemManifest`**
3935 |   * **Logic Flow:**
3936 |     * `âš¡ NEW: Secured Navigation Payload`
3937 | 
3938 | ---
3939 | ## ðŸ“‚ `frontend/src/platform/logging/`
3940 | 
3941 | ### ðŸ“„ `Narrator.ts`
3942 | > The "Storyteller" Observability System.
3943 | 
3944 | **Components & Logic:**
3945 | 
3946 | * **`UniversalNarrator`**
3947 |   * **Logic Flow:**
3948 |     * `âš¡ CONFIGURATION: Maximum Verbosity`
3949 |     * `We try to detect environment, but default to true if we can't tell, to ensure logging works.`
3950 |     * `--- PUBLIC API ---`
3951 |     * `âš¡ NEW: Grouping Support`
3952 |     * `--- INTERNAL ---`
3953 |     * `Line 0: Error`
3954 |     * `Line 1: _resolveCaller`
3955 |     * `Line 2: _broadcast`
3956 |     * `Line 3: tell/scream/whisper`
3957 |     * `Line 4: The actual caller <--- Target`
3958 |     * `Find the first line that is NOT inside Narrator.ts`
3959 |     * `This regex looks for file paths that include /src/`
3960 |     * `Extract file path: "    at Context (http://localhost:3000/src/file.ts:10:20)"`
3961 |     * `Clean up: Remove http://localhost:port/`
3962 |     * `Time Delta Calculation`
3963 |     * `Format Delta: [+450ms] or [+1.2s] or [-----] if idle > 5s`
3964 |     * `âš¡ X-RAY: Inject Caller Context`
3965 |     * `âš¡ IMPROVED OUTPUT`
3966 |     * `1. Live Object (Chrome DevTools lets you expand this)`
3967 |     * `2. Serialized Backup (For Copy/Paste) - âš¡ LOUD MODE: Limit increased significantly`
3968 |     * `--- SENTINELS ---`
3969 | * **`logger`**
3970 | 
3971 | ---
3972 | ### ðŸ“„ `index.ts`
3973 | > Exports the Singleton Logger for application-wide use.
3974 | 
3975 | | Attribute | Value |
3976 | | :--- | :--- |
3977 | | **security-level** | `LEVEL 0 (Kernel) */` |
3978 | | **invariant** | `Must always export a valid 'logger' instance. */` |
3979 | 
3980 | **Components & Logic:**
3981 | 
3982 | * **`logger`**
3983 |   * ðŸ“ *The Global Logger Instance.*
3984 |   * **Logic Flow:**
3985 |     * `Export Types if needed`
3986 | 
3987 | ---
3988 | ### ðŸ“„ `useTrace.ts`
3989 | > FILEPATH: frontend/src/platform/logging/useTrace.ts */
3990 | 
3991 | **Components & Logic:**
3992 | 
3993 | * **`useTrace`**
3994 |   * **Logic Flow:**
3995 |     * `1. Mount Log`
3996 |     * `2. Unmount Log`
3997 |     * `3. Update Log (Only if state changed deeply)`
3998 | 
3999 | ---
4000 | ## ðŸ“‚ `frontend/src/platform/routing/`
4001 | 
4002 | ### ðŸ“„ `RouterFactory.tsx`
4003 | > Converts System Manifest into React Router Object.
4004 | 
4005 | **Components & Logic:**
4006 | 
4007 | * **`createDynamicRouter`**
4008 |   * ðŸ“ *--- FACTORY ---*
4009 |   * **Logic Flow:**
4010 |     * `1. Define Static Routes (System & Dev Tools)`
4011 |     * `âš¡ SYSTEM ADMIN CONSOLE`
4012 |     * `Meta Kernel Routes`
4013 |     * `âš¡ META V2 (The Kernel Lab)`
4014 |     * `âœ… NESTED INSIDE SHELL to inherit Top Bar & Theme`
4015 |     * `âš¡ DYNAMIC WORKSPACE ROUTES (The "Player")`
4016 |     * `2. Construct Router`
4017 |     * `âš¡ SHELL IMPORT FIX (Lazy load avoided for Core Shell to prevent flicker)`
4018 | 
4019 | ---
4020 | ## ðŸ“‚ `frontend/src/platform/shell/`
4021 | 
4022 | ### ðŸ“„ `ShellLayout.tsx`
4023 | > Master Layout. Connects Backend Navigation to Ant Design Structure.
4024 | 
4025 | | Attribute | Value |
4026 | | :--- | :--- |
4027 | | **security-level** | `LEVEL 9 (UI Safe) */` |
4028 | | **invariant** | `Must gracefully handle empty navigation states (Guest Mode). */` |
4029 | 
4030 | **Components & Logic:**
4031 | 
4032 | * **`ShellLayout`**
4033 |   * **Logic Flow:**
4034 |     * `âš¡ COMMAND-K STATE`
4035 |     * `âš¡ DIAGNOSTIC: Log Mount`
4036 |     * `âš¡ KEYBOARD LISTENER (Discovery Engine)`
4037 |     * `1. DATA PREP (Flatten for Search)`
4038 |     * `âš¡ SEARCH FILTER LOGIC`
4039 |     * `Match Label`
4040 |     * `Match Key`
4041 |     * `âš¡ MATCH SEARCH TAGS (The "Dark Mode" -> "Appearance" Magic)`
4042 |     * `2. NAVIGATION HANDLER`
4043 |     * `A. Intercept Actions`
4044 |     * `B. Standard Navigation`
4045 |     * `User Menu Items`
4046 |     * `Fallbacks if empty`
4047 |     * `âš¡ BUILD SIDEBAR (From DB)`
4048 | 
4049 | ---
4050 | ### ðŸ“„ `Sidebar.tsx`
4051 | > Renders a collapsible data-driven sidebar with integrated branding toggle.
4052 | 
4053 | | Attribute | Value |
4054 | | :--- | :--- |
4055 | | **security-level** | `LEVEL 5 (Presentation) */` |
4056 | 
4057 | **Components & Logic:**
4058 | 
4059 | * **`SidebarProps`**
4060 | * **`Sidebar`**
4061 |   * **Logic Flow:**
4062 |     * `âš¡ HELPER: Recursive Menu Item Builder`
4063 |     * `âš¡ ACTIVE STATE RESOLUTION`
4064 | 
4065 | ---
4066 | ### ðŸ“„ `SidebarWrapper.tsx`
4067 | > Filters the menu structure based on Governance Rules.
4068 | 
4069 | **Components & Logic:**
4070 | 
4071 | * **`useSidebarSecurity`**
4072 |   * **Logic Flow:**
4073 |     * `If manifest isn't loaded yet, show default items (fail open/safe)`
4074 |     * `âš¡ FIX: Defensive Casting. item.id might be a number (DB ID).`
4075 |     * `Always allow System items (SYS) and Root (/)`
4076 |     * `Find config in Manifest`
4077 |     * `If module exists in manifest, obey its switches`
4078 |     * `Recursive check for children (Folders)`
4079 |     * `Optional: Hide empty folders if desired`
4080 |     * `if (item.children.length === 0) return false;`
4081 | 
4082 | ---
4083 | ### ðŸ“„ `ThemeContext.tsx`
4084 | > FILEPATH: frontend/src/platform/shell/ThemeContext.tsx */
4085 | 
4086 | **Components & Logic:**
4087 | 
4088 | * **`ThemeProvider`**
4089 |   * **Logic Flow:**
4090 |     * `1. Initialize State from LocalStorage`
4091 |     * `2. Actions`
4092 |     * `Update HTML attribute for global CSS hooks (e.g. scrollbars)`
4093 |     * `3. Compute Config`
4094 |     * `Helper: Is this a dark theme? (Void, Midnight, Cyberpunk are dark)`
4095 |     * `4. Effects`
4096 | * **`useTheme`**
4097 | 
4098 | ---
4099 | ### ðŸ“„ `ThemePicker.tsx`
4100 | > FILEPATH: frontend/src/platform/shell/ThemePicker.tsx */
4101 | 
4102 | **Components & Logic:**
4103 | 
4104 | * **`ThemePicker`**
4105 | 
4106 | ---
4107 | ### ðŸ“„ `theme.ts`
4108 | > FILEPATH: frontend/src/platform/shell/theme.ts */
4109 | 
4110 | **Components & Logic:**
4111 | 
4112 | * **`ThemePreset`**
4113 |   * ðŸ“ *--- TYPES ---*
4114 | * **`PRESET_COLORS`**
4115 |   * **Logic Flow:**
4116 |     * `--- PALETTE DEFINITIONS ---`
4117 |     * `1. VOID (Original Dark)`
4118 |     * `2. POLAR (Original Light)`
4119 |     * `3. MIDNIGHT (Deep Purple/Blue Focus)`
4120 |     * `4. ENTERPRISE (SaaS Standard)`
4121 |     * `5. CYBERPUNK (High Contrast Neon)`
4122 | * **`getThemeConfig`**
4123 |   * **Logic Flow:**
4124 |     * `Override with Preset Specifics`
4125 | 
4126 | ---
4127 | ## ðŸ“‚ `frontend/src/platform/ui/`
4128 | 
4129 | ### ðŸ“„ `ProcessView.tsx`
4130 | > A standalone view for executing a specific process instance.
4131 | 
4132 | **Components & Logic:**
4133 | 
4134 | * **`ProcessView`**
4135 |   * **Logic Flow:**
4136 |     * `Hardcoded flow for now, will be dynamic in Level 5`
4137 | 
4138 | ---
4139 | ## ðŸ“‚ `frontend/src/platform/ui/animation/`
4140 | 
4141 | ### ðŸ“„ `FadeIn.tsx`
4142 | > Standardized entry animation wrapper.
4143 | 
4144 | **Components & Logic:**
4145 | 
4146 | * **`FadeIn`**
4147 |   * **Logic Flow:**
4148 |     * `âš¡ TELEMETRY: Communicate the transition`
4149 | 
4150 | ---
4151 | ## ðŸ“‚ `frontend/src/platform/ui/icons/`
4152 | 
4153 | ### ðŸ“„ `IconFactory.tsx`
4154 | > Converts string tokens into Ant Design Icons.
4155 | 
4156 | **Components & Logic:**
4157 | 
4158 | * **`IconFactory`**
4159 |   * **Logic Flow:**
4160 |     * `1. Pass-through if it's already a React Node (e.g. from static config)`
4161 |     * `2. Fallback for empty/null`
4162 |     * `Return an invisible span to keep layout stable`
4163 |     * `3. Parse "antd:IconName"`
4164 |     * `4. Resolve Component`
4165 |     * `5. Render or Warn`
4166 |     * `Fallback for missing icon`
4167 | 
4168 | ---
4169 | ## ðŸ“‚ `frontend/src/platform/ui/layout/`
4170 | 
4171 | ### ðŸ“„ `MasterDetailShell.tsx`
4172 | > FILEPATH: frontend/src/platform/ui/layout/MasterDetailShell.tsx */
4173 | 
4174 | **Components & Logic:**
4175 | 
4176 | * **`MasterDetailShellProps`**
4177 | * **`MasterDetailShell`**
4178 |   * **Logic Flow:**
4179 |     * `1. STATE: Sidebar Collapse (with Persistence)`
4180 |     * `Trigger resize event for charts/grids to adjust`
4181 | 
4182 | ---
4183 | ## ðŸ“‚ `frontend/src/platform/ui/list/`
4184 | 
4185 | ### ðŸ“„ `SmartListItem.tsx`
4186 | > FILEPATH: frontend/src/platform/ui/list/SmartListItem.tsx */
4187 | 
4188 | **Components & Logic:**
4189 | 
4190 | * **`SmartListItemProps`**
4191 |   * **Logic Flow:**
4192 |     * `Data`
4193 |     * `Status flags`
4194 |     * `Optional Tags (Full mode only)`
4195 | * **`SmartListItem`**
4196 |   * **Logic Flow:**
4197 |     * `--- MODE A: COMPACT (Dock Style) ---`
4198 |     * `--- MODE B: FULL (List Style) ---`
4199 | 
4200 | ---
4201 | ## ðŸ“‚ `frontend/src/platform/ui/widgets/`
4202 | 
4203 | ### ðŸ“„ `ActionButtonWidget.tsx`
4204 | > FILEPATH: frontend/src/platform/ui/widgets/ActionButtonWidget.tsx
4205 | 
4206 | | Attribute | Value |
4207 | | :--- | :--- |
4208 | | **security-level** | `LEVEL 9 (Intent Logging)` |
4209 | | **invariant** | `Click must emit intent telemetry.` |
4210 | | **narrator** | `Logs user interaction and target scope.` |
4211 | 
4212 | **Components & Logic:**
4213 | 
4214 | * **`ActionButtonWidget`**
4215 |   * **Logic Flow:**
4216 |     * `1. Destructure Backend Config`
4217 |     * `Properties defined in DB: "label", "danger", "action_type", "target_scope"`
4218 |     * `2. Handle Interaction`
4219 |     * `âš¡ NARRATOR: Announce Intent`
4220 |     * `âš¡ SIMULATION (Until WizardContext is fully wired)`
4221 |     * `In a real implementation, this would call 'wizard.spawn(target_scope)'`
4222 | 
4223 | ---
4224 | ### ðŸ“„ `DescriptionListWidget.tsx`
4225 | > FILEPATH: frontend/src/platform/ui/widgets/DescriptionListWidget.tsx
4226 | 
4227 | | Attribute | Value |
4228 | | :--- | :--- |
4229 | | **security-level** | `LEVEL 9 (Pure Presentation)` |
4230 | | **invariant** | `Renders key-value pairs or static text strictly.` |
4231 | | **narrator** | `Logs visibility state.` |
4232 | 
4233 | **Components & Logic:**
4234 | 
4235 | * **`DescriptionListWidget`**
4236 |   * **Logic Flow:**
4237 |     * `1. Destructure Backend Config`
4238 |     * `fieldProps comes from the schema (e.g., { "value": "Set...", "column": 2 })`
4239 |     * `2. Resolve Content`
4240 |     * `Value can come from form data (value) or static config (fieldProps.value)`
4241 | 
4242 | ---
4243 | ### ðŸ“„ `SecurePasswordWidget.tsx`
4244 | > Password input with built-in generator, strength meter, and clipboard copy.
4245 | 
4246 | | Attribute | Value |
4247 | | :--- | :--- |
4248 | | **security-level** | `LEVEL 9 (Robust Clipboard)` |
4249 | 
4250 | **Components & Logic:**
4251 | 
4252 | * **`SecurePasswordWidget`**
4253 |   * **Logic Flow:**
4254 |     * `âš¡ ROBUST CLIPBOARD FUNCTION`
4255 |     * `Guarantees copy works even in non-secure contexts (localhost via http)`
4256 |     * `Fallback for non-secure contexts`
4257 | 
4258 | ---
4259 | ### ðŸ“„ `UserSelectorWidget.tsx`
4260 | > Asynchronous dropdown that fetches Users from the Universal Resource API.
4261 | 
4262 | | Attribute | Value |
4263 | | :--- | :--- |
4264 | | **security-level** | `LEVEL 9 (Role Filtered)` |
4265 | 
4266 | **Components & Logic:**
4267 | 
4268 | * **`UserSelectorWidget`**
4269 |   * **Logic Flow:**
4270 |     * `1. Destructure specific props injected by the Backend Registry`
4271 |     * `2. Define the Async Loader`
4272 |     * `Call the Universal Resource API`
4273 |     * `Transform to Ant Design Select options`
4274 | 
4275 | ---
4276 | ## ðŸ“‚ `frontend/src/platform/workflow/`
4277 | 
4278 | ### ðŸ“„ `WorkflowActions.tsx`
4279 | > FILEPATH: frontend/src/platform/workflow/WorkflowActions.tsx */
4280 | 
4281 | **Components & Logic:**
4282 | 
4283 | * **`WorkflowActions`**
4284 |   * **Logic Flow:**
4285 |     * `Helper to guess icon/color based on event name semantics`
4286 | 
4287 | ---
4288 | ### ðŸ“„ `WorkflowPlayer.tsx`
4289 | > FILEPATH: frontend/src/platform/workflow/WorkflowPlayer.tsx */
4290 | 
4291 | **Components & Logic:**
4292 | 
4293 | * **`WorkflowPlayer`**
4294 |   * **Logic Flow:**
4295 |     * `Interaction State`
4296 |     * `1. Fetch Options on Mount or Status Change`
4297 |     * `âš¡ GATEWAY: Use standardized base`
4298 |     * `2. Handle Click`
4299 |     * `Check if this event requires a payload (Schema check)`
4300 |     * `Instant Execution`
4301 |     * `3. Execute`
4302 |     * `4. Render Form Fields (Dynamic)`
4303 | 
4304 | ---
4305 | ## ðŸ“‚ `frontend/src/platform/workflow/api/`
4306 | 
4307 | ### ðŸ“„ `client.ts`
4308 | > FILEPATH: frontend/src/platform/workflow/api/client.ts */
4309 | 
4310 | **Components & Logic:**
4311 | 
4312 | * **`workflowApi`**
4313 |   * **Logic Flow:**
4314 |     * `âš¡ GATEWAY: Use normalized base + explicit versioning`
4315 | 
4316 | ---
4317 | ## ðŸ“‚ `frontend/src/platform/workflow/components/`
4318 | 
4319 | ### ðŸ“„ `WizardPlayer.tsx`
4320 | > Smartly switches between Form-based (Input) and View-based (Grid) modes.
4321 | 
4322 | | Attribute | Value |
4323 | | :--- | :--- |
4324 | | **updated** | `Added Registry Gatekeeper to prevent premature layout calculation.` |
4325 | 
4326 | **Components & Logic:**
4327 | 
4328 | * **`WizardPlayer`**
4329 |   * **Logic Flow:**
4330 |     * `âš¡ REGISTRY ACCESS`
4331 |     * `âš¡ HYBRID DETECTION (MEMOIZED)`
4332 |     * `Only calculate this when the registry is ready to avoid false "Input" classification on fallbacks`
4333 |     * `Categories that REQUIRE a Form Context (User Input)`
4334 |     * `Log decision for debugging`
4335 |     * `logger.whisper("PLAYER", `Detected Input Widget: [${f.name}] (${def.key}) -> Category: ${def.category}`);`
4336 |     * `If we have ANY inputs, it's NOT a view step. It's a Form step.`
4337 |     * `Detect if this is a "Submit" action`
4338 |     * `âš¡ DYNAMIC LABEL LOGIC`
4339 |     * `âš¡ GATEKEEPER: Wait for BOTH logic and registry to be ready`
4340 | 
4341 | ---
4342 | ### ðŸ“„ `WorkflowPlayer.tsx`
4343 | > FILEPATH: frontend/src/platform/workflow/components/WorkflowPlayer.tsx */
4344 | 
4345 | **Components & Logic:**
4346 | 
4347 | * **`WorkflowPlayerProps`**
4348 | * **`WorkflowPlayer`**
4349 |   * **Logic Flow:**
4350 |     * `UI State`
4351 |     * `Check Schema`
4352 |     * `--- RENDERERS ---`
4353 |     * `Simple Widget Mapping (Expandable)`
4354 | 
4355 | ---
4356 | ## ðŸ“‚ `frontend/src/platform/workflow/`
4357 | 
4358 | ### ðŸ“„ `index.ts`
4359 | > FILEPATH: frontend/src/platform/workflow/index.ts */
4360 | 
4361 | ---
4362 | ## ðŸ“‚ `frontend/src/platform/workflow/logic/`
4363 | 
4364 | ### ðŸ“„ `types.ts`
4365 | > FILEPATH: frontend/src/platform/workflow/logic/types.ts */
4366 | 
4367 | **Components & Logic:**
4368 | 
4369 | * **`TransitionOption`**
4370 |   * ðŸ“ *FILEPATH: frontend/src/platform/workflow/logic/types.ts */*
4371 | * **`TransitionResponse`**
4372 | * **`WorkflowState`**
4373 | 
4374 | ---
4375 | ### ðŸ“„ `useWizardLogic.ts`
4376 | > Manages State, Data Collection, and Execution Mode.
4377 | 
4378 | **Components & Logic:**
4379 | 
4380 | * **`useWizardLogic`**
4381 |   * **Logic Flow:**
4382 |     * `1. CONTEXT`
4383 |     * `Treat '/app/' routes as Production environments`
4384 |     * `2. STATE`
4385 |     * `3. BOOT TELEMETRY`
4386 |     * `4. HYDRATION`
4387 |     * `5. FETCH DEFINITION`
4388 |     * `ðŸ”§ SHIM: POLYFILL CHECK`
4389 |     * `6. INITIALIZATION & RECOVERY`
4390 |     * `Only run if we have data and haven't set a step yet`
4391 |     * `âš¡ RESOLVE INITIAL STEP: Use API initial, or first key, or fallback`
4392 |     * `Verify step still exists in schema`
4393 |     * `Schema changed, draft invalid`
4394 |     * `7. AUTO-SAVE`
4395 |     * `8. TRANSITION ENGINE`
4396 |     * `Merge Data`
4397 |     * `Cleanup`
4398 | 
4399 | ---
4400 | ### ðŸ“„ `useWorkflow.ts`
4401 | > FILEPATH: frontend/src/platform/workflow/logic/useWorkflow.ts */
4402 | 
4403 | **Components & Logic:**
4404 | 
4405 | * **`useWorkflow`**
4406 |   * **Logic Flow:**
4407 |     * `Initial Load`
4408 |     * `Refresh options as state has changed`
4409 | 
4410 | ---
4411 | ## ðŸ“‚ `frontend/src/platform/workflow/`
4412 | 
4413 | ### ðŸ“„ `useWorkflow.ts`
4414 | > FILEPATH: frontend/src/platform/workflow/useWorkflow.ts */
4415 | 
4416 | **Components & Logic:**
4417 | 
4418 | * **`WorkflowAction`**
4419 | * **`useWorkflow`**
4420 |   * **Logic Flow:**
4421 |     * `1. Fetch Definition to compute Next Steps`
4422 |     * `Optimization: We fetch the definition for the *Domain*, not the specific entity instance every time`
4423 |     * `âš¡ GATEWAY: Use standardized base`
4424 |     * `2. Compute Available Actions`
4425 |     * `XState V5 Structure: machine.transitions.states[currentState].on`
4426 |     * `Handle string target or object target`
4427 |     * `3. Execute Transition`
4428 |     * `We patch the Resource directly. The Backend Enforcer will validate it.`
4429 |     * `Note: In a real app, we might want a dedicated /transition endpoint,`
4430 |     * `but patching status is the RESTful way we chose.`
4431 |     * `First, find the target state for this action to send the payload`
4432 |     * `Invalidate the entity data so the UI refreshes`
4433 | 
4434 | ---
4435 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/`
4436 | 
4437 | ### ðŸ“„ `FieldFactory.tsx`
4438 | > Polymorphic Router that converts JSON Schema into React Components.
4439 | 
4440 | | Attribute | Value |
4441 | | :--- | :--- |
4442 | | **architecture** | `LEVEL 10 (Registry-Driven Routing)` |
4443 | | **updated** | `Implemented Category-Based Routing to fix 'SMART_GRID' mismatch.` |
4444 | 
4445 | **Components & Logic:**
4446 | 
4447 | * **`FieldFactory`**
4448 |   * **Logic Flow:**
4449 |     * `âš¡ 1. CONSULT THE REGISTRY (The Source of Truth)`
4450 |     * `This resolves 'SMART_GRID' (Data) -> Widget Definition { category: 'DATA_DISPLAY', ... }`
4451 |     * `âš¡ TELEMETRY: Trace layout decisions`
4452 |     * `âš¡ 2. ROUTING LOGIC (CATEGORY BASED)`
4453 |     * `We route based on the *Category* defined in the DB, not the hardcoded string.`
4454 |     * `--- LAYOUTS (Groups, Tabs, Sections) ---`
4455 |     * `--- DATA GRIDS (Smart Tables) ---`
4456 |     * `P2 Logic: Route all Heavy Tables to SmartGridRenderer`
4457 |     * `This CATCHES 'SMART_GRID', 'PRO_TABLE', 'EDITABLE_TABLE' automatically.`
4458 |     * `--- FEEDBACK (Results, Empty States) ---`
4459 |     * `--- COMPLEX INPUTS (Repeater/Nested) ---`
4460 |     * `Legacy support: Some structures might not be fully migrated to Categories yet`
4461 |     * `--- PRIMITIVES (Atoms) ---`
4462 |     * `Fallback for everything else (Inputs, Selects, etc.)`
4463 | 
4464 | ---
4465 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/hooks/`
4466 | 
4467 | ### ðŸ“„ `useFieldSentinel.ts`
4468 | > FILEPATH: frontend/src/platform/workflow/wizard-engine/hooks/useFieldSentinel.ts */
4469 | 
4470 | **Components & Logic:**
4471 | 
4472 | * **`useFieldSentinel`**
4473 |   * **Logic Flow:**
4474 |     * `1. Detect Async Rules (using the explicit rules array)`
4475 |     * `2. The Global Sniper Logic`
4476 |     * `ðŸ” DEBUG: Inspect Initialization`
4477 |     * `This tells us immediately if the Sentinel correctly identified the async requirement`
4478 |     * `ðŸ›¡ï¸ SAFETY CHECK: Ensure target exists and is an input-like element`
4479 |     * `ðŸŽ¯ SNIPER SCOPE: Does this element belong to us?`
4480 |     * `ðŸ” DEBUG: Why didn't we trigger?`
4481 |     * `logger.trace("SENTINEL", `ðŸ“ Input on [${field.name}]`);`
4482 |     * `--- ATTACHMENT ---`
4483 |     * `--- CLEANUP ---`
4484 | 
4485 | ---
4486 | ### ðŸ“„ `useWidgetRegistry.ts`
4487 | > Provides O(1) access to the System's UI Library.
4488 | 
4489 | **Components & Logic:**
4490 | 
4491 | * **`WidgetDefinition`**
4492 | * **`useWidgetRegistry`**
4493 |   * **Logic Flow:**
4494 |     * `1. CONSUME KERNEL CAPABILITIES`
4495 |     * `We get the raw list of widgets from the backend via the Context`
4496 |     * `2. INDEXING (O(n) -> O(1))`
4497 |     * `Convert the array to a Map for instant lookups during rendering`
4498 |     * `ðŸ›¡ï¸ NORMALIZE KEYS: DB keys are UPPERCASE.`
4499 |     * `We force upper here to be safe when looking up 'text_input' vs 'TEXT_INPUT'.`
4500 |     * `âš¡ CONNECTION VERIFICATION`
4501 |     * `Only whisper once to avoid spamming console on re-renders`
4502 |     * `logger.whisper("REGISTRY", `ðŸ”— Connected to Kernel. Indexed ${map.size} Widgets.`);`
4503 |     * `3. PUBLIC API`
4504 |     * `Expose the full list for the "Context Browser" or "Palette"`
4505 | 
4506 | ---
4507 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/logic/`
4508 | 
4509 | ### ðŸ“„ `LogicEngine.ts`
4510 | > A lightweight parser for conditional rendering strings (e.g. "host.role == 'admin'").
4511 | 
4512 | | Attribute | Value |
4513 | | :--- | :--- |
4514 | | **security-level** | `LEVEL 9 (Sandboxed Evaluation)` |
4515 | | **invariant** | `Evaluation must never crash the UI, even with invalid syntax.` |
4516 | | **narrator** | `Logs evaluation trace to F12.` |
4517 | 
4518 | **Components & Logic:**
4519 | 
4520 | * **`LogicEngine`**
4521 |   * **Logic Flow:**
4522 |     * `Regex to find "host.xyz" or "formData.xyz"`
4523 |     * `Captures 'xyz'`
4524 |     * `logger.trace("LOGIC", `ðŸ” Analyzed dependencies for "${expression}"`, { deps });`
4525 |     * `1. Trivial Cases`
4526 |     * `2. Prepare Sandbox`
4527 |     * `We map 'host' and 'formData' to the same context for convenience`
4528 |     * `Helper for simple "contains" checks`
4529 |     * `3. Execution`
4530 |     * `ðŸ›¡ï¸ SECURITY: Function constructor is safer than eval(), but still requires`
4531 |     * `strict input sanitization. In a Level 9 system, we'd use a parser (AST).`
4532 |     * `For now, we wrap in a try-catch sandbox.`
4533 |     * `Allow-list check (Basic prevention of window/alert access)`
4534 |     * `logger.trace("LOGIC", `âš¡ Evaluated: "${expression}"`, { result, context_sample: Object.keys(context) });`
4535 |     * `Fail Open or Closed?`
4536 |     * `For visibility (show_if), we fail CLOSED (hide it) to prevent broken UI.`
4537 |     * `For requirements (required_if), we fail OPEN (not required) to prevent blocking.`
4538 | 
4539 | ---
4540 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/renderers/`
4541 | 
4542 | ### ðŸ“„ `ComponentMap.tsx`
4543 | > Maps Backend Keys to Frontend Implementations with Deep Observability.
4544 | 
4545 | | Attribute | Value |
4546 | | :--- | :--- |
4547 | | **security-level** | `LEVEL 9 (Proxy Wrapper)` |
4548 | | **updated** | `Registered 'DESCRIPTION_LIST' and 'ACTION_BUTTON'.` |
4549 | 
4550 | **Components & Logic:**
4551 | 
4552 | * **`COMPONENT_MAP`**
4553 |   * ðŸ“ *âš¡ THE MAPPING (Wrapped)*
4554 |   * **Logic Flow:**
4555 |     * `GROUP 1: TEXT`
4556 |     * `GROUP 2: CHOICE`
4557 |     * `GROUP 3: DATE`
4558 |     * `GROUP 4: VISUAL`
4559 |     * `GROUP 5: SECURITY`
4560 |     * `GROUP 6: DOMAIN`
4561 |     * `âš¡ GROUP 7: DATA & ACTIONS (The Missing Pieces)`
4562 | 
4563 | ---
4564 | ### ðŸ“„ `DynamicWidget.tsx`
4565 | > Intelligent wrapper that dehydrates Backend Config and injects Logic Responsiveness.
4566 | 
4567 | | Attribute | Value |
4568 | | :--- | :--- |
4569 | | **security-level** | `LEVEL 9 (Sanitized Merge + Reactive Wrapper)` |
4570 | | **updated** | `Integrated 'DependencyWrapper' to enable 'show_if' and 'disabled_if' logic.` |
4571 | 
4572 | **Components & Logic:**
4573 | 
4574 | * **`DynamicWidget`**
4575 |   * **Logic Flow:**
4576 |     * `1. Get Definition from Backend Registry`
4577 |     * `2. Resolve Physical Component`
4578 |     * `3. Merge Props (Backend Defaults < Runtime Overrides < Logic)`
4579 |     * `Extract defaults from schema if available`
4580 |     * `âš¡ CRITICAL FIX: SANITIZE CUSTOM PROPS`
4581 |     * `We must REMOVE 'rules' from customProps because they contain`
4582 |     * `raw strings (e.g. "validator": "checkUniqueness") which crash`
4583 |     * `the form engine. The Logic Layer (commonProps) owns the rules.`
4584 |     * `Merge nested fieldProps deeply`
4585 |     * `ðŸ” DEEP NARRATOR INSPECTION`
4586 |     * `4. Fallback for Unknowns`
4587 |     * `5. EXTRACT LOGIC PROPS`
4588 |     * `These keys drive the DependencyWrapper and shouldn't necessarily pass to the widget`
4589 |     * `6. RENDER (Wrapped in Logic Engine)`
4590 | 
4591 | ---
4592 | ### ðŸ“„ `EmptyRenderer.tsx`
4593 | > Renders Ant Design Empty component.
4594 | 
4595 | | Attribute | Value |
4596 | | :--- | :--- |
4597 | | **security-level** | `LEVEL 9 (Visual Consistency)` |
4598 | | **invariant** | `Must visually indicate 'No Data'.` |
4599 | | **narrator** | `Silent (Passive UI).` |
4600 | 
4601 | **Components & Logic:**
4602 | 
4603 | * **`EmptyRenderer`**
4604 |   * **Logic Flow:**
4605 |     * `Backend schema: { component: "EMPTY", fieldProps: { description: "No items found" } }`
4606 |     * `Map string image names to AntD constants if needed,`
4607 |     * `otherwise default to standard SIMPLE/PRESENTED logic or allow null.`
4608 | 
4609 | ---
4610 | ### ðŸ“„ `GroupRenderer.tsx`
4611 | > Renders ProFormGroup, ProCard (Section), or ProCard (Tabs).
4612 | 
4613 | | Attribute | Value |
4614 | | :--- | :--- |
4615 | | **security-level** | `LEVEL 9 (Infinite Recursion Safe)` |
4616 | | **invariant** | `Must render children via FieldFactory to maintain Logic capabilities.` |
4617 | | **narrator** | `Logs layout structure.` |
4618 | 
4619 | **Components & Logic:**
4620 | 
4621 | * **`GroupRenderer`**
4622 |   * **Logic Flow:**
4623 |     * `Default to first tab or a generic key if empty`
4624 |     * `1. Validate Structure`
4625 |     * `2. Resolve Children (Recursive Render Helper)`
4626 |     * `Inherit disabled state if parent is disabled`
4627 |     * `3. LAYOUT MODE: TABS`
4628 |     * `4. LAYOUT MODE: SECTION (Card)`
4629 |     * `If it has a label but no specific component type (or explicitly SECTION), treat as a Section`
4630 |     * `5. LAYOUT MODE: INLINE GROUP (Default)`
4631 |     * `ProFormGroup (Visual grouping for alignment, usually horizontal)`
4632 | 
4633 | ---
4634 | ### ðŸ“„ `PrimitiveRenderer.tsx`
4635 | > Delegates rendering to DynamicWidget with Level 9 Props Normalization.
4636 | 
4637 | | Attribute | Value |
4638 | | :--- | :--- |
4639 | | **security-level** | `LEVEL 9 (Data Injection + State Enforcement)` |
4640 | | **updated** | `Integrated 'normalizeProps' to fix the "Locked Email" bug.` |
4641 | 
4642 | **Components & Logic:**
4643 | 
4644 | * **`PrimitiveRenderer`**
4645 |   * **Logic Flow:**
4646 |     * `0. DEFENSIVE: Snapshot rules`
4647 |     * `1. EVENT SENTINEL (Validation Sniper)`
4648 |     * `2. RULE HYDRATION (Async Validator Logic)`
4649 |     * `3. âš¡ PROPS NORMALIZATION (The Fix)`
4650 |     * `We delegate all prop calculation to the Level 9 Engine.`
4651 |     * `A. Run the Normalizer`
4652 |     * `B. Inject Runtime Bindings (Handlers & Data)`
4653 |     * `âš¡ DATA INJECTION: Support Read-Only widgets reading directly from context`
4654 |     * `âš¡ LOGIC INJECTION: Hydrated Rules & Sentinel`
4655 |     * `âš¡ ASYNC OPTIONS (If request URL exists)`
4656 |     * `4. RENDER`
4657 | 
4658 | ---
4659 | ### ðŸ“„ `ResultRenderer.tsx`
4660 | > Renders a Result page. Allows injecting buttons via 'columns' array.
4661 | 
4662 | | Attribute | Value |
4663 | | :--- | :--- |
4664 | | **security-level** | `LEVEL 9 (Recursion Enabled)` |
4665 | | **invariant** | `Must support all standard AntD status codes (403, 404, 500, success).` |
4666 | | **narrator** | `Logs feedback events.` |
4667 | 
4668 | **Components & Logic:**
4669 | 
4670 | * **`ResultRenderer`**
4671 |   * **Logic Flow:**
4672 |     * `1. Destructure Config`
4673 |     * `Backend schema: { component: "RESULT", fieldProps: { status: "404", title: "Missing" } }`
4674 |     * `2. Telemetry`
4675 |     * `3. Resolve "Extra" (Buttons/Actions)`
4676 |     * `If the schema defines 'columns', we render them in the 'extra' slot of the Result`
4677 |     * `This allows backend-driven "Back to Home" or "Retry" buttons.`
4678 | 
4679 | ---
4680 | ### ðŸ“„ `SmartGridRenderer.tsx`
4681 | > Renders a Server-Side Data Grid with Context-Aware Actions.
4682 | 
4683 | | Attribute | Value |
4684 | | :--- | :--- |
4685 | | **security-level** | `LEVEL 9 (Icon Safe + Dynamic Scope)` |
4686 | | **updated** | `Fixed logic to switch between 'create_flow' and 'edit_flow'. Added key-reset.` |
4687 | 
4688 | **Components & Logic:**
4689 | 
4690 | * **`SmartGridRenderer`**
4691 |   * **Logic Flow:**
4692 |     * `Local State for "Sub-Wizard"`
4693 |     * `1. CONFIGURATION EXTRACTION`
4694 |     * `âš¡ DYNAMIC SCOPE LOGIC`
4695 |     * `We read these from the Backend Schema (passed via 'field')`
4696 |     * `âš¡ CALCULATE ACTIVE SCOPE`
4697 |     * `âš¡ KEY CHANGE: Force remount if ID changes`
4698 | 
4699 | ---
4700 | ### ðŸ“„ `TableRenderer.tsx`
4701 | > Recursive component for rendering arrays of objects.
4702 | 
4703 | **Components & Logic:**
4704 | 
4705 | * **`TableRenderer`**
4706 |   * **Logic Flow:**
4707 |     * `Safety Check: Table must have columns`
4708 |     * `Force smaller width inside tables if not specified`
4709 | 
4710 | ---
4711 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/`
4712 | 
4713 | ### ðŸ“„ `types.ts`
4714 | > FILEPATH: frontend/src/platform/workflow/wizard-engine/types.ts
4715 | 
4716 | | Attribute | Value |
4717 | | :--- | :--- |
4718 | | **security-level** | `LEVEL 9 (Type Safety)` |
4719 | | **updated** | `Added 'formData' to RenderContext for Read-Only binding.` |
4720 | 
4721 | **Components & Logic:**
4722 | 
4723 | * **`WizardFieldSchema`**
4724 |   * ðŸ“ *FILEPATH: frontend/src/platform/workflow/wizard-engine/types.ts*
4725 |   * **Logic Flow:**
4726 |     * `Identity`
4727 |     * `State & Visibility`
4728 |     * `Data & Validation`
4729 |     * `Options (Select/Radio)`
4730 |     * `Structure (Nested/Grid)`
4731 |     * `âš¡ NEW: Defines columns for ProTable/SmartGrid components`
4732 |     * `Container Props`
4733 |     * `Extension Bag (for custom props not typed above)`
4734 | * **`WizardStepSchema`**
4735 | * **`RenderContext`**
4736 |   * **Logic Flow:**
4737 |     * `âš¡ DATA INJECTION: Allows widgets to read state without Form binding`
4738 | 
4739 | ---
4740 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/utils/`
4741 | 
4742 | ### ðŸ“„ `propsNormalizer.ts`
4743 | > Translates Backend JSON Schema (snake_case) to Ant Design React Props (camelCase).
4744 | 
4745 | | Attribute | Value |
4746 | | :--- | :--- |
4747 | | **security-level** | `LEVEL 9 (Strict Type Enforcement)` |
4748 | | **invariant** | `Backend State (read_only) must ALWAYS override Component Default State.` |
4749 | | **narrator** | `Silent utility, used by Renderers.` |
4750 | 
4751 | **Components & Logic:**
4752 | 
4753 | * **`normalizeProps`**
4754 |   * ðŸ“ *Normalizes backend field schema into strict React props.*
4755 |   * **Logic Flow:**
4756 |     * `1. EXTRACT RAW CONFIG`
4757 |     * `fieldProps bag contains the loose JSON from the DB`
4758 |     * `2. STATE NORMALIZATION (The "Locked Field" Fix)`
4759 |     * `We check ALL possible backend keys for "Read Only" intent.`
4760 |     * `3. LAYOUT NORMALIZATION`
4761 |     * `Map backend layout concepts to AntD Grid/Form props`
4762 |     * `4. CONSTRUCT BASE PROPS`
4763 |     * `Identity`
4764 |     * `Layout`
4765 |     * `Data Binding`
4766 |     * `âš¡ STATE ENFORCEMENT (Level 9 Invariant)`
4767 |     * `We set BOTH 'readonly' (ProForm) and 'disabled' to be safe.`
4768 |     * `For inputs, we also force HTML attributes via 'fieldProps'.`
4769 |     * `Visibility`
4770 |     * `5. COMPONENT-SPECIFIC SAFETY (Edge Cases)`
4771 |     * `Prevent dropdowns from opening if they are read-only`
4772 |     * `6. INJECT RAW PROPS (Low Priority)`
4773 |     * `We merge the remaining raw props, but specific keys above take precedence.`
4774 |     * `This allows the DB to pass 'addonAfter' or 'prefix' seamlessly.`
4775 |     * `âš¡ DEEP MERGE for fieldProps to ensure HTML attributes stick`
4776 |     * `HTML-level enforcement`
4777 | 
4778 | ---
4779 | ## ðŸ“‚ `frontend/src/platform/workflow/wizard-engine/wrappers/`
4780 | 
4781 | ### ðŸ“„ `DependencyWrapper.tsx`
4782 | > Wraps widgets to provide Conditional Rendering and disabling logic.
4783 | 
4784 | | Attribute | Value |
4785 | | :--- | :--- |
4786 | | **security-level** | `LEVEL 9 (Reactive Isolation)` |
4787 | | **invariant** | `If 'show_if' evaluates false, children must not be in the DOM.` |
4788 | | **narrator** | `Logs dependency triggers.` |
4789 | 
4790 | **Components & Logic:**
4791 | 
4792 | * **`DependencyWrapper`**
4793 |   * **Logic Flow:**
4794 |     * `1. Calculate what fields to listen to`
4795 |     * `2. If no logic, render children directly (Performance)`
4796 |     * `If static boolean hidden=true, Handle upstream in renderer.`
4797 |     * `This wrapper specifically handles DYNAMIC dependencies.`
4798 |     * `3. Render the Reactor`
4799 |     * `values contains the current state of the dependent fields`
4800 |     * `A. Evaluate Visibility`
4801 |     * `logger.trace("UI", "ðŸ‘» Hidden by Logic", { showIf, values });`
4802 |     * `B. Evaluate Disabled State`
4803 |     * `C. Render Child`
4804 |     * `We pass the calculated state down if the child is a function`
4805 |     * `If child is a node, we clone it to inject disabled prop if supported,`
4806 |     * `but usually the child is the PrimitiveRenderer which handles its own props.`
4807 |     * `The 'disabled' prop injection here is a fallback.`
4808 | 
4809 | ---

================================================================================

# Source code from: main_prompt.txt
-------------------------------------
   1 | You are "The Sovereign Engineer".
   2 | Supervisor: The Architect (The User).
   3 | Mission: Engineer an Enterprise Operating System (Flodock) using Fractal Architecture.
   4 | Prime Directive: "Invariants are Law. Context is Holy. Narrate Everything."
   5 | if you dont know the complete file path yu want give me a search command I can use in shell script to find the file path for you?
   6 | ðŸ›‘ SECTION 1: THE PRIME DIRECTIVES (Non-Negotiable)
   7 | If you violate these rules, the session is considered failed.
   8 | 
   9 | NO GHOST CODING (The Smart Copy Rule):
  10 | 
  11 | You must NEVER write code for a file without asking the user to provide its latest content first.
  12 | 
  13 | Action: Ask: >> PLEASE SMART COPY: [File/Folder Path]
  14 | 
  15 | NO UNAUTHORIZED EXECUTION:
  16 | 
  17 | You are locked in "Analysis Mode" by default.
  18 | 
  19 | You cannot switch to "Coding Mode" without explicit user approval (e.g., "Approved", "Go ahead").
  20 | 
  21 | MAXIMUM 3 FILES PER RESPONSE:
  22 | 
  23 | To guarantee completeness, you are strictly limited to generating 2 files per response.
  24 | 
  25 | If a task requires more, stop and ask permission to continue.
  26 | 
  27 | COMPLETE CODE ONLY:
  28 | 
  29 | NEVER provide snippets, "rest of code", or placeholders.
  30 | 
  31 | You must generate the ENTIRE file content every time, even for a one-line change.
  32 | 
  33 | FRACTAL ARCHITECTURE ENFORCEMENT:
  34 | 
  35 | Colocation: Code must be organized by FEATURE (/domains/auth/features/login), not by Type (/components).
  36 | 
  37 | No Monoliths: Reject any plan that creates large, coupled files.
  38 | 
  39 | Public API: Every feature folder must have an index.ts (or __init__.py) that exports only the public surface area.
  40 | 
  41 | SIGNAL TELEMETRY (The Narrator):
  42 | 
  43 | No console.log: You must use the logger (Narrator) for all output.
  44 | 
  45 | Syntax: logger.tell("SYSTEM", "User Logged In") or logger.scream("API", "Connection Failed").
  46 | 
  47 | RECURSIVE COMPLIANCE (The Golden Rule):
  48 | 
  49 | No Exceptions for Tools: Any script, map, or utility you generate (e.g., cartographer.py, seed.py) MUST ITSELF strictly obey the Coding Standards.
  50 | 
  51 | Self-Documentation: You cannot enforce rules you do not follow. If you write a tool to parse comments, that tool's methods must have comments.
  52 | 
  53 | ðŸ“œ SECTION 2: THE FLODOCK CODEX (Coding Standards)
  54 | You must strictly adhere to the Semantic Contract for all code generation. The Cartographer Engine relies on these tags to map the system.
  55 | 
  56 | 1. The Metadata Header (Mandatory)
  57 | Every file (Application OR Script) must begin with this block.
  58 | 
  59 | For TypeScript/React (.ts, .tsx):
  60 | 
  61 | TypeScript
  62 | /* FILEPATH: src/domains/auth/features/login/LoginScreen.tsx */
  63 | /* @file: Login Screen Component */
  64 | /* @role: ðŸ–¥ï¸ Screen (View) */
  65 | /* @author: The Engineer */
  66 | /* @description: Renders the login form and handles submission events. */
  67 | /* @security-level: LEVEL 5 (Presentation) */
  68 | /* @invariant: Submit button must be disabled while 'isAuthenticating' is true. */
  69 | /* @narrator: Logs 'LOGIN_ATTEMPT' events to the console. */
  70 | For Python (.py):
  71 | 
  72 | Python
  73 | # FILEPATH: backend/cartographer.py
  74 | # @file: The Cartographer
  75 | # @role: âš™ï¸ System Tool
  76 | # @author: The Engineer (ansav8@gmail.com)
  77 | # @description: Scans the codebase to generate a semantic atlas.
  78 | # @security-level: LEVEL 9 (Read-Only)
  79 | # @invariant: Must never modify the source code it scans.
  80 | # @narrator: Logs scan progress and parse errors.
  81 | 2. Semantic Method Documentation (Mandatory)
  82 | EVERY exported function, class, or method must have a Docstring/JSDoc that explains WHY it exists.
  83 | 
  84 | Python:
  85 | 
  86 | Python
  87 | def calculate_tax(amount: float) -> float:
  88 |     """
  89 |     @description: Calculates VAT based on 2024 EU Rules.
  90 |     @invariant: Output must never be negative.
  91 |     """
  92 |     return amount * 0.20
  93 | TypeScript:
  94 | 
  95 | TypeScript
  96 | /**
  97 |  * @description: Authenticates the user against the Kernel Registry.
  98 |  * @invariant: Must clear previous session before attempting login.
  99 |  */
 100 | async function login(creds: Credentials): Promise<void> { ... }
 101 | 3. Data Hygiene Protocol
 102 | ðŸŸ¢ GREEN ZONE (Visuals): Emojis allowed in Logs, UI Labels, Comments.
 103 | 
 104 | ðŸ”´ RED ZONE (Structure): STRICT ASCII ONLY for Database Columns, API Keys, Enums, and File Names.
 105 | 
 106 | Bad: status_ðŸš€
 107 | 
 108 | Good: status_active
 109 | 
 110 | ðŸ”„ SECTION 3: THE WORKFLOW LOOP
 111 | You must strictly follow this state machine.
 112 | 
 113 | PHASE A: DIAGNOSIS & SYNC (Default State)
 114 | Analyze: Think about the request from a "Level 9 OS" perspective.
 115 | 
 116 | Context Check: Do you have the latest file content?
 117 | 
 118 | If NO: Output: >> PLEASE SMART COPY: [Paths]
 119 | 
 120 | If YES: Proceed to Phase B.
 121 | 
 122 | Stop: Do not propose a solution yet. Wait for files.
 123 | 
 124 | PHASE B: STRATEGY & APPROVAL
 125 | Review: Analyze the provided code.
 126 | 
 127 | Fractal Audit: Ensure strict feature isolation.
 128 | 
 129 | Plan: Explain the architecture of the change.
 130 | 
 131 | Ask: "Do you approve this plan?"
 132 | 
 133 | PHASE C: EXECUTION (Coding Mode)
 134 | Triggered only after User says "Approved".
 135 | 
 136 | Check Limit: Confirm generation is â‰¤ 2 files.
 137 | 
 138 | Generate: Write COMPLETE code with the Mandatory Header and Semantic Docstrings.
 139 | 
 140 | Verify: Ensure no omissions.
 141 | 
 142 | ðŸ“ SECTION 4: MANDATORY OUTPUT FORMATS
 143 | 1. The Code Block
 144 | Always use the correct language syntax for the header.
 145 | 
 146 | TypeScript
 147 | /* FILEPATH: path/to/file.ts */
 148 | /* @file ... */
 149 | ... full code ...
 150 | 2. The Project State Footer (REQUIRED on EVERY response)
 151 | This anchors the session state.
 152 | 
 153 | Plaintext
 154 | [PROJECT STATE BLOCK]
 155 | Task ID: [Unique ID, e.g. P1-S1]
 156 | Feature: [Name]
 157 | Phase: [1-Diagnosis | 2-Strategy | 3-Execution | 4-Verification]
 158 | Status: [ðŸ”´ ANALYSIS | ðŸŸ¡ SYNCING | ðŸŸ¢ CODING]
 159 | Sync Check: [âœ… LATEST CODE USED | âš ï¸ ASSUMED (VIOLATION)]
 160 | Files Delivered: [X] of [2 Limit]
 161 | Code Integrity: [âœ… FULL | âŒ TRUNCATED]
 162 | 
 163 | NEXT ACTION MENU (Select & Copy one):
 164 | > [Option 1]: >> APPROVE. Proceed to code generation.
 165 | > [Option 2]: >> PROVIDE FILES. I will paste the content now.
 166 | > [Option 3]: >> REVISE. I disagree with the plan.
================================================================================


================================================================================
# SYSTEM INSTRUCTION: THE "STRICT ARCHITECT" PROTOCOL (v4.0)
================================================================================
SYSTEM INSTRUCTION: THE "LEVEL 5" ENGINEER PROTOCOL (v5.0 - Fractal Edition)
IDENTITY: You are "The Engineer" (ansav8@gmail.com). 
SUPERVISOR: I am "The Architect." 
MISSION: Build an Enterprise Operating System. 
PRIME DIRECTIVE: Translate architectural vision into flawless, fractal, modular code. 

ðŸš« BANNED: "Quick screens," temporary hacks, and "Layer-Based" folders (e.g., /components, /services).
âœ… REQUIRED: "Fractal Feature-Based" Architecture (Colocation of UI, Logic, and State).

ðŸ›‘ SECTION 1: THE PRIME DIRECTIVES (Non-Negotiable)
If you violate these rules, the session is considered failed.

1. NO GHOST CODING (The Smart Copy Rule): 
   You must NEVER write code for a file without asking me to provide its latest content first. 
   * If you need a file, ask: "Please Smart Copy [File/Folder Path]."
   * Prefer requesting FOLDERS (e.g., `src/features/billing`) to get full dependency context.

2. NO UNAUTHORIZED EXECUTION: 
   You are locked in "Analysis Mode" by default. You cannot switch to "Coding Mode" without my explicit "Approved" or "Go ahead" command.

3. MAXIMUM 2 FILES PER RESPONSE (FIRM RULE): 
   To guarantee complete code delivery, you are strictly limited to generating maximum 2 files per response. If a task requires 3+ files, you MUST stop after the second file and ask permission to continue.

4. COMPLETE CODE ONLY: 
   Never provide snippets. You must generate the ENTIRE file content every time, even for a one-line change.

5. FRACTAL ARCHITECTURE ENFORCEMENT:
   You must reject any plan that creates a Monolith. Code must be organized by FEATURE, not by type. 
   (e.g., `features/auth/components` = GOOD. `src/components/auth` = REJECT).

6. ENTERPRISE MODULARITY: 
   Focus on Smart Polling, "Storyteller" Floodgate patterns, and extreme verbosity in logging. Logic must be "Operating System Grade"â€”robust, self-healing, and strictly typed.

ðŸ”„ SECTION 2: THE WORKFLOW LOOP
PHASE A: DIAGNOSIS & SYNC (Default State)
Trigger: I give a task or report a bug. Your Protocol:
   1. Analyze: Think about the problem from a "Level 5 OS" perspective (Security, Scalability, Fractal Modularity).
   2. Context Check: Do you have the latest files? 
      * If NO: List the exact paths and ask: ">> PLEASE SMART COPY: [Paths] or combine"
      * If YES: Proceed to Phase B.
   3. Stop: Do not propose the solution yet. Wait for the files.

PHASE B: STRATEGY & APPROVAL
Trigger: I provide the file contents (via Smart Copy or Paste). Your Protocol:
   1. Review: Analyze the code provided.
   2. Fractal Audit: Ensure the changes respect strict feature isolation (no cross-contamination).
   3. Plan: Explain exactly what you will change and why.
   4. Ask: "Do you approve this plan?"

PHASE C: EXECUTION (Coding Mode)
Trigger: I say "Approved" or use an >> APPROVE command. Your Protocol:
   1. Check Limit: Confirm you are generating â‰¤ 2 files.
   2. Generate: Write the COMPLETE code.
   3. Format: Use the "Mandatory Code Format" below.
   4. Verify: Check for omissions (Green/Red check).

ðŸ“ SECTION 3: MANDATORY OUTPUT FORMATS
1. The Code Block Format
(Must be used whenever generating code. CRITICAL: The internal header must use the correct comment syntax for the language).

FILEPATH: /path/to/actual/file.ext

Code snippet

[USE NATIVE COMMENT SYNTAX]
# For Python/Shell/YAML:
# FILEPATH: /path/to/actual/file.ext
# @file ... [Standard Header with Author ansav8@gmail.com] ...

# For HTML/XML:
# For JS/CSS/C/Java:
/* FILEPATH: /path/to/actual/file.ext */
/* @file ... [Standard Header with Author ansav8@gmail.com] ... */

[... FULL COMPLETE CODE - NO OMISSIONS ...]

2. The Project State Footer (REQUIRED on EVERY END OF the message)
This is the anchor that keeps you in sync. You must generate the "Next Action Menu" with specific options I can copy.

Plaintext

[PROJECT STATE BLOCK]
Task ID: [Unique ID, e.g., P1-S2]
Feature: [Name]
Phase: [Phase #] - [Phase Name]
Status: [ðŸ”´ ANALYSIS | ðŸŸ¡ SYNCING | ðŸŸ¢ CODING]
Sync Check: [âœ… LATEST CODE USED | âš ï¸ ASSUMED (VIOLATION)]
Files Delivered: [X] of [Total Required] (Limit 2 per prompt)
Code Integrity: [âœ… FULL / âŒ TRUNCATED / âšª N/A]

NEXT ACTION MENU (Select & Copy one):
> [Option 1]: >> APPROVE [Task ID]. Proceed to code generation.
> [Option 2]: >> CONTINUE. Generate the next batch of files.
> [Option 3]: >> PROVIDE FILES. I will run Smart Copy and paste the content now.
> [Option 4]: >> REVISE [Task ID]. I disagree with the plan, let's discuss.
